pfad$=DIR$(0)
PAUSE 10
DO
  FILESELECT pfad$+"\*.*","",a$
  EXIT IF a$="\" OR a$=""
  OPEN "U",#1,a$
  c$=""
  d1$=""
  WHILE NOT EOF(#1)
    LINE INPUT #1,b$
    PRINT b$
    IF INSTR(b$,"schirmtext") AND d1$<>""
      @save
    ENDIF
    IF INSTR(b$,"zungsdaten")
      d1$="BTX            am: "+MID$(b$,33,6)+"19"+MID$(b$,39,2)
      LINE INPUT #1,b$
      PRINT b$
      d1$=d1$+MID$(b$,35,6)+":59"
    ENDIF
    IF INSTR(b$,"Verbindungsdauer")
      IF MID$(b$,31,1)=" "
        MID$(b$,31,1)="0"
      ENDIF
      d$=MID$(b$,31,5)+":59"
      d=VAL(MID$(d$,7,2))+VAL(MID$(d$,4,2))*60+VAL(MID$(d$,1,2))*3600
      d1$=d1$+" "+d$
      d$=STR$(d)
      WHILE LEN(d$)<6
        d$=" "+d$
      WEND
      d1$=d1$+" "+d$
      d1%=(d/480)+1
      d$=STR$(d1%)
      WHILE LEN(d$)<2
        d$=" "+d$
      WEND
      d1$=d1$+" "+d$
      d1%=(d/640)+1
      d$=STR$(d1%)
      WHILE LEN(d$)<2
        d$=" "+d$
      WEND
      d1$=d1$+" "+d$
    ENDIF
    IF INSTR(b$,"seiten")
      MID$(b$,35,1)="."
      b=VAL(MID$(b$,32,6))
    ENDIF
    IF INSTR(b$,"zeitabh")
      MID$(b$,35,1)="."
      b=b+VAL(MID$(b$,32,6))
    ENDIF
    IF INSTR(b$,"reg. Seiten")
      MID$(b$,35,1)="."
      b=b+VAL(MID$(b$,32,6))
      r=VAL(MID$(b$,11,2))
      r$=STR$(r)
      IF LEN(r$)<2
        r$=" "+r$
      ENDIF
    ENDIF
    IF INSTR(b$,"Mitteilungen")
      MID$(b$,35,1)="."
      b=b+VAL(MID$(b$,32,6))
      be$=STR$(b*100)
      WHILE LEN(be$)<4
        be$="0"+be$
      WEND
      be$=MID$(be$,1,2)+","+MID$(be$,3,2)
      m=VAL(MID$(b$,11,2))
      m$=STR$(m)
      IF LEN(m$)<2
        m$=" "+m$
      ENDIF
      d1$=d1$+"  Betrag: "+be$+" "+r$+m$
    ENDIF
  WEND
  CLOSE #1
  IF d1$<>""
    @save
  ENDIF
LOOP
PROCEDURE save
  IF EXIST(pfad$+"\gebÅhren.btx")
    OPEN "R",#2,pfad$+"\gebÅhren.btx",82
    FIELD #2,82 AS qq$
    flag%=0
    start=0
    WHILE NOT EOF(#2)
      INC start
      GET #1,start
      IF MID$(d1$,1,34)=MID$(qq$,1,34)
        flag%=1
        qq$=MID$(qq$,1,60)+MID$(d1$,61,20)+CHR$(13)+CHR$(10)
        PUT #2,start
      ENDIF
      EXIT IF flag%=1
    WEND
    IF flag%=0
      qq$=d1$+CHR$(13)+CHR$(10)
      PUT #2,start+1
    ENDIF
  ELSE
    OPEN "O",#2,pfad$+"\gebÅhren.btx"
    PRINT #2,"Mailbox                  Online-Zeit        GebÅhreneinheiten im"
    PRINT #2,"                        Datum     Zeit  Minuten   Sek.  8 12  BTX-GebÅhren   R M"
    PRINT #2,"---------------    ---------- --------  ------- ------ -- --  ------------------"
    PRINT #2,d1$
  ENDIF
  CLOSE #1
  d1$=""
RETURN
