pfad$=DIR$(0)
PAUSE 10
DIM a$(500),b$(500),c$(500)
datei$=pfad$+"\gebÅhren.btx"
OPEN "U",#1,datei$
i=0
PRINT "Datei wird eingelesen..."
WHILE NOT EOF(#1)
  LINE INPUT #1,a$
  IF MID$(a$,1,3)="BTX" OR MID$(a$,1,3)="Dat" OR MID$(a$,1,3)="Fre"
    INC i
    a$(i)=a$
  ELSE
    INC x
    b$(x)=a$
  ENDIF
WEND
CLOSE
PRINT
PRINT "Daten werden sortiert..."
FOR ii=1 TO i
  WHILE LEN(a$(ii))<80
    a$(ii)=a$(ii)+" "
  WEND
  a$(ii)=MID$(a$(ii),1,80)
  a$=a$(ii)
  b$=MID$(a$,20,10)
  b=VAL(MID$(b$,7,4))*365+VAL(MID$(b$,4,2))*31+VAL(MID$(b$,1,2))
  b$=STR$(b)
  c$=MID$(a$,31,8)
  c=VAL(MID$(c$,1,2))*3600+VAL(MID$(c$,4,2))*60+VAL(MID$(c$,7,2))
  c$=STR$(c)
  WHILE LEN(c$)<5
    c$="0"+c$
  WEND
  a$(ii)=b$+c$+a$(ii)
NEXT ii
quicksort(1,i)
FOR ii=1 TO i
  a$(ii)=MID$(a$(ii),12,80)
NEXT ii
start$=MID$(a$(1),23,2)
PRINT
PRINT "Welcher Monat soll aus der Datei 'GEBöHREN.BTX' herausgenommen werden ?"
PRINT "(Eingaben von 01 - 12, Default-Monat ist ";start$;") ";
INPUT start1$
PRINT
PRINT "Jahreszahl eingeben ";
INPUT jahr1$
IF jahr1$=""
  jahr1$=MID$(DATE$,9,2)
ENDIF
IF start1$=""
  start1$=start$
ENDIF
start$=start1$
IF start$="01"
  mon$="JAN"
ENDIF
IF start$="02"
  mon$="FEB"
ENDIF
IF start$="03"
  mon$="MéR"
ENDIF
IF start$="04"
  mon$="APR"
ENDIF
IF start$="05"
  mon$="MAI"
ENDIF
IF start$="06"
  mon$="JUN"
ENDIF
IF start$="07"
  mon$="JUL"
ENDIF
IF start$="08"
  mon$="AUG"
ENDIF
IF start$="09"
  mon$="SEP"
ENDIF
IF start$="10"
  mon$="OKT"
ENDIF
IF start$="11"
  mon$="NOV"
ENDIF
IF start$="12"
  mon$="DEZ"
ENDIF
FOR ii=1 TO i
  a$=a$(ii)
  IF MID$(a$,23,2)=start$
    a$(ii)=""
    c$(ii)=a$
  ENDIF
NEXT ii
PRINT
PRINT "Korrigierte Datei wird gesichert..."
OPEN "O",#1,datei$
FOR ii=1 TO x
  PRINT #1,b$(ii)
NEXT ii
FOR ii=1 TO i
  IF a$(ii)<>""
    PRINT #1,a$(ii)
  ENDIF
NEXT ii
CLOSE
PRINT
PRINT "Monatsdatei fÅr Monat: ";mon$;" wird angelegt..."
datei$=MID$(datei$,1,LEN(datei$)-3)+mon$
OPEN "O",#1,datei$
FOR ii=1 TO x
  PRINT #1,b$(ii)
NEXT ii
FOR ii=1 TO i
  IF c$(ii)<>""
    PRINT #1,c$(ii)
  ENDIF
NEXT ii
CLOSE
PRINT
PRINT "Monatsabschluû"
PRINT
PRINT "Monatswerte werden ermittelt..."
jahr$=datei$
jahr$=MID$(jahr$,1,LEN(jahr$)-3)+jahr1$
OPEN "R",#1,datei$,82
FIELD #1,82 AS qq$
ende%=LOF(#1)/82
start=0
anz1=0
anz2=0
anz3=0
WHILE start<ende%
  INC start
  GET #1,start
  IF MID$(qq$,1,3)="BTX" OR MID$(qq$,1,9)="Datacraft" OR MID$(qq$,1,5)="Freak"
    IF MID$(qq$,1,3)="BTX"
      INC anz1
      a=1
    ENDIF
    IF MID$(qq$,1,9)="Datacraft"
      INC anz2
      a=2
    ENDIF
    IF MID$(qq$,1,5)="Freak"
      INC anz3
      a=3
    ENDIF
    sek=sek+VAL(MID$(qq$,49,6))
    IF a=1
      sek1=sek1+VAL(MID$(qq$,49,6))
    ENDIF
    IF a=2
      sek2=sek2+VAL(MID$(qq$,49,6))
    ENDIF
    IF a=3
      sek3=sek3+VAL(MID$(qq$,49,6))
    ENDIF
    geb1=geb1+VAL(MID$(qq$,56,2))
    geb2=geb2+VAL(MID$(qq$,59,2))
    betrag=betrag+VAL(MID$(qq$,71,2))+VAL(MID$(qq$,74,2))/100
    reg=reg+VAL(MID$(qq$,77,2))
    mit=mit+VAL(MID$(qq$,79,2))
  ENDIF
WEND
PRINT
PRINT "... und gespeichert ..."
b$=STR$(anz1)
WHILE LEN(b$)<3
  b$="0"+b$
WEND
a$="BTX            "+b$
b$=STR$(sek1)
WHILE LEN(b$)<6
  b$="0"+b$
WEND
c=INT(sek1/60)
d=INT(sek1/3600)
e=INT(d*60)
f=c-e
d$=STR$(d)
WHILE LEN(d$)<2
  d$="0"+d$
WEND
f$=STR$(f)
WHILE LEN(f$)<2
  f$="0"+f$
WEND
e$=d$+":"+f$
aa$="  Dauer:    "+b$+"  Stunden: "+e$
qq$="Login:  "+a$+" mal "+aa$
WHILE LEN(qq$)<80
  qq$=qq$+" "
WEND
qq$=qq$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qq$
PUT #1,start+1
b$=STR$(anz2)
WHILE LEN(b$)<3
  b$="0"+b$
WEND
a$="Datacraft      "+b$
b$=STR$(sek2)
WHILE LEN(b$)<6
  b$="0"+b$
WEND
c=INT(sek2/60)
d=INT(sek2/3600)
e=INT(d*60)
f=c-e
d$=STR$(d)
WHILE LEN(d$)<2
  d$="0"+d$
WEND
f$=STR$(f)
WHILE LEN(f$)<2
  f$="0"+f$
WEND
e$=d$+":"+f$
aa$="  Dauer:    "+b$+"  Stunden: "+e$
qq$="Login:  "+a$+" mal "+aa$
WHILE LEN(qq$)<80
  qq$=qq$+" "
WEND
qq$=qq$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qx$+qq$
PUT #1,start+2
b$=STR$(anz3)
WHILE LEN(b$)<3
  b$="0"+b$
WEND
a$="Freak          "+b$
b$=STR$(sek3)
WHILE LEN(b$)<6
  b$="0"+b$
WEND
c=INT(sek3/60)
d=INT(sek3/3600)
e=INT(d*60)
f=c-e
d$=STR$(d)
WHILE LEN(d$)<2
  d$="0"+d$
WEND
f$=STR$(f)
WHILE LEN(f$)<2
  f$="0"+f$
WEND
e$=d$+":"+f$
aa$="  Dauer:    "+b$+"  Stunden: "+e$
qq$="Login:  "+a$+" mal "+aa$
WHILE LEN(qq$)<80
  qq$=qq$+" "
WEND
qq$=qq$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qx$+qq$
PUT #1,start+3
b$=STR$(sek)
WHILE LEN(b$)<6
  b$="0"+b$
WEND
c=INT(sek/60)
d=INT(sek/3600)
e=INT(d*60)
f=c-e
d$=STR$(d)
WHILE LEN(d$)<2
  d$="0"+d$
WEND
f$=STR$(f)
WHILE LEN(f$)<2
  f$="0"+f$
WEND
e$=d$+":"+f$
a$="Dauer gesamt:                              "+b$+"  Stunden: "+e$
WHILE LEN(a$)<80
  a$=a$+" "
WEND
qq$=a$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qx$+qq$
PUT #1,start+4
b$=STR$(geb1)
WHILE LEN(b$)<5
  b$="0"+b$
WEND
a$="GebÅhreneinheiten 1: "+b$
WHILE LEN(a$)<80
  a$=a$+" "
WEND
qq$=a$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qx$+qq$
PUT #1,start+5
b$=STR$(geb2)
WHILE LEN(b$)<5
  b$="0"+b$
WEND
a$="GebÅhreneinheiten 2: "+b$
WHILE LEN(a$)<80
  a$=a$+" "
WEND
qq$=a$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qx$+qq$
PUT #1,start+6
b$=STR$(betrag*100)
WHILE LEN(b$)<5
  b$="0"+b$
WEND
b$=MID$(b$,1,3)+","+MID$(b$,4,2)
a$="BTX-Betrag:         "+b$
WHILE LEN(a$)<80
  a$=a$+" "
WEND
qq$=a$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qx$+qq$
PUT #1,start+7
b$=STR$(reg)
WHILE LEN(b$)<6
  b$="0"+b$
WEND
a$="BTX Regionale S.:   "+b$
WHILE LEN(a$)<80
  a$=a$+" "
WEND
qq$=a$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qx$+qq$
PUT #1,start+8
b$=STR$(mit)
WHILE LEN(b$)<6
  b$="0"+b$
WEND
a$="BTX Mitteilungen:   "+b$
WHILE LEN(a$)<80
  a$=a$+" "
WEND
qq$=a$+CHR$(13)+CHR$(10)
PRINT qq$
qx$=qx$+qq$
PUT #1,start+9
CLOSE
PRINT
PRINT "Die ermittelten Monatswerte werden in die Jahresdatei geschrieben..."
IF NOT EXIST(jahr$)
  OPEN "O",#1,jahr$
  a$="          Monatliche GebÅhrenaufstellung DFö"
  WHILE LEN(a$)<80
    a$=a$+" "
  WEND
  PRINT #1,a$
  a$="          ----------------------------------"
  WHILE LEN(a$)<80
    a$=a$+" "
  WEND
  PRINT #1,a$
  CLOSE #1
ENDIF
OPEN "R",#1,jahr$,82
FIELD #1,82 AS q$
start=LOF(#1)/82+1
q$="Monat: "+mon$+"."+MID$(DATE$,9,2)
WHILE LEN(q$)<80
  q$=q$+" "
WEND
q$=q$+CHR$(13)+CHR$(10)
PUT #1,start
FOR i%=1 TO LEN(qx$) STEP 82
  q$=MID$(qx$,i%,82)
  INC start
  PUT #1,start
NEXT i%
CLOSE
PRINT
PRINT "Fertig!"
a=INP(2)
PROCEDURE quicksort(anfang%,ende%)
  aaaaa%=anfang%
  zzzzz%=ende%
  xxxxx$=a$((anfang%+ende%)/2)
  REPEAT
    WHILE a$(aaaaa%)<xxxxx$
      INC aaaaa%
    WEND
    WHILE xxxxx$<a$(zzzzz%)
      DEC zzzzz%
    WEND
    IF aaaaa%<=zzzzz%
      SWAP a$(aaaaa%),a$(zzzzz%)
      INC aaaaa%
      DEC zzzzz%
    ENDIF
  UNTIL aaaaa%>zzzzz%
  IF anfang%<zzzzz%
    @quicksort(anfang%,zzzzz%)
  ENDIF
  IF aaaaa%<ende%
    @quicksort(aaaaa%,ende%)
  ENDIF
RETURN
