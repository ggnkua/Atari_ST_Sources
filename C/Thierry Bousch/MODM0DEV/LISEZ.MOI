Chers Utilisateurs de MiNT,

vous trouverez dans cette archive un (autre) driver pour le port serie
de l'Atari ST. Je n'ai pu le tester que sur ma propre machine; si vous
avez plus d'un port serie, il est probable que c'est le premier qui sera
gere, c'est pourquoi les devices s'appellent /dev/cua0 et /dev/ttyd0. Il
ne devrait pas etre trop difficile d'adapter le code pour les autres
ports serie, et de creer les devices /dev/cua1, /dev/ttyd1, etc., mais
je prefere laisser ce travail a quelqu'un qui est capable de le tester.
Des volontaires?

Mon intention etait d'ecrire des devices entrant (/dev/ttyd0) et sortant
(/dev/cua0) pour le port serie, comme cela existe sous Unix.  Quoiqu'ils
se rapportent au meme peripherique, ils ont une semantique legerement
differente; le device entrant attend l'arrivee d'une porteuse pour
commencer a echanger des donnees (ce qui est parfait pour attendre une
communication a partir d'un modem), delogue l'utilisateur si celui-ci
perd la porteuse, et raccroche quand l'utilisateur se delogue.  Le
device sortant ne necessite pas qu'une communication soit etablie, ce
qui permet en particulier d'envoyer des commandes au modem.  Le driver
garantit qu'il n'y a pas de conflit entre ces deux devices. 

Le device entrant est habituellement utilise avec getty, dans l'attente
d'un appel. Le device sortant est utilise soit pour configurer le modem,
soit pour appeler un autre systeme (avec uucp par exemple). Dans ce
dernier cas, lorsque la connexion sera etablie, il ne faut surtout pas
que le device entrant croie que cette connexion lui est destinee (j'ai
vu un Sun3 faire ca!).

L'archive contient en fait deux versions du driver; la premiere,
modm0dev.ttp, est une version "allegee" qui affiche les erreurs sur la
console; elle a l'avantage d'etre maigre, car elle n'utilise pas printf. 
La seconde, modm0dev.syslog, utilise syslog pour indiquer les erreurs,
mais fait 15Ko de plus.

Vous trouverez egalement une version de stty(1) legerement adaptee de
celle d'Eric Smith, prenant en compte les drapeaux `rtscts', `local' et
`hupcl'. Les fichiers syslog.[ch] sont extraits du package init(1) de
Stephen Usher, avec quelques adaptaptions mineures pour qu'il compile en
16 bits, et corrigeant une "fonctionnalite non documentee" qui empechait
notre demon d'appeler syslog() plusieurs fois de suite.

Ce demon est insensible a tous les signaux, a l'exception evidemment de
SIGSTOP et SIGKILL qui ne peuvent etre masques. Il est deconseille de
stopper le demon. Il ne faut absolument pas le tuer, ou bien c'est le
plantage garanti. Heureusement, seul root peut le tuer.

En theorie, il n'est pas necessaire de modifier MiNT pour utiliser ce
driver.  En pratique, si vous voulez utiliser votre Atari en mode
multi-utilisateurs, il est souhaitable de le securiser un peu.  En
particulier, seul root devrait avoir le droit d'ecrire sur les
partitions TOS (il faut patcher la fonction tos_getxattr dans tosfs.c),
et la machine devrait rebooter automatiquement si jamais on quitte MiNT
ou en cas d'erreur fatale.  C'est plus une protection contre les bourdes
que contre le sabotage; ne comptez pas trop sur MiNT pour la securite!

Enfin, la manpage (modm0dev.8, modm0dev.asc) et le source vous donneront
tous les autres details.  Si les reglages par defaut ne vous conviennent
pas (taille des buffers, nom du device entrant, etc.), modifiez les
parametres correspondants dans modm0dev.h, puis recompilez. 

Thierry Bousch       Internet: bousch@suntopo.matups.fr
44 Bd du Temple      Fidonet:  Thierry Bousch @ 2:320/100.9
75011 PARIS
FRANCE
