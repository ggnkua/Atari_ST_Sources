Technischer énderungsreport (chronologisch)
-------------------------------------------

Hierin sind alle fÅr Programmmierer und Anwender relevanten énderungen an MagiCMac
aufgefÅhrt, nicht jedoch énderungen am MagiC-Betriebssystem!

Dieser Liste ist als Referenz und nicht als Anleitung zu verstehen!

Hinweis: Die diversen Parameter in der sog. Prefs-Datei kînnen nur mit einem Resource-
Editor auf dem Macintosh vorgenommen werden, z.B. mit ResEdit. Dazu ist die Datei
"MagiCMac Prefs" mit ResEdit zu îffnen. Dort befinden sich dann alle Parameter im
Resource-Element "STR#". Die Parameter haben alle einen Namen und ihre Werte kînnen
durch Doppelklick eingesehen und verÑndert werden.

énderungen vor Version 1.1.2:

- Neuer Parameter in Prefs-Datei: "IntsWhileWNE". Ist er Eins, werden die Interrupt-Routinen
  fÅr 200 Hz-Timer ($118) und VBL ($70) auch aufgerufen, wÑhrend Mac-Applikationen im
  Hintergrund Zeit abbekommen. Damit bekommen Programme, die diese Interrupts benutzen,
  lÅckenlos ihre Aufrufe, solange MagiCMac im Vordergrund lÑuft.
  Ist der Wert Null, werden wie bisher die Interrupt-Aufrufe unterdrÅckt, wenn gerade Zeit
  an die Mac-Applikationen im Hintergrund vergeben wird.
  Sobald MagiCMac nicht mehr den Bildschirm vollstÑndig belegt, also z.B. durch Command-W
  auf die Mac-Seite umgeschaltet wurde oder wenn ein Mac-Dialog einscheint, werden unbedingt
  alle Interrupt-Aufrufe unterdrÅckt.
- Neuer Parameter in Prefs-Datei: "PhysVideo". Er ist fÅr 68030-Rechner vorgesehen, bei denen
  beim Start eine Fehlermeldung kommt, die darauf hinweist, da· GetPhysical nicht funktioniert
  oder da· die Adresse des Video-Speichers nicht ermittelt werden kann. In diesem Fall sollte
  der Wert von Null auf Eins oder Zwei gesetzt und jeweils ein erneuter Start von MagiCMac
  versucht werden. In jedem Fall sollte ASH vom Ergebnis informiert werden, damit in Zukunft
  auf diesen Parameter verzichtet werden kann.
- Durch Festhalten der Option-Taste bei "öber MagiCMac*" erscheinen statt der Info-Box
  Angaben Åber die Speicherbelegung von MagiC im Mac.
- Neuer Parameter in Prefs-Datei: "UseCDM". Ist er Eins, wird zum Abfragen der Maus der
  neue "Cursor Device Manager" des MacOS benutzt, falls er vorhanden ist. Dies ist z.B.
  bei den Performa 475 und 630 sowie den neuen 68040-PowerBooks der Fall. Wird der CDM
  benutzt, ist offenbar die Mausbeschleunigung deaktiviert und die Maus lÑ·t sich nicht
  pixelgenau positionieren, ruckelt wahrscheinlich auch mehr. Daher sollte dieses Flag
  normalerweise auf Null stehen, damit das alte Verfahren benutzt wird. Dies funktioniert
  aber evtl. auf neueren Systemen nicht mehr. Mal sehen...
- lange Dateinamen gehen, QED lÑuft wieder.
- Die RÅckruf-Routinen des MgMc-Cookies fÅhren nicht mehr zum Absturz des Systems.
- LÑuft nun auch mit System 7.0.1 (vorher kam Meldung "MoveHHi() failed")
- Logitech "MouseMan" wird unterstÅtzt.
- Zeichenkonvertierung bei Clipboard erzeugt nun scharfes "s" statt beta-Zeichen.
- UnterstÅtzung fÅr 2-Tasten-MÑuse und Rechts-Shift bei Tastaturen verbessert:
  1. Wenn mehrere Tastaturen vorhanden sind (z.B. ein Extended Keyboard an einem PowerBook),
  wird explizit nach der Extended Tastatur gesucht und genau diese dann fÅr die
  Rechts-Shift-UnterstÅtzung umprogrammiert.
  2. Wenn mehrere MÑuse und/oder TrackBalls angeschlossen sind (z.B. eine 2-Tasten-Maus
  an einem PowerBook, welches zudem ja noch den TrackBall hat), wird jedes einzelne
  GerÑt ggf. fÅr die 2-Tasten-Bedienung umprogrammiert.
  3. Einige PowerBooks (170 nicht, jedoch z.B. 270c) erlauben die Unterscheidung der
  beiden TrackBall-Tasten als linke und rechte Maustaste. Dies wird nun ebenso aktiviert,
  wie bei der MicroSpeed- und der Logitech-Maus, falls der Schalter in den Systemparametern
  aktiviert ist.
- Pure-Pascal-Programme dÅrften nun nicht mehr mit "Exception 11" abstÅrzen beim Start
  auf Rechnern mit einer 68LC040-CPU.
- Keine AbstÅrze mehr auf 68030-CPUs mit FPU, wenn ein Programm mit FPU-Benutzung
  darauf gestartet wird.
- Neuer Schalter "Zeit an Mac-Appl. im Hintergrund abgeben": Ist er aktiviert (wie es
  bisher praktisch immer war), dann bekommen die Macintosh-Programme auch Rechenzeit,
  wÑhrend MagiC im Vordergrund arbeitet. Dies ist z.B. sinnvoll, wenn ein Mac-Programm
  wÑhrenddessen Dateien entpacken oder Daten Åber's Modem Åbertragen soll. Schaltet man
  hingegen diese Option aus, kînnen auch stîrende Programme, wie z.B. das Monitor-
  Kontrollfeld, auf Mac-Seite geîffnet bleiben, ohne da· sie den Betrieb unter MagiC
  beeinflussen.
  Besonders, wenn Zeitmessungen (Benchmarks) vorgenommen werden, sollte daher dieser
  Schalter deaktiviert werden!
- Neuer Schalter "ADB-Maussteuerung": Ist er aktiviert, werden die Mausdaten direkt an
  der Quelle abgefragt, anstatt dazu die "normale" Betriebssystemvariablen zu verwenden.
  Dies ist effektiver, kann aber nur mit richtigen und Apple-kompatiblen MÑusen
  funktionieren. Au·erdem werden dabei die Bewegungsdaten der Maus unverÑndert ermittelt,
  d.h., da· z.B. die Einstellung einer Mausbeschleunigung Åber das Mac-Maus-Kontrollfeld
  keine Wirkung mehr hat. Wenn dennoch eine Beschleunigung erwÅnscht ist, sollte ein
  Mausbeschleuniger auf MagiC-Seite installiert werden. Solche, die sich in den Maus-Vektor
  mittels der XBIOS-Funktion "Kbdvbase" einhÑngen, dÅrften keine Probleme bereiten.
- XBRA-Ketten bei Cookie werden nicht mehr mit NULL-Zeiger sondern mit Zeiger auf RTS
  terminiert.
- Fehler behoben, der zu unkontrolliertem Absturz fÅhrte, wenn Templemon nicht installiert
  war und dann eine Exception auftrat.
- Disk-Einlegen fÅhrt unter VM nicht mehr zum Absturz.
- Wenn keine Zeit an Mac-Hintergrund abgegeben wird, wird das Einlegen von
  Mac-Disketten wieder erkannt.
- Speicherverteilung korrigiert:
  Es wird darauf geachtet, da· bei aufgeteiltem RAM das TT-RAM immer im TPA2-Bereich
  liegt; ST-RAM wird immer unterhalb von 16MB angelegt.
- Preemptives MT optional (Prefs: "AllowTaskSwitch" von 0 auf 1 setzen!).
- Durch Doppelklick (o. Drag&Drop auf MM) einer Prefs-Datei kann diese explizit
  verwendet werden.
- Printer-Setup wird in Prefs gesichert, Cookie erweitert um Printer-Setup und
  Callback f. Setup-Dialog.
- Disk-Auswurf per Befehl-Y statt Befehl-E

20.3. v1.1.2

- GEMDOS.Fdatime() korrigiert: Das énderungsdatum der Datei stimmt nun auch bei Uhrzeiten
  ab 16.00h. -> Make bei Pure C funktioniert nun wieder.
- Wenn "PhysVideo" = 3 (Prefs-Datei) ist, wird keine Fehlermeldung angezeigt, wenn
  Video-Adr. nicht verifiziert werden kann.
- "Mediach"-Funktion (BIOS 9) liefern nun EUNDEV (-15) statt Null bei Laufwerken,
  die kein FAT-Dateisystem enthalten.
- Der BPB bei Floppies mit FAT-Dateisystem enthÑlt nun hinter den 18 offiziellen Bytes
  noch die mehr oder weniger undokumentierten Werte bis einschl. zur Seriennummer der
  Disk (KOBOLD benîtigt dies).
- macxfs.c/Fxattr(): "device"-Eintrag liefert nun die ioVRefNum statt die Atari-LW-Kennung

7.4. v1.1.6

- Prefs: Boolean "QuitAEUncond" beendet MagiCMac ohne Nachfrage, wenn Quit Åber
  AppleEvents kommt.
- Die Info-Routinen des Cookies fÅr's Beenden von MM werden nun eher aufgerufen
  (die von MM simulierten Interrupts sind dann noch aktiv).
- Prefs: Boolean "UnlockMemOnMacSide" (Default 1): Wenn Null, wird der belegte Speicher
  unter VM nicht zum Auslagern freigegeben.
- Fdatime-Aufrufe Ñndern neben dem énderungsdatum nun auch das Erzeugungsdatum.
- Atari-I/O-Karten (z.B. McSTout) lassen sich nun auch auf 68030-Rechnern einblenden
  (bisher nur auf 68040, sonst kam Fehlermeldung, da· GetPhysical nicht funktioniert)

6.6. v1.2

- 2 Bugs in Floppy-Routinen behoben:
  Erstens wurde fÅr A: und B: derselbe BPB-Puffer verwendet (dies war aber nicht weiter
  tragisch, denn wer hat schon 2 Floppy-Laufwerke im Einsatz?)
  Zweitens passiert es nun nicht mehr, da· beim Verwendung von PC Exchange der Inhalt vom
  Bootlaufwerk statt von der Floppy gelesen wird (Reg. A2 wurde in is_dos_format() beim
  Aufruf von Floppy_bpb() zerstîrt, was zu Folgefehlern fÅhrte).
- Cookie erweitert um PowerPC-Flag (Cookie-Version 1.05)
- Cookie: Der 'flags1'-Eintrag wurde vîllig falsch gesetzt (es wurde "||" statt "|"
  zum verodern benutzt ƒ ich hasse C!).
- SchreibgeschÅtzte Dateien lassen sich nun endlich îffnen, wenn sie nur zum Lesen
  geîffnet werden sollen.
- Eject-Mechanismus fÅr Dcntl() implementiert.

13.6. v1.2.1

- Gefordertes ST-RAM wird mîglichst ans obere Ende, also direkt unter den I/O-Bereich,
  verschoben, damit der System-Heap nicht im Wachsen blockiert wird.
- Tastaturcodes: Die Mac-Tasten End(79), PgUp(73), PgDown(81), F11(69), F12(70) und
  F14(55) liefern nun auch eigene Scan-Codes (Werte in Klammern). Nicht ausgewertete
  Mac-Tasten, die bisher den Scan-Code Null lieferten, werden nun ignoriert.
- Command-B simuliert das DrÅcken beider Shift-Tasten (nÅtzlich bei Keyboards, die nicht
  zw. rechter und linker Shift-Taste unterscheiden kînnen).
- MacEvents/Intr: Zeitabgabe an Mac-Apps jetzt einstellbar Åber Pref "WNEFrequency"
  (Werte: 1 -> alle 1/60s, n -> n/60s, Werte kleiner 0 werden zu 1). Default ist nun
  1/60s statt bisher 8/60s.
- Prefs: "EmulUpdFreq" neu. Bestimmt, bei jedem wievielten VBL die Screen im 640*400-
  Emulationsmodus kopiert werden soll. Default: 2.
- Monochrom-Emul-Modus wird auch bei Rechnern unterstÅtzt, deren Monitore nicht auf
  Schwarz/Wei· einstellbar sind (das gilt z.B. fÅr die Grafikkarten bei den PowerMacs).
  In diesem Fall wird der Mac-Monitor in 256 Farben betrieben. Das Kopieren dauert
  dadurch leider deutlich lÑnger und bremst den Rechner spÅrbar.
- Der Puffer zum Sichern des Atari-Bildschirminhalts beim Wechsel zum Mac wird nun
  noch so gro· angelegt, wie benîtigt. Bei bestimmten Rechnern (z.B. Q950) wurde bisher
  immer so viel Speicher wie fÅr die theoretisch hîchste Auflîsung reserviert, auch wenn
  diese Auflîsung gar nicht benutzt wurde. Im 640*400-Emul-Modus wird allerdings so viel
  Speicher verbraucht, wie die Sicherung des gesamten Bildschirms mitsamt des schw.
  Rands benîtigt.
- Prefs: "NMIToAtari" (Boolean). Wenn FALSE, gehen alle NMI-Intrs an Mac-Seite.
  Bei TRUE wird zur Atari-Seite geschaltet, sofern MagiCMac im Vordergrund lÑuft
  (ist die Mac-Screen aktiv, wird der NMI-Handler vom Mac aufgerufen). Allerdings
  sollte nach Mîglichkeit Befehl-Einschalttaste statt des NMI-Tasters benutzt werden,
  denn die Entprellung beim NMI ist nicht ganz zuverlÑssig.
- Der Default-Exception-Handler (Alert #139) macht bei "Quit App" mit gedrÅckter
  Option-Taste einfach einen RTE, ignoriert also die Exception.
- Prefs: "SelectMonitor". Ist der Wert ungleich Null, verwendet MM nicht den Hauptmonitor
  sondern den mit der angegebenen Nummer, falls mehrere Monitore vorhanden sind.
  Templemon verwendet aber weiterhin den Hauptmonitor.
- MagiC.c: Bconout (PRN), Bconout (AUX) und Bconin (AUX) liefern nun immer Long-
  expandierte RÅckgabewerte. Bisher stand u.U. im High-Word MÅll.
- Prefs: "KbdConfig" legt fest, welche Tasten in Kombination mit der Befehlstaste
  simuliert werden sollen. Der Wert setzt sich aus einzelnen Bit-Flags zusammen.
  Bit 0: Simulation fÅr die Funktionstasten Åber Befehl-Ziffer (Default: An).
  Bit 1: Simulation der Sondertasten Åber Bef-H/U/D/E/C (Default: An).
  Bit 2: Simumation der beiden Shift-Tasten Åber Befehl-B (Default: An).
- Prefs: "AHDI_Devs" ist ein Bit-Feld, das bestimmt, welche SCSI-IDs auf AHDI-Laufwerke
  ÅberprÅft werden sollen. Dabei steht Bit 0 fÅr SCSI 0, Bit 1 fÅr SCSI 1 usw. bis SCSI 6.
  Um alle SCSI-IDs zu prÅfen, ist also 127 einzutragen, wenn keine AHDI-LWs angeschlossen
  sind, kann 0 eingetragen werden, um den Boot-Vorgang zu beschleunigen.
- Der Schalter "Keinen Idle-Zustand erlauben" bei den Powerbook-Prefs hatte Åberhaupt
  keine Wirkung. Der Code, der dieses Flag behandeln sollte, ist spurlos verschwunden.
  Mal sehen, wie lange er diesmal drin bleibt*
- Die Meldung "Nicht genÅgend Heap-Speicher" konnte bisher nicht ausgegeben werden,
  stattdessen erschien dann "LÑuft nur mit System 7.".
- Bei ADB-Mausabfrage wird ebenso, wie das DrÅcken des Buttons, nun auch die Mausbewegung
  ausgefiltert, d.h., fÅr das MacOS und andere Hintergrundappl. bleibt die Maus unbewegt
  in der Mitte des Hauptmonitors, solange der MagiC-Bildschirm aktiv ist.
- Falls Prefs-Flag "UnlockMemOnMacSide" = 0 ist, wird bei Programmende der Bereich
  nun unlocked - bisher passierte das nicht und dÅrfte deswegen zu Problemen beim
  Beenden gefÅhrt haben. Dies ist natÅrlich nur dann relevant, wenn man VM aktiviert
  hat und das Prefs-Flag manuell auf Null gesetzt hat.
- Kein Absturz mehr, wenn bei aktivem VM auf ein Mac-Programm gewechselt wird (Fehler
  dÅrfte seit v1.1.7 existiert haben). Dabei wird nun der Speicher, den MM fÅr MagiC
  reserviert hat, erst freigegeben, wenn man auf eine andere Mac-Appl. wechselt und
  nicht mehr, wie bisher, bereits beim Umschalten auf die Mac-Seite mittels Cmd-W.
- Die Versionskennung von "MagiCMac OS" wird nun mit der von der Applikation verglichen
  und eine Fehlermeldung bei NichtÅbereinstimmung angezeigt.
- Wenn wg. defektem "Design Kbd" die Handler-ID nicht rÅcksetzbar ist, wird eine entspr.
  Fehlermeldung angezeigt.
- Bei Aufruf von Info-Routinen durch 'PortControl', 'InfoHideAndShow' und
  'InfoSuspendResumeQuit' wird nun kein eigener Stack mehr benutzt sondern der
  MagiC-Stack verwendet. Dies ist notwendig, weil die aufgerufenen Info-Handler
  evtl. 'callMacContext' aufrufen und deshalb vorher nicht der Mac-Appl-Stack aktiv
  sein darf, wie es dennoch bisher der Fall war.
- Prefs: 'AtariStackSize' neu (Default: 0). Wenn ungleich Null, wird damit die Grî·e
  aller unter MagiC eingerichteten Supervisor-Stacks (jeder Proze· bekommt einen)
  vorgegeben. Der Mindestwert ist z.Zt. 5120 (wird verwendet, wenn AtariStackSize
  zu klein oder Null ist), der Maximalwert 32764.
- Floppy-Zugriff geht wieder bei aktivem VM.
- Read-Only-ôffnen von schreibgeschÅtzten Dateien auf Servern und CD-ROMs sollte nun
  auch funktionieren.
- BIOS-Funktion Bcostat() fÅr AUX fragt nicht mehr CTS-Status ab, sondern prÅft, ob die
  nun asynchrone öbertragung des letzten Bytes bereits abgeschlossen ist.
- Auf PowerBooks mit 16 Graustufen (z.B. PB 520) bleiben beim Wechsel zum Mac-Bildschirm
  nun die "Farben" erhalten, bisher nutzte der Finder z.B. dann nur noch s/w-Icons.
- Text bei PowerBook-Optionen geÑndert in "Einschlafen und langsame Taktung verhindern".
- Aufwachproblem bei PBs gelîst: vor dem Einschlafen wird nun automatisch zum Mac-Schirm
  gewechselt, beim Aufwachen entspr. zurÅck.
- Die XBIOS-Funktionen zum Setzen von Datum&Zeit funktionieren nun.
- Control Strip wird nun automatisch bei Wechsel zum Atari-Schirm ausgeblendet;
  der Prefs-Eintrag "FKEYContextSwitch" wird nicht mehr benutzt.
- XBios-Routinen fÅr Floppy-Zugriffe implementiert:
  - Floprd(), Flopwr()
  - Flopver() liefert bei Fehlern immer alle verifizierten Sektoren in der Bad-Sector-List.
  - Flopfmt() formatiert und verifiziert ganze Disk auf einmal, wenn mit Spur 0, als auch
    wenn mit Spur 79 begonnen wird.
    Falls dabei ein Fehler auftritt, wird in dem Åbergebenen Puffer allerdings eine leere
    Bad-Sector-List Åbermittelt. Bei anderen Spuren wird nichts getan und immer OK geliefert.
    Bei SPT ungleich 9 oder 18 sowie bei Track>79 wird auch sofort ein Fehler geliefert.
    Beim Formatieren gibt es noch eine kleine Macke: Wenn man eine Disk unter MagiC formatiert,
    die vorher ein Mac-Format hatte, dann kann man nach dem Formatieren nicht auf die Diskette
    zugreifen, bis sie einmal aus- und wieder eingeworfen wurde.
  Allerdings funktionieren die Floppy-Routinen immer noch nur mit zweiseitigen Disks mit
  9 oder 18 Sektoren pro Spur und max. 80 Spuren.
- Zeichenumwandlung fÅr Clipboard beherrscht nun alle umsetzbaren Zeichen. Nicht umsetzbare
  Zeichen werden nun zu Sternchen ("*") anstatt, wie bisher, zu Fragezeichen.
- Wenn Text-Konvertierung fÅr`s Clipboard wg. zuwenig Speicher nicht klappt, wird nun ein
  richtiger Alert angezeigt. Bisher wurde Alert #128 aufgerufen, der aber gar nicht existierte
  und damit zu AbstÅrzen o.Ñ. fÅhren konnte.
- Wenn Mac-FKEYs Åber Cmd-Shift-Ziffer augefÅhrt werden, fÅhrt dies nicht mehr gleichzeitig
  zu einer Simulation einer Funktionstaste unter MagiC. Umgekehrt wird auch beim Erzeugen
  einer Shift-Funktionstaste per Shift-Cmd-Ziffer kein FKEY ausgelîst.
  Ob Mac-FKEY oder Shift-Funktionstaste erzeugt wird, ist davon abhÑngig, ob zuerst die
  Befehls- oder die Shift-Taste gedrÅckt wird, es sei denn, nur eine der beiden
  Tastenkombinationen soll ausgewertet werden (s. KbdConfig).
  Die Unterscheidung, ob Funktionstaste oder FKEY gewÑhlt wurde, klappt leider nur, wenn
  kein WNE fÅr Event-Abfrage benutzt wird, wenn also keine Zeit an Mac-Apps gegeben wird.
  Bei Zeitabgabe an Mac-Apps werden FKEYs immer ausgefÅhrt, egal, ob zuerst die Shift-
  oder die Befehlstaste gedrÅckt wurde. Das Flag in "KbdConfig" ist dann auch nicht wirksam,
  d.h, die FKEY-Auswertung kann bei WNE-Benutzung nicht deaktiviert werden.
- Prefs: "KbdConfig" (s.o.) erweitert:
  Bit 4: Auslîsen von FKEYs beim DrÅcken von Befehl-Shift-Ziffer (Default: An)
- Warmstart, ausgelîst durch eine Interrupt-Routine, kann nicht funktionieren.
  Deswegen wird nun dann eine entspr. Fehlermeldung angezeigt.
  Andere Warmstarts, z.B. von der EASE (Auflîsungswechsel) aus, funktionieren aber.
- Dateityp der Prefs-Datei ist nun wieder 'Pref' statt 'pref', alte 'pref'-Files kînnen
  aber weiterhin geîffnet werden.
- XCMDs neu. XCMDs liegen im Ordner, der i.d.R. "MagiCMac XCMDs" hei·t und im selben Verzeichnis
  wie die MagiCMac-Appl. liegt. Statt des Ordners selbst kann dort auch ein Alias auf einen
  beliebigen Ordner (auch im Netz) angelegt werden, wichtig ist nur, da· der Ordnername mit dem
  Åbereinstimmt, was in den Prefs unter "XCMDs folder name" steht.
  Im resultierenden Ordner kînnen wiederum statt des XCMDs selbst Alias-Dateien auf sie
  angelegt werden.
- Kein Mac-Systemabsturz mehr, wenn wg. zuwenig Speicher "MagiCMac OS" nicht ausgefÅhrt
  werden konnte.

11.8. v1.2.2

- Der Mac-Applikations-Stack wurde um 8KB vergrî·ert.
- Die von MagiCMac verwendeten temporÑren Stacks fÅr die Umschaltung in den Atari-Modus
  wurden von 4KB auf 8KB erhîht, damit das System auch stabil auf den neuen PCI-PowerMacs,
  z.B. dem PM 9500, lÑuft.
- Prefs: "PutRAMatIO" (Boolean, Default: 0) probeweise vorgesehen. Ist es 1, wird im
  I/O-Bereich ($xxFF8xxx) RAM eingeblendet, das anfangs mit Null-Bytes gefÅllt ist.
  Wenn dies der Fall ist, laufen aber viele Programme nicht mehr, die dort Bus-Errors
  erwarten, z.B. Pure Pascal-Programme, die Floating-Point-Berechnungen durchfÅhren,
  da der PP-Runtime-Code prÅft, ob sich dort eine FPU befindet, indem es testet, ob
  es in dem Bereich einen Bus-Error gibt.

24.8.95: Fertigstellung v1.2.3

- MgMcCookie.auxControl wird bei ZurÅckschalten auf Atari-Bildschirm nun endlich mit
  richtigem Argument (1 statt 0) aufgerufen, so da· HSMODEM nun auch den Ser. Port
  wieder îffnet, wenn er manuell auf Mac-Seite geschlossen wurde.
- Dateisystem (Mac-Partitionen): Dateien, die nicht ins 8.3-Schema passen, werden bei
  Fsfirst/Fsnext nicht mehr mitgeteilt. D.h, da· z.B. EASE, solange sie nicht Dreaddir
  fÅr lange Dateinamen benutzt, in Verzeichnissen nur noch solche Dateien anzeigt, die
  auch von ihr geîffnet werden kînnen. Das selbe gilt fÅr den Dateiauswahldialog.
  So kann es sein, da· Verzeichnisse, wo der Finder viele Mac-Dateien anzeigt, unter
  MagiCMac leer aussehen.
- Interrupt-Handler optimiert -> deutlich hîhere Datenraten bei serieller öbertragung.
- Cookie: WÑhrend "callMacContext" werden keine Mac-Tasks mehr bearbeitet, auch wenn
  wÑhrenddessen zeitweise in den Atari-Modus gewechselt wird.
- MagiCMac OS: Behebt Fehler, da· AUTO-Ordner nicht ausgefÅhrt wurde, wenn sich das
  Boot-Laufwerk auf einem anderen Mac-Volume als die MagiCMac-Applikation befand.
- Dpathconf liefert nun 31 statt 32 als Max-LÑnge, Korrekturen auch an anderen Stellen
  bzgl. Dateinamenbehandlung.
- Aktivierung von "True Color" Åber den Einstelldialog klappt nun.
- AHDI-Driver liest/schreibt nun in kleineren HÑppchen (1MB statt 32MB). Vielleicht lîst
  dies das Problem mit dem Laden/Speichern von gro·en Dateien.
- Die Anzahl der Partitionen, die fÅr Wechselmedien beim Start von MM reserviert
  werden sollen, kann nun in der Prefs-Variable "RsrvPartitions" vorgegeben werden.
- Stackgrî·e ist nun auch fÅr die in MM bisher statisch allozierten Stacks
  variabel, d.h. fÅr die PCI-Macs sollte nun Prefs:AtariStackSize > 8192 gesetzt
  werden und MM dann auch bei aktivem File Sharing stabil laufen kînnen.
- Beim Neuanlegen der Prefs-Datei wird nun fÅr "AtariStackSize" 8KB (68K) bzw. 16KB (PPC)
  eingetragen.
- Prefs: "SafetyFlags" neu. Falls MM instabil lÑuft, diesen Wert auf -1 setzen
  (normal: 0). Wenn's dann stabil lÑuft, unbedingt Nachricht an mich (TT), damit
  der Fehler eingekreist werden kann.
- Der Cache-Modus "Copyback" wird nicht mehr benutzt, weil er kaum Geschwindigkeitsvorteile
  bringt, dafÅr aber viele Probleme bereitet.
- Prefs: PPCExtMMUTo16MB (Boolean, Default: 1) neu: wenn 0, werden bei PPC die MMU-Tables
  nicht Åber 16MB erweitert, wenn max. 16MB installiert sind. Damit treten keine Dateisystem-
  Zerstîrungen mehr bei 7100/80 und 8100/100 auf, dafÅr aber auch keine Bus-Errors beim
  unteren I/O-Bereich, was evtl. einige Programme nicht mehr laufen lÑ·t.
- Prefs: "AtariIO1Enabled" (Boolean, Default: 1). Ist der Wert Null, wird der I/O-Bereich bei
  $00FFxxxx nicht ausgeblendet sondern dieser Bereich und alles darÅber als ST-RAM benutzt.
  So gibt es dann keine LÅcke bei 16MB.
  Der Speicher-Einstelldialog hat dafÅr einen neuen Schalter erhalten.
- Cookie "PMMU" wird mit dem Wert Null angelegt, um anzuzeigen, da· die MMU belegt ist.
- MgMc-Cookie: "ext"-Funktionen 0-3 neu. Jetzt kann man endlich einen Mac-FSSpec in einen
  GEMDOS-Pfad konvertieren, um Dateien vom Mac an Atari-Prgs zu Åbergeben.
- Warmstart verbessert (einige zusÑtzliche Vars rÅckgesetzt): Sollte nun korrekt klappen.
- Beim Dialog, der bei ATARI-Exceptions erscheint, kann mit "Cmd-Q" der "Quit MagiC"-Button
  gewÑhlt werden (fÅr den Fall, da· die Maus nicht funktioniert).
- Prefs: "ScreenSizeAdd" neu (Default: 16). Damit stÅrzt MM nicht mehr ab, wenn Maus-Cursor
  in untere rechte Ecke bei Grafikkarte "formac BW card II" bewegt wird (Wert 1 scheint auch
  zu reichen).
- Fehler behoben, da· MM nicht lief bei Auflîsungen ab 1024*768 und True Color.
- MagiC lîscht den CPU-Cache nach dem Relozieren (Laden) von Programmen auch, wenn es angeblich
  auf einer 68020- oder 68030-CPU lÑuft. Damit dÅrfte es keine AbstÅrze mehr beim Starten
  von Programmen geben, wenn der Speed Enabler (Speed Doubler) auf PowerMacs installiert ist.
  NatÅrlich kann es immer noch Probleme geben, wenn die Programme selbstmodifizierenden Code
  enthalten - dort mu· dann ebenso der CPU-Cache gelîscht werden (unter Speed Doubler verhÑlt
  sich die emulierte CPU wie eine 68030 mit riesigem Daten- und Programm-Cache).
- Prefs: "PhysVideo" wird nun bei Neuanlegen der Prefs-Datei mit 3 statt mit 0 vorbesetzt,
  so da· es nicht mehr zur Warnung bei Grafikkarten kommt, da· die Adresse des Video-Speichers
  nicht ermittelt werden kînne.
- Systemparameter-Dialog: Schalter "MagiC-Multitasking ermîglichen" neu. Setzt die Prefs-
  Variable "AllowTaskSwitch".

7.11.95: Fertigstellung v1.2.5

- BIOS-Funktion Rsconf() wertet nun ucr-Parameter aus (d.h., gewÅnschte Stop-Bits,
  Parity und DatenlÑnge werden nun berÅcksichtigt - bisher wurde immer 8N1 benutzt)
- Prefs: "CloseAuxOnSwitch" & "ClosePrtOnSwitch" (Booleans, Default: 0) neu.
  Wenn TRUE, wird beim Wechsel zur Mac-OberflÑche automatisch der entspr. Port
  geschlossen, so als ob man den MenÅbefehl benutzen wÅrde.
- UnterstÅtzt nun schnelleres Drucken (bei Ausgabe Åber GEMDOS-Funktionen).
- In AES-Vars Offset $78 wird Boot-LW eingetragen, damit neues OS endlich auch wieder
  von anderen LWs als C: booten kann.

Fertigstellung v1.2.7

- Config-Dialog: SCSI-IDs fÅr AHDI-LWs Åber Checkboxen im LW-Dialog Ñnderbar.
- Kein Absturz unter VM, wenn andere Tasten wÑhrend Cmd-W gehalten werden.
- Config: PPCExtMMUTo16MB wird immer "false" gesetzt bei folg. Macs: 7100/80, 8100/100,
  8100/110. (Wenn diese hîchstens 16MB haben, kînnen sie keinen Bus-Error erzeugen,
  wenn ein Programm auf den unteren I/O-Bereich ab $FF8000 zugteift).
- Mac-XFS: DateiÑnderungsdatum sollte nun bei den Dateien immer korrekt gesetzt werden.
- MacEvents: GrafPort wurde nicht korrekt restauriert am Ende von MacTasks(). Kînnte
  Redraw-Fehler bei anderen Mac-Programmen verursacht haben.
- PhysVideo (in Prefs-Datei) wird wieder mit 0 vorbesetzt. DafÅr wurde die Erkennung, ob
  die Adresse des Video-Speichers ermittelt werden kînne, im 24 Bit-Modus korrigiert.
- Laufwerksdialog enthÑlt nun auch Schalter fÅr Ordnungsrichtung der Verzeichnisse.
- Mac-CFS: Alias-Auswertung (Symlinks) implementiert.
- ST High-Emulation fÅr 8 Bit-Grafikmodus um ca. 1/3 beschleunigt (gemessen mit 68040-CPU)
- ST Mid- und ST Low-Emulationen mit 68K-Code und in C (fÅr PPC-Native) implementiert.
- CopyEmulScreen wird nun nicht mehr als Deferred Task sondern kontrollert vom MM-Intr-Handler
  aufgerufen, damit sicher ist, da· CopyBits (fÅr PowerMacs) benutzt werden kann.
  Dadurch wird bei ST High auf PowerMacs CopyBits statt der eigenen 68K-Routinen verwendet,
  was die Emulation deutlich schneller machen dÅrfte.
- Copy-Back-Cache wieder aktivierbar, jedoch nur versteckt (durch Halten der Option-Taste
  beim Aufruf des Dialogs).
- Text-Konversion-Tabellen liegen nun in der Rsrc-Fork statt im Code und sind damit
  leicht Ñnderbar.
- Mac-XFS: Drei neue Fcntl-Funktionen fÅr Mac-Dateien implementiert: Rsrc-Fork îffnen, sowie
  FInfo erfragen/setzen.
- Laufwerksdialog: Reservierte Anzahl LWs fÅr Wechselplattenlaufwerke einstellbar.
- Systemparameterdialog: Monitor wÑhlbar
- Bei ATARI ST-Screen-Emulation wird nicht mehr ein Extra-Puffer zum Sichern des Bildschirms
  alloziert. Das dÅrfte dann je nach Monitor bis zu einigen 100KB einsparen.
- Absolut-Modus fÅr Maus-Steuerung implementiert. Damit sollten sich nun auch Grafik-Tablets
  im abs-Modus betreiben lassen.
- Wird ein Mac-Volume statt eines Unterverzeichnisses als MagiC-Laufwerk gewÑhlt, merkt
  sich MM seinen Treiber und die Partitionsnummer. Dies ist z.B. sinnvoll bei CD-ROM-Laufwerken,
  damit MagiC erkennt, wenn die CD gewechselt wird, um dann die neue CD zu benutzen anstatt
  auf der alten CD zu beharren. Bei Server-Volumes wird jedoch weiterhin Bezug auf den Volume-
  namen genommen, d.h., man bekommt den Einlog-Dialog, wenn man auf das noch nicht vorhandene
  Volume zugreifen will.
  Durch Halten der Option-Taste beim WÑhlen des Volumes wird der Modus invertiert.
  Die Buttons im LW-Dialog zeigen dann entweder "SCSI n, #p" an (n: 0-6, p:Partitionsnr.)
  oder den Namen des MacOS-Treibers mitsamt der Part-Nr. an.
- Versionsnr. wird im About-Dialog angezeigt.
- ST-Mid und -Low: Auf PowerMacs wird nun immer nach 8 Bit-Auflîsung konvertiert.
- Archiv-Bit funzt nun auch bei Mac-Verzeichnissen.
- ReadOnly-Flag kann nun ohne Fehlermeldung gesetzt/gelîscht werden.
- MAGICMAC.ACC neu, wenn es installiert ist, gibt's folg. neue Funktionen:
  - Cmd-Q bringt neuen Mac-Dialog, der auch einen sicheren "Shutdown" erlaubt.
  - Quit-AppleEvent an MagiCMac fÅhrt ebenfalls zum Shutdown, vorausgesetzt,
    die Prefs-Variable "QuitAEUncond" ist Null.
  - Redraw-Msgs vom Mac werden ans MagiC weitergeleitet.
  - Wenn das ACC lÑuft, kann man auf Mac-Seite ATARI-Programme starten, indem
    man sie einfach îffnet. Dazu mÅssen diese Dateien allerdings den Typ '.PRG'
    und den Creator 'MgMc' haben.
  - Das ACC ermittelt einmal beim Start den Clipboard-Pfad (Åber scrap_read) und
    Åbermittelt ihn an den MagiCMac-Kernel.
- Einige neue Dnctl-Funktionen implementiert (siehe XFS_DEMO.C in der Prg's doc)
- LÑuft nun auch auf PPCs mit aktiviertem VM.
- Type&Creator werden nun auch beim Ersetzen schon bestehender Dateien korrekt gesetzt.
- Eject sollte jetzt bei allen Wechselmedien (auch CDs, Netzlaufwerke) gehen.
  Kann per Dcntl (CDROM_EJECT) ausgelîst werden.
- Durch Mac-Software (z.B. Wacom-Stift) erzeugte Doppelklicks werden nun erkannt,
  indem nicht mehr die Low-Mem Variable "MBState" abgefragt wird sondern die
  MouseUp/down-Events registriert werden.
- Prefs: "UseScreenBuffer" (Default: 1). Wenn 0, wird kein Speicher zum Sichern des
  ATARI-Bildschirminhalts angelegt (spart einige hundert KB, siehe "öber MagiCMac*"-
  Dialog bei gedrÅckter Option-Taste).
  Nachteil: Wenn MAGICMAC.ACC nicht installiert ist oder wÑhrenddessen ein ATARI-Prg
  im Single-Modus lÑuft, kann kein Redraw stattfinden, falls auf Mac-Seite gewechselt
  wurde oder ein Mac-Dialog (z.B. Beenden-Dialog) erschienen war.
- Neuen Algorithmus zum Anfordern des Speicher fÅr MagiC (TPA) implementiert. Der alte
  Algorithmus kann durch Setzen der neuen Prefs-Var. "MemAllocMode" von 1 auf -1 wieder
  aktiviert werden.
- Exeption-Dialog zeigt neben der Exc-Nr und der opt. Bus Error-Adresse nun auch den
  PC, bei dem der Fehler auftrat.
- TempleMon 2.05 lÑuft auch auf Macs, die keinen S/W-Darstellungsmodus haben.
- MM konnte unter System 7.5.3 (vermutlich auch auf System vor 7.5) mit System Error #28
  (Stack-öberlauf) abstÅrzen, insbesondere, wenn man gleichzeitig Verbindungen Åbers
  Netzwerk benutzte. DÅrfte nur aufgetreten sein, wenn auch "Zeit an Mac-Apps" aktiviert
  war. (Hintergrund: Nun wird auch in Intr-Routinen, bei denen der Stack-Ptr umgesetzt
  wird, die Low-Mem StkLowPT auf Null gesetzt, um dort den "Stack-Sniffer" zu deaktivieren.)
- Prefs: Defaulf f. 'AtariStackSize' nun immer 32000 (falls der Wert 8192 bzw. 16386 ist,
  wird der Wert in 32000 geÑndert).
- Beim Start wird geprÅft, ob im angemeldeten Boot-Laufwerk die Datei MAGX.INF und der
  Ordner GEMSYS existiert. Wenn nicht, wird ein Alert und dann der Laufwerksdialog
  angezeigt.
- Mac-XFS: FUTIME (MiNT-Funktion) als Dcntl implementiert.
- Versteckte Mac-Dateien werden nun also solche erkannt.
- Cookie: Neue Ext-Funktion (extIntrInfo) speziell fÅr Harun.

17.6.96: Fertigstellung Version 2.0

- Hidden-Attribut kann nun auch gesetzt/gelîscht werden (per Fattrib).
- Dcntl(FUTIME) funktioniert nun auch bei Ordnern.
- Memory-Aufteilung korrigiert. Sollte nun mit gro·en Werten in "Max Total" klarkommen.
- Wenn McSTout installiert, kann man im Memory-Dialog trotzdem "durchgÑngiges ST-RAM"
  im unteren I/O-Bereich aktivieren.
- BNDL-Resource: 'alis'-Eintrag wieder entfernt, weil MM sonst unter System 7.5.3 nicht
  Åber Alias im Apple-MenÅ zu starten ist.
- Aufwerfen von CDs geht nun auch mit AppleCD-Treiber (bisher nur mit FWB CD-ROM Toolkit)
- Neues Programm "Dateinamen konvertieren": Wandelt Umlaute von Dateien, die unter
  MagiCMac 1.x erzeugt wurden, in Macintosh-Zeichen um, damit sie unter MagiCMac 2.x
  wieder korrekt erscheinen.
- Frename() und Fsfirst() funktionieren wieder mit Umlauten in den Dateinamen
- Die bevorzugte Grî·e der Speicherzuteilung (Heap) von MagiCMac ist nun 350 KB
  (bisher 280).

2.7.96: Fertigstellung Version 2.0.1

- Neues Programm "True Gray": Korrigiert Device-Attribut auf Null, wenn der
  Bildschirm Graustufen darstellen soll.
- Kein Absturz mehr beim Start von MM, wenn SoftwareFPU installiert ist (klappt aber
  nur wenn mind. Version 3.0 von SoftwareFPU benutzt wird!).
- BugFix in TmpMemAlloc: Wenn nur ein Block angefordert wird, z.B., weil "durchgehender
  I/O-Ber." gewÅnscht wird, kommt es nur noch dann zu einem Abbruch, wenn dieser eine
  Block nicht der MinTPA-Anforderung entspricht.

15.7.96: Fertigstellung Version 2.0.2

- Jetzt kann man wieder Floppies formatieren, ohne da· sie dabei gleich ausgeworfen werden.
- Bei einer 68040-CPU wird der FPU-Cookie auf 8 gesetzt, damit MagiC beim Proze·-
  Switching die FPU-Regs berÅcksichtigt.
- MgMc-Cookie: Neue configKernel-Funktion zum Umschalten auf Mac-Seite.

10.9.96: Fertigstellung Version 2.0.4

- Prefs: AltGrOnRightOption (Boolean, Default: 0) neu. Wenn 1, dann wird bei erweiterten
  Tastaturen und aktivierter Recht-Shift-UnterstÅtzung beim DrÅcken der rechten Wahltaste
  der neue AltGr-Code statt des normalen Alternate-Codes verwendet.
- Mac-XFS: Erkennt nun auch dann eine Datei als archiviert (Archiv-Bit ist gelîscht bei
  Abfrage der Dateiattribute), wenn das Backup-Datum _nach_ dem Modifikationsdatum
  liegt (bisher nur dann, wenn beide gleich waren).
- Setzen des FPU-Cookies auf 8 bei 68040-CPUs mÅ·te jetzt funktionieren (es war noch ein
  Fehler drin, der den Cookie _immer_ auf 0 setzte, auch bei anderen CPUs/FPUs).
- MagiC 5.04 eingebunden

20.11.96: Fertigstellung Version 2.0.5

- Falls Speed Enabler ("SE") installiert ist, wird dafÅr gesorgt, da· "Zeitabgabe an Mac-Appl."
  ("TimeForMacApps") immer deaktiviert ist
- Beim Performa 6400 und PowerMac 5400 wird das Prefs-Flag "PPCExtMMUTo16MB" immer auf Null
  gesetzt, um AbstÅrze bei Maschinen mit max. 16MB RAM zu vermeiden.
- Extension-Mapping: Nun kînnen auch 4-stellige Extensions (Bsp: .HTML) verwendet werden
  (bisher: max. 3).
  Achtung: Damit ist das Format der 'dMap'-Resource nicht mehr kompatibel zu PC Exchange.
- Falls nicht der Hauptmonitor fÅr MagiCMac verwendet wird, klappt nun die Wiederherstellung
  des Bildschirminhalts bei Wechsel vom Mac zu MM.
- Ausnahmeliste fÅr Rechner, bei denen das Prefs-Flag "PPCExtMMUTo16MB" FALSE (Null) sein muss,
  liegt nun in der Applications-Rsrc "16MB" vor. Dort kann sie leicht um die MachineCodes neuer
  problematischer Rechner erweitert werden.
- MgMc-Cookie: Neues Flag: SpeedEmulatorInstalled (Bit 6)
- Prefs: "AutoRestartSpeedEmul" (Default: FALSE) neu: Wenn TRUE, ist nicht das Wechseln zur
  Mac-Seite (per Befehl-W) nîtig, um den Speed Doubler zu (re)aktivieren. Leider funktioniert
  dies noch nicht zuverlÑssig - teilweise stÅrzt MM oder Mac OS dabei ab.
- MgMc-Cookie/ConfigKernel: Wenn SE installiert ist, kann 'TimeForMacApps' nicht auf TRUE gesetzt
  werden.
- vget_rgb (die VDI-Funktion zur Abfrage der Farbtabelle) lieferte bisher immer unbrauchbare
  Werte - sollte nun behoben sein.
- MgMc-Cookie: Version 1.13

14.1.97: Fertigstellung Version 2.0.6

- Verschieben einer Datei von einem Volume auf ein Anderes (z.B. mittels Frename) erzeugt
  nun endlich eine Fehlermeldung (ENSAME).
- Prefs: "IgnoreSpeedEmulator" neu (Default: 0). Wenn 1, wird der SE nicht erkannt und auch keine
  diesbezÅglichen Sonderbehandlungen vorgenommen.
- XCMDs und MagiC-Programme kînnen nun Åber den Cookie alle Events, die Mac-seitig auftreten,
  erkennen und ggf. auch ausfiltern. So kann z.B. ein Prg auf Befehl-A reagieren oder HighLevel-
  Events mit anderen Mac-Anwendungen austauschen. (Cookie-Version 1.14)
- MagiC 5.1 eingebunden

27.1.97: Fertigstellung Version 2.1

Known Bugs (14.1.97):
- Speed Emulator (Teil von Speed Doubler: Ein schnellerer 68K-Emulator) kann MagiCMac
  und das Mac OS zum Absturz bringen. Er zeigt sich als "Fehler 11" (bei installiertem
  MacsBug steht der PC hinter einem "_Debugger"-Aufruf auf einer Instruktion mit dem Code
  $FE10).
  Der Absturz tritt immer dann auf, wenn die Mac OS-Funktion Get- bzw. WaitNextEvent
  aufgerufen wird. Ab MM 2.0.6 wird dieser Effekt weitgehend vermieden, kann jedoch
  unter seltenen UmstÑnden immer noch passieren, so z.B., wenn ein Programm unter MagiC
  mittels der MgMc-Cookie-Funktion "ConfigKernel" #5 MM zum Umschalten auf die Mac-Seite
  (wie bei Befehl-W) veranla·t.
- Auf manchen PowerPC-Rechnern treten AbstÅrze auf, sobald man das Netzwerk (Ethernet?)
  benutzt. Abhilfe wird erreicht, indem man das Prefs-Flag "PPCExtMMUTo16MB" auf Null
  setzt. Der Grund dafÅr ist jedoch nicht bekannt.
- Symlinks (Aliase) auf Mac-Volumes funktionieren nicht immer korrekt.
- Templemon zerstîrt bei jedem Aufruf irgendwelche Speicherbereiche, die je nach
  Memory-Konfiguration zu AbstÅrzen fÅhren oder auch unbemerkt bleiben.

END.
