'
' MODULE OFLS - check Open FiLeS
'
' by Claus Brod (fr die KOBOLD-Routinen berarbeitet 23.10.93 von M.Ssykor)
'
' Dieses Modul schaut nch, ob das Programm CHK_OFLS.PRG installiert ist,
' bzw. ob der Cookie OFLS vorhanden ist.
' Somit kann man nun berprfen, ob auf einem Laufwerk Dateien ge”ffnet
' sind. Zum Beispiel, wenn man mittels KOBOLD_2 Daten lschen m”chte.
'       Dort kann dann von vorne herein auf GEMDOS-Modus umgeschaltet werden.
'
'
> PROCEDURE init_ofls
LOCAL a$
a$=MKL$(&H202F0004)+MKL$(&H48E77FFE)+MKL$(&H260042A7)+MKL$(&H3F3C0020)+MKL$(&H4E412F40)+MKL$(&H22079)+MKL$(&H5A0)+MKL$(&H670C2218)+MKL$(&H2018B283)+MKL$(&H67064A81)
a$=a$+MKL$(&H66F47000)+MKL$(&H26004E41)+MKL$(&H5C8F2003)+MKL$(&H4CDF7FFE)+MKI$(&H4E75)
cookie%=V:a$
' Assembler Routine, um einen Cookie zu suchen
DEFFN cookie(cookie$)=C:cookie%(L:CVL(cookie$))
a$=""
RETURN
'
> FUNCTION chk_ofls$(start$)    ! Datei_offen_berwacher installiert?
SELECT @ofls(ASC(LEFT$(start$,1))-65)
CASE -1
' OFLS.PRG nicht installiert...                      GEMDOS_MODE
ext$=" GEMDOS_MODE = ("+UPPER$(LEFT$(start$,1))+") "
CASE 1 TO 999999
' offene Dateien auf Laufwerk..                      GEMDOS_MODE
ext$=" GEMDOS_MODE = ("+UPPER$(LEFT$(start$,1))+") "
DEFAULT
' OFLS inst und keine offenen Dateien...             KOBOLD_MODE
ext$=" "
ENDSELECT
RETURN ext$   ! Teiljob zurckliefern
ENDFUNC
> FUNCTION ofls(drv%)     ! Gibt anzahl offener dateien von LW drv% zurck...
IF @cookie("OFLS")>0
RETURN DPEEK(@cookie("OFLS")+6+drv%*2)
ENDIF
' Wenn OFLS.PRG nicht installiert wird -1 geliefert
RETURN -1
ENDFUNC
'
' ------------------------- END-MODULE-OFLS -----------------------------------
'
