énderungen V1.1/9.11.97

ICONNECT:

-Fehler in USIS/GET_PROXY behoben, NULL-Zeiger konnte zu Absturz
 beim ermitteln der Proxy-IPs fÅhren.
-Timeout fÅr Modem-Antwort auf Initialisierungs-Sequenz erhîht.

CAB.OVL:

-"Host:"-Feld in Header eingebaut. Damit funktionieren Seiten, 
 deren Pfad im Hostnamen kodiert ist (z.B. die ATOS-Homepage).
-Fehler in USIS/GET_PROXY behoben, ein Zeiger war nicht
 initialisiert, konnte zu Absturz bei Proxy-Zugriff fÅhren.
-Auf Wunsch eines einzelnen Herrn werden 404-Replies nicht gespeichert.
 D.h. wenn der Host "Fehler 404/File not found" liefert, wird nicht
 die mitgelieferte Fehler-HTML-seite des Hosts angezeigt, sondern
 die CAB-interne Fehlermeldung. Dadurch landen solche Seiten
 nicht mehr im Cache.


GET_IP/RSDAEMON:

-Offensichtlich ist hier bei der Umstellung einer Protokoll-Nummer
 was durcheinander gekommen. Behoben.



énderungen an den PPP-Connect Programmen von Version 1.0
zu Version 1.1:


ICONF:

-Fehler behoben:
 Der ETC-Path wurde falsch gespeichert, wenn er als Pfad und
 nicht Åber eine Environment-Variable angegeben wurde

-Neu:
 Die Service-Server und Proxies kînnen jetzt auch per Host-
 Namen angegeben werden. Die zugehîrige IP wird dann beim
 Verbindungsaufbau von IConnect ermittelt.
 Die zugehîrigen Editfelder sind scrollbar und fassen so
 bis zu 64 Zeichen.
 
-Neu:
 Die Passworteingabe erfolgt jetzt mit einem '*'-Editfeld
 (anstatt wie bisher einem weiûen Feld).

-Neu:
 IConf merkt jetzt, ob Åberhaupt etwas geÑndert wurde und
 verzichtet daher beim Beenden ggf. auf die Warnmeldungen.
 Deshalb gibt es jetzt auch keine OK/Abbruch-Buttons mehr,
 die wÅrden nÑmlich logischerweise beide die selbe Meldung
 ("énderungen sichern?") bringen, oder garnix, wenn nix 
 geÑndert wurde.
 Stattdessen gibt es jetzt die Buttons "Sichern" (sichert ohne
 RÅckfrage) und "Beenden". Letzterer beendet nur, wenn seit
 dem letzten Sichern keine énderungen vorgenommen wurden,
 ansonsten erfolgt eine RÅckfrage.

-Neu:
 Im Dialog "Modem" kann jetzt ein Initialisierungsstring ein-
 gegeben werden.

 Im Dialog "Zugang" kînnen jetzt die Anwahlparameter Rufnummer,
 Wahlart und Wahlwiederholung eingestellt werden.
 Damit wird das Login-Script fÅr "PPP-Direkt-ZugÑnge" jetzt
 nicht mehr benîtigt und auûerdem merkt IConnect schneller, ob
 z.B. belegt ist (bisher muûte dazu der Login-Timeout abgewartet
 werden).

 Zudem erfolgt die 7-Bit-Umstellung erst nach erfolgter Anwahl,
 damit sollte jetzt also auch der Compuserve Zugang keine
 Probleme mehr machen.
 
 Sollte diese neue Option nicht funktionieren (weil das Modem
 andere Antworten liefert) kann wie bisher das Login-Script
 fÅr die gesamte Anwahl verwendet werden, indem man die neuen
 Felder einfach leer lÑût.


ICONNECT:

-Fehler behoben:
 Absturz, wenn ein Proxy-Eintrag erfragt wurde, fÅr den keine
 Port-Nummer angegeben war.

-Neu:
 IConnect merkt sich die Position des Online-Fensters in der
 Datei ICONNECT.CFG.

-Neu:
 Die Passworteingabe erfolgt jetzt mit einem '*'-Editfeld
 (anstatt wie bisher einem weiûen Feld).
 
-Neu:
 Die Editfelder fÅr User-/Passworteingabe sind srollbar. Der
 Dialog ist dadurch deutlich gefÑlliger.
 
-Neu:
 Wurden Proxies oder Server per Name statt IP in IConf ein-
 getragen, so wird die jeweilige IP jetzt beim Verbindungs-
 aufbau ermittelt (wird als Statustext unter dem Prozeûbalken
 angezeigt).
 
 Dazu ist das Programm RSDAEMON.PRG notwendig, daû sich im
 gleichen Ordner wie ICONNECT.PRG befinden muû. Es wird beim Start
 von ICONNECT.PRG automatisch nachgestartet und nach dem Abbau
 der Verbindung auch automatisch wieder beendet.

-Neu:
 Beim Beenden der Verbindung informiert jetzt ebenfalls ein
 Status-Fenster Åber die VorgÑnge (Abbau der Netzwerkver-
 bindungen und Auflegen des Modems).
 Bisher erschien einfach der Desktop und evtl. ein paar 
 Sekunden spÑter der Bienen-Mauszeiger. Manche Leute haben nicht
 so lange gewartet und in der Annahme, das Auflegen hÑtte nicht
 geklappt, das Modem aus/eingeschaltet.

-Neu:
 IConnect legt in seinem Verzeichnis eine Datei ONLINE.LOG an,
 in der die Verbindungszeiten festgehalten werden. Die EintrÑge
 sehen immer wie folgt aus:
 Zuerst kommt das Stichwort "ONLINE" oder "OFFLINE", danach ein
 Leerzeichen, der Name des Setups, ein Tabstop-Zeichen und dann
 der Zeitpunkt im ctime-Format. Zeilenabschluû ist ein LF. 
 Das ctime-Format sieht so aus, wobei alle Felder konstante LÑnge
 haben:
 
 Mon Nov 21 11:31:54 1983
 
 Mit dieser Datei kann man also mal so grob die entstandenen Kosten
 abschÑtzen. Auûerdem sollte man natÅrlich von Zeit zu Zeit danach
 schauen, daû sie nicht zu groû wird.

-Neu:
 Die neuen Parameter fÅr Modem-Initialisierung und Anwahl werden
 unterstÅtzt. Dabei wird wie folgt vorgegangen:
 Der Modem-Init-String wird mit fÅhrendem (fÅr RestmÅll im Port)
 und abschlieûendem Return verschickt. Es wird auf "OK" gewartet.
 Bei Tonwahl wird "atdt ", bei Pulswahl "atdp " plus Rufnummer
 und Return verschickt. 
 Kommt "CONNECT" oder "CARRIER" zurÅck (und nicht "NO CARRIER"),
 gilt die Anwahl als erfolgreich und das Login-Script wird 
 ausgefÅhrt (das dann z.B. nur noch aus "Fertig, PPP" bestehen kann).
 Bei BUSY wird die eingestellte Anwahlpause eingelegt.
 Ansonsten wird die Antwort des Modems als Fehlermeldung ausgegeben,
 wobei CR oder LF als Ende der Antwort interpretiert wird. Die
 Anwahl wird in diesem Fall abgebrochen.

 LÑût man den Modem-Init-String und/oder die Rufnummer in IConf leer,
 wird der jeweilige Anwahl-Teil ausgelassen, alte Setups verhalten
 sich also genau wie bisher.

-Neu:
 Das Modem wird nicht mehr unnîtig aufgelegt, wenn man wÑhrend einer
 Script-Retry-Pause den Abbruch-Button betÑtigt.

-Neu:
 Im Online-Fenster wird jetzt die lokale IP angezeigt.

-(Schînheits-)Fehler behoben:
 Der Fenstertitel im Online-Fenster paût jetzt, weil nur noch
 "PPP-Connect" drinsteht.

-Neu:
 Der Rahmen des Prozeû-Balkens im Verbindungsaufbau-Fenster ist
 etwas hÅbscher.
 Auûerdem sitzen die Icons einen Pixel hîher, sieht auch netter
 aus.

-Neu:
 Bei Nicht-8-Bit-öbertragungen werden die "Sende-Text"-Strings
 des Login-Scripts zeichenweise verschickt.


CAB.OVL:

-Fehler behoben:
 In speziellen FÑllen konnte es vorkommen, daû der HTTP-Header
 nicht abgeschnitten wurde. Die vielfÑltigen Auswirkungen
 (Seiten werden falsch angezeigt, Bilder werden garnicht angezeigt,
 Redirections funktionieren nicht...) sind damit beseitigt.
 
-Fehler behoben:
 Es konnte vorkommen, daû die erste Zeile des Headers verloren
 ging, dadurch klappte die Redirection in solchen FÑllen nicht
 (weil der Returncode des Servers nicht ausgewertet werden konnte).
 
-Neu:
 Das OVL akzeptiert jetzt so ziemlich jeden spezifikations-widrigen
 Bullshit, den irgendwelche Server meinen als Zeilentrenner schicken
 zu mÅssen.
 Die goldene Zitrone verdient sich germany.net (151.189.0.20), der meint,
 die Redirection-Info mit CR/LF nach der ersten Header-Zeile, LF nach
 allen weiteren, und CR/LF/LF als Header-Ende abschicken zu dÅrfen.

-Neu:
 Das OVL sendet jetzt das "User-Agent"-Header-field. Damit
 funktionieren die Testseiten auf
 http://www.research.digital.com/nsl/formtest/home.html
 und die "Internet Movie Database" auf
 http://uk.imdb.com/
 
-Das Formular auf der Seite http://search.t-online.de/
 funktioniert.

-Die Fehlermeldung "Die angegebene Methode wird nicht
 unterstÅtzt" bei http://www.sperrmuell.de erscheint
 nicht mehr
 
-Neu:
 Das OVL kann jetzt auch eMails verschicken. Dazu muû in ICONF
 unter "SERVICES" unbedingt die eigene eMail-Adresse und der
 SMTP-Server eingetragen sein!
 Die Status-Meldungen wÑhrend des Versendens sind nicht besonders
 aussagekrÑftig. Es wird nur zwischen "Sending request" und
 "Waiting for reply" gewechselt. Besonders wenn wÑhrend des
 Verschickens des eigentlichen Mail-Textes nur "Sending request"
 erscheint, ist das etwas irrefÅhrend und kînnte evtl. den einen
 oder anderen Anwender zur umgehenden BetÑtigung des STOP-Buttons
 animieren.
 
-Neu:
 Das OVL kann jetzt auch Artikel aus Newsgroups anzeigen, wie sie
 z.B. manchmal auf Suchmaschinen referenziert werden. Dazu muû in 
 ICONF unter "SERVICES" der NEWS-Server eingetragen sein!

-Fehler behoben:
 Relative Links in Redirections werden jetzt richtig aufgelîst.
 Damit funktioniert z.B. http://www.web.de
 
-Fehler behoben:
 Doppelpunkte in der Pfadangabe einer URL wurden irrtÅmlich auch
 dann als Trennzeichen fÅr eine alternative Portnummer ausgewertet,
 wenn sie hinter dem "/" fÅr den Pfad standen. Behoben.
 Damit funktionieren jetzt die Links auf http://www.apple.com

-Neu:
 WÑhrend "Resolving host" kann man jetzt auch den STOP-Button
 benutzen.
 Dazu muû RSDAEMON.PRG parallel laufen, was von IConnect automatisch
 beim Start erledigt wird.
 Ist RSDAEMON nicht da, wird die bisherige Methode benutzt (CAB steht
 dann wie bisher wÑhrend "Resolving host" still).


GET_IP:

-Neu:
 Das Editfeld ist scrollbar und faût max. 64 Zeichen.
 
-Neu:
 Die gefundene IP wird so ins Clipboard kopiert, wie sie auf dem 
 Bildschirm steht (bisher wurden die Punkte weggelassen und die
 Zahlen mit fÅhrenden Nullen auf drei Stellen aufgefÅllt, damit
 sie in die speziellen IP-Editfelder von IConf eingefÅgt werden
 konnten. Da diese aber jetzt normale Textfelder sind, liefert
 GET_IP eben auch im normalen Textformat).

-Neu:
 Der RSDAEMON wird unterstÅtzt, d.h. man kann das Fenster auch
 wÑhrend laufender Suche verschieben, eine neue Suche eingeben,
 das Programm beenden etc.

-Neu:
 In der IP-Anzeige wird jetzt auch der Status "Suchen..." und
 "Unbekannt" gemeldet.


SOCKETS:

-Fehler behoben:
 In der PPP-Initialisierung wurde ein CONF-NAK fÅr das Authentication-
 Protokoll mit einem falschen Parameter verschickt.

-Neu:
 Die ACCM der Gegenstelle wird nun erst nach abgeschlossener PPP-
 Konfiguration verwendet. Dadurch ist nun auch der Verbindungsaufbau
 zu Hosts mîglich, die nicht damit rechnen, daû ihre angebotene
 Tabelle bereits wÑhrend der Konfiguration benutzt wird.

-Neu:
 Workaround fÅr DesignschwÑche im PPP-Protokoll, die dazu fÅhren
 konnte, daû durch ein verlorenes oder verspÑtetes Antwort-Paket
 die Initialisierung in eine Endlosschleife geriet.

-Neu:
 getsockopt()  mit SO_SNDBUF liefert fÅr SOCK_STREAM-sockets jetzt
 die Anzahl der auf TCP-Ebene noch vorhandenen Bytes, fÅr die noch
 keine EmpfangsbestÑtigung eingetroffen ist.

-Neu:
 Workaround fÅr bestimmten Host, der Code Reject 23 nicht versteht.


RSDAEMON.PRG:

-Neues Programm, daû gehthostbyname() per AES-Message ausfÅhrt und
 das Ergebnis auch per Message zurÅckgibt. Allerdings kein ganzes
 hostent-struct sondern nur die IP als ulong.
 Da Unix keinen nicht-blockierenden Modus fÅr gethostbyname() vor-
 sieht, muûte man sich bisher wÑhrend des resolvens mit aufwendigeren
 Methoden (Thread oder eigener Resolver) behelfen, falls unbedingt
 nîtig.

Hier der neue Abschnitt aus der Prog-Doku:

----------

Der RSDAEMON ist eine parallel laufende Applikation, die die Aufgabe des
Resolvers per AES-Message Åbernimmt. Sinn ist quasi ein nichtblockierendes
gethostbyname(), allerdings liefert der RSDAEMON nur eine IP, kein ganzes
hostent-struct.

Der RSDAEMON wird normalerweise automatisch von IConnect gestartet und 
beendet.

Nutzung:

Per appl_find("RSDAEMON") ist die App-ID zu ermitteln. Im Fehlerfall
sollte man auf das blockierende gethostbyname() zurÅckgreifen und nur,
wenn garnicht anders mîglich, stattdessen mit Fehlermeldung abbrechen.

Nun kann dem RSDAEMON eine AES-Message geschickt werden:

#include <rsdaemon.h>

pbuf[0]=RSDAEMON_MSG
pbuf[1]=<eigene App-ID>
pbuf[2]=0
pbuf[3]=RSD_REQUEST_IP
pbuf[4]=<eigene frei wÑhlbare ID, um die Antwort zuordnen zu kînnen>
pbuf[5/6]=<Zeiger auf den String, der den Namen des Hosts enthÑlt>
           (Ggf. Speicherschutz beachten!)

Der RSDAEMON liefert eine Antwort folgender Form:

pbuf[0]=RSDAEMON_MSG
pbuf[1]=<RSDAEMON-ID>
pbuf[2]=0

pbuf[3]=RSD_IP_UNKNOWN = IP konnte nicht ermittelt werden. Das kann
                         verschiedene Ursachen haben (User hat keinen
                         DNS eingetragen, DNS kenn den Host nicht etc.)
pbuf[4]=<hier wird die ID aus dem Request zurÅckgeliefert>

oder:

pbuf[3]=RSD_IP_FOUND
pbuf[4]=<hier wird die ID aus dem Request zurÅckgeliefert>
pbuf[5/6]=<IP des Hosts als ulong>

----------

Und hier noch die RSDAEMON.H:

#ifndef __RSDAEMON__
#define __RSDAEMON__

#define RSDAEMON_MSG	0x995

#define RSD_REQUEST_IP	1
#define RSD_IP_FOUND		2
#define RSD_IP_UNKNOWN	3

#endif
----------
