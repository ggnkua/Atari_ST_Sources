; ************************************************************
; *   A SCROLLING ROUTINE WITH SAMPLED SOUND, WRITTEN BY:    *
; *       THE MEGA MIGHTY TDB OF TLT (WHO ELSE??)            *
; ************************************************************

 MOVE.L A7,A5
 MOVE.L 4(A5),A5
 MOVE.L $C(A5),D0
 ADD.L $14(A5),D0
 ADD.L $1C(A5),D0
 ADD.L #$1100,D0
 MOVE.L A5,D1
 ADD.L D0,D1
 AND.L #-2,D1
 MOVE.L D1,A7
 MOVE.L D0,-(SP)
 MOVE.L A5,-(SP)
 MOVE.W D0,-(SP)
 MOVE.W #$4A,-(SP)
 TRAP #1
 ADD.L #12,SP

 MOVE.W #0,-(SP)
 MOVE.L #-1,-(SP)
 MOVE.L #-1,-(SP)
 MOVE.W #5,-(SP)
 TRAP #14
 ADD.L #12,SP

 MOVE.W #2,-(SP)
 TRAP #14
 ADDQ.L #2,SP
 MOVE.L D0,SCREEN

 MOVE.L FONTPOINT,A4
 MOVE.W #0,D4
 MOVE.W #15,D5
COLORS:
 MOVE.W 4(A4),-(SP)
 MOVE.W D4,-(SP)
 MOVE.W #7,-(SP)
 TRAP #14
 ADDQ.L #6,SP
 ADD.L #2,A4
 ADD.W #1,D4
 DBRA D5,COLORS
 ADD.L #128,FONTPOINT
 MOVE.L #SCROLLTXT,BOKSTAV
 BSR INIT
 CLR.W COUNTER

MAIN:
 BSR COPY
 CMP.W #0,COUNTER
 BNE INTE
 MOVE.W #16,COUNTER
 BSR GETBOK
INTE:
 BSR SCROLL
 CMP.B #185,$FFFC02
 BEQ QUIT
 BRA MAIN

GETBOK: MOVE.L BOKSTAV,A0
 ADD.L #1,BOKSTAV
 CLR.L D1
 MOVE.B (A0),D1
 CMP.B #0,D1
 BNE NEXT2
 MOVE.L #SCROLLTXT,BOKSTAV
 BRA GETBOK
NEXT2: CMP.B #32,D1
 BNE NEXT4
 MOVE.L #BOKADR,A0
 MOVE.L (A0),ADDSUM
 RTS
NEXT4: SUB.L #32,D1
 MULU #4,D1
 MOVE.L #BOKADR,A0
 ADD.L D1,A0
 MOVE.L (A0),ADDSUM
 RTS

SCROLL:
 MOVE.L #BUFFER,A1
 ADDA.L #160,A1
 MOVE.L FONTPOINT,A0
 ADDA.L ADDSUM,A0
 MOVE.L #15,D3
LINES16:
 MOVE.L A1,-(SP)
 MOVE.L #3,D2
BITPL:
 CLR.L D1
 ROXL.W #1,D1
 CLR.L D1
 MOVE.W (A0),D1
 ROL.W #1,D1
 MOVE.W D1,(A0)+
 ROXR.W #1,D1
 ROXL.W 152(A1)
 ROXL.W 144(A1)
 ROXL.W 136(A1)
 ROXL.W 128(A1)
 ROXL.W 120(A1)
 ROXL.W 112(A1)
 ROXL.W 104(A1)
 ROXL.W 96(A1)
 ROXL.W 88(A1)
 ROXL.W 80(A1)
 ROXL.W 72(A1)
 ROXL.W 64(A1)
 ROXL.W 56(A1)
 ROXL.W 48(A1)
 ROXL.W 40(A1)
 ROXL.W 32(A1)
 ROXL.W 24(A1)
 ROXL.W 16(A1)
 ROXL.W 8(A1)
 ROXL.W (A1)
 ADDQ.L #2,A1
 DBRA D2,BITPL
 MOVE.L (SP)+,A1
 ADDA.L #160,A1
 ADDA.L #152,A0
 DBRA D3,LINES16
 SUBQ.W #1,COUNTER
 RTS

COPY:
 MOVE.L #BUFFER,A0
 MOVE.L SCREEN,A1
 ADDA.L #160*100,A1
 MOVE.L #1279,D5
WAIT:
 CMP.W #1,VTRUE
 BNE WAIT
 MOVE.W #0,VTRUE
MOVE:
 MOVE.L (A0)+,(A1)+
 DBRA D5,MOVE
 RTS

INIT:
 MOVE.L #59122,LENGTH
 MOVE.L #SOUNDBUFF,D6
 ADD.L LENGTH,D6
 MOVE.L D6,SBUFF
 MOVE.L #SOUNDBUFF,PLAYPOS
                 
 CLR.L -(SP)
 MOVE.W #$20,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 MOVE.L D0,SPSAVE

 MOVE.L #10,D0
SETREGS:
 MOVE.B D0,$FFF8800
 CLR.B $FFF8802
 DBF D0,SETREGS
 CLR.B $FFF8800
 CLR.B $FFF8802
 MOVE.B #7,$FFF8800
 MOVE.B #$F8,$FFF8802

 MOVE.L $70,VSAVE
 MOVE.L #VSYNC,$70
 MOVE.B $FFFA07,INT1
 MOVE.B $FFFA09,INT2
 MOVE.B #0,$FFFA07
 MOVE.B #0,$FFFA09
 LEA CHANEL_A(PC),A6
 MOVE.L PLAYPOS,A3
 MOVE.L #$FFFF8800,A5

STARTINT:
 MOVE.L #ISR,-(SP)
 MOVE.W #5,-(SP)
 MOVE.W #4,-(SP)
 MOVE.W #0,-(SP)
 MOVE.W #31,-(SP)	
 TRAP #14
 ADD.L #12,SP
 RTS

QUIT:
 MOVE.B INT1,$FFFA07
 MOVE.B INT2,$FFFA09
 MOVE.L VSAVE,$70
 MOVE.W #$20,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 CLR.W -(SP)
 TRAP #1

ISR:             
 MOVE.B (A3)+,D0
 MOVE.L SBUFF,D6
 CMPA.L D6,A3
 BLT.S OUTPUT
 MOVE.L #SOUNDBUFF,A3

OUTPUT:
 AND.W #$FF,D0
 MOVE.B #8,(A5)
 MOVE.B 0(A6,D0.W),2(A5)
 MOVE.B #9,(A5)
 ADD.L #256,A6
 MOVE.B 0(A6,D0.W),2(A5)
 MOVE.B #10,(A5)
 ADD.L #256,A6
 MOVE.B 0(A6,D0.W),2(A5)
 SUB.L #512,A6
 MOVE.L A3,PLAYPOS
 BCLR #5,ISRA
 RTE

CHANEL_A:
 DC.L    $00000000,$00000000,$00000000,$00000000
 DC.L    $00010000,$00000001,$00000000,$00000001
 DC.L    $02000000,$00010000,$01020001,$00010203
 DC.L    $00010000,$00000100,$01020000,$00010203
 DC.L    $00010204,$00000001,$02000100,$00010001
 DC.L    $02030001,$00010200,$01020403,$03000102
 DC.L    $06050300,$00010001,$02000000,$01020001
 DC.L    $02000100,$01020000,$01020203,$00010204
 DC.L    $05030001,$02060503,$00010200,$01020207
 DC.L    $03030504,$04050000,$00010200,$01020001
 DC.L    $00010203,$00010202,$04000102,$04000100
 DC.L    $01020305,$03040404,$00010206,$07030304
 DC.L    $04040505,$05060600,$00010207,$0B030309
 DC.L    $04080001,$02020603,$03000001,$02020303
 DC.L    $06080404,$05070706,$06060908,$07070707
 DC.L    $0B0B0000,$00000102,$00010200,$01000100

CHANEL_B:
 DC.L    $00000001,$02000102,$00010001,$02030001
 DC.L    $02020400,$01020404,$03000102,$06050303
 DC.L    $03040001,$02020703,$03030404,$05050504
 DC.L    $06060001,$02070703,$03030408,$05050504
 DC.L    $06060608,$00010202,$02030308,$04040505
 DC.L    $05040606,$09090907,$07070607,$07080808
 DC.L    $0607080A,$0A0A0909,$09000102,$02020303
 DC.L    $03040405,$05050A06,$0606060A,$07070706
 DC.L    $0A070808,$08060708,$0B0B0B09,$09090907
 DC.L    $09090B09,$09090001,$02020203,$03030404
 DC.L    $05050504,$06060606,$05070707,$060B0B08
 DC.L    $08080B07,$080B0808,$0909090B,$07090909
 DC.L    $09090909,$0909090A,$0A0A0A09,$0B0A0A0B
 DC.L    $0A090C0C,$0C0C0A0C,$0C0B0B0B,$0B0B0B0B
 DC.L    $0C0A0B0B,$0B0C0C0B,$0B0B0A0C,$0B0B0B0B
 DC.L    $0B0B0000,$01020202,$03030304,$0405050C

CHANEL_C:
 DC.L    $00010202,$02030303,$04040505,$05040606
 DC.L    $06060507,$07070606,$07080808,$06070808
 DC.L    $08080909,$09090709,$09090909,$09090909
 DC.L    $09090A0A,$0A09090A,$0A0A0A09,$0A0A0A0A
 DC.L    $0A0A0A09,$0B0B0B0B,$0B0B0B0A,$0B0B0B0B
 DC.L    $0B0B0B0B,$0A0A0A0B,$0B0B0B0B,$0B0B0B0B
 DC.L    $0B0B0B0A,$0A0A0B0B,$0B0C0C0C,$0C0C0C0C
 DC.L    $0C0C0C0C,$0C0C0B0C,$0C0C0C0B,$0C0C0C0C
 DC.L    $0B0C0C0C,$0C0C0C0C,$0B0B0B0C,$0C0C0C0C
 DC.L    $0C0C0B0C,$0C0C0D0D,$0D0D0D0D,$0D0D0D0D
 DC.L    $0D0D0D0D,$0D0D0D0D,$0D0D0D0D,$0D0C0C0D
 DC.L    $0D0D0C0D,$0D0C0D0D,$0D0D0D0C,$0D0D0D0D
 DC.L    $0D0D0D0D,$0D0D0D0D,$0D0D0D0D,$0B0D0D0C
 DC.L    $0D0D0C0C,$0C0C0D0C,$0C0D0D0D,$0D0D0D0D
 DC.L    $0C0D0D0D,$0D0C0C0D,$0D0D0D0C,$0D0D0D0D
 DC.L    $0C0C0E0E,$0E0E0E0E,$0E0E0E0E,$0E0E0E0D

VSYNC:
 MOVE.W #1,VTRUE
 RTE
			 		
VTRUE:			DC.W 0
SPSAVE:        		DS.L 1
SOUNDBUFF:		INCBIN A:\MEGA10.SPL
STACKST:      		DS.W 1
SAVESP:        		DS.L 1
LENGTH:       		DS.L 1
SBUFF:      		DS.L 1
PLAYPOS:      		DS.L 1
VSAVE:	 		DS.L 1
INT1: 			DS.B 1
INT2:			DS.B 1
ISRA:        		EQU $FFFA00+$F
FONTBUF:                INCBIN A:\16X16_02.NEO
FONTPOINT:              DC.L FONTBUF
SCREEN:                 DC.L 0
HANDLE:                 DC.W 0
BOKSTAV:                DC.L 0
ADDSUM:                 DC.L 0
COUNTER:		DC.W 0
BOKADR: 		DC.L 12800,5136,5144,5176,5168,12800,5184,12800
     			DC.L 2704,2712,0,5352,2696,5360,2688,5368,2680,2608,2616
       			DC.L 2624,2632,2640,2648,2656,2664,2672,5120,5128
       			DC.L 2712,0,0,5160,0
      			DC.L 0,8,16,24,32,40,48,56,64,72
      			DC.L 80,88,96,104,112,120,128,136,144,152
     			DC.L 2560,2568,2576,2584,2592,2600
SCROLLTXT:  		DC.B 'YEAH! NICE SAMPLING, EEHH  ????? ????    ',0
BUFFER:			DS.W 2560
		END	 