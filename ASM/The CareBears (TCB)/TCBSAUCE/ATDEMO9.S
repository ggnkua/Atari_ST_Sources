        org     $8000
        load    $88000

x:      jmp     main
; A new 3d scroller

; Ante Raster
; **************************************************************



initializeraster:

        moveq   #127,d0
omfs9:  move.w  d0,-(sp)
        lea     bigsintab,a0
        adda.l  sinadding,a0
        lea     180(a0),a0
        moveq   #0,d0
        move.l  d0,d1
        move.l  d0,d2
        move.l  d0,d3
        move.l  d0,d4
        move.l  d0,d5
        move.l  d0,d6
        move.l  d0,a1
        move.l  d0,a2
        move.l  d0,a3
        move.l  d0,a4
        move.l  d0,a5
        movem.l d0-d6/a1-a5,-(a0)
        movem.l d0-d6/a1-a5,-(a0)
        movem.l d0-d6/a1-a5,-(a0)
        movem.l d0-d6/a1-a2,-(a0)


        lea     tabsn1(pc),a0
        lea     temptab(pc),a1

        move.w  sintabpek,d1
        lsl.w   #2,d1
        addq.w  #1,sintabpek
        and.w   #127,sintabpek


forbifs2:
        moveq   #5,d0
omfs1:  move.l  (a0,d1.w),(a1)+
        add.w   #56,d1
        and.w   #511,d1
        dbra    d0,omfs1 

        moveq   #5,d3
omfs4:  lea     temptab(pc),a0
        moveq   #0,d5
        move.w  (a0),d4
        move.w  2(a0),d5
        moveq   #5,d0
omfs2:  move.l  (a0)+,d1
        cmp.w   d5,d1
        bgt.s   utfs1
        move.w  d1,d5           ;d5 lastmin
        swap    d1
        move.w  d1,d4           ;d4 lastminpos
        move.l  a0,a2
utfs1:  dbra    d0,omfs2
        move.w  #32767,-2(a2)

        lsr.w   #7,d5
        subq.w  #1,d5
        move.w  d5,d1
        subq.w  #8,d1
        lsr.w   #1,d1
        lsl.w   #2,d1
        lea     sizetab(pc),a0
        move.l  (a0,d1.w),a1
        lsl.w   #1,d4

        add.w   (a1)+,d4

        lea     bigsintab,a2
        adda.l  sinadding,a2
        adda.l  d4,a2

        btst    #0,d5
        beq.s   omfs3
        subq.w  #1,d5

omfs3:  
        move.w  (a1)+,(a2)+
        dbra    d5,omfs3 

        dbra    d3,omfs4


        
        lea     bigsintab,a0
        adda.l  sinadding(pc),a0
        or.w    #$8000,72(a0)
        or.w    #$8000,174(a0)

        add.l   #180,sinadding
        move.w  (sp)+,d0
        dbra    d0,omfs9
        
        rts


sinadding:      dc.l    0
sintabpek:      dc.w    0
temptab:        blk.l   16,0
sizetab:        dc.l    b09,b11,b13,b15,b17,b19,b21,b23
                dc.l    b25,b27




;b27:            dc.w   0
                dc.w    $001,$002,$003,$004,$005,$006,$007,$117
                dc.w    $227,$337,$447,$557,$667,$777,$667,$557
                dc.w    $447,$337,$227,$117,$007,$006,$005,$004
                dc.w    $003,$002,$001

;b25:            dc.w   2
                dc.w    $001,$002,$003,$004,$005,$006,$007,$117
                dc.w    $227,$337,$447,$557,$667,$557
                dc.w    $447,$337,$227,$117,$007,$006,$005,$004
                dc.w    $003,$002,$001

;b23:            dc.w   4
                dc.w    $001,$002,$003,$004,$005,$006,$007,$117
                dc.w    $227,$337,$447,$557
                dc.w    $447,$337,$227,$117,$007,$006,$005,$004
                dc.w    $003,$002,$001
;b21:            dc.w   6
                dc.w    $001,$002,$003,$004,$005,$006,$007,$117
                dc.w    $227,$337
                dc.w    $447,$337,$227,$117,$007,$006,$005,$004
                dc.w    $003,$002,$001
;b19:            dc.w   8
                dc.w    $001,$002,$003,$004,$005,$006,$007,$117
                dc.w    $227,$337
                dc.w    $447,$337,$227,$117,$007,$006,$005,$004
                dc.w    $003,$002,$001
;b17:            dc.w   10
                dc.w    $001,$002,$003,$004,$005,$006,$007,$117
                dc.w    $227,$337
                dc.w    $227,$117,$007,$006,$005,$004
                dc.w    $003,$002,$001
;b15:            dc.w   12
                dc.w    $001,$002,$003,$004,$005,$006,$007,$117
                dc.w    $227,$117,$007,$006,$005,$004
                dc.w    $003,$002,$001
;b13:            dc.w   14
                dc.w    $001,$002,$003,$004,$005,$006,$007,$117
                dc.w    $007,$006,$005,$004
                dc.w    $003,$002,$001
;b11:            dc.w   16
                dc.w    $001,$002,$003,$004,$005,$006
                dc.w    $007,$006,$005,$004
                dc.w    $003,$002,$001
;b09:            dc.w   18
                dc.w    $001,$002,$003,$004,$005,$006
                dc.w    $005,$004
                dc.w    $003,$002,$001



b27:            dc.w    0,$100,$200,$300,$400,$500,$600,$700
                dc.w    $710,$720,$730,$741,$752,$763,$772
                dc.w    $763,$752,$741,$730,$720,$710,$700
                dc.w    $600,$500,$400,$300,$200,$100

b25:            dc.w    2,$100,$200,$300,$400,$500,$600,$700
                dc.w    $710,$720,$730,$741,$752
                dc.w    $763,$752,$741,$730,$720,$710,$700
                dc.w    $600,$500,$400,$300,$200,$100

b23:            dc.w    4,$100,$200,$300,$400,$500,$600,$700
                dc.w    $710,$720,$730,$741,$752
                dc.w    $741,$730,$720,$710,$700
                dc.w    $600,$500,$400,$300,$200,$100

b21:            dc.w    6,$100,$200,$300,$400,$500,$600,$700
                dc.w    $710,$720,$730
                dc.w    $741,$730,$720,$710,$700
                dc.w    $600,$500,$400,$300,$200,$100

b19:            dc.w    8,$100,$200,$300,$400,$500,$600,$700
                dc.w    $710,$720,$730
                dc.w    $720,$710,$700
                dc.w    $600,$500,$400,$300,$200,$100

b17:            dc.w    10,$100,$200,$300,$400,$500,$600,$700
                dc.w    $710
                dc.w    $720,$710,$700
                dc.w    $600,$500,$400,$300,$200,$100

b15:            dc.w    12,$100,$200,$300,$400,$500,$600,$700
                dc.w    $710
                dc.w    $700
                dc.w    $600,$500,$400,$300,$200,$100

b13:            dc.w    14,$100,$200,$300,$400,$500,$600,$700
                dc.w    $600,$500,$400,$300,$200,$100

b11:            dc.w    16,$100,$200,$300,$400,$500
                dc.w    $600,$500,$400,$300,$200,$100

b09:            dc.w    18,$100,$200,$300,$400,$500
                dc.w    $400,$300,$200,$100






tabsn1: 
        dc.w     1,2304,1,2361,1,2417,1,2473,2,2529,2,2584,
        dc.w     2,2638,3,2692,3,2745,4,2797,5,2847,5,2896,6,2944,
        dc.w     7,2990,8,3035,9,3078,10,3119,11,3158,12,3195,14,3229,
        dc.w     15,3262,16,3292,17,3320,19,3345,20,3368,22,3389,23,3406,
        dc.w     24,3421,26,3434,27,3444,29,3450,30,3455,32,3456,34,3455,
        dc.w     35,3450,37,3444,38,3434,40,3421,41,3406,42,3389,44,3368,
        dc.w     45,3345,47,3320,48,3292,49,3262,50,3229,52,3195,53,3158,
        dc.w     54,3119,55,3078,56,3035,57,2990,58,2944,59,2896,59,2847,
        dc.w     60,2797,61,2745,61,2692,62,2638,62,2584,62,2529,63,2473,
        dc.w     63,2417,63,2361,63,2304,63,2247,63,2191,63,2135,62,2079,
        dc.w     62,2024,62,1970,61,1916,61,1863,60,1811,59,1761,59,1712,
        dc.w     58,1664,57,1618,56,1573,55,1530,54,1489,53,1450,52,1413,
        dc.w     50,1379,49,1346,48,1316,47,1288,45,1263,44,1240,42,1219,
        dc.w     41,1202,40,1187,38,1174,37,1164,35,1158,34,1153,32,1152,
        dc.w     30,1153,29,1158,27,1164,26,1174,24,1187,23,1202,22,1219,
        dc.w     20,1240,19,1263,17,1288,16,1316,15,1346,14,1379,12,1413,
        dc.w     11,1450,10,1489,9,1530,8,1573,7,1618,6,1664,5,1712,
        dc.w     5,1761,4,1811,3,1863,3,1916,2,1970,2,2024,2,2079,
        dc.w     1,2135,1,2191,1,2247,







; **************************************************************


; 4:th bitplane utblatter
; ***************************************************************

blattut:
        lea     bittis4(pc),a0
        move.l  #picadd1,a1
        move.l  #picadd2,a2
        moveq   #89,d0
ombu1:  moveq   #19,d1
ombu2:  move.w  (a0),(a1)
        move.w  (a0)+,(a2)
        addq.l  #8,a1
        addq.l  #8,a2
        dbra    d1,ombu2
        dbra    d0,ombu1
        rts

bittis4:
;
;  NEOchrome cut buffer contents (left justified):
;
;    pixels/scanline    = $0140 (bytes/scanline: $0028)
;  # scanlines (height) = $005A
;
;  Monochrome mask (1 plane; background=0/non-background=1)
;
;
;
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$000C,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0700,$0180
        dc.w    $6000,$01F8,$1E00,$0000,$0000,$001F,$F00E,$0000
        dc.w    $0078,$0000,$0000,$1F81,$E000,$0000,$0000,$0000
        dc.w    $0000,$0000,$1FC0,$0180,$F000,$07FC,$3F80,$01E0
        dc.w    $0000,$007F,$FC3E,$0000,$01E0,$03E0,$0000,$7FC3
        dc.w    $F800,$1E00,$0000,$0000,$0000,$0000,$23E0,$07E1
        dc.w    $F800,$1FFE,$78C0,$07F8,$0000,$01FF,$FFFC,$0000
        dc.w    $0780,$0678,$0001,$FFE7,$8C00,$7F80,$0000,$0000
        dc.w    $0000,$0000,$41F0,$07E1,$FE00,$3FFF,$7840,$0FFC
        dc.w    $0200,$03FF,$FFF8,$0C00,$1F00,$0C7C,$0003,$FFF7
        dc.w    $8400,$FFC0,$2000,$0000,$0000,$0000,$00F8,$0187
        dc.w    $7FE0,$7C3F,$FC00,$1FFE,$0600,$0701,$FFE0,$3800
        dc.w    $7C00,$386F,$0007,$C3FF,$C001,$FFE0,$6000,$0000
        dc.w    $0000,$0000,$00FC,$01FC,$7FE0,$F01F,$FE00,$3FFF
        dc.w    $CC00,$0E00,$3F80,$F000,$F800,$7867,$C00F,$01FF
        dc.w    $E003,$FFFC,$C000,$0000,$0000,$0000,$007C,$01FC
        dc.w    $7FC0,$E00E,$7F00,$307F,$FC00,$0800,$0F03,$E001
        dc.w    $F000,$F063,$E00E,$00E7,$F003,$07FF,$C000,$0000
        dc.w    $0000,$0000,$007E,$01F0,$7F81,$C00E,$1F80,$207F
        dc.w    $F800,$0800,$0607,$8001,$E001,$E061,$F01C,$00E1
        dc.w    $F802,$07FF,$8000,$0000,$0000,$0000,$007E,$0180
        dc.w    $7F01,$C006,$0FC0,$406F,$F000,$0400,$780F,$0003
        dc.w    $E003,$E060,$F81C,$0060,$FC04,$06FF,$0000,$0000
        dc.w    $0000,$0000,$007E,$0180,$7F01,$C006,$0FE0,$8067
        dc.w    $E000,$0000,$781F,$0003,$C007,$C060,$FC1C,$0060
        dc.w    $FE08,$067E,$0000,$0000,$0000,$0000,$007E,$0180
        dc.w    $7E01,$E106,$07F0,$0060,$0000,$0001,$F81E,$0007
        dc.w    $C01F,$C060,$7C1E,$1060,$7F00,$0600,$0000,$0000
        dc.w    $0000,$0000,$007E,$0180,$7E00,$F306,$07F0,$0060
        dc.w    $0000,$0001,$F83E,$0007,$C07F,$8060,$7E0F,$3060
        dc.w    $7F00,$0600,$0000,$0000,$0000,$0000,$1FFE,$0180
        dc.w    $7E00,$FE06,$03F8,$0060,$0000,$007F,$F83E,$000F
        dc.w    $81FF,$8060,$7E0F,$E060,$3F80,$0600,$0000,$0000
        dc.w    $0000,$0000,$3FFE,$0180,$7E00,$7806,$03F8,$0060
        dc.w    $0000,$00FF,$F87E,$000F,$87FF,$8060,$7F07,$8060
        dc.w    $3F80,$0600,$0000,$0000,$0000,$0000,$67FE,$0180
        dc.w    $7E00,$0006,$01FC,$0060,$0000,$0087,$F87E,$001F
        dc.w    $8C1F,$8060,$7F00,$0060,$1FC0,$0600,$0000,$0000
        dc.w    $0000,$0000,$61FE,$0180,$7E00,$0006,$01FC,$0060
        dc.w    $0000,$00C3,$F87E,$001F,$881F,$8060,$7F00,$0060
        dc.w    $1FC0,$0600,$0000,$0000,$0000,$0000,$607E,$01FF
        dc.w    $FE00,$01FE,$00FE,$0060,$0000,$0021,$F87E,$001F
        dc.w    $881F,$8060,$7F80,$1FE0,$0FE0,$0600,$0000,$0000
        dc.w    $0000,$0000,$607E,$01FF,$FE00,$03FE,$00FE,$0060
        dc.w    $0000,$0001,$F87E,$003F,$841F,$8060,$7F80,$3FE0
        dc.w    $0FE0,$0600,$0000,$0000,$0000,$0000,$307E,$0180
        dc.w    $7E00,$0606,$007F,$1060,$0000,$0001,$F87E,$003F
        dc.w    $801F,$807F,$FF80,$6060,$07F1,$0600,$0000,$0000
        dc.w    $0000,$0000,$087E,$0180,$7E00,$0606,$007F,$7060
        dc.w    $0000,$0001,$F87E,$003F,$801F,$807F,$FF80,$6060
        dc.w    $07F7,$0600,$0000,$0000,$0000,$0000,$007E,$0180
        dc.w    $7E00,$0606,$003F,$E060,$0000,$000F,$F87E,$007F
        dc.w    $801F,$8060,$7F80,$6060,$03FE,$0600,$0000,$0000
        dc.w    $0000,$0000,$007E,$0180,$7E00,$0706,$001F,$E060
        dc.w    $0000,$003F,$F87E,$007F,$801F,$8060,$7F80,$7060
        dc.w    $01FE,$0600,$0000,$0000,$0000,$0000,$07FE,$0180
        dc.w    $7E00,$0186,$007F,$8060,$0000,$0023,$F87E,$007F
        dc.w    $80FF,$807F,$FF80,$1860,$07F8,$0600,$0000,$0000
        dc.w    $0000,$0000,$0FFE,$0180,$7E00,$0086,$007F,$8060
        dc.w    $0000,$0011,$F87E,$007F,$83FF,$807F,$FF80,$0860
        dc.w    $07F8,$0600,$0000,$0000,$0000,$0000,$187E,$01FF
        dc.w    $FE00,$0006,$00C7,$E060,$0000,$0009,$F87E,$007F
        dc.w    $823F,$8060,$7F80,$0060,$0C7E,$0600,$0000,$0000
        dc.w    $0000,$0000,$187E,$01FF,$FE00,$0006,$0087,$E060
        dc.w    $0000,$0001,$F87E,$007F,$811F,$8060,$7F80,$0060
        dc.w    $087E,$0600,$0000,$0000,$0000,$0000,$0C7E,$0180
        dc.w    $7E00,$007E,$0007,$F060,$0000,$0001,$F87E,$007F
        dc.w    $809F,$8060,$7F80,$07E0,$007F,$0600,$0000,$0000
        dc.w    $0000,$0000,$027C,$0180,$7E00,$00FE,$0007,$F060
        dc.w    $0000,$0001,$F87E,$007F,$801F,$0060,$7F80,$0FE0
        dc.w    $007F,$0600,$0000,$0000,$0000,$0000,$007C,$0180
        dc.w    $7E00,$0086,$0003,$F860,$0000,$0001,$F87E,$003F
        dc.w    $801F,$0060,$7F00,$0860,$003F,$8600,$0000,$0000
        dc.w    $0000,$0000,$0078,$0180,$7E00,$00C6,$0003,$F860
        dc.w    $0000,$0001,$F87E,$003F,$C01E,$0060,$FF00,$0C60
        dc.w    $003F,$8600,$0000,$0000,$0000,$0000,$01E0,$0000
        dc.w    $7E00,$0046,$0001,$FC60,$0000,$0001,$E07F,$001F
        dc.w    $C03E,$0060,$FE00,$0460,$001F,$C600,$0000,$0000
        dc.w    $0000,$0000,$0180,$0000,$FE00,$0026,$0001,$FC60
        dc.w    $0000,$0001,$E07F,$001F,$E03C,$0061,$FE00,$0260
        dc.w    $001F,$C600,$0000,$0000,$0000,$0000,$007F,$F800
        dc.w    $FE00,$0007,$E180,$FE60,$0000,$07F8,$00FF,$000F
        dc.w    $E070,$0061,$FC00,$007E,$180F,$E600,$0000,$0000
        dc.w    $0000,$0000,$03FF,$FF00,$FE00,$001F,$E380,$7F60
        dc.w    $0000,$1FFE,$00FF,$800F,$F000,$0063,$FC00,$01FE
        dc.w    $3807,$F600,$0000,$0000,$0000,$0000,$1FFF,$FFE1
        dc.w    $FE00,$007F,$FF00,$7FE0,$1000,$7FFF,$C1FF,$8007
        dc.w    $F800,$0063,$F800,$07FF,$F007,$FE01,$0000,$0000
        dc.w    $0000,$0000,$3FFF,$FFF9,$FF00,$01FF,$FE00,$3FE0
        dc.w    $2001,$F83F,$F3FF,$0003,$FC00,$0067,$F800,$1FFF
        dc.w    $E003,$FE02,$0000,$0000,$0000,$0000,$7F03,$FFFE
        dc.w    $7FE0,$07FF,$FC00,$1FF8,$6007,$C007,$FFF8,$0003
        dc.w    $FF00,$007F,$F000,$7FFF,$C001,$FF86,$0000,$0000
        dc.w    $0000,$0000,$F800,$7FFE,$1FE0,$0FFF,$F800,$0FFC
        dc.w    $C00F,$0001,$FFC0,$0000,$FFE0,$007F,$E000,$FFFF
        dc.w    $8000,$FFCC,$0000,$0000,$0000,$0000,$E000,$1FFC
        dc.w    $0FC0,$1F80,$7100,$03FF,$C00C,$0000,$FE00,$0000
        dc.w    $7FFF,$FFFF,$8001,$F807,$1000,$3FFC,$0000,$0000
        dc.w    $0000,$0001,$C000,$07E0,$07C0,$3C00,$E0C0,$01FF
        dc.w    $8018,$0000,$7800,$0000,$1FFF,$FFFE,$0003,$C00E
        dc.w    $0C00,$1FF8,$0000,$0000,$0000,$0001,$8000,$03C0
        dc.w    $0380,$3801,$C060,$007F,$0018,$0000,$6000,$0000
        dc.w    $07FF,$FFF0,$0003,$801C,$0600,$07F0,$0000,$0000
        dc.w    $0000,$0001,$8000,$0180,$0180,$3801,$80E0,$001E
        dc.w    $0018,$0000,$4000,$0000,$00FF,$FFE0,$0003,$8018
        dc.w    $0E00,$01E0,$0000,$0000,$0000,$0001,$8040,$0000
        dc.w    $0000,$3800,$01C0,$0000,$0018,$1000,$0000,$0000
        dc.w    $0000,$0060,$0003,$8000,$1C00,$0000,$0000,$0000
        dc.w    $0000,$0001,$C020,$0000,$0000,$1C00,$0380,$0000
        dc.w    $001C,$0800,$0000,$0000,$0000,$0060,$0001,$C000
        dc.w    $3800,$0000,$0000,$0000,$0000,$0000,$F018,$0000
        dc.w    $0000,$0E00,$0700,$0000,$000F,$0400,$0000,$0000
        dc.w    $0000,$01F8,$0000,$E000,$7000,$0000,$0000,$0000
        dc.w    $0000,$0000,$7C18,$0000,$0000,$0780,$1E00,$0000
        dc.w    $0003,$CC00,$0000,$0000,$0000,$01F8,$0000,$7801
        dc.w    $E000,$0000,$0000,$0000,$0000,$0000,$3FF0,$0000
        dc.w    $0000,$03FF,$F800,$0000,$0000,$F800,$0000,$0000
        dc.w    $0000,$0060,$0000,$3FFF,$8000,$0000,$0000,$0000
        dc.w    $0000,$0000,$07C0,$0000,$0000,$007F,$E000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0060,$0000,$07FE
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$FF3F,$C1F7,$F9FF,$F800
        dc.w    $007E,$1001,$F803,$FFE0,$0FFF,$F8FF,$FC00,$3F84
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $3FCF,$F07D,$FFFF,$FE00,$019F,$B407,$7E00,$FFF8
        dc.w    $03FF,$FE3F,$FF00,$CFED,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$1F07,$C050,$F960,$7C00
        dc.w    $0660,$7C1D,$C380,$7C06,$01E0,$0E1F,$01C1,$B03F
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $1E07,$8050,$F140,$7C00,$0D80,$3C3F,$01E0,$7803
        dc.w    $81E0,$0A1E,$01E3,$601F,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0E03,$8090,$F040,$F800
        dc.w    $1B00,$1C7E,$00F0,$7801,$C1E0,$021E,$00E3,$C00F
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0F03,$C0A0,$F001,$F800,$3600,$14FC,$0078,$7801
        dc.w    $E1E0,$001E,$00F3,$C007,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0F03,$C0A0,$F001,$F000
        dc.w    $3C00,$04F8,$007C,$7800,$E1E0,$001E,$00F3,$C005
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0705,$C120,$F003,$E000,$6C00,$01F8,$003C,$7800
        dc.w    $F1E0,$201E,$01B3,$E001,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0785,$E140,$F003,$E000
        dc.w    $7800,$01F0,$003E,$7800,$F1E0,$281E,$01E1,$FC00
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0785,$E140,$F007,$C000,$7800,$01F0,$003E,$7800
        dc.w    $F1E0,$681E,$0760,$7F80,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0389,$E240,$F00F,$C000
        dc.w    $7800,$01F0,$003E,$7800,$F1FF,$F81F,$FDC0,$1FE0
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $03CA,$F280,$F00F,$8000,$7800,$01F0,$003E,$7800
        dc.w    $F1FF,$F81E,$FF00,$07F8,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$03CA,$F280,$F01F,$0000
        dc.w    $7800,$01F0,$003E,$7800,$F1E0,$381E,$0E00,$00FE
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $01D2,$7480,$F01F,$0000,$7800,$01F0,$003E,$7800
        dc.w    $F1E0,$281E,$0700,$001F,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$01F4,$7D00,$F03E,$0000
        dc.w    $3800,$00F0,$007E,$7800,$F1E0,$081E,$0384,$000F
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $01F4,$7D00,$F07E,$0000,$3C00,$00F8,$007C,$7801
        dc.w    $B1E0,$001E,$03C5,$0007,$8000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$00E4,$3900,$F07C,$0000
        dc.w    $1C00,$0878,$00FC,$7801,$E1E0,$001E,$01C7,$0007
        dc.w    $8000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $00F8,$3E00,$F0F8,$0400,$0E00,$123C,$01F8,$7803
        dc.w    $61E0,$041E,$00E7,$8007,$8000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$00F8,$3E00,$F0F8,$0500
        dc.w    $0700,$641E,$03F0,$7806,$C1E0,$051E,$00F7,$C00D
        dc.w    $8000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0078,$1E01,$F1F0,$0D00,$0181,$9807,$0EE0,$F819
        dc.w    $83E0,$0D3E,$0077,$E01B,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0050,$1407,$FBFF,$FF00
        dc.w    $007E,$6001,$FB83,$FFE6,$0FFF,$FFFF,$007D,$BFE6
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0010,$0401,$FEFF,$FF00,$001F,$8000,$7E00,$FFF8
        dc.w    $03FF,$FF3F,$C01F,$0FF8,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000



; Our MegaDistorted AN Cool Logo
; ***************************************************************

Shiftanblock:
        lea     anblock,a0
        moveq   #0,d1
        move.l  d1,d2
        move.l  d1,d3
        move.l  d1,d4
        move.l  d1,d5
        move.l  d1,d6
        move.l  d1,d7
        move.l  d1,a1
        move.l  d1,a2
        move.l  d1,a3
        move.l  d1,a4
        move.l  d1,a5
        move.l  d1,a6
        moveq   #24,d0
omsa1:  movem.l d1-d7/a1-a4,(a0)
        movem.l d1-d7/a1-a4,44(a0)
        movem.l d1-d7/a1-a4,88(a0)
        move.l  d1,132(a0)
        move.w  d1,136(a0)
        lea     228(a0),a0
        dbra    d0,omsa1        
        
        lea     anorig,a0
        lea     anblock,a1
        moveq   #24,d0
        lea     138(a1),a1
omsa2:  moveq   #13,d1
omsa6:  move.l  (a0)+,(a1)+
        move.w  (a0)+,(a1)+
        addq.l  #2,a0
        dbra    d1,omsa6                

        clr.l   (a1)+
        clr.w   (a1)+

        lea     138(a1),a1
        dbra    d0,omsa2        

        lea     anblock,a0
        move.l  a0,a1
        lea     5700(a1),a1
        clr.w   shiftcount
        moveq   #14,d0
omsa4:  addq.w  #1,shiftcount
        move.l  #949,d1
omsa3:  
        movem.w (a0)+,d4-d6
        swap    d4
        swap    d5
        swap    d6
        move.w  #0,d4
        move.w  #0,d5
        move.w  #0,d6
        
        move.w  shiftcount,d3
        lsr.l   d3,d4
        lsr.l   d3,d5
        lsr.l   d3,d6
        move.w  d4,6(a1)
        move.w  d5,8(a1)
        move.w  d6,10(a1)
        swap    d4
        swap    d5
        swap    d6
        or.w    d4,(a1)
        or.w    d5,2(a1)
        or.w    d6,4(a1)
        addq.l  #6,a1
        dbra    d1,omsa3
        lea     anblock,a0
        dbra    d0,omsa4
        rts




distan:
        lea     ANdisttab(pc),a2
        add.l   ANdisttabwindpos(pc),a2
        move.l  currpicadd(pc),a1
        add.l   boingofs(pc),a1
        addq.l  #2,a1
        moveq   #24,d0
        moveq   #0,d1
omda1:  move.l  (a2)+,a0
        add.l   d1,a0
        move.l  a1,a3
        add.l   (a2)+,a3
        move.l  (a0)+,(a3)+
        move.w  (a0)+,(a3)
        move.l  (a0)+,4(a3)
        move.w  (a0)+,8(a3)
        move.l  (a0)+,12(a3)
        move.w  (a0)+,16(a3)
        move.l  (a0)+,20(a3)
        move.w  (a0)+,24(a3)
        move.l  (a0)+,28(a3)
        move.w  (a0)+,32(a3)
        move.l  (a0)+,36(a3)
        move.w  (a0)+,40(a3)
        move.l  (a0)+,44(a3)
        move.w  (a0)+,48(a3)
        move.l  (a0)+,52(a3)
        move.w  (a0)+,56(a3)
        move.l  (a0)+,60(a3)
        move.w  (a0)+,64(a3)
        move.l  (a0)+,68(a3)
        move.w  (a0)+,72(a3)
        move.l  (a0)+,76(a3)
        move.w  (a0)+,80(a3)
        move.l  (a0)+,84(a3)
        move.w  (a0)+,88(a3)
        move.l  (a0)+,92(a3)
        move.w  (a0)+,96(a3)
        move.l  (a0)+,100(a3)
        move.w  (a0)+,104(a3)
        move.l  (a0)+,108(a3)
        move.w  (a0)+,112(a3)
        move.l  (a0)+,116(a3)
        move.w  (a0)+,120(a3)
        move.l  (a0)+,124(a3)
        move.w  (a0)+,128(a3)
        move.l  (a0)+,132(a3)
        move.w  (a0)+,136(a3)
        move.l  (a0)+,140(a3)
        move.w  (a0)+,144(a3)

        lea     160(a1),a1
        add.l   #228,d1
        dbra    d0,omda1
        rts


disting:        
        move.l  ANdisttabwindpos(pc),d0
        addq.l  #8,d0
        cmp.l   #200,d0
        blt.s   forbid7
        moveq   #0,d0
forbid7:
        move.l  d0,ANdisttabwindpos
        lea     ANdisttab(pc),a0
        add.l   d0,a0

;       movem.l 8(a0),d0-d6/a1-a5
;       movem.l d0-d6/a1-a5,(a0)
;       movem.l 56(a0),d0-d6/a1-a5
;       movem.l d0-d6/a1-a5,48(a0)
;       movem.l 104(a0),d0-d6/a1-a5
;       movem.l d0-d6/a1-a5,96(a0)
;       movem.l 152(a0),d0-d6/a1-a5
;       movem.l d0-d6/a1-a5,144(a0)
        move.l  distpointer(pc),a1
        move.l  (a1)+,d0
        tst.w   d0
        bpl.s   vidared2
        move.l  distingpointer(pc),a2
        move.l  (a2)+,a1
        cmp.l   #-1,a1
        bne.s   vidared1
        lea     distingtab(pc),a2
        move.l  (a2)+,a1
vidared1:
        move.l  a2,distingpointer
        move.l  (a1)+,d0
vidared2:

        add.l   #16,d0
        move.l  d0,d1
        and.l   #15,d0
;       moveq   #15,d2
;       sub.l   d0,d2
        lea     tab5700(pc),a2
        lsl.w   #2,d0
        move.l  (a2,d0.w),d2

        move.l  d1,d4
        lsr.l   #1,d4
        and.l   #-8,d4
        lsr.l   #4,d1
        mulu    #6,d1


        move.l  #anblock,d0

        add.l   d2,d0
        moveq   #0,d3
        sub.l   #120,d1
        sub.l   #160,d4
;       d2=shifted address
;       d1=target offset
;       d3=calced target offset

        tst.l   d1
        bmi.s   specfall1
        cmp.l   #6,d1
        bgt.s   specfall2
specfall3:
        add.l   #126,d0
        add.l   d4,d3
;       add.l   #8,d0
;       add.l   #8,d3
        bra.s   forbiddd1
specfall1:
        add.l   #126,d0
        sub.l   d1,d0
        bra.s   forbiddd1
specfall2:
        move.l  #8,d3
        add.l   #126,d0
        subq.l  #6,d1
        sub.l   d1,d0
forbiddd1:
;       moveq   #0,d3
        move.l  d0,192(a0)
        move.l  d3,196(a0)
        move.l  d0,-8(a0)
        move.l  d3,-4(a0)
        
        move.l  a1,distpointer
        rts

tab5700:        dc.l    0,5700,11400,17100
                dc.l    22800,28500,34200,39900
                dc.l    45600,51300,57000,62700
                dc.l    68400,74100,79800,85500
        

boinganc:
        move.w  boingpos(pc),d0
        lea     boingtab(pc),a0
        addq.w  #1,d0
        cmp.w   #76,d0
        blt.s   forbibanc1
        moveq   #0,d0
forbibanc1:
        move.w  d0,boingpos
        lsl.w   #1,d0
        move.w  (a0,d0.w),d0
        lea     tab160(pc),a0
        lsl.w   #2,d0
        move.l  (a0,d0.w),d0
        add.l   #6080,d0                ;6560
        move.l  d0,boingofs
        move.l  oldsladdr(pc),voldsladdr
        move.l  sladdr(pc),oldsladdr
        add.l   currpicadd(pc),d0
        move.l  d0,sladdr
        rts

boingofs:       dc.l    0
boingpos:       dc.w    0
sladdr:         dc.l    0
oldsladdr:      dc.l    0
voldsladdr:     dc.l    0

slackanc:
        subq.w  #1,skitcount1
        tst.w   skitcount1
        bpl.L   skitit1
        clr.w   skitcount1
        move.l  voldsladdr(pc),d0
        move.l  sladdr(pc),d1
        cmp.l   d1,d0
        beq.L   utslanc
        cmp.l   d1,d0
        bgt.L   nedersida
oversida:
        move.l  d1,a0
        moveq   #0,d2
        lea     -160(a0),a0
omos1:  
        move.l  d2,2(a0)
        move.w  d2,6(a0)
        move.l  d2,10(a0)
        move.w  d2,14(a0)
        move.l  d2,18(a0)
        move.w  d2,22(a0)
        move.l  d2,26(a0)
        move.w  d2,30(a0)
        move.l  d2,34(a0)
        move.w  d2,38(a0)
        move.l  d2,42(a0)
        move.w  d2,46(a0)
        move.l  d2,50(a0)
        move.w  d2,54(a0)
        move.l  d2,58(a0)
        move.w  d2,62(a0)
        move.l  d2,66(a0)
        move.w  d2,70(a0)
        move.l  d2,74(a0)
        move.w  d2,78(a0)
        move.l  d2,82(a0)
        move.w  d2,86(a0)
        move.l  d2,90(a0)
        move.w  d2,94(a0)
        move.l  d2,98(a0)
        move.w  d2,102(a0)
        move.l  d2,106(a0)
        move.w  d2,110(a0)
        move.l  d2,114(a0)
        move.w  d2,118(a0)
        move.l  d2,122(a0)
        move.w  d2,126(a0)
        move.l  d2,130(a0)
        move.w  d2,134(a0)
        move.l  d2,138(a0)
        move.w  d2,142(a0)
        move.l  d2,146(a0)
        move.w  d2,150(a0)
        move.l  d2,154(a0)
        move.w  d2,158(a0)
        lea     -160(a0),a0
        sub.l   #160,d1
        cmp.l   d0,d1
        bgt.L   omos1
        bra.L   utslanc
nedersida:
        move.l  d0,a0
        lea     4000(a0),a0
        moveq   #0,d2
        lea     -160(a0),a0
omns1:  
        move.l  d2,2(a0)
        move.w  d2,6(a0)
        move.l  d2,10(a0)
        move.w  d2,14(a0)
        move.l  d2,18(a0)
        move.w  d2,22(a0)
        move.l  d2,26(a0)
        move.w  d2,30(a0)
        move.l  d2,34(a0)
        move.w  d2,38(a0)
        move.l  d2,42(a0)
        move.w  d2,46(a0)
        move.l  d2,50(a0)
        move.w  d2,54(a0)
        move.l  d2,58(a0)
        move.w  d2,62(a0)
        move.l  d2,66(a0)
        move.w  d2,70(a0)
        move.l  d2,74(a0)
        move.w  d2,78(a0)
        move.l  d2,82(a0)
        move.w  d2,86(a0)
        move.l  d2,90(a0)
        move.w  d2,94(a0)
        move.l  d2,98(a0)
        move.w  d2,102(a0)
        move.l  d2,106(a0)
        move.w  d2,110(a0)
        move.l  d2,114(a0)
        move.w  d2,118(a0)
        move.l  d2,122(a0)
        move.w  d2,126(a0)
        move.l  d2,130(a0)
        move.w  d2,134(a0)
        move.l  d2,138(a0)
        move.w  d2,142(a0)
        move.l  d2,146(a0)
        move.w  d2,150(a0)
        move.l  d2,154(a0)
        move.w  d2,158(a0)
        lea     -160(a0),a0

        sub.l   #160,d0
        cmp.l   d1,d0
        bgt.L   omns1
utslanc:
skitit1:
        rts     

skitcount1:     dc.w    2

initializeANDist:
        lea     ANdisttab(pc),a0
        moveq   #49,d0
omm7:   move.l  #$57dfe,(a0)+
        move.l  #8,(a0)+
        dbra    d0,omm7

        bsr     shiftanblock    

        rts


distANDist:
        bsr     disting
        bsr     boinganc
        bsr     distan
        bsr     slackanc
        rts     
        

boingtab:       dc.w    13,14,15,16,17,18,19,19
                dc.w    20,21,22,22,23,24,24,24
                dc.w    25,25,25,25,25,25,25,24
                dc.w    24,23,23,22,21,21,20,19
                dc.w    18,17,16,15,14,13,12,11
                dc.w    10, 9, 8, 7, 6, 5, 4, 4
                dc.w     3, 2, 2, 1, 1, 0, 0, 0
                dc.w     0, 0, 0, 0, 1, 1, 1, 2
                dc.w     3, 3, 4, 5, 6, 6, 7, 8
                dc.w     9,10,11,12     


dist0:          blk.l   20,320  
                dc.l    -1


dist1:          dc.l    320,326,331,337,342,348,353,358,362,366
                dc.l    370,373,376,379,381,382,383,384,384,383
                dc.l    382,381,379,376,373,370,366,362,358,353
                dc.l    348,342,337,331,326,320,314,309,303,298
                dc.l    292,287,282,278,274,270,267,264,261,259
                dc.l    258,257,256,256,257,258,259,261,264,267
                dc.l    270,274,278,282,287,292,298,303,309,314
                dc.l    -1

dist2:          dc.l    320,319,319,319,318,317,316,315,314,312
                dc.l    310,308,306,304,301,299,296,293,290,286         
                dc.l    283,279,275,271,267,263,258,254,249,244
                dc.l    239,234,228,223,217,212,206,200,194,188
                dc.l    181,175,168,162,155,148,141,134,127,120
                dc.l    113,106, 98, 91, 84, 76, 69, 61, 53, 46
                dc.l     38, 30, 23, 15,  7,  0,632,624,616,609
                dc.l    601,593,586,578,570,563,555,548,541,533
                dc.l    526,519,512,505,498,491,484,477,471,464         
                dc.l    458,451,445,439,433,427,422,416,411,405
                dc.l    400,395,390,385,381,376,372,368,364,360
                dc.l    356,353,349,346,343,340,338,335,333,331
                dc.l    329,327,325,324,323,322,321,320,320,320         
                dc.l    -1                      

dist3:          dc.l    320,319,319,318,316,314,312,309,306,303
                dc.l    300,296,292,288,284,280,275,271,267,263
                dc.l    260,256,253,250,247,245,243,241,240,240
                dc.l    -1

dist4:          dc.l    240,242,244,246,247,248,247,246,244,242
                dc.l    240,237,235,233,232,232,232,233,235,237
                dc.l    -1

dist5:          dc.l    240,240,240,241,243,245,247,250,253,256
                dc.l    260,263,267,271,275,280,284,288,292,296
                dc.l    300,303,306,309,312,314,316,318,319,319
                dc.l    -1

dist6:          dc.l    320,320,320,321,323,325,327,330,333,336
                dc.l    340,343,347,351,355,360,364,368,372,376
                dc.l    380,383,386,389,392,394,396,398,399,399
                dc.l    -1                              

dist7:          dc.l    400,395,392,388,384,381,378,375,372,371
                dc.l    369,368,368,368,368,369,371,372,375,378
                dc.l    381,384,388,392,395,400,404,407,411,415 
                dc.l    418,421,424,427,428,430,431,431,431,431
                dc.l    430,428,427,424,421,418,415,411,407,404
                dc.l    -1

dist8:          dc.l    400,399,399,398,396,394,392,389,386,383
                dc.l    380,376,372,368,364,360,355,351,347,343
                dc.l    340,336,333,330,327,325,323,321,320,320
                dc.l    -1

dist9:          dc.l    320,327,334,341,348,356,363,369,376,382
                dc.l    389,395,401,406,411,416,421,425,429,433
                dc.l    436,439,441,443,445,446,447,447,447,447
                dc.l    446,445,443,441,439,436,433,429,425,421
                dc.l    416,411,406,401,395,389,382,376,369,363
                dc.l    356,348,341,334,327,320,312,305,298,291
                dc.l    283,276,270,263,257,250,244,238,233,228
                dc.l    223,218,214,210,206,203,200,198,196,194
                dc.l    193,192,192,192,192,193,194,196,198,200
                dc.l    203,206,210,214,218,223,228,233,238,244
                dc.l    250,257,263,270,276,283,291,298,305,312
                dc.l    -1

dist10:         dc.l    320,322,324,327,329,331,332,334,335,335
                dc.l    336,335,335,334,332,331,329,327,324,322
                dc.l    320,317,315,312,310,308,307,305,304,304
                dc.l    304,304,304,305,307,308,310,312,315,317
                dc.l    -1
        

dist11:         dc.l    320,321,322,322,321,320,319,318,318,319         
                dc.l    -1

dist12:         blk.l   20,240
                dc.l    -1

dist13:         dc.l    320,321,320,319,320,321,320,319,-1

                dc.l    -2

                blk.l   2,0
ANdisttab:      blk.l   50,0
                blk.l   50,0
ANdisttabwindpos:
                dc.l    0

distingtab:     dc.l    dist0,dist0,dist1,dist1,dist1,dist1,dist0,dist3
                dc.l    dist4,dist4,dist5,dist0,dist1,dist3,dist4,dist5
                dc.l    dist3,dist5,dist0,dist0,dist9,dist9,dist0,dist0
                dc.l    dist3,dist4,dist4,dist4,dist4,dist4,dist4,dist4
                dc.l    dist12,dist4,dist12,dist4,dist12,dist4,dist5
                dc.l    dist2,dist13,dist13,dist0,dist13,dist11,dist13
                dc.l    dist0,dist9,dist9,dist9,dist9,dist9,dist9,dist9
                dc.l    dist1,dist10,dist11,dist13,dist13,dist13,dist0
                dc.l    dist13,dist0,dist11,dist11,dist11,dist11,dist11
                dc.l    dist0,dist13,dist11,dist10,dist1,dist9,dist13
                dc.l    dist13,dist0,dist13,dist0,dist2,dist13,dist2
                dc.l    dist13,dist11,dist11,dist1,dist9,dist1,dist0
                dc.l    dist13,dist13,dist13,dist13,dist13,dist13,dist13
                dc.l    dist13,dist13,dist13,dist13,dist0,dist13,dist0
                dc.l    dist6,dist7,dist7,dist8,dist6,dist7,dist8,dist13
                dc.l    -1

distpointer:    dc.l    dist0
distingpointer: dc.l    distingtab

shiftcount:     dc.w    0





; ***************************************************************



;  My XYDistorted TCB Logo
; ****************************************************************


distTCB:

        move.l  currpicadd(pc),a1
        lea     4210(a1),a1
        lea     shifteddistblocks,a0
        lea     1400(a0),a0
        lea     disttab(pc),a2
        add.l   disttabwindpos(pc),a2


        move.l  a0,a3
        add.l   (a2),a3

        move.l  a1,a4
        lea     -160(a1),a1


        moveq   #6,d0
        lea     bendtab(pc),a5
        moveq   #0,d2
        add.l   (a5)+,a4
omd3:   
        move.l  d2,(a4)
        move.w  d2,4(a4)
        move.l  d2,160(a4)
        move.w  d2,164(a4)
        move.l  d2,-160(a4)
        move.w  d2,-156(a4)
        move.l  d2,-320(a4)
        move.w  d2,-316(a4)

        move.l  d2,-3840(a4)
        move.w  d2,-3836(a4)
        move.l  d2,-4000(a4)
        move.w  d2,-3996(a4)
        move.l  d2,-4160(a4)
        move.w  d2,-4156(a4)
        move.l  d2,-4320(a4)
        move.w  d2,-4316(a4)

        add.l   (a5)+,a4
        add.l   (a5)+,a4
        dbra    d0,omd3


        moveq   #24,d1
omd1:   
        add.l   (a2)+,a0
        move.l  a0,a3
        move.l  a1,a4
        lea     -160(a1),a1
;       moveq   #6,d0
        lea     bendtab(pc),a5
omd2:   
        add.l   (a5)+,a4
        move.b  (a3),(a4)
        move.b  2(a3),2(a4)
        move.b  4(a3),4(a4)
        add.l   (a5)+,a4
        move.b  1(a3),-3(a4)
        move.b  3(a3),-1(a4)
        move.b  5(a3),1(a4)
        add.l   (a5)+,a4
        move.b  8(a3),(a4)
        move.b  10(a3),2(a4)
        move.b  12(a3),4(a4)
        add.l   (a5)+,a4
        move.b  9(a3),-3(a4)
        move.b  11(a3),-1(a4)
        move.b  13(a3),1(a4)
        add.l   (a5)+,a4
        move.b  16(a3),(a4)
        move.b  18(a3),2(a4)
        move.b  20(a3),4(a4)
        add.l   (a5)+,a4
        move.b  17(a3),-3(a4)
        move.b  19(a3),-1(a4)
        move.b  21(a3),1(a4)
        add.l   (a5)+,a4
        move.b  24(a3),(a4)
        move.b  26(a3),2(a4)
        move.b  28(a3),4(a4)
        add.l   (a5)+,a4
        move.b  25(a3),-3(a4)
        move.b  27(a3),-1(a4)
        move.b  29(a3),1(a4)
        add.l   (a5)+,a4
        move.b  32(a3),(a4)
        move.b  34(a3),2(a4)
        move.b  36(a3),4(a4)
        add.l   (a5)+,a4
        move.b  33(a3),-3(a4)
        move.b  35(a3),-1(a4)
        move.b  37(a3),1(a4)
        add.l   (a5)+,a4
        move.b  40(a3),(a4)
        move.b  42(a3),2(a4)
        move.b  44(a3),4(a4)
        add.l   (a5)+,a4
        move.b  41(a3),-3(a4)
        move.b  43(a3),-1(a4)
        move.b  45(a3),1(a4)
        add.l   (a5)+,a4
        move.b  48(a3),(a4)
        move.b  50(a3),2(a4)
        move.b  52(a3),4(a4)
        add.l   (a5)+,a4
        move.b  49(a3),-3(a4)
        move.b  51(a3),-1(a4)
        move.b  53(a3),1(a4)

        lea     56(a3),a3
        dbra    d1,omd1

        rts        



distyTCBLogo:
        lea     disttaby(pc),a0
        lea     bendtab(pc),a1
        lea     tab160(pc),a2
        move.l  distypos(pc),d0
        addq.l  #3,d0
        cmp.l   #128,d0
        blt.s   forbidi31
        sub.l   #128,d0
forbidi31:
        move.l  d0,distypos
        lsl.l   #1,d0
        move.l  #0,d2
        moveq   #14,d1
omdi31: move.w  (a0,d0.w),d3
        lsr.l   #1,d3
        move.w  d3,d4
        sub.w   d2,d3
        move.w  d4,d2
        add.l   #13,d3
        lsl.l   #2,d3
        move.l  (a2,d3.w),d3
        sub.l   #2076,d3
        move.l  d3,(a1)+
        add.l   #8,d0
        and.l   #255,d0
        dbra    d1,omdi31
        subq.l  #4,bendtab
        rts

distypos:       dc.l    0
disttaby:
        dc.w    12,12,13,13,14,14,15,15
        dc.w    16,16,17,17,18,18,19,19
        dc.w    20,20,20,21,21,21,22,22
        dc.w    22,22,23,23,23,23,23,23
        dc.w    23,23,23,23,23,23,23,22
        dc.w    22,22,22,21,21,21,20,20
        dc.w    20,19,19,18,18,17,17,16
        dc.w    16,15,15,14,14,13,13,12
        dc.w    12,11,10,10, 9, 9, 8, 8
        dc.w     7, 7, 6, 6, 5, 5, 4, 4
        dc.w     4, 3, 3, 2, 2, 2, 1, 1
        dc.w     1, 1, 0, 0, 0, 0, 0, 0
        dc.w     0, 0, 0, 0, 0, 0, 0, 1
        dc.w     1, 1, 1, 2, 2, 2, 3, 3
        dc.w     3, 4, 4, 5, 5, 6, 6, 7
        dc.w     7, 8, 8, 9, 9,10,10,11
        

        dc.w    12,13,14,16,17,18,19,20,21,22
        dc.w    22,23,23,23,23,22,22,21,20,19
        dc.w    18,17,16,14,13,12,10, 9, 7, 6
        dc.w     5, 4, 3, 2, 1, 1, 0, 0, 0, 0
        dc.w     1, 1, 2, 3, 4, 5, 6, 7, 9,10

        dc.w    12,13,14,16,17,18,19,20,21,22
        dc.w    22,23,23,23,23,22,22,21,20,19
        dc.w    18,17,16,14,13,12,10, 9, 7, 6
        dc.w     5, 4, 3, 2, 1, 1, 0, 0, 0, 0
        dc.w     1, 1, 2, 3, 4, 5, 6, 7, 9,10

        dc.w    0,1,2,3,4,5,6,7,8,9
        dc.w    10,11,12,13,14,15,16,17,18,19
        dc.w    20,21,22,23,24,24,23,22,21,20
        dc.w    19,18,17,16,15,14,13,12,11,10
        dc.w    9,8,7,6,5,4,3,2,1,0


bendtab:        dc.l    0
                blk.l   200,4



distTCBLogo:
        move.l  disttabwindpos(pc),d0
        subq.l  #4,d0
        tst.l   d0
        bpl.s   forbidtl1
        moveq   #116,d0
forbidtl1:
        move.l  d0,disttabwindpos
        lea     disttab(pc),a0
        add.l   d0,a0
;       lea     100(a0),a0
;       moveq   #5,d0
;omdi1: move.l  16(a0),20(a0)
;       move.l  12(a0),16(a0)
;       move.l  8(a0),12(a0)
;       move.l  4(a0),8(a0)
;       move.l  (a0),4(a0)
;       lea     -20(a0),a0
;       dbra    d0,omdi1
;       lea     disttab(pc),a0
        lea     disttabx(pc),a1
        lea     distsorttab(pc),a2
        move.w  distpos(pc),d0
        addq.w  #1,d0
        move.l  d0,d1
        lsl.w   #1,d1   
        move.w  (a1,d1.w),d2
        tst.w   d2
        bge.s   forbidi2
        addq.w  #1,distsortpos
        and.w   #63,distsortpos
        move.w  distsortpos,d3
        lsl.w   #2,d3
        move.l  (a2,d3.w),d3
        move.l  d3,d0

        sub.l   #disttabx,d0
        lsr.l   #1,d0
forbidi2:
        move.w  d0,distpos
        lsl.w   #1,d0
        move.w  (a1,d0.w),d0
;       and.l   #15,d0



;       cmp.w   #50,d0
;       blt     forbidi2
;       moveq   #0,d0
;       addq.w  #1,distsortpos
;       and.w   #15,distsortpos
;       move.w  distsortpos,d1
;       lsl.w   #1,d1
;       lea     distsorttab(pc),a1
;       move.w  (a1,d1.w),d1
;       move.w  d1,distsort
;forbidi2:
;       move.w  d0,distpos
;       add.w   distsort(pc),d0
;       lea     disttabx(pc),a1
;       lsl.w   #1,d0
;       move.w  (a1,d0.w),d0

        mulu    #1400,d0
        sub.l   #56,d0
        move.l  d0,120(a0)
        move.l  d0,(a0)+
        sub.l   d0,120(a0)
        sub.l   #56,120(a0)
        sub.l   d0,(a0)
        sub.l   #56,(a0)
        rts



disttab:        dc.l    11200
                blk.l   29,-56
                dc.l    11200
                blk.l   50,-56
disttabwindpos:
                dc.l    0
distpos:        dc.w    0
distsortpos:    dc.w    0
distsorttab:    dc.l    t5,t5,t5,t5,t1,t5,t5,t5
                dc.l    t1,t2,t1,t1,t1,t1,t2,t1
                dc.l    t1,t2,t3,t1,t1,t4,t1,t5
                dc.l    t5,t5,t1,t1,t1,t1,t1,t3 
                dc.l    t6,t5,t1,t2,t3,t2,t1,t5
                dc.l    t1,t6,t1,t1,t1,t2,t1,t5
                dc.l    t5,t5,t6,t5,t1,t4,t3,t1
                dc.l    t1,t1,t1,t4,t1,t1,t1,t3


                dc.l    t1,t1,t1,t1,t2,t1,t1,t2
                dc.l    t1,t1,t1,t2,t3,t2,t2,t1
                dc.l    t1,t3,t1,t2,t2,t3,t3,t3
                dc.l    t1,t1,t1,t1,t1,t1,t2,t1

distsort:       dc.w    0       

disttabx:

t1:
        dc.w     7, 8, 9,10,11,12,13,13,14,14
        dc.w    15,15,15,15,15,15,14,14,13,13
        dc.w    12,11,10, 9, 8, 8, 7, 6, 5, 4
        dc.w     3, 2, 2, 1, 1, 0, 0, 0, 0, 0
        dc.w     0, 1, 1, 2, 2, 3, 4, 5, 6, 7
        dc.w    -1



t2:
        dc.w     7, 8, 9,10,11,12,12,12,12,11
        dc.w    10, 9, 8, 6, 5, 4, 3, 2, 2, 2
        dc.w     2, 3, 4, 5, 6
        dc.w    -1

t3:
        dc.w     7, 9,11,13,14,15,15,15,14,13
        dc.w    12,10, 8, 7, 5, 3, 2, 1, 0, 0
        dc.w     0, 1, 2, 4, 6
        dc.w    -1


t4:     dc.w    7,8,9,10,11,12,13,14,15
        dc.w    14,13,12,11,10,9,8,7,6
        dc.w    5,4,3,2,1,0,1,2,3,4,5,6
        dc.w    -1

t5:     dc.w     8, 8, 9,10,10,11,12,12
        dc.w    13,13,14,14,14,15,15,15
        dc.w    15,15,15,15,14,14,14,13
        dc.w    13,12,12,11,10,10, 9, 8
        dc.w     8, 7, 6, 5, 5, 4, 3, 3
        dc.w     2, 2, 1, 1, 1, 0, 0, 0
        dc.w     0, 0, 0, 0, 1, 1, 1, 2
        dc.w     2, 3, 3, 4, 5, 5, 6, 7
        dc.w    -1

t6:     dc.w     8, 8, 8, 9, 9, 9,10,10
        dc.w    10,11,11,11,12,12,12,13
        dc.w    13,13,13,14,14,14,14,14
        dc.w    14,15,15,15,15,15,15,15
        dc.w    15,15,15,15,15,15,15,15
        dc.w    14,14,14,14,14,14,13,13
        dc.w    13,13,12,12,12,11,11,11
        dc.w    10,10,10, 9, 9, 9, 8, 8
        dc.w     8, 7, 7, 6, 6, 6, 5, 5
        dc.w     5, 4, 4, 4, 3, 3, 3, 2
        dc.w     2, 2, 2, 1, 1, 1, 1, 1
        dc.w     1, 0, 0, 0, 0, 0, 0, 0
        dc.w     0, 0, 0, 0, 0, 0, 0, 0
        dc.w     1, 1, 1, 1, 1, 1, 2, 2
        dc.w     2, 2, 3, 3, 3, 4, 4, 4
        dc.w     5, 5, 5, 6, 6, 6, 7, 7
        dc.w    -1 






shiftdistblocks:
        lea     shifteddistblocks,a1
        moveq   #15,d7
omsdb1: move.l  d7,-(sp)
        moveq   #15,d0
        sub.l   d7,d0
        lea     unshifteddistblock(pc),a0
        moveq   #24,d1
omsdb2:
        moveq   #5,d2
        moveq   #0,d3
        moveq   #0,d4
omsdb3:
        moveq   #0,d5
        move.w  (a0)+,d5
        ror.l   d0,d5
        or.w    d3,d5
        move.w  d5,(a1)+
        swap    d5
        move.w  d5,d3
        swap    d3

        moveq   #0,d5
        move.w  (a0)+,d5
        ror.l   d0,d5
        or.w    d3,d5
        move.w  d5,(a1)+
        swap    d5
        move.w  d5,d3
        swap    d3

        moveq   #0,d5
        move.w  (a0)+,D5
        swap    d5
        lsr.l   d0,d5
        move.w  d5,d6
        swap    d5
        or.w    d4,d5
        move.w  d6,d4
        swap    d4
        move.w  d5,(a1)+

        moveq   #0,d5
        move.w  (a0)+,d5
        swap    d5
        lsr.l   d0,d5
        move.w  d5,d6
        swap    d5
        or.w    d4,d5
        move.w  d6,d4
        swap    d4
        move.w  d5,(a1)+

        dbra    d2,omsdb3
        move.w  d3,(a1)+
        swap    d3
        move.w  d3,(a1)+
        move.w  d4,(a1)+
        swap    d4
        move.w  d4,(a1)+
        dbra    d1,omsdb2
        move.l  (sp)+,d7
        dbra    d7,omsdb1
        rts


         
            
distTCBxy:
        bsr     distTCBLogo
        bsr     distyTCBLogo
        bsr     distTCB
        rts

PALETTE2:   
        dc.w    $000,$000,$310,$310,$420,$420,$430,$430
        dc.w    $530,$530,$540,$540,$650,$650,$770,$770
;               dc.w    $0000,$0310,$0420,$0430,$0530,$0540,$0650,$0770
;               dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0777


unshifteddistblock:
;
;  NEOchrome cut buffer contents (left justified):
;
;    pixels/scanline    = $0060 (bytes/scanline: $0030)
;  # scanlines (height) = $0019
;
;  Hardware color pallet  (color 0 to 15):
;
;      $0000,$0310,$0420,$0430,$0530,$0540,$0650,$0770
;      $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0777
;
;
        dc.w    $FFF0,$FFFF,$FFFF,$0000,$7FFF,$FFFF,$FFFF,$0000
        dc.w    $87F8,$07FF,$87FF,$0000,$1FF8,$FFF8,$FFF8,$0000
        dc.w    $E7F8,$FFFF,$FFFF,$0000,$1FF8,$FFF8,$FFF8,$0000
        dc.w    $FFFF,$FFFF,$FFFF,$0000,$FFFF,$FFFE,$FFFF,$0000
        dc.w    $BFFF,$3FFF,$3FFF,$0000,$FFFA,$FFFC,$FFFE,$0000
        dc.w    $FFFF,$FFFF,$FFFF,$0000,$FFF8,$FFFE,$FFFC,$0000
        dc.w    $ECBD,$E3C1,$DFFE,$0000,$FC03,$FC3E,$03FE,$0000
        dc.w    $FCBD,$7BC1,$7FFE,$0000,$FC07,$FC39,$03FE,$0001
        dc.w    $ECBD,$E3C1,$DFFE,$0000,$FC05,$FC3A,$03FC,$0000
        dc.w    $CFBB,$C7C3,$FFFC,$0000,$DAE3,$D81E,$27FE,$0000
        dc.w    $EFBB,$E7C3,$FFFC,$0000,$DAE1,$D81F,$27FE,$0000
        dc.w    $CFBB,$C7C3,$FFFC,$0000,$DAE3,$D81E,$27FC,$0000
        dc.w    $DE7F,$FF8F,$FFF0,$0000,$4597,$027E,$FFFE,$0000
        dc.w    $DE7F,$FF8F,$FFF0,$0000,$4596,$027F,$FFFE,$0000
        dc.w    $DE7F,$FF8F,$FFF0,$0000,$4597,$027E,$FFFE,$0000
        dc.w    $FFCF,$FE0E,$FFF1,$0000,$781F,$07FE,$FFFE,$0000
        dc.w    $FFCF,$FE0E,$FFF1,$0000,$781E,$07FF,$FFFE,$0000
        dc.w    $FFCF,$FE0E,$FFF1,$0000,$781F,$07FE,$FFFE,$0000
        dc.w    $F9DC,$FE5C,$FFA3,$0000,$F97F,$07FE,$FFFE,$0000
        dc.w    $F9DC,$FE5C,$FFA3,$0000,$F97F,$07FE,$FFFE,$0000
        dc.w    $F9DC,$FE5C,$FFA3,$0000,$F979,$07FE,$FFFE,$0000
        dc.w    $FFFF,$8000,$C00F,$0000,$CFFF,$3000,$F000,$0000
        dc.w    $E77F,$F840,$FF80,$0000,$FFFF,$01FE,$01FE,$0000
        dc.w    $E70F,$F870,$FF80,$0000,$F9F1,$07FA,$01FE,$0000
        dc.w    $FFFF,$0008,$801F,$0000,$DFFF,$3000,$F000,$0000
        dc.w    $5CFF,$E080,$FF00,$0000,$FF3F,$01FE,$02FE,$0000
        dc.w    $DC40,$E0BF,$FF7F,$0000,$3BF9,$FFF0,$FCFE,$0000
        dc.w    $001E,$0019,$001F,$0000,$7C00,$F000,$F000,$0000
        dc.w    $53E0,$E380,$FC00,$0000,$03FF,$0200,$0100,$0000
        dc.w    $D39F,$E3FF,$FC7F,$0000,$F3E5,$FFF0,$FFFE,$0000
        dc.w    $0018,$001F,$001F,$0000,$3C00,$F000,$F000,$0000
        dc.w    $66E0,$C680,$F900,$0000,$03FF,$0000,$0200,$0000
        dc.w    $66D0,$C68F,$F97F,$0000,$3F89,$FFFA,$FFF4,$0000
        dc.w    $0018,$001F,$001F,$0000,$FC00,$F000,$F000,$0000
        dc.w    $6D60,$CD00,$F280,$0000,$0000,$0000,$0000,$0000
        dc.w    $6D50,$CD0F,$F2FF,$0000,$FE3F,$FFCC,$FFF0,$0000
        dc.w    $001F,$001F,$001F,$0000,$FC00,$F000,$F000,$0000
        dc.w    $64E0,$E000,$DF80,$0000,$0000,$0000,$0000,$0000
        dc.w    $648F,$E07F,$DFFF,$0000,$F19E,$FE10,$FFE8,$0000
        dc.w    $000F,$001F,$001F,$0000,$FC00,$F000,$F000,$0000
        dc.w    $EE60,$E180,$DF80,$0000,$0000,$0000,$0000,$0000
        dc.w    $6E0F,$E1FF,$DFFF,$0000,$F6E3,$F8E4,$FF1C,$0000
        dc.w    $000F,$001F,$001F,$0000,$CC00,$F000,$F000,$0000
        dc.w    $E840,$C7A0,$FF80,$0000,$03FF,$03FF,$03FF,$0000
        dc.w    $683F,$C7FF,$FFFF,$0000,$8CC5,$F0C2,$FF3C,$0000
        dc.w    $000F,$001F,$001F,$0000,$1C00,$E000,$F000,$0000
        dc.w    $F220,$CFE0,$FF80,$0000,$03FF,$03FE,$03FF,$0000
        dc.w    $727F,$CF80,$FF80,$0000,$FFFB,$01E6,$001C,$0000
        dc.w    $000F,$001F,$001F,$0000,$9C00,$E000,$F000,$0000
        dc.w    $E3F7,$DFCF,$FFBF,$0000,$FF03,$FF3E,$FFFE,$0000
        dc.w    $E3EC,$DF9F,$FFFF,$0000,$03C5,$FCDC,$FF3E,$0000
        dc.w    $0019,$001F,$001F,$0000,$7C00,$8000,$F000,$0000
        dc.w    $CFEF,$FFDF,$FFFF,$0000,$FFE3,$FF1E,$FEFE,$0000
        dc.w    $CFF7,$FFCF,$FFFF,$0000,$FF0D,$F91E,$FEFE,$0000
        dc.w    $001D,$001E,$001F,$0000,$EC00,$0000,$F000,$0000
        dc.w    $EFF5,$DFFE,$FFFF,$0000,$E73B,$0706,$F8FE,$0000
        dc.w    $EFF7,$DFFC,$FFFF,$0000,$CE79,$0E1E,$F1FE,$0000
        dc.w    $0019,$001E,$001F,$0000,$EC00,$2000,$D000,$0000
        dc.w    $FFE9,$FFFE,$FFFF,$0000,$E8E7,$281E,$D7FE,$0000
        dc.w    $FFEB,$FFFC,$FFFF,$0000,$D1C7,$503E,$AFFE,$0000
        dc.w    $0018,$0018,$001F,$0000,$3C00,$3000,$C000,$0000
        dc.w    $DF18,$FFE0,$FFFF,$0000,$33B9,$307E,$CFFE,$0000
        dc.w    $FF18,$FFE0,$FFFF,$0000,$33B9,$307E,$CFFE,$0000
        dc.w    $0018,$0018,$001F,$0000,$4C00,$4000,$B000,$0000
        dc.w    $3070,$DF80,$FFFF,$0000,$46EF,$4170,$BFFC,$0000
        dc.w    $F070,$FF80,$FFFF,$0000,$46EF,$4170,$BFFC,$0000
        dc.w    $0019,$0019,$001E,$0000,$1C00,$0000,$F000,$0000
        dc.w    $70A1,$0F41,$77FE,$0000,$102F,$03F0,$FFF0,$0000
        dc.w    $E8A1,$FF41,$FFFE,$0000,$102E,$03F0,$FFF0,$0000
        dc.w    $001F,$0010,$0018,$0000,$FC00,$0000,$0000,$0000
        dc.w    $21FF,$1E00,$2000,$0000,$FFFE,$0000,$0000,$0000
        dc.w    $FFFF,$8000,$C000,$0000,$FFFC,$0000,$0000,$0000
        dc.w    $001F,$0000,$0010,$0000,$FC00,$0000,$0000,$0000
        dc.w    $03FF,$0400,$0000,$0000,$FFF0,$0000,$0000,$0000
        dc.w    $FFFF,$0000,$8000,$0000,$FFF0,$0000,$0000,$0000

; ****************************************************************




;   AN's scrolline here
; *****************************************************************


scroll:
        move.l  currpicadd(pc),d0
        add.l   stalin(pc),d0
        addq.l  #8,d0
        move.l  d0,scrollineaddress
        move.l  stalin(pc),lookingatstalin
        addq.l  #8,lookingatstalin
     move.l   stalin(pc),d0
     cmp.l    pos(pc),d0
     beq.s    dumjump
     move.l   char(pc),a0
     add.l    shnum(pc),a0
     move.l   pos(pc),a1
     bsr      bps
dumjump:
     move.l   stalin(pc),d0
     cmp.l    pos2(pc),d0
     beq.s    dumjump2
     move.l   char2(pc),a0
     add.l    shnum(pc),a0
     move.l   pos2(pc),a1
     bsr      bps
dumjump2:
     move.l   stalin(pc),d0
     cmp.l    pos3(pc),d0
     beq.s    dumjump3
     move.l   char3(pc),a0
     add.l    shnum(pc),a0
     move.l   pos3(pc),a1
     bsr      bps
dumjump3:
     move.l   stalin(pc),d0
     cmp.l    pos4(pc),d0
     beq.s    dumjump4
     move.l   char4(pc),a0
     add.l    shnum(pc),a0
     move.l   pos4(pc),a1
     bsr      bps
dumjump4:
     move.l   stalin(pc),d0
     cmp.l    pos5(pc),d0
     beq.s    dumjump5
     move.l   char5(pc),a0
     add.l    shnum(pc),a0
     move.l   pos5(pc),a1
     bsr      bps
dumjump5:
     move.l   stalin(pc),d0
     cmp.l    pos6(pc),d0
     beq.s    dumjump6
     move.l   char6(pc),a0
     add.l    shnum(pc),a0
     move.l   pos6(pc),a1
     bsr      bps
dumjump6:
     move.l   stalin(pc),d0
     cmp.l    pos7(pc),d0
     beq.s    dumjump7
     move.l   char7(pc),a0
     add.l    shnum(pc),a0
     move.l   pos7(pc),a1
     bsr      bps
dumjump7:
     move.l   addcrr(pc),d0
     sub.l    d0,shnum
     cmp.l    #0,shnum
     blt.s    new_pos
     rts
bump_line:
     move.l   sinptr(pc),a0
     move.l   (a0)+,d0
     cmp.l    #-2,d0
     beq.s    fix_sin
     sub.l    d0,pos
     sub.l    d0,pos2
     sub.l    d0,pos3
     sub.l    d0,pos4
     sub.l    d0,pos5
     sub.l    d0,pos6
     sub.l    d0,pos7
     sub.l    d0,enlin
     sub.l    d0,stalin
     move.l   a0,sinptr
     rts
fix_sin:
     bsr      sin_select
     bra.s    bump_line
new_pos:
     add.l      #2400,shnum
        
        subq.l  #8,pos
        subq.l  #8,pos2
        subq.l  #8,pos3
        subq.l  #8,pos4
        subq.l  #8,pos5
        subq.l  #8,pos6
        subq.l  #8,pos7
     bsr      new_char
     rts
new_char:
     move.l   enlin(pc),d0
     cmp.l    pos(pc),d0
     beq.s    yes
     cmp.l    pos2(pc),d0
     beq.s    yes2
     cmp.l    pos3(pc),d0
     beq.s    yes3
     cmp.l    pos4(pc),d0
     beq.s    yes4
     cmp.l    pos5(pc),d0
     beq.s    yes5
     cmp.l    pos6(pc),d0
     beq      yes6
     cmp.l    pos7(pc),d0
     beq      yes7
     rts
yes:
     bsr      get_lt
     move.l   d0,char
     move.l   stalin(pc),pos
     rts
yes2:
     bsr      get_lt
     move.l   d0,char2
     move.l   stalin(pc),pos2
     rts
yes3:
     bsr      get_lt
     move.l   d0,char3
     move.l   stalin(pc),pos3
     rts
yes4:
     bsr      get_lt
     move.l   d0,char4
     move.l   stalin(pc),pos4
     rts
yes5:
     bsr      get_lt
     move.l   d0,char5
     move.l   stalin(pc),pos5
     rts
yes6:
     bsr      get_lt
     move.l   d0,char6
     move.l   stalin(pc),pos6
     rts
yes7:
     bsr      get_lt
     move.l   d0,char7
     move.l   stalin(pc),pos7
     rts
get_lt:
     lea        convert(pc),a1
     move.l     #shiftedfont,d0
     move.l   tptr(pc),a0
     cmp.b    #-1,(a0)
     beq.s    eort
     moveq      #0,d1
     move.b   (a0)+,d1
     add.l    d1,a1
     add.l    (a1),d0
     move.l   a0,tptr
     rts
eort:
     move.l   #real_text,tptr
     bra.s      get_lt
bps:
        add.l   currpicadd(pc),a1
     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,(a1)         ;1
     movem.l  d6/d7/a2-a5,160(a1)        ;2

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,320(a1)        ;3
     movem.l  d6/d7/a2-a5,480(a1)        ;4

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,640(a1)        ;5
     movem.l  d6/d7/a2-a5,800(a1)        ;6

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,960(a1)        ;7
     movem.l  d6/d7/a2-a5,1120(a1)        ;8

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,1280(a1)        ;9
     movem.l  d6/d7/a2-a5,1440(a1)        ;10

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,1600(a1)        ;11
     movem.l  d6/d7/a2-a5,1760(a1)        ;12

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,1920(a1)        ;13
     movem.l  d6/d7/a2-a5,2080(a1)        ;14

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,2240(a1)        ;15
     movem.l  d6/d7/a2-a5,2400(a1)        ;16

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,2560(a1)        ;17
     movem.l  d6/d7/a2-a5,2720(a1)        ;18

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,2880(a1)        ;19
     movem.l  d6/d7/a2-a5,3040(a1)        ;20

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,3200(a1)        ;21
     movem.l  d6/d7/a2-a5,3360(a1)        ;22

     movem.l  (a0)+,d0-d7/a2-a5
     movem.l  d0-d5,3520(a1)        ;23
     movem.l  d6/d7/a2-a5,3680(a1)        ;24

     movem.l  (a0)+,d0-d5
     movem.l  d0-d5,3840(a1)        ;25
     rts

sin_select:
     move.l   sinsptr(pc),a0
     move.b   (a0)+,d0
     cmp.b    #-2,d0
     beq.s      rest_ss
     cmp.b    #1,d0
     beq.s      sin1
     cmp.b    #2,d0
     beq.s      sin2
     cmp.b    #3,d0
     beq.s      sin3
     cmp.b    #0,d0
     beq.s      sin4
     cmp.b    #4,d0
     beq.s      sin5
     cmp.b    #5,d0
     beq.s      sin6
   rts

rest_ss:
     move.l   #sin_sel_tab,sinsptr
     bra.s    sin_select
sin1:
     move.l   #sin_tab,sinptr
     move.l   a0,sinsptr
     rts
sin2:
     move.l   #sin_tab2,sinptr
     move.l   a0,sinsptr
     rts
sin3:
     move.l   #sin_tab3,sinptr
     move.l   a0,sinsptr
     rts
sin4:
     move.l   #sin_tab4,sinptr
     move.l   a0,sinsptr
     rts
sin5:
     move.l   #sin_tab5,sinptr
     move.l   a0,sinsptr
     rts
sin6:
     move.l   #sin_tab6,sinptr
     move.l   a0,sinsptr
     rts

muffer:
        move.l  currpicadd(pc),a1
     add.l   stalin(pc),a1
     lea        colbuf(pc),a0
     moveq      #25,d0
     move.l     #0,-160(a1)
     move.l     #0,-156(a1)
power_loop:
        movem.l (a0)+,d0-d7/a2-a5
        move.l  d0,(a1)
        move.l  d1,4(a1)
        move.l  d0,-152(a1)
        move.l  d1,-148(a1)
        move.l  d2,160(a1)
        move.l  d3,164(a1)
        move.l  d2,8(a1)
        move.l  d3,12(a1)
        move.l  d4,320(a1)
        move.l  d5,324(a1)
        move.l  d4,168(a1)
        move.l  d5,172(a1)
        move.l  d6,480(a1)
        move.l  d7,484(a1)
        move.l  d6,328(a1)
        move.l  d7,332(a1)
        move.l  a2,640(a1)
        move.l  a3,644(a1)
        move.l  a2,488(a1)
        move.l  a3,492(a1)
        move.l  a4,800(a1)
        move.l  a5,804(a1)
        move.l  a4,648(a1)
        move.l  a5,652(a1)
        movem.l (a0)+,d0-d7/a2-a5
        move.l  d0,960(a1)
        move.l  d1,964(a1)
        move.l  d0,808(a1)
        move.l  d1,812(a1)
        move.l  d2,1120(a1)
        move.l  d3,1124(a1)
        move.l  d2,968(a1)
        move.l  d3,972(a1)
        move.l  d4,1280(a1)
        move.l  d5,1284(a1)
        move.l  d4,1128(a1)
        move.l  d5,1132(a1)
        move.l  d6,1440(a1)
        move.l  d7,1444(a1)
        move.l  d6,1288(a1)
        move.l  d7,1292(a1)
        move.l  a2,1600(a1)
        move.l  a3,1604(a1)
        move.l  a2,1448(a1)
        move.l  a3,1452(a1)
        move.l  a4,1760(a1)
        move.l  a5,1764(a1)
        move.l  a4,1608(a1)
        move.l  a5,1612(a1)
        movem.l (a0)+,d0-d7/a2-a5
        move.l  d0,1920(a1)
        move.l  d1,1924(a1)
        move.l  d0,1768(a1)
        move.l  d1,1772(a1)
        move.l  d2,2080(a1)
        move.l  d3,2084(a1)
        move.l  d2,1928(a1)
        move.l  d3,1932(a1)
        move.l  d4,2240(a1)
        move.l  d5,2244(a1)
        move.l  d4,2088(a1)
        move.l  d5,2092(a1)
        move.l  d6,2400(a1)
        move.l  d7,2404(a1)
        move.l  d6,2248(a1)
        move.l  d7,2252(a1)
        move.l  a2,2560(a1)
        move.l  a3,2564(a1)
        move.l  a2,2408(a1)
        move.l  a3,2412(a1)
        move.l  a4,2720(a1)
        move.l  a5,2724(a1)
        move.l  a4,2568(a1)
        move.l  a5,2572(a1)
        movem.l (a0)+,d0-d7/a2-a5
        move.l  d0,2880(a1)
        move.l  d1,2884(a1)
        move.l  d0,2728(a1)
        move.l  d1,2732(a1)
        move.l  d2,3040(a1)
        move.l  d3,3044(a1)
        move.l  d2,2888(a1)
        move.l  d3,2892(a1)
        move.l  d4,3200(a1)
        move.l  d5,3204(a1)
        move.l  d4,3048(a1)
        move.l  d5,3052(a1)
        move.l  d6,3360(a1)
        move.l  d7,3364(a1)
        move.l  d6,3208(a1)
        move.l  d7,3212(a1)
        move.l  a2,3520(a1)
        move.l  a3,3524(a1)
        move.l  a2,3368(a1)
        move.l  a3,3372(a1)
        move.l  a4,3680(a1)
        move.l  a5,3684(a1)
        move.l  a4,3528(a1)
        move.l  a5,3532(a1)
        move.l  (a0),3840(a1)
        move.l  (a0)+,3688(a1)
        move.l  (a0),3844(a1)
        move.l  (a0),3692(a1)
     rts

init_ANvar:
      move.l   #shiftedfont+117600,char
      move.l   #shiftedfont+117600,char2
      move.l   #shiftedfont+117600,char3
      move.l   #shiftedfont+117600,char4
      move.l   #shiftedfont+117600,char5
      move.l   #shiftedfont+117600,char6
      move.l   #shiftedfont+117600,char7
     
      move.l   #sin_sel_tab,sinsptr

      move.l   #sin_tab,sinptr

      move.l   #real_text,tptr

      move.l   #shiftedfont,fptr

     rts


initializescrolline:
      move.l   #24800,pos
      move.l   pos,enlin
      move.l   pos,stalin
      sub.l    #16,enlin
      add.l    #152,stalin
      move.l   pos,pos2
      move.l   pos,pos3
      move.l   pos,pos4
      move.l   pos,pos5
      move.l   pos,pos6
      move.l   pos,pos7
      add.l    #8,pos
      add.l    #32,pos2
      add.l    #56,pos3
      add.l    #80,pos4
      add.l    #104,pos5
      add.l    #128,pos6
      add.l    #152,pos7
      move.l   d0,real_pos
        bsr     init_ANvar
        rts




ANscroll:
      bsr        scroll
      bsr        muffer
      bsr        bump_line

      move.b    $fffc02,d0
      cmp.b     key(pc),d0
      beq.s     decexit 
      cmp.b     #59,d0
      beq.s     slow
      cmp.b     #60,d0
      beq.s     fast
        cmp.b   #61,d0
        beq.s   tune1
        cmp.b   #62,d0
        beq.s   tune2
        cmp.b   #63,d0
        beq.s   tune3
decexit:
        rts 


stop:
     move.b     d0,key
     clr.l      shnum
     clr.l      addcrr
     bra.s      decexit
slow:
     move.b     d0,key
        clr.l   shnum
     move.l     #600,addcrr
     bra.s      decexit
fast:
     move.b     d0,key
        clr.l   shnum
     move.l     #1200,addcrr
     bra.s      decexit          
tune1:
        move.b  d0,key
        st      newtune
        move.l  #2,newtuneno
        bra.s   decexit
tune2:
        move.b  d0,key
        st      newtune
        move.l  #3,newtuneno
        bra.s   decexit
tune3:
        move.b  d0,key
        st      newtune
        move.l  #4,newtuneno
        bra.L   decexit

newtune:        dc.b    0
    even
newtuneno:      dc.l    0
addcrr: dc.l    1200
hblctr: dc.w    0
SST:    dc.l    0
miut:   dc.l    0
real_pos:
        dc.l    0
fptr:   dc.l    0
shnum:  dc.l    2400
pos:    dc.l    0
pos2:   dc.l    0
pos3:   dc.l    0
pos4:   dc.l    0
pos5:   dc.l    0
pos6:   dc.l    0
pos7:   dc.l    0
char:   dc.l    0
char2:  dc.l    0
char3:  dc.l    0
char4:  dc.l    0
char5:  dc.l    0
char6:  dc.l    0
char7:  dc.l    0
enlin:  dc.l    0
stalin: dc.l    0
tptr:   dc.l    0
key:    dc.l    0
sinptr: dc.l    0
sinsptr:
        dc.l    0
blanks:
      dc.l    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
chartab:
      dc.l    0,16,32,48,64,80,96,112,128,144
      dc.l    4000,4016,4032,4048,4064,4080,4096,4112,4128,4144
      dc.l    8000,8016,8032,8048,8064,8080,8096,8112,8128,8144
      dc.l    12000,12016,12032,12048,12064,12080,12096,12112,12128,12144
      dc.l    16000,16016,16032,16048,16064,16080,16096,16112,16128,16144,-1
convert:
      dc.l    0,2400,4800,7200,9600,12000,14400,16800,19200,21600,24000
      dc.l    26400,28800,31200,33600,36000,38400,40800,43200,45600,48000
      dc.l    50400,52800,55200,57600,60000,62400,64800,67200,69600
      dc.l    72000,74400,76800,79200,81600,84000,86400,88800,91200
      dc.l    93600,96000,98400,100800,103200,105600,108000,110400
      dc.l    112800,115200,117600
sin_tab:
 dc.l        640,640,640,640,480,480,640,480,320,320,320,320,160,160
 dc.l        0,0,0
 dc.l        -160,-160,-320,-320,-320,-320,-480,-640,-480,-480,-640,-640,-640,-640
 dc.l        -2
sin_tab2:
 dc.l        320,320,320,320,320,320,320,320,320,320,320,320,320,320,320,320
 dc.l        -320,-320,-320,-320,-320,-320,-320,-320,-320,-320,-320,-320,-320,-320,-320,-320
 dc.l        -2
sin_tab3:
 dc.l        640,640,640,640,480,480,480,160,160
 dc.l        0,0 
 dc.l        -160,-160,-480,-480,-480,-640,-640,-640,-640  
 dc.l        -2
sin_tab4:
 blk.l  200,0
 dc.l        -2
sin_tab5:
 dc.l   0,0,0,0,0,0,0,0,0,160,0,160,0,160,0
 dc.l   160,160,160,160,160,160,160,160
 dc.l   320,160,160,320,160,320,160,320,160,320,320,160
 dc.l   320,320,320,160,320,320,320,320,160

 dc.l   -320,-320,-320,-320,-160,-320,-320,-320,-160
 dc.l   -320,-320,-160,-320,-320,-160,-160,-160,-320,-160
 dc.l   -160,-160,-320,-160,-160,-160,-160,-160,-160
 dc.l   0,-160,-160,0,-160,0,-160

 dc.l        -2
sin_tab6:
 dc.l        0,0,0,0,0,0,0,0,0,0,0,160,0,0
 dc.l        160,0,160,160,0,160,160,160 
 dc.l        0,160,160,160,160,160,160,160,160
 dc.l        320,160,160,160,160,160,160
 dc.l        320,160,160,160,160,160,160,160,160
 dc.l        160,160,160,160,160,160,160
 dc.l        0,160,160,0,160,0,160,0,160

 dc.l        0,0,0,0,0,0,0,0,0,0,0,-160,0,0
 dc.l        -160,0,-160,-160,0,-160,-160,-160 
 dc.l        0,-160,-160,-160,-160,-160,-160,-160,-160
 dc.l        -320,-160,-160,-160,-160,-160,-160
 dc.l        -320,-160,-160,-160,-160,-160,-160,-160,-160
 dc.l        -160,-160,-160,-160,-160,-160,-160
 dc.l        0,-160,-160,0,-160,0,-160,0,-160

 dc.l        -2

super_turbo:
 dc.w           $111,$222,$333,$444,$555,$666,$777,$666,$555,$444,$333,$222,$111
 dc.w           $1,$2,$3,$4,$5,$6,$7,$6,$5,$4,$3,$2,$1
 dc.w           $100,$200,$300,$400,$500,$600,$700,$600,$500,$400,$300,$200,$100
super_turbo2:
 dc.w           $1,$1,$2,$2,$3,$3,$4,$4,$5,$5,$6,$6,$7,$7,$7,$7,$17,$17,$27,$27,$37,$37,$47,$47,$57,$57,$67,$67,$77,$77
 dc.w           $176,$176,$275,$275,$374,$374,$473,$473,$572,$572,$671,$671,$770,$770
 dc.w           $761,$761,$752,$752,$743,$743,$734,$734,$725,$725,$716,$716
 dc.w           $707,$707,$706,$706,$705,$705,$704,$704,$703,$703,$702,$702,$701,$701,$700,$700
 dc.w           $600,$600,$500,$500,$400,$400

real_text:
 dc.b   196,196,196,176,196,0,52,196,8,56,56,44,196,176,196,196,196,196
 dc.b   -1
sin_sel_tab:
      dc.b   0,0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,5,5,5,5,5,5,5,5,4,5,5,5
      dc.b   5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,2,2,1,1,3,3,0,0,0,0
      dc.b   1,1,1,1,1,2,2,2,3,3,3,0,0,0,0,0,5,5,5,5,5,5,5,5,5,5,5,5
      dc.b   5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,3,1,1,1,1,1,1,1,1,1
      dc.b   1,1,1,2,2,3,2,1,1,2,3,2,3,3,3,3,3,5,5,5,5,5,5,0,0,2,3,1 
      dc.b    -2
     even

; **** colector ***

colbuf:
        dc.w    $FFFE,$0001,$0001,$ffff,$DB6C,$5B6D,$2493,$ffff
        dc.w    $9248,$1249,$6DB7,$ffff,$FFFE,$7FFF,$0001,$ffff
        dc.w    $DFFC,$5FFD,$2003,$ffff,$9000,$1FF9,$6FF7,$ffff
        dc.w    $F7F6,$780F,$0FF1,$ffff,$D004,$5FFD,$2003,$ffff
        dc.w    $9FF8,$1FF9,$6007,$ffff,$FEFE,$7EFF,$0101,$ffff
        dc.w    $DDFC,$5CFD,$2303,$ffff,$9A18,$1919,$67E7,$ffff
        dc.w    $F4EE,$730F,$0FF1,$ffff,$DA1C,$591D,$27E3,$ffff
        dc.w    $9DF8,$1CF9,$6307,$ffff,$FEFE,$7EFF,$0101,$ffff
        dc.w    $DFFC,$5FFD,$2003,$ffff,$9FF8,$1FF9,$6007,$ffff
        dc.w    $F006,$7FFF,$0FF1,$ffff,$D7F4,$580D,$2FF3,$ffff
        dc.w    $9000,$1FF9,$6007,$ffff,$FFFE,$7FFF,$0001,$ffff
        dc.w    $DB6C,$5B6D,$2493,$ffff,$9248,$1249,$6DB7,$ffff
        dc.w    $8000,$7FFF,$FFFF,$ffff




; *****************************************************************

; border brus med dist
; *****************************************************************



bslack:
        move.l  boldcurradd,a1
        moveq   #17,d0
        move.l  bcurrpicadd,a0
boms1:  move.l  (a0)+,d1
        move.l  (a0)+,d2
        move.l  (a0)+,d3
        move.l  (a0)+,d4

        move.l  d1,-(a1)
        move.l  d2,-(a1)
        move.l  d3,-(a1)
        move.l  d1,-(a1)
        move.l  d3,-(a1)
        move.l  d4,-(a1)
        move.l  d1,-(a1)
        move.l  d3,-(a1)
        move.l  d2,-(a1)
        move.l  d4,-(a1)
;       move.l  d1,-(a1)
;       move.l  d2,-(a1)
;       move.l  d1,-(a1)
;       move.l  d2,-(a1)
        lea     -190(a1),a1
        dbra    d0,boms1
        rts
        
        

bdist:
        move.l  bcurrpicadd,a1
        lea     19308(a1),a1
        move.l  a1,boldcurradd
        lea     bshifteddistblocks,a0
        lea     720(a0),a0
        lea     bdisttab(pc),a2
        moveq   #17,d0
bomd1:  
        add.l   (a2)+,a0
;       movem.l 40(a0),d1-d4
;       movem.l d1-d4,-(a1)
        movem.l 20(a0),d1-d4/a3
        movem.l d1-d4/a3,-(a1)
        movem.l (a0),d1-d4/a3
        movem.l d1-d4/a3,-(a1)
        lea     -190(a1),a1
        dbra    d0,bomd1

        rts        



bdistit:
        lea     bdisttab(pc),a0
        lea     80(a0),a0
        moveq   #4,d0
bomdi1: move.l  16(a0),20(a0)
        move.l  12(a0),16(a0)
        move.l  8(a0),12(a0)
        move.l  4(a0),8(a0)
        move.l  (a0),4(a0)
        lea     -20(a0),a0
        dbra    d0,bomdi1
        lea     bdisttab(pc),a0
        move.w  bdistpos(pc),d0
        addq.w  #1,d0
        cmp.w   #50,d0
        blt     bforbidi2
        moveq   #0,d0
        addq.w  #1,bdistsortpos
        and.w   #7,bdistsortpos
        move.w  bdistsortpos,d1
        lsl.w   #1,d1
        lea     bdistsorttab(pc),a1
        move.w  (a1,d1.w),d1
        move.w  d1,bdistsort
bforbidi2:
        move.w  d0,bdistpos
        add.w   bdistsort(pc),d0
        lea     bdisttabx(pc),a1
        lsl.w   #1,d0
        move.w  (a1,d0.w),d0
        mulu    #720,d0
        sub.l   #40,d0
        move.l  d0,(a0)+
        sub.l   d0,(a0)
        sub.l   #40,(a0)
        rts



bdisttab:       dc.l    4320
                blk.l   30,-40
bdistpos:       dc.w    0
bdistsortpos:   dc.w    0
bdistsorttab:   dc.w    0,0,50,50,0,0,50,50
bdistsort:      dc.w    0       

bdisttabx:


        dc.w     6, 7, 8, 9,10,11,10, 9, 8, 7
        dc.w     6, 5, 4, 3, 2, 1, 0, 1, 2, 3
        dc.w     4, 5, 6, 7, 8, 9,10,11,10, 9
        dc.w     8, 7, 6, 5, 4, 3, 2, 1, 0, 1
        dc.w     2, 3, 4, 5, 6, 5, 4, 3, 4, 5

        dc.w     6, 7, 8, 7, 6, 5, 4, 5, 6, 7
        dc.w     8, 7, 6, 5, 4, 5, 6, 7, 8, 7
        dc.w     6, 5, 4, 5, 6, 7, 8, 7, 6, 5
        dc.w     4, 5, 6, 7, 8, 6, 5, 4, 5, 6
        dc.w     7, 8, 7, 6, 5, 4, 5, 6, 7, 8








bshiftdistblocks:
        lea     bshifteddistblocks,a1
        moveq   #11,d7
bomsdb1: move.l d7,-(sp)
;       addq.l  #2,d7
        moveq   #15,d0
        sub.l   d7,d0
        lea     bunshifteddistblock(pc),a0
        moveq   #17,d1
bomsdb2:
        moveq   #3,d2
        moveq   #0,d3
        moveq   #0,d4
bomsdb3:
        moveq   #0,d5
        move.w  (a0)+,d5
        ror.l   d0,d5
        or.w    d3,d5
        move.w  d5,(a1)+
        swap    d5
        move.w  d5,d3
        swap    d3

        moveq   #0,d5
        move.w  (a0)+,d5
        ror.l   d0,d5
        or.w    d3,d5
        move.w  d5,(a1)+
        swap    d5
        move.w  d5,d3
        swap    d3

        moveq   #0,d5
        move.w  (a0)+,D5
        swap    d5
        lsr.l   d0,d5
        move.w  d5,d6
        swap    d5
        or.w    d4,d5
        move.w  d6,d4
        swap    d4
        move.w  d5,(a1)+

        moveq   #0,d5
        move.w  (a0)+,d5
        swap    d5
        lsr.l   d0,d5
        move.w  d5,d6
        swap    d5
        or.w    d4,d5
        move.w  d6,d4
        swap    d4
        move.w  d5,(a1)+

        dbra    d2,bomsdb3
        move.w  d3,(a1)+
        swap    d3
        move.w  d3,(a1)+
        move.w  d4,(a1)+
        swap    d4
        move.w  d4,(a1)+
        dbra    d1,bomsdb2
        move.l  (sp)+,d7
        dbra    d7,bomsdb1

        lea     $70000,a1
        lea     bshifteddistblocks,a0
        move.l  #1079,d0
bomsdb7:
        move.w  (a0),d1
        or.w    2(a0),d1
        or.w    4(a0),d1
        or.w    6(a0),d1
        not.w   d1
        move.w  (a1)+,d2
        and.w   d1,d2
        or.w    d2,(a0)+
        move.w  (a1)+,d2
        and.w   d1,d2
        or.w    d2,(a0)+
        move.w  (a1)+,d2
        and.w   d1,d2
        or.w    d2,(a0)+
        move.w  (a1)+,d2
        and.w   d1,d2
        or.w    d2,(a0)+
        dbra    d0,bomsdb7
        
        rts



bunshifteddistblock:
;
; NEOchrome cut buffer contents (left justified):
;
;    pixels/scanline    = $0040 (bytes/scanline: $0020)
;  # scanlines (height) = $0012
;
;  Hardware color pallet  (color 0 to 15):
;
;      $0000,$0777,$0555,$0444,$0333,$0222,$0111,$0000
;      $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0777
;
;
        dc.w    $6966,$999E,$0601,$0000,$C065,$F0E6,$0898,$0000
        dc.w    $C8CD,$3B13,$0400,$0000,$2CD0,$33D4,$C02C,$0000
        dc.w    $371B,$4FFB,$8004,$0000,$08AD,$F36E,$1A10,$0000
        dc.w    $B786,$7449,$08D0,$0000,$E36E,$FF7C,$0082,$0000
        dc.w    $8CCC,$1595,$E3E3,$0000,$D2B3,$8169,$FA07,$0000
        dc.w    $6616,$BDC2,$C3D9,$0000,$666A,$CAC9,$F1F7,$0000
        dc.w    $CCCC,$3B7B,$C787,$0000,$D533,$6256,$9C8F,$0000
        dc.w    $66DE,$5305,$8FDB,$0000,$6664,$BDBF,$C3C3,$0000
        dc.w    $B333,$1656,$CF8F,$0000,$3ECC,$47A6,$981F,$0000
        dc.w    $9911,$F6C3,$0FDF,$0000,$9998,$2B2B,$C7C7,$0000
        dc.w    $4CCC,$66A6,$9F1F,$0000,$CB33,$B3ED,$1C1E,$0000
        dc.w    $6606,$ACC3,$1FDF,$0000,$6664,$5353,$8F8F,$0000
        dc.w    $9243,$E0D4,$7F3F,$0000,$B126,$2898,$DE7F,$0000
        dc.w    $461B,$3853,$FFCC,$0000,$97A4,$EF6F,$001F,$0000
        dc.w    $26B4,$4113,$FE7F,$0000,$98C1,$11BE,$EE7F,$0000
        dc.w    $8311,$7C15,$FFCE,$0000,$9998,$4D4F,$3E3F,$0000
        dc.w    $0138,$00E0,$007C,$0000,$02C0,$0678,$01F8,$0000
        dc.w    $0019,$001A,$0004,$0000,$9992,$B2BC,$7C7E,$0000
        dc.w    $0048,$01E0,$007C,$0000,$0138,$06C0,$01F8,$0000
        dc.w    $0006,$001D,$0000,$0000,$6663,$3530,$F8FF,$0000
        dc.w    $00B8,$0150,$006C,$0000,$06D4,$0187,$01F8,$0000
        dc.w    $4681,$BF5F,$0000,$0000,$999A,$6F6D,$F0F3,$0000
        dc.w    $01B4,$0028,$004C,$0000,$06CE,$016F,$0190,$0000
        dc.w    $6919,$9E44,$00C3,$0000,$DD98,$E3D7,$0023,$0000
        dc.w    $0144,$00F8,$000C,$0000,$0133,$0656,$018F,$0000
        dc.w    $6606,$53DD,$8FC3,$0000,$6664,$BDBF,$C3C3,$0000
        dc.w    $0034,$01D8,$000C,$0000,$05CC,$07A6,$001F,$0000
        dc.w    $9901,$F6DB,$0FC7,$0000,$9998,$2B2B,$C7C7,$0000
        dc.w    $01B0,$01EC,$001C,$0000,$02CC,$06D9,$053E,$0000
        dc.w    $99D9,$4D1E,$3EC7,$0000,$999F,$F6F0,$0F0F,$0000
        dc.w    $01C0,$01DC,$003C,$0000,$0373,$01DA,$023C,$0000
        dc.w    $661E,$DB1C,$3CC7,$0000,$666A,$ACA1,$1F1F,$0000
        dc.w    $0090,$010C,$01FC,$0000,$01A8,$0090,$017F,$0000
        dc.w    $C05D,$3F90,$FFCF,$0000,$1DC4,$E03A,$FFFE,$0000
        dc.w    $0198,$0004,$01FC,$0000,$0058,$0020,$007F,$0000
        dc.w    $3008,$0FD0,$FFDF,$0000,$8870,$700C,$FFFC,$0000


bcurrpicadd:
        dc.l    0
boldcurradd:
        dc.l    0

;************
bvsyn:
        move.w  #$2100,sr
 movem.l d0-d7/a0-a3/a5-a6,-(sp)
; move #$2700,sr
        
        move.l a4,d7
        add.l #33,d7    ;24
; 62 when ready!, normally
;       move.w  #$2100,sr


;       bsr     chksmp
        bsr     bslack
        bsr     bdistit
        tst.b   bdistquest
        beq     bforbivs4
        bsr     bdist
bforbivs4:
;       bra     forbiallt

        addq.l  #4,bpictabpos
        and.l   #63,bpictabpos
        lea     bpictab(pc),a0
        add.l   bpictabpos,a0
        move.l  (a0),d0
        move.l  d0,bcurrpicadd
        lsr.l   #8,d0
        move.b  d0,$ff8203
        lsr     #8,d0
        move.b  d0,$ff8201

        cmp.l   #bstartborder,a4
        bls     bforbiallt
 lea $ff8209,a0
 lea $ff8260,a1
 lea $fffa21,a2
 lea $ff8241,a3

 moveq #0,d0
 moveq #0,d1
 moveq #16,d2
 moveq #2,d3
 moveq #0,d4

;tbsyncloop:
; cmp.b #199,(a2)
; bne tbsyncloop



bwaitis:
        cmp.l   d7,a4
        blt.s   bwaitis
        move.w  #$2700,sr
        moveq   #8,d0
bomw1:  dbf     d0,bomw1
        move.w  #$00,$ffff8240.w        ;70
        clr.b   $ffff820a.w
        moveq   #3,d0
bomw2:  nop
        dbf     d0,bomw2
        move.w  #2,$ffff820a.w  
        move.w  #$000,$ffff8240.w       ;700
;       move.w  #$2100,sr
;       add.l   #2,d7
;waitis2:
;       cmp.l   d7,a4
;       blt.s   waitis2
;       move.w  #$2700,sr
;       bra     forbiallt

bwaitloop27:
 move.b (a0),d0
 beq.s bwaitloop27

; move.w #$2700,sr      ;???????????? 16
 sub d0,d2
 lsl.w d2,d1

;       moveq   #18,d0
;ommmm: nop
;       dbf     d0,ommmm
;       nop

banfang2:

; nop

 lea $ffff8800.w,a6

; nop
; nop
 nop
 nop
 nop
 nop
 nop
 nop
 nop

 nop
 nop
 nop
 nop

 nop
 nop
 nop
 nop

 nop
 nop
 nop
 nop

 nop
 nop
 nop
 nop

 nop
 nop
 nop
 nop

 moveq #14,d0
bdelayloop21:
 nop
 dbra d0,bdelayloop21

 lea $ff820a,a0
 move #227,d0
bzeilenloop22:


 nop

;monochromeumschaltung fuer linken rand

 move.b d3,(a1)
 move.b d4,(a1)

 moveq #12,d1
bdelayloop22:
 nop
 dbra d1,bdelayloop22

 nop
        lea     bimptab(pc),a5  ;12
        moveq   #0,d5           ;4
        move.b  (a4)+,d5        ;8
        lsl.w   #3,d5           ;12
        move.l  (a5,d5.w),d6    ;18 /20
        move.w  4(a5,d5.w),d5   ;14 /16
        lea     $ffff8800.w,a5  ;12 /8
        movep.l d6,0(a5)        ;24
        movep.w d5,0(a5)        ;16
;                               120
; or 4 cycles wrong!
;************************
 nop

;***********************


; nop
 nop
 nop

;50/60 Hz fuer rechten rand
 move.b d4,(a0)
 move.b d3,(a0)

 nop
 nop
 nop
 nop
 nop
 nop
 nop

 nop
 nop
 nop
 nop

 nop
 nop

 move.b d3,(a1)
 nop
 move.b d4,(a1)

 
 nop
 nop
 nop
 nop
 nop

 nop
 nop
 nop
 nop

 dbra d0,bzeilenloop22
;       move.w  #$000,$ffff8240.w       ;777
;       clr.b   $ffff820a.w
;       moveq   #3,d0
;omw28: nop
;       dbf     d0,omw28
;       move.w  #2,$ffff820a.w  
;       move.w  #$000,$ffff8240.w       ;700

;forbiallt:
 move.w #$000,$ffff8240.w
 cmp.b  #185,$fffc02
 bne    bforbivs3
 move.l #bvsyndummy,$70
bforbivs3:
 bsr    bchksmp
bforbiallt:
 movem.l (sp)+,d0-d7/a0-a3/a5-a6
; bclr #0,$fffa0f
 rte

bvsyndummy:
        st      bvready
        rte
bvready:        dc.b    0
even

bhsyn:
;       add.w   #$123,$ffff8240.w
;       lea     imptab(pc),a5   ;12
        moveq   #0,d5           ;4
        move.b  (a4)+,d5        ;8
        lsl.w   #3,d5           ;12
        move.l  (a5,d5.w),d6    ;18 /20
        move.w  4(a5,d5.w),d5   ;14 /16
;       lea     $ffff8800.w,a5  ;12 /8
        movep.l d6,0(a6)        ;24
        movep.w d5,0(a6)        ;16
        rte



bchksmp:
;       cmp.l   #endoffirstloop,a4
;       bls     forbics2
;       cmp.l   #endoffirstloop,a4
;       blt     forbics2
;       st      bordersquest
bforbics2:
        cmp.l   #bstarttcblogo,a4
        bls     bforbics3
        st      bdistquest
bforbics3:
        cmp.l   bsampend,a4
        bls     bforbics1
        sub.l   bdissamplen,a4
        addq.l  #1,bsampnr
        cmp.l   #10,bsampnr
        blt     bforbics4
        move.l  #bendofsecondloop,bsampend
        move.l  #bsamplen2,bdissamplen
bforbics4:
        clr.b   bbordersquest
        clr.b   bdistquest
        move.w  #0,bbordersquest
        move.b #2,$ff820a
bforbics1:
        rts

bsampnr:        dc.l    0
bbordersquest:
        dc.b    0
bdistquest:
        dc.b    0
bpicpos:        equ     $70000
bpictab:        
        dc.l    bpicpos+$000,bpicpos+$700,bpicpos+$300,bpicpos+$900
        dc.l    bpicpos+$500,bpicpos+$200,bpicpos+$a00,bpicpos+$100
        dc.l    bpicpos+$600,bpicpos+$f00,bpicpos+$000,bpicpos+$d00
        dc.l    bpicpos+$800,bpicpos+$e00,bpicpos+$b00,bpicpos+$400
bpictabpos:
        dc.l    0




brandomizescreen:
 lea $70000,a0
 moveq #0,d1
 move #15000,d0
bclsloop2:
 move.l d1,(a0)+
 dbra d0,bclsloop2

 lea $70000,a0
 move.l a0,bcurrpicadd
 move.l a0,boldcurradd
 add.l #2000,boldcurradd
 move.l #$75831639,d1
 move #30000,d0 ;260104
bclsloop:
 eor.l d1,(a0)
 addq   #2,a0
 add.l #$74928123,d1
 eor.l #$52345679,d1
 rol.l #3,d1
; eor.l d0,d1
 dbra d0,bclsloop
 rts


binitvsync:

 move.b #0,$fffa1d

 move #0,$ff8240


 move.l #$70000,d0
 lsr.l #8,d0
 move.b d0,$ff8203
 lsr #8,d0
 move.b d0,$ff8201

 move.l #$70000+5280,bvidram
        move.l  #bvsyndummy,$70
        move.w  #$2300,sr

        clr.b   bvready
bomb1:  tst.b   bvready
        beq     bomb1   


 move.b #2,$ff820a
 move.b #0,$ff8260

 movem.l bpalette,d0-d7
 movem.l d0-d7,$ff8240

        clr.b   bvready
bomb2:  tst.b   bvready
        beq     bomb2   

        move.w  #$2700,sr
;timer_b installieren
; move.l #timer_b,$120
; move.b #0,$fffa1b
; move.b #31,$fffa21
; move.b #8,$fffa1b
; move.b #200,$fffa21
; bset #0,$fffa07
; bset #0,$fffa13
 move.b $fffa07,bmfpiea
 move.b $fffa09,bmfpieb
 move.b #0,$fffa07
 move.b #0,$fffa09
 move.l $70,boldvsyn
 move.l #bvsyn,$70
 move.l $68,boldhsync
 move.l #bhsyn,$68
 move.w #$2100,sr
 rts

boldhsync:      dc.l    0

brestorevsync:
 move.w #$2700,sr
 move.b #0,$fffa1b
; bclr #0,$fffa07
; bclr #0,$fffa13
; move.b bmfpiea,$fffa07
; move.b bmfpieb,$fffa09
; move.b #$51,$fffa1d

; move.l boldhsync,$68
; move.l boldvsyn,$70
; move #$777,$ff8240
; move #0,$ff8240+6
        move.b  #0,$fffa07
        move.b  #0,$fffa09

 move.b #1,$ff8260
 move.b #2,$ff820a

; move.l borgram,d0
; lsr.l #8,d0
; move.b d0,$ff8203
; lsr #8,d0
; move.b d0,$ff8201
 move.w #$2700,sr 
rts

bmfpiea:        dc.b    0
bmfpieb:        dc.b    0

bintsamp:
        lea     bstarttcblogo,a0
        lea     bendofsecondloop,a1
        move.l  #1000,d0
bomis2: move.l  (a0)+,(a1)+
        dbra    d0,bomis2
        moveq   #10,d0
bsetregs:
        move.b  d0,$fff8800
        clr.b   $fff8802
        dbf     d0,bsetregs
        clr.b   $fff8800
        clr.b   $fff8802
        move.b  #7,$fff8800
        move.b  #$ff,$fff8802
        lea     bsamplin,a4
        lea     bimptab(pc),a5  ;12
        lea     $ffff8800.w,a6  ;12 /8
        rts


borderdemo:
        bsr     brandomizescreen
        bsr     bshiftdistblocks
        bsr     bintsamp
        bsr     binitvsync
bwait:  bsr     bchksmp
        cmp.b   #185,$fffc02
        bne     bwait
        bsr     brestorevsync
        move.w  #$2700,sr
        rts

 even


bpalette:
 dc.w   $000,$666,$555,$444,$333,$222,$111,$000
 dc.w   $444,$333,$666,$111,$000,$555,$777,$222
; dc.w $0000,$0076,$0210,$0650,$0320,$0760,$0540,$0430
; dc.w $0527,$0111,$0222,$0333,$0444,$0555,$0666,$0777

kasten:
  dc.w $0001,$0000,$FFFF,$FFFF,$7FFD,$7FFC,$8003,$FFFF
  dc.w $4005,$7FFC,$8003,$FFFF,$5FF5,$7FFC,$8003,$FFFF
  dc.w $5015,$701C,$8FE3,$FFFF,$57D5,$701C,$8FE3,$FFFF
  dc.w $5455,$739C,$8FE3,$FFFF,$5555,$739C,$8FE3,$FFFF
  dc.w $5455,$739C,$8FE3,$FFFF,$57D5,$701C,$8FE3,$FFFF
  dc.w $5015,$701C,$8FE3,$FFFF,$5FF5,$7FFC,$8003,$FFFF
  dc.w $4005,$7FFC,$8003,$FFFF,$7FFD,$7FFC,$8003,$FFFF
  dc.w $0001,$0000,$FFFF,$FFFF,$FFFF,$0000,$FFFF,$FFFF


 EVEN

bitcount: dc.w 0
textpos: dc.l 0

borgram: dc.l 0
bvidram: dc.l 0
boldvsyn: dc.l 0

;bpuffer:


bimptab:         ;this is the output from "IMPACT" it's not our own
 dc.w $80E,$90D,$A0C,$0,$80F,$903,$A00,$0,$80F,$903,$A00,$0,$80F,$903,$A00,0
 dc.w $80F,$903,$A00,$0,$80F,$903,$A00,$0,$80F,$903,$A00,$0,$80E,$90D,$A0B,0
 dc.w $80E,$90D,$A0B,$0,$80E,$90D,$A0B,$0,$80E,$90D,$A0B,$0,$80E,$90D,$A0B,0
 dc.w $80E,$90D,$A0B,$0,$80E,$90D,$A0B,$0,$80E,$90D,$A0A,$0,$80E,$90D,$A0A,0
 dc.w $80E,$90D,$A0A,$0,$80E,$90D,$A0A,$0,$80E,$90C,$A0C,$0,$80E,$90D,$A00,0
 dc.w $80D,$90D,$A0D,$0,$80D,$90D,$A0D,$0,$80D,$90D,$A0D,$0,$80D,$90D,$A0D,0
 dc.w $80D,$90D,$A0D,$0,$80D,$90D,$A0D,$0,$80E,$90C,$A0B,$0,$80E,$90C,$A0B,0
 dc.w $80E,$90C,$A0B,$0,$80E,$90C,$A0B,$0,$80E,$90C,$A0B,$0,$80E,$90C,$A0B,0
 dc.w $80E,$90C,$A0B,$0,$80E,$90C,$A0B,$0,$80E,$90C,$A0A,$0,$80E,$90C,$A0A,0
 dc.w $80E,$90C,$A0A,$0,$80E,$90C,$A0A,$0,$80D,$90D,$A0C,$0,$80D,$90D,$A0C,0
 dc.w $80E,$90C,$A09,$0,$80E,$90C,$A09,$0,$80E,$90C,$A05,$0,$80E,$90C,$A00,0
 dc.w $80E,$90C,$A00,$0,$80E,$90B,$A0B,$0,$80E,$90B,$A0B,$0,$80E,$90B,$A0B,0
 dc.w $80E,$90B,$A0B,$0,$80E,$90B,$A0A,$0,$80E,$90B,$A0A,$0,$80E,$90B,$A0A,0
 dc.w $80D,$90D,$A0B,$0,$80D,$90D,$A0B,$0,$80D,$90D,$A0B,$0,$80E,$90B,$A09,0
 dc.w $80E,$90B,$A09,$0,$80E,$90B,$A09,$0,$80D,$90C,$A0C,$0,$80D,$90D,$A0A,0
 dc.w $80E,$90B,$A07,$0,$80E,$90B,$A00,$0,$80E,$90B,$A00,$0,$80D,$90D,$A09,0
 dc.w $80D,$90D,$A09,$0,$80E,$90A,$A09,$0,$80D,$90D,$A08,$0,$80D,$90D,$A07,0
 dc.w $80D,$90D,$A04,$0,$80D,$90D,$A00,$0,$80E,$90A,$A04,$0,$80E,$909,$A09,0
 dc.w $80E,$909,$A09,$0,$80D,$90C,$A0B,$0,$80E,$909,$A08,$0,$80E,$909,$A08,0
 dc.w $80E,$909,$A07,$0,$80E,$908,$A08,$0,$80E,$909,$A01,$0,$80C,$90C,$A0C,0
 dc.w $80D,$90C,$A0A,$0,$80E,$908,$A06,$0,$80E,$907,$A07,$0,$80E,$908,$A00,0
 dc.w $80E,$907,$A05,$0,$80E,$906,$A06,$0,$80D,$90C,$A09,$0,$80E,$905,$A05,0
 dc.w $80E,$904,$A04,$0,$80D,$90C,$A08,$0,$80D,$90B,$A0B,$0,$80E,$900,$A00,0
 dc.w $80D,$90C,$A06,$0,$80D,$90C,$A05,$0,$80D,$90C,$A02,$0,$80C,$90C,$A0B,0
 dc.w $80C,$90C,$A0B,$0,$80D,$90B,$A0A,$0,$80D,$90B,$A0A,$0,$80D,$90B,$A0A,0
 dc.w $80D,$90B,$A0A,$0,$80C,$90C,$A0A,$0,$80C,$90C,$A0A,$0,$80C,$90C,$A0A,0
 dc.w $80D,$90B,$A09,$0,$80D,$90B,$A09,$0,$80D,$90A,$A0A,$0,$80D,$90A,$A0A,0
 dc.w $80D,$90A,$A0A,$0,$80C,$90C,$A09,$0,$80C,$90C,$A09,$0,$80C,$90C,$A09,0
 dc.w $80D,$90B,$A06,$0,$80C,$90B,$A0B,$0,$80C,$90C,$A08,$0,$80D,$90B,$A00,0
 dc.w $80D,$90B,$A00,$0,$80C,$90C,$A07,$0,$80C,$90C,$A06,$0,$80C,$90C,$A05,0
 dc.w $80C,$90C,$A03,$0,$80C,$90C,$A01,$0,$80C,$90B,$A0A,$0,$80D,$90A,$A05,0
 dc.w $80D,$90A,$A04,$0,$80D,$90A,$A02,$0,$80D,$909,$A08,$0,$80D,$909,$A08,0
 dc.w $80C,$90B,$A09,$0,$80C,$90B,$A09,$0,$80D,$908,$A08,$0,$80B,$90B,$A0B,0
 dc.w $80D,$909,$A05,$0,$80C,$90B,$A08,$0,$80D,$909,$A02,$0,$80D,$908,$A06,0
 dc.w $80C,$90B,$A07,$0,$80D,$907,$A07,$0,$80C,$90B,$A06,$0,$80C,$90A,$A09,0
 dc.w $80B,$90B,$A0A,$0,$80C,$90B,$A02,$0,$80C,$90B,$A00,$0,$80C,$90A,$A08,0
 dc.w $80D,$906,$A04,$0,$80D,$905,$A05,$0,$80D,$905,$A04,$0,$80C,$909,$A09,0
 dc.w $80D,$904,$A03,$0,$80B,$90B,$A09,$0,$80C,$90A,$A05,$0,$80B,$90A,$A0A,0
 dc.w $80C,$909,$A08,$0,$80B,$90B,$A08,$0,$80C,$90A,$A00,$0,$80C,$90A,$A00,0
 dc.w $80C,$909,$A07,$0,$80B,$90B,$A07,$0,$80C,$909,$A06,$0,$80B,$90B,$A06,0
 dc.w $80B,$90A,$A09,$0,$80B,$90B,$A05,$0,$80A,$90A,$A0A,$0,$80B,$90B,$A02,0
 dc.w $80B,$90A,$A08,$0,$80C,$907,$A07,$0,$80C,$908,$A04,$0,$80C,$907,$A06,0
 dc.w $80B,$909,$A09,$0,$80C,$906,$A06,$0,$80A,$90A,$A09,$0,$80C,$907,$A03,0
 dc.w $80B,$90A,$A05,$0,$80B,$909,$A08,$0,$80B,$90A,$A03,$0,$80A,$90A,$A08,0
 dc.w $80B,$90A,$A00,$0,$80B,$909,$A07,$0,$80B,$908,$A08,$0,$80A,$90A,$A07,0
 dc.w $80A,$909,$A09,$0,$80C,$901,$A01,$0,$80A,$90A,$A06,$0,$80B,$908,$A07,0
 dc.w $80A,$90A,$A05,$0,$80A,$909,$A08,$0,$80A,$90A,$A02,$0,$80A,$90A,$A01,0
 dc.w $80A,$90A,$A00,$0,$809,$909,$A09,$0,$80A,$908,$A08,$0,$80B,$908,$A01,0
 dc.w $80A,$909,$A06,$0,$80B,$907,$A04,$0,$80A,$909,$A05,$0,$809,$909,$A08,0
 dc.w $80A,$909,$A03,$0,$80A,$908,$A06,$0,$80A,$909,$A00,$0,$809,$909,$A07,0
 dc.w $809,$908,$A08,$0,$80A,$908,$A04,$0,$809,$909,$A06,$0,$80A,$908,$A01,0
 dc.w $809,$909,$A05,$0,$809,$908,$A07,$0,$808,$908,$A08,$0,$809,$909,$A02,0
 dc.w $809,$908,$A06,$0,$809,$909,$A00,$0,$809,$907,$A07,$0,$808,$908,$A07,0
 dc.w $809,$907,$A06,$0,$809,$908,$A02,$0,$808,$908,$A06,$0,$809,$906,$A06,0
 dc.w $808,$907,$A07,$0,$808,$908,$A04,$0,$808,$907,$A06,$0,$808,$908,$A02,0
 dc.w $807,$907,$A07,$0,$808,$906,$A06,$0,$808,$907,$A04,$0,$807,$907,$A06,0
 dc.w $808,$906,$A05,$0,$808,$906,$A04,$0,$807,$906,$A06,$0,$807,$907,$A04,0
 dc.w $808,$905,$A04,$0,$806,$906,$A06,$0,$807,$906,$A04,$0,$807,$905,$A05,0
 dc.w $806,$906,$A05,$0,$806,$906,$A04,$0,$806,$905,$A05,$0,$806,$906,$A02,0
 dc.w $806,$905,$A04,$0,$805,$905,$A05,$0,$806,$905,$A02,$0,$805,$905,$A04,0
 dc.w $805,$904,$A04,$0,$805,$905,$A02,$0,$804,$904,$A04,$0,$804,$904,$A03,0
 dc.w $804,$904,$A02,$0,$804,$903,$A03,$0,$803,$903,$A03,$0,$803,$903,$A02,0
 dc.w $803,$902,$A02,$0,$802,$902,$A02,$0,$802,$902,$A01,$0,$801,$901,$A01,0
 dc.w $802,$901,$A00,$0,$801,$901,$A00,$0,$801,$900,$A00,$0,$800,$900,$A00,0

;bshifteddistblocks:
;       blk.l   5600,0

bsampend:       dc.l    bendoffirstloop
bdissamplen:    dc.l    bsamplen






; *****************************************************************







flash_tab:
        dc.w    $111,     $222,$333
        dc.w    $444,$555,$666,$777
        dc.w    $777,$777,$777,$777,$777
        dc.w    $666,$666,$666,$666,$666
        dc.w    $555,$555,$555,$555,$555
        dc.w    $444,$444,$444,$444,$444
        dc.w    $333,$333,$333,$333,$333
        dc.w    $222,$222,$222,$222,$222
        dc.w    $111,$111,$111,$111,$111
        dc.w    -1

startraster:
        move.l  rastoffset(pc),a6
        lea     180(a6),a6
        cmp.l   #23040,a6
        blt.s   forbirs
        move.l  #0,a6
forbirs:
        move.l  a6,rastoffset
        add.l   #bigsintab,a6
        tst.b   newtune
        beq.s   forbisr2
        clr.b   newtune
        move.l  d0,-(sp)
        move.l  newtuneno(pc),d0
        jsr     $50600
        move.l  (sp)+,d0
forbisr2:
        rts
rastoffset:
        dc.l    0


vsync:  
        add.w   #1,flash_count
        cmp.w   #70,flash_count
        beq.s   flash_on
        st      ready
        move.l  a0,-(sp)
        move.l  a1,-(sp)
        jsr     $50612
        lea     palette2,a0     ;(pc)
        lea     $ffff8240.w,a1
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (sp)+,a1
        move.l  (sp)+,a0
        clr.b   $fffffa09.w
        clr.b   $fffffa1b.w
        move.b  #1,$fffffa07.w
        move.b  #1,$fffffa13.w
        move.b  #1,$fffffa21.w
        move.b  #8,$fffffa1b.w
        move.l  #hsync1,$120.w
        bsr     startraster
        move.b  calcedval(pc),waittillpalchange
        rte
flash_on:
        clr.w   flash_count
        move.l  #flash_tab,flash_ptr
        move.l  #vsync2,$70.w
        st      ready
        move.l  a0,-(sp)
        move.l  a1,-(sp)
        jsr     $50612
        lea     palette2,a0     ;(pc)
        lea     $ffff8240.w,a1
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (sp)+,a1
        move.l  (sp)+,a0
        clr.b   $fffffa09.w
        clr.b   $fffffa1b.w
        move.b  #1,$fffffa07.w
        move.b  #1,$fffffa13.w
        move.b  #1,$fffffa21.w
        move.b  #8,$fffffa1b.w
        move.l  #hsync1,$120.w
        bsr     startraster
        move.b  calcedval(pc),waittillpalchange
        rte
vsync2:
        st      ready
        move.l  a0,-(sp)
        move.l  a1,-(sp)
        jsr     $50612
        lea     palette2,a0     ;(pc)
        lea     $ffff8240.w,a1
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  flash_ptr(pc),a1
        move.w  (a1)+,a0
        cmp.w   #-1,a0
        beq.s   flash_off
        move.w  a0,$ffff8242.w
        move.l  a1,flash_ptr
ret:
        move.l  (sp)+,a1
        move.l  (sp)+,a0
        clr.b   $fffffa09.w
        clr.b   $fffffa1b.w
        move.b  #1,$fffffa07.w
        move.b  #1,$fffffa13.w
        move.b  #1,$fffffa21.w
        move.b  #8,$fffffa1b.w
        move.l  #hsync1,$120.w
        bsr     startraster
        move.b  calcedval(pc),waittillpalchange
        rte

flash_off:
        clr.w   $ffff8242.w
        move.l  #vsync,$70.w
        bra.s   ret
flash_ptr:
        dc.l    0
flash_count:
        dc.w    0

hsync1: move.w  (a6)+,$ffff8240.w
        bmi.s   slutt1
        bclr    #0,$fffffa0f.w
        rte


slutt1: 
        move.l  a0,-(sp)
        move.l  a1,-(sp)
        lea     palette4(pc),a0
        lea     $ffff8244.w,a1
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (a0)+,(a1)+
        move.l  (sp)+,a1
        move.l  (sp)+,a0
        move.l  #hsync2,$120.w
        bclr    #0,$fffffa0f.w
        rte

palette4:       
        dc.w    $766,$766,$755,$755,$644,$644
        dc.w    $533,$533,$422,$422,$311,$311,$003,$003
;               dc.w    $766,$755,$644,$533,$422,$311,$003
;               dc.w    $000,$766,$755,$644,$533,$422,$311,$003


hsync2: move.w  (a6)+,$ffff8240.w
        bmi.s   slutt2
        bclr    #0,$fffffa0f.w
        rte


slutt2: clr.w   $ffff8240.w
        move.b  #0,$fffa1b
        move.l  a1,-(sp)
        lea     palettetone1(pc),a6
        lea     $ffff8240.w,a1
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (sp)+,a1
        move.b  waittillpalchange(pc),$fffffa21.w
        move.b  #8,$fffffa1b.w
        move.l  #hsync3,$120.w
        bclr    #0,$fffffa0f.w
        rte




hsync3: 
        move.l  a1,-(sp)
        lea     $ffff8240.w,a1
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (sp)+,a1
        clr.b   $fffffa1b.w
        move.b  #8,$fffffa21.w
        move.b  #8,$fffffa1b.w
        move.l  #hsync4,$120.w
        bclr    #0,$fffffa0f.w
        rte


hsync4: 
        move.l  a1,-(sp)
        lea     $ffff8240.w,a1
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (sp)+,a1
        move.l  #hsync5,$120.w
        bclr    #0,$fffffa0f.w
        rte

hsync5: 
        move.l  a1,-(sp)
        lea     $ffff8240.w,a1
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (sp)+,a1
        move.l  #hsync6,$120.w
        bclr    #0,$fffffa0f.w
        rte

hsync6: 
        move.l  a1,-(sp)
        lea     $ffff8240.w,a1
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (sp)+,a1
        move.l  #hsync7,$120.w
        bclr    #0,$fffffa0f.w
        rte

hsync7: 
        move.l  a1,-(sp)
        lea     $ffff8240.w,a1
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (sp)+,a1
        move.l  #hsync8,$120.w
        bclr    #0,$fffffa0f.w
        rte


hsync8: 
        move.l  a1,-(sp)
        lea     $ffff8240.w,a1
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (a6)+,(a1)+
        move.l  (sp)+,a1
        clr.b   $fffffa1b.w
        bclr    #0,$fffffa0f.w
        rte


palettetone1:
        dc.w    $000,$420,$310,$210,$100,$000,$000,$300
        dc.w    $000,$530,$420,$310,$210,$100,$000,$001
palettetone2:
        dc.w    $000,$310,$210,$100,$000,$000,$000,$200
        dc.w    $000,$640,$530,$420,$310,$210,$100,$002
palettetone3:
        dc.w    $000,$210,$100,$000,$000,$000,$000,$100
        dc.w    $000,$750,$640,$530,$420,$310,$200,$003
palettetone4:
        dc.w    $000,$210,$100,$000,$000,$000,$000,$000
        dc.w    $000,$760,$750,$640,$530,$420,$310,$004
palettetone5:
        dc.w    $000,$210,$100,$000,$000,$000,$000,$100
        dc.w    $000,$750,$640,$530,$420,$310,$200,$003
palettetone6:
        dc.w    $000,$310,$210,$100,$000,$000,$000,$200
        dc.w    $000,$640,$530,$420,$310,$210,$100,$002
palettetone7:
        dc.w    $000,$420,$310,$210,$100,$000,$000,$300
        dc.w    $000,$530,$420,$310,$210,$100,$000,$001







waittillpalchange:
        dc.b    1
calcedval:
        dc.b    1
even
testtab:        
                dc.w    $000,$000,$000,$000,$000,$000,$000,$000
                dc.w    $100,$000,$100,$100,$211,$100,$211,$211
                dc.w    $321,$211,$321,$321,$432,$321,$432,$432
                dc.w    $543,$432,$543,$543,$654,$543,$654,$654
                dc.w    $765,$654,$765,$765,$765,$765,$654,$8765
                dc.w    $654,$654,$543,$654,$543,$543,$432,$543
                dc.w    $432,$432,$321,$432,$321,$321,$211,$321
                dc.w    $211,$211,$100,$211,$100,$100,$000,$100
                dc.w    $000,$000,$000,$000,$000,$000,$000,$000

                dc.w    $000,$000,$000,$000,$000,$000,$000,$000
                dc.w    $000,$000,$000,$000,$000,$000,$000,$000
                dc.w    $000,$000

                dc.w    $8000
                blk.w   200,$300



calcpalettechangepos:
        move.l  stalin(pc),d0
        divu    #160,d0
        sub.w   #96,d0  ;108 is the base
;       tst.w   d0
;       bgt.s   forbicpcp
;       moveq   #1,d0
;forbicpcp:
        move.b  d0,calcedval
        rts



;d0 = x 0-80
;d1 = y
;d2 = char
;d3 = rot
spritebehind:
        lea     rotate(pc),a2
        lsl.l   #7,d3
        add.l   d3,a2
        move.l  (a2)+,d7
        sub.w   d7,d1
        lsl.l   #1,d7
        move.l  d0,d4
        and.w   #3,d0
        lsl.w   #2,d0
        lea     shiftedfont,a0
        lea     tab600(pc),a1
        add.l   (a1,d0.w),a0
        lsl.w   #2,d1
        lea     tab160(pc),a1
        move.l  (a1,d1.w),a1
;
;       add.l   currpicadd(pc),a1
;       sub.l   #16000,a1
;       add.l   stalin,a1
;       sub.l   #2552,a1
        add.l   scrollineaddress(pc),a1
        lea     -18560(a1),a1
        lsr.l   #2,d4
        cmp.l   #17,d4
        bls.s   forbish2
forbish1:
        cmp.w   #18,d4
        beq.L   shfall18
        cmp.w   #19,d4
        beq.L   shfall19
        cmp.w   #-1,d4
        beq.L   shfallm1
        cmp.w   #-2,d4
        beq.L   shfallm2
        bra.s   forbish3

forbish2:
        lsl.l   #3,d4
        adda.l  d4,a1
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
omsh1:  move.l  a0,a3
        adda.l  (a2)+,a3
        movem.l (a3)+,d0-d5

        move.w  6(a1),d6
        not.l   d6
        and.w   d6,d0
        swap    d0
        and.w   d6,d0
        swap    d0
        swap    d1
        and.w   d6,d1
        or.w    d1,4(a1)
        or.l    d0,(a1)

        move.w  14(a1),d6
        not.l   d6
        and.w   d6,d2
        swap    d2
        and.w   d6,d2
        swap    d2
        swap    d3
        and.w   d6,d3
        or.w    d3,12(a1)
        or.l    d2,8(a1)

        move.w  22(a1),d6
        not.l   d6
        and.w   d6,d4
        swap    d4
        and.w   d6,d4
        swap    d4
        swap    d5
        and.w   d6,d5
        or.w    d5,20(a1)
        or.l    d4,16(a1)

        lea     160(a1),a1
        dbra    d7,omsh1       
forbish3:
        rts


shfall18:
        lsl.l   #3,d4
        adda.l  d4,a1
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
omsh21: move.l  a0,a3
        adda.l  (a2)+,a3
        movem.l (a3)+,d0-d3
        addq.l  #8,a3

        move.w  6(a1),d6
        not.l   d6
        and.w   d6,d0
        swap    d0
        and.w   d6,d0
        swap    d0
        swap    d1
        and.w   d6,d1
        or.w    d1,4(a1)
        or.l    d0,(a1)

        move.w  14(a1),d6
        not.l   d6
        and.w   d6,d2
        swap    d2
        and.w   d6,d2
        swap    d2
        swap    d3
        and.w   d6,d3
        or.w    d3,12(a1)
        or.l    d2,8(a1)

        lea     160(a1),a1
        dbra    d7,omsh21       
        rts


shfall19:
        lsl.l   #3,d4
        adda.l  d4,a1
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
omsh31: move.l  a0,a3
        adda.l  (a2)+,a3
        move.l  (a3)+,d0
        move.l  (a3)+,d1
        lea     16(a3),a3



        move.w  6(a1),d6
        not.l   d6
        and.w   d6,d0
        swap    d0
        and.w   d6,d0
        swap    d0
        swap    d1
        and.w   d6,d1
        or.w    d1,4(a1)
        or.l    d0,(a1)

        lea     160(a1),a1
        dbra    d7,omsh31       
        rts

shfallm1:
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
        addq.l  #8,a0
omsh41: move.l  a0,a3
        adda.l  (a2)+,a3
        movem.l (a3)+,d0-d3
        addq.l  #8,a3




        move.w  6(a1),d6
        not.l   d6
        and.w   d6,d0
        swap    d0
        and.w   d6,d0
        swap    d0
        swap    d1
        and.w   d6,d1
        or.w    d1,4(a1)
        or.l    d0,(a1)

        move.w  14(a1),d6
        not.l   d6
        and.w   d6,d2
        swap    d2
        and.w   d6,d2
        swap    d2
        swap    d3
        and.w   d6,d3
        or.w    d3,12(a1)
        or.l    d2,8(a1)

        lea     160(a1),a1
        dbra    d7,omsh41       
        rts

shfallm2:
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
        lea     16(a0),a0
omsh51: move.l  a0,a3
        adda.l  (a2)+,a3
        move.l  (a3)+,d0
        move.l  (a3)+,d1
        lea     16(a3),a3



        move.w  6(a1),d6
        not.l   d6
        and.w   d6,d0
        swap    d0
        and.w   d6,d0
        swap    d0
        swap    d1
        and.w   d6,d1
        or.w    d1,4(a1)
        or.l    d0,(a1)

        lea     160(a1),a1
        dbra    d7,omsh51       
        rts










;d0 = x 0-80
;d1 = y
;d2 = char
;d3 = rot
spritebefore:
        lea     rotate(pc),a2
        lsl.l   #7,d3
        add.l   d3,a2
        move.l  (a2)+,d7
        sub.w   d7,d1
        lsl.l   #1,d7
        move.l  d0,d4
        and.l   #3,d0
        lsl.w   #2,d0
        lea     shiftedfont,a0
        lea     tab600(pc),a1
        add.l   (a1,d0.w),a0
        lsl.w   #2,d1
        lea     tab160(pc),a1
        move.l  (a1,d1.w),a1
;       add.l   currpicadd(pc),a1
;       sub.l   #16000,a1
;       add.l   stalin,a1
;       sub.l   #2552,a1
        add.l   scrollineaddress(pc),a1
        lea     -18560(a1),a1
        lsr.l   #2,d4
        cmp.l   #17,d4
        bls.s   forbisb2
forbisb1:
        cmp.w   #18,d4
        beq.s   sbfall18
        cmp.w   #19,d4
        beq.L   sbfall19
        cmp.w   #-1,d4
        beq.L   sbfallm1
        cmp.w   #-2,d4
        beq.L   sbfallm2
        bra.s   forbisb3

forbisb2:
        lsl.l   #3,d4
        adda.l  d4,a1
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
omsb1:  move.l  a0,a3
        adda.l  (a2)+,a3
        movem.l (a3)+,d0-d5
        move.w  d1,d6
        swap    d6
        move.w  d1,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d0,(a1)+
        or.l    d1,(a1)+

        move.w  d3,d6
        swap    d6
        move.w  d3,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d2,(a1)+
        or.l    d3,(a1)+


        move.w  d5,d6
        swap    d6
        move.w  d5,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d4,(a1)+
        or.l    d5,(a1)+


        lea     136(a1),a1
        dbra    d7,omsb1       
forbisb3:
        rts


sbfall18:
        lsl.l   #3,d4
        adda.l  d4,a1
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
omsb21: move.l  a0,a3
        adda.l  (a2)+,a3
        movem.l (a3)+,d0-d3
        addq.l  #8,a3
        move.w  d1,d6
        swap    d6
        move.w  d1,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d0,(a1)+
        or.l    d1,(a1)+

        move.w  d3,d6
        swap    d6
        move.w  d3,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d2,(a1)+
        or.l    d3,(a1)+



        lea     144(a1),a1
        dbra    d7,omsb21       
        rts


sbfall19:
        lsl.l   #3,d4
        adda.l  d4,a1
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
omsb31: move.l  a0,a3
        adda.l  (a2)+,a3
        move.l  (a3)+,d0
        move.l  (a3)+,d1
        lea     16(a3),a3
        move.w  d1,d6
        swap    d6
        move.w  d1,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d0,(a1)+
        or.l    d1,(a1)+


        lea     152(a1),a1
        dbra    d7,omsb31       
        rts

sbfallm1:
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
        addq.l  #8,a0
omsb41: move.l  a0,a3
        adda.l  (a2)+,a3
        movem.l (a3)+,d0-d3
        addq.l  #8,a3
        move.w  d1,d6
        swap    d6
        move.w  d1,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d0,(a1)+
        or.l    d1,(a1)+

        move.w  d3,d6
        swap    d6
        move.w  d3,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d2,(a1)+
        or.l    d3,(a1)+


        lea     144(a1),a1
        dbra    d7,omsb41       
        rts

sbfallm2:
        lea     tab2400,a4
        lsl.w   #2,d2
        add.l   (a4,d2.w),a0
        lea     16(a0),a0
omsb51: move.l  a0,a3
        adda.l  (a2)+,a3
        move.l  (a3)+,d0
        move.l  (a3)+,d1
        lea     16(a3),a3
        move.w  d1,d6
        swap    d6
        move.w  d1,d6
        not.l   d6
        and.l   d6,(a1)
        and.l   d6,4(a1)
        or.l    d0,(a1)+
        or.l    d1,(a1)+


        lea     152(a1),a1
        dbra    d7,omsb51       
        rts





rotate:
r0:     dc.l    12,00,01,02,03,04,05,06,07,08,09,10,11,12,13,14
        dc.l    15,16,17,18,19,20,21,22,23,24,00,00,00,00,00,00
r1:     dc.l    11,00,01,02,03,04,05,07,08,09,10,11,12,13,14,15
        dc.l    16,17,19,20,21,22,23,24,00,00,00,00,00,00,00,00
r2:     dc.l    10,00,01,02,04,05,06,07,08,10,11,12,13,14,16,17
        dc.l    18,19,20,22,23,24,00,00,00,00,00,00,00,00,00,00
r3:     dc.l    09,00,01,03,04,05,07,08,09,11,12,13,15,16,17,19
        dc.l    20,21,23,24,00,00,00,00,00,00,00,00,00,00,00,00
r4:     dc.l    08,00,02,03,05,06,08,09,11,12,13,15,16,18,19,21
        dc.l    22,24,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r5:     dc.l    07,00,02,04,05,07,09,10,12,14,15,17,19,20,22,24
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r6:     dc.l    06,00,02,04,06,08,10,12,14,16,18,20,22,24,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r7:     dc.l    05,01,03,05,07,10,12,14,17,19,21,23,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r8:     dc.l    04,01,04,06,09,12,15,18,20,23,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r9:     dc.l    03,01,05,08,12,16,19,23,00,00,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r10:    dc.l    02,02,07,12,17,22,00,00,00,00,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r11:    dc.l    01,04,12,20,00,00,00,00,00,00,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r12:    dc.l    00,12,00,00,00,00,00,00,00,00,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r13:    dc.l    01,20,12,04,00,00,00,00,00,00,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r14:    dc.l    02,22,17,12,07,02,00,00,00,00,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r15:    dc.l    03,23,19,16,12,08,05,01,00,00,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r16:    dc.l    04,23,20,18,15,12,09,06,04,01,00,00,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r17:    dc.l    05,23,21,19,17,14,12,10,07,05,03,01,00,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r18:    dc.l    06,24,22,20,18,16,14,12,10,08,06,04,02,00,00,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r19:    dc.l    07,24,22,20,19,17,15,14,12,10,09,07,05,04,02,00
        dc.l    00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r20:    dc.l    08,24,22,21,19,18,16,15,13,12,11,09,08,06,05,03
        dc.l    02,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
r21:    dc.l    09,24,23,21,20,19,17,16,15,13,12,11,09,08,07,05
        dc.l    04,03,01,00,00,00,00,00,00,00,00,00,00,00,00,00
r22:    dc.l    10,24,23,22,20,19,18,17,16,14,13,12,11,10,08,07
        dc.l    06,05,04,02,01,00,00,00,00,00,00,00,00,00,00,00
r23:    dc.l    11,24,23,22,21,20,19,17,16,15,14,13,12,11,10,09
        dc.l    08,07,05,04,03,02,01,00,00,00,00,00,00,00,00,00
r24:    dc.l    12,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10
        dc.l    09,08,07,06,05,04,03,02,01,00,00,00,00,00,00,00




        dc.b    12,13,13,14,14,15,15,16,17,17,18,18,19,19,20,20
        dc.b    20,21,21,22,22,22,23,23,23,23,23,23,24,24,24,24
        dc.b    24,24,24,24,24,24,23,23,23,23,23,22,22,22,21,21
        dc.b    20,20,20,19,19,18,18,17,17,16,15,15,14,14,13,13
        dc.b    12,11,11,10,10,09,09,08,07,07,06,06,05,05,04,04
        dc.b    04,03,03,02,02,02,01,01,01,01,01,00,00,00,00,00
        dc.b    00,00,00,00,00,00,01,01,01,01,01,02,02,02,03,03
        dc.b    04,04,04,05,05,06,06,07,07,08,09,09,10,10,11,11
RotData:
        dc.b    12,13,13,14,14,15,15,16,17,17,18,18,19,19,20,20
        dc.b    20,21,21,22,22,22,23,23,23,23,23,23,24,24,24,24
        dc.b    24,24,24,24,24,24,23,23,23,23,23,22,22,22,21,21
        dc.b    20,20,20,19,19,18,18,17,17,16,15,15,14,14,13,13
        dc.b    12,11,11,10,10,09,09,08,07,07,06,06,05,05,04,04
        dc.b    04,03,03,02,02,02,01,01,01,01,01,00,00,00,00,00
        dc.b    00,00,00,00,00,00,01,01,01,01,01,02,02,02,03,03
        dc.b    04,04,04,05,05,06,06,07,07,08,09,09,10,10,11,11
        dc.b    12,13,13,14,14,15,15,16,17,17,18,18,19,19,20,20
        dc.b    20,21,21,22,22,22,23,23,23,23,23,23,24,24,24,24
        dc.b    24,24,24,24,24,24,23,23,23,23,23,22,22,22,21,21
        dc.b    20,20,20,19,19,18,18,17,17,16,15,15,14,14,13,13
        dc.b    12,11,11,10,10,09,09,08,07,07,06,06,05,05,04,04
        dc.b    04,03,03,02,02,02,01,01,01,01,01,00,00,00,00,00
        dc.b    00,00,00,00,00,00,01,01,01,01,01,02,02,02,03,03
        dc.b    04,04,04,05,05,06,06,07,07,08,09,09,10,10,11,11
        dc.b    12,13,13,14,14,15,15,16,17,17,18,18,19,19,20,20
        dc.b    20,21,21,22,22,22,23,23,23,23,23,23,24,24,24,24
        dc.b    24,24,24,24,24,24,23,23,23,23,23,22,22,22,21,21
        dc.b    20,20,20,19,19,18,18,17,17,16,15,15,14,14,13,13
        dc.b    12,11,11,10,10,09,09,08,07,07,06,06,05,05,04,04
        dc.b    04,03,03,02,02,02,01,01,01,01,01,00,00,00,00,00
        dc.b    00,00,00,00,00,00,01,01,01,01,01,02,02,02,03,03
        dc.b    04,04,04,05,05,06,06,07,07,08,09,09,10,10,11,11


yposs:
        dc.b    25,26,27,29,30,31,32,33,35,36,37,38,39,40,41,42
        dc.b    43,44,44,45,46,46,47,48,48,49,49,49,50,50,50,50
        dc.b    50,50,50,50,50,49,49,49,48,48,47,46,46,45,44,44
        dc.b    43,42,41,40,39,38,37,36,35,33,32,31,30,29,27,26
        dc.b    25,24,23,21,20,19,18,17,15,14,13,12,11,10,09,08
        dc.b    07,06,06,05,04,04,03,02,02,01,01,01,00,00,00,00
        dc.b    00,00,00,00,00,01,01,01,02,02,03,04,04,05,06,06
        dc.b    07,08,09,10,11,12,13,14,15,17,18,19,20,21,23,24
        dc.b    25,26,27,29,30,31,32,33,35,36,37,38,39,40,41,42
        dc.b    43,44,44,45,46,46,47,48,48,49,49,49,50,50,50,50
        dc.b    50,50,50,50,50,49,49,49,48,48,47,46,46,45,44,44
        dc.b    43,42,41,40,39,38,37,36,35,33,32,31,30,29,27,26
        dc.b    25,24,23,21,20,19,18,17,15,14,13,12,11,10,09,08
        dc.b    07,06,06,05,04,04,03,02,02,01,01,01,00,00,00,00
        dc.b    00,00,00,00,00,01,01,01,02,02,03,04,04,05,06,06
        dc.b    07,08,09,10,11,12,13,14,15,17,18,19,20,21,23,24
        dc.b    25,26,27,29,30,31,32,33,35,36,37,38,39,40,41,42
        dc.b    43,44,44,45,46,46,47,48,48,49,49,49,50,50,50,50
        dc.b    50,50,50,50,50,49,49,49,48,48,47,46,46,45,44,44
        dc.b    43,42,41,40,39,38,37,36,35,33,32,31,30,29,27,26
        dc.b    25,24,23,21,20,19,18,17,15,14,13,12,11,10,09,08
        dc.b    07,06,06,05,04,04,03,02,02,01,01,01,00,00,00,00
        dc.b    00,00,00,00,00,01,01,01,02,02,03,04,04,05,06,06
        dc.b    07,08,09,10,11,12,13,14,15,17,18,19,20,21,23,24
        dc.b    25,24,23,21,20,19,18,17,15,14,13,12,11,10,09,08
        dc.b    07,06,06,05,04,04,03,02,02,01,01,01,00,00,00,00
        dc.b    00,00,00,00,00,01,01,01,02,02,03,04,04,05,06,06
        dc.b    07,08,09,10,11,12,13,14,15,17,18,19,20,21,23,24





scroller:
;       addq.l  #4,rotpos
        subq.l  #1,rotpos
        and.l   #127,rotpos
        move.l  rotpos(pc),d2
        add.l   #12,d2
        lea     rotdata(pc),a2
        add.l   d2,a2
        lea     yposs(pc),a3
        add.l   d2,a3
        move.l  scrollpos(pc),d0
        move.l  miniscrollpos(pc),d1
        addq.l  #1,d1
        cmp.l   #12,d1
        blt.s   forbis1
        moveq   #0,d1
        addq.l  #1,d0
        cmp.l   #textlen,d0
        blt.s   forbis2
        moveq   #0,d0
forbis2:
forbis1:
        move.l  d0,scrollpos
        move.l  d1,miniscrollpos
        neg.l   d1
        add.l   d1,a2
        add.l   d1,a2
        add.l   d1,a3
        add.l   d1,a3
        lea     text(pc),a0
        add.l   d0,a0
        lea     stasc(pc),a1
        move.l  d1,d0
        moveq   #6,d7
oms1:   moveq   #0,d2
        move.b  (a0)+,d2
        move.b  (a1,d2.w),d2
        moveq   #100,d1
        add.b   32(a3),d1
        moveq   #0,d3
        move.b  (a2),d3
        movem.l d0/d7/a0-a3,-(sp)

        cmp.w   #12,d3
        bhi.s   forbis3
        bsr     spritebefore
        bra.s   forbis4        
forbis3:
        bsr     spritebehind
forbis4:
        movem.l (sp)+,d0/d7/a0-a3
        add.l   #12,d0
        lea     24(a2),a2
        lea     24(a3),a3
        dbra    d7,oms1
        rts



scrollpos:      dc.l    0
miniscrollpos:  dc.l    0
rotpos:         dc.l    0




tab600: dc.l    0,600,1200,1800
        


slack:
        move.l  vvoldaddress(pc),a1
        move.l  voldaddress(pc),vvoldaddress
        move.l  lookingatstalin(pc),voldaddress
        subq.w  #1,skitcount2
        tst.w   skitcount2
        bpl.L   skitit2
        clr.w   skitcount2
        move.l  a1,a3
        add.l   currpicadd(pc),a1
        move.l  lookingatstalin(pc),a4
        add.l   #6080,a1
;       move.l  stalin,oldaddress
;       move.l  currpicadd,d0
;       add.l   d0,oldaddress
;       add.l   #6400,oldaddress

;       move.l  currpicadd(pc),a1
;       add.l   a2,a1
;       lea     6560(a1),a1
;;      lea     24640(a1),a1
; a3 = oldaddress
; a4 = new address

        move.l  a3,d0
        sub.l   a4,d0
        add.l   #2240,d0

        moveq   #0,d1
        move.l  d1,d2
        move.l  d1,d3
        move.l  d1,d4
        move.l  d1,d5
        move.l  d1,d6
        move.l  d1,d7
        move.l  d1,a2

omsl1:  movem.l d1-d7/a2,-(a1)
        movem.l d1-d7/a2,-(a1)
        movem.l d1-d7/a2,-(a1)
        movem.l d1-d7/a2,-(a1)
        movem.l d1-d7/a2,-(a1)
        sub.l   #160,d0
        tst.l   d0
        bgt.s   omsl1

;       lea     block,a0
;       lea     3840(a0),a0
;       moveq   #24,d0
;omsl2: 
;       movem.l 128(a0),d1-d7/a2
;       movem.l d1-d7/a2,-(a1)
;       movem.l 96(a0),d1-d7/a2
;       movem.l d1-d7/a2,-(a1)
;       movem.l 64(a0),d1-d7/a2
;       movem.l d1-d7/a2,-(a1)
;       movem.l 32(a0),d1-d7/a2
;       movem.l d1-d7/a2,-(a1)
;       movem.l (a0),d1-d7/a2
;       movem.l d1-d7/a2,-(a1)
;       lea     -160(a0),a0
;       dbra    d0,omsl2

        move.l  a4,d0
        sub.l   a3,d0
        add.l   #2880,d0
        lea     -4000(a1),a1
        moveq   #0,d1
        move.l  d1,d2
        move.l  d1,d3
        move.l  d1,d4
        move.l  d1,d5
        move.l  d1,d6
        move.l  d1,d7
        move.l  d1,a2
omsl3:  movem.l d1-d7/a2,-(a1)
        movem.l d1-d7/a2,-(a1)
        movem.l d1-d7/a2,-(a1)
        movem.l d1-d7/a2,-(a1)
        movem.l d1-d7/a2,-(a1)
        sub.l   #160,d0
        tst.l   d0
        bgt.s   omsl3
skitit2:
        rts

scrollineaddress:       dc.l    0
voldaddress:    dc.l    0
vvoldaddress:   dc.l    0
lookingatstalin:
                dc.l    0
skitcount2:     dc.w    2


updatevars:
        not.l   oddvsync
        tst.l   oddvsync
        bne.s   forbiudv1
        move.l  #picadd1,currpicadd
        bra.s   forbiudv2
forbiudv1:
        move.l  #picadd2,currpicadd
forbiudv2:
        move.l  currpicadd(pc),d0
        lsr.l   #8,d0
        move.b  d0,$ff8203
        lsr.l   #8,d0
        move.b  d0,$ff8201
        rts

oddvsync:
        dc.l    0       

shiftfont:
        lea     font(pc),a0
        lea     shiftedfont,a1
        moveq   #49,d0
omssp1: moveq   #12,d1
omssp2: move.l  a0,a2
        moveq   #16,d4
        sub.l   d1,d4
        move.w  #-1,d2
        lsr.w   d4,d2
        move.w  d2,d5
        swap    d5
        move.w  d2,d5
        move.l  d1,d6
        movem.l d0-d1/a0,-(sp)
        moveq   #24,d2
omssp3: movem.l (a2),d0-d1

        move.l  d0,d7
        lsr.l   d4,d7
        and.l   d5,d7
        lsl.l   d6,d0
        not.l   d5
        and.l   d5,d0
        not.l   d5
        move.l  d7,(a1)
        move.l  d0,8(a1)
        


        move.l  d1,d7
        lsr.l   d4,d7
        and.l   d5,d7
        lsl.l   d6,d1
        eor.l   #-1,d5
        and.l   d5,d1
        eor.l   #-1,d5
        move.l  d7,4(a1)
        move.l  d1,12(a1)


        movem.l 8(a2),d0-d1

        move.l  d0,d7
        lsr.l   d4,d7
        and.l   d5,d7
        lsl.l   d6,d0
        not.l   d5
        and.l   d5,d0
        not.l   d5
        or.l    d7,8(a1)
        move.l  d0,16(a1)

        move.l  d1,d7
        lsr.l   d4,d7
        and.l   d5,d7
        lsl.l   d6,d1
        eor.l   #-1,d5
        and.l   d5,d1
        eor.l   #-1,d5
        or.l    d7,12(a1)
        move.l  d1,20(a1)


        adda.l  #16,a2
        adda.l  #24,a1

        dbra    d2,omssp3
        movem.l (sp)+,d0-d1/a0
        subq.l  #4,d1
        tst.l   d1
        bge.L   omssp2
        adda.l  #400,a0
        dbra    d0,omssp1
        rts


svs:    st      svsready
        rte

svsready:       dc.b    0
even

setints:
        move.l  #svs,$70
        move.w  #$2300,sr
        clr.b   svsready
bomb3:  tst.b   svsready
        beq     bomb3
        move.w  #$2700,sr
        move.l  #vsync,$70
        move.b  #0,$fffa07
        move.b  #0,$fffa09
;        move.l  #hs1,-(sp)
;        move.w  #150,-(sp)
;        move.w  #8,-(sp)
;        move.w  #1,-(sp)
;        move.w  #31,-(sp)
;        trap    #14
;        add.l   #12,sp

        move.w  #$2300,sr

        rts


saveints:
        move.w  #$2700,sr
        move.b  $fffa07,mfpiea
        move.b  $fffa09,mfpieb
        move.b  $fffa13,mfpima
        move.b  $fffa15,mfpimb
        move.b  $fffa19,mfptac
        move.b  $fffa1b,mfptbc
        move.b  $fffa1f,mfptad
        move.b  $fffa21,mfptbd

        move.l  $120,timbvec
        move.l  $68,hsynvec
        move.l  $70,oldvsync
        rts

retints:
        move.w  #$2700,sr
        move.b  mfpiea,$fffa07
        move.b  mfpieb,$fffa09
        move.b  mfpima,$fffa13
        move.b  mfpimb,$fffa15
        move.b  mfptac,$fffa19
        move.b  mfptbc,$fffa1b
        move.b  mfptad,$fffa1f
        move.b  mfptbd,$fffa21


        move.l  timbvec,$120
        move.l  hsynvec,$68
        move.l  oldvsync,$70
        move.w  #$2300,sr
        rts


clearscreen:
        move.l  oldphys(pc),a0
        add.l   #32000,a0
        move.l  #1999,d0
        movem.l tom,d1-d7/a1
omcs1:  movem.l d1-d7/a1,-(a0)
        dbra    d0,omcs1
        rts

tom:    blk.l   10,0

emptyall:
        lea     $80000,a0
        moveq   #0,d0
omea1:  move.l  d0,-(a0)
        cmp.l   #shifteddistblocks,a0
        bgt     omea1
        rts


initvars:

        
;       move.w  #0,-(sp)
;       move.l  #-1,-(sp)
;       move.l  #-1,-(sp)
;       move.w  #5,-(sp)
;       trap    #14
;       add.l   #12,sp

        lea     oldpal(pc),a0
        movem.l $ff8240,d0-d7
        movem.l d0-d7,(a0)
        lea     palette(pc),a0
        movem.l (a0),d0-d7
        movem.l d0-d7,$ff8240
        bsr     shiftfont

;       move.w  #3,-(sp)
;       trap    #14
;       addq.l  #2,sp
;       move.l  d0,iglogscr


        moveq   #0,d1
        moveq   #0,d2
        move.w  #199,d0
        lea     tab160,a0
        lea     tab56,a1
omiv1:  move.l  d1,(a0)+
        move.l  d2,(a1)+
        add.l   #160,d1
        add.l   #56,d2
        dbra    d0,omiv1

        moveq   #0,d0
        moveq   #59,d1
        lea     tab2400,a0
omiv7:  move.l  d0,(a0)+
        add.l   #2400,d0
        dbra    d1,omiv7



        lea     rotate(pc),a0
        moveq   #24,d0
omiv2:  addq.l  #4,a0
        moveq   #30,d1
omiv3:  move.l  (a0),d2
        mulu    #24,d2
        move.l  d2,(a0)+
        dbra    d1,omiv3
        dbra    d0,omiv2

        bsr     saveints
        move.l  #0,scrollineaddress
        move.l  #0,voldaddress
        move.l  #0,vvoldaddress
        move.l  #picadd1,sladdr
        move.l  #picadd1,oldsladdr
        rts
        
        
endp:   tst.b   ready
        beq.s   endp
        bsr     retints

        lea     oldpal(pc),a0
        movem.l (a0),d0-d7
        movem.l d0-d7,$ff8240

;       move.w  oldres,-(sp)
;       move.l  oldphys,-(sp)
;       move.l  oldphys,-(sp)
;       move.w  #5,-(sp)
;       trap    #14
;       adda.l  #12,sp

        rts

startmuzak:
        lea     orgmus(pc),a0
        lea     music,a1
        move.l  #$7ff,d0
omsm1:  move.l  (a0)+,(a1)+
        dbra    d0,omsm1

        moveq   #4,d0
        jsr     $50600
        rts



main:
        move.l  sp,oldstck
        move.l  #stck,sp
;       bsr     emptyall
        bsr     borderdemo
        bsr     emptyall
        bsr     startmuzak
        bsr     shiftdistblocks

;       clr.l   -(sp)
;       move.w  #32,-(sp)
;       trap    #1
;       addq.l  #6,sp
;       move.l  d0,savstk

        bsr     initvars
        bsr     clearscreen
        jsr     initializeraster
        bsr     initializescrolline
        bsr     initializeANDist

        move.l  oldphys,currpicadd
        bsr     setints


        bsr     blattut
        clr.b   ready
omm1:   
omm2:   tst.b   ready
        beq.s   omm2
        clr.b   ready
;       move.w  #$000,$ff8240
        bsr     updatevars

        bsr     calcpalettechangepos
        bsr     ANscroll
        bsr     slack
        bsr     scroller
        bsr     distTCBxy
        bsr     DistANDist
;       move.w  #$555,$ff8240
        cmp.b   #185,$fffc02
        beq.s   utm1
        bra.s   omm1
utm1:
        bsr     endp
;       move.l  savstk,-(sp)
;       move.w  #32,-(sp)
;       trap    #1
;       addq.l  #6,sp
;       move.l  oldstck,sp      
        rts

        
savstk:         dc.l    0
oldstck:        dc.l    0
ustck:          blk.l   100
stck:           dc.l    0
ready:          dc.b    0,0
oldstack:       dc.l    0
mfpiea:         dc.b    0
mfpieb:         dc.b    0
mfpima:         dc.b    0
mfpimb:         dc.b    0
mfptac:         dc.b    0
mfptbc:         dc.b    0
mfptad:         dc.b    0
mfptbd:         dc.b    0
timbvec:        dc.l    0
hsynvec:        dc.l    0
oldvsync:       dc.l    0
oldphys:        dc.l    0
oldres:         dc.w    0
oldpal:         blk.w   16
tab160:         blk.l   200,0
tab56:          blk.l   200,0
palette:        dc.w    $000,$076,$075,$064,$053,$042,$031,$002
                dc.w    $000,$760,$750,$640,$530,$420,$310,$003
palette3:       dc.w    $000,$000,$076,$760,$075,$750,$064,$640
                dc.w    $053,$530,$042,$420,$031,$310,$002,$003
currpicadd:     dc.l    0
picadd1:        equ     $80000-32000
picadd2:        equ     $80000-64000
theunion:       dc.b    'THE UNION',0

text:           
                DC.B    '         ','          '
                DC.B    'HELLO! THIS IS A TEST. THE CAREBEARS'
                DC.B    ' ARE PROUD TO PRESENT - THE HARD TO READ'
                DC.B    ' SCROLLER. ANDREAS GOT A HEADACHE AFTER'
                DC.B    ' FIVE MINUTES AND SO DID I AFTER TEN...'
                DC.B    ' WHY DO WE WRITE ANYTHING AT ALL IN THESE'
                DC.B    ' PREVIEWS, YOU MIGHT WANT TO ASK. WELL,'
                DC.B    ' WE DONT KNOW, BUT WE MIGHT AS WELL'
                DC.B    ' GREET SOME PEOPLE. MEGAGREETINGS GO TO:'
                DC.B    ' ALL THE OTHER MEMBERS OF THE UNION.'
                DC.B    ' A BIT SMALLER GREETING (8 OUT OF 10)'
                DC.B    ' GOES TO AN COOL (YOUR LATEST INTRO IS REALLY'
                DC.B    ' SOMETHING). A COUPLE OF ORDINARY GREETINGS'
                DC.B    ' GO TO THE BLADERUNNERS (ESPECIALLY HCC)'
                DC.B    ', PYROTECHNICS (WERE YOUR BIGGEST FANS)'
                DC.B    ', SYNC, ZZAP GAMES (SEE, WE DO GREET YOU)'
                DC.B    '. FINALLY, I SUPPOSE I SHOULD GREET GROWTWIG,'
                DC.B    ' MATTI AND BEAR OF BLOCKBUSTERS TOO, SO A'
                DC.B    ' COUPLE OF HELLO(E)S GO TO YOU TOO:'
                DC.B    ' - HELLO, HELLO, HELLO '
                DC.B    ' LETS START ALL OVER AGAIN.......'
                DC.B    '         ','          '
EVEN
textlen:        equ     800



STASC:  DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,26,46,47,47,47,47,45,40,41,47,47,43,42,44,47
        DC.B    30,31,32,33,34,35,36,37,38,39,28,29,47,47,47,27
        DC.B    47,0 ,1 ,2 ,3 ,4 ,5 ,6 ,7 ,8 ,9 ,10,11,12,13,14
        DC.B    15,16,17,18,19,20,21,22,23,24,25,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,45,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47
        DC.B    47,47,47,47,47,47,47,47,47,47,47,47,47,47,47,47

anorig:
; *** AN COOL sprite ****
        dc.w    $0000,$0000,$0000,$0000,$00D0,$17C8,$1838,$0000
        dc.w    $00F0,$08E8,$0F18,$0000,$0512,$0B1C,$00E2,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $0719,$0B1E,$0CE0,$0000,$C69E,$3EE0,$0102,$0000
        dc.w    $071E,$0B1F,$0CE0,$0000,$7940,$8720,$00E0,$0000
        dc.w    $071E,$0B1F,$0CE0,$0000,$7940,$8720,$00E0,$0000
        dc.w    $5120,$B1C0,$0E20,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$3688,$1984,$207C,$0000
        dc.w    $1E80,$2EF4,$310C,$0000,$02B4,$05BA,$0846,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $1793,$2B9C,$3060,$0000,$CCBC,$3CC2,$0306,$0000
        dc.w    $179C,$2B9F,$3060,$0000,$71B0,$8FE8,$0018,$0000
        dc.w    $179C,$2B9F,$3060,$0000,$71B0,$8FE8,$0018,$0000
        dc.w    $2B40,$5BA0,$8460,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$4EBC,$31B8,$4044,$0000
        dc.w    $2308,$5FFA,$6006,$0000,$08A8,$03B6,$0C4E,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $2DB9,$53BE,$6040,$0000,$9978,$7986,$060E,$0000
        dc.w    $2DBC,$53BF,$6040,$0000,$63E8,$9F90,$0008,$0000
        dc.w    $2DBC,$53BF,$6040,$0000,$63E8,$9F90,$0008,$0000
        dc.w    $0A80,$3B60,$C4E0,$0000,$0000,$0000,$0000,$0000
        dc.w    $0000,$0000,$0000,$0000,$87FC,$7BF0,$83CC,$0000
        dc.w    $59DC,$27FD,$41C3,$0000,$0DF0,$01FE,$0FFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $4DFF,$33FF,$41FF,$0000,$FFF2,$FFFC,$FFFE,$0000
        dc.w    $4DFF,$33FF,$41FF,$0000,$FF58,$FFBC,$FF04,$0000
        dc.w    $4DFF,$33FF,$41FF,$0000,$FF58,$FFBC,$FF04,$0000
        dc.w    $9F00,$1FE0,$FFE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $0001,$0000,$0001,$0000,$EFF8,$FFE6,$0FFE,$0000
        dc.w    $5FFF,$E7FE,$87F1,$0000,$07F0,$81FE,$8FFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $27FF,$DFFF,$87FF,$0000,$FFF6,$FFF8,$FFFE,$0000
        dc.w    $27FF,$DFFF,$87FF,$0000,$FFF4,$FFF0,$FFCC,$0000
        dc.w    $27FF,$DFFF,$87FF,$0000,$FFF4,$FFF0,$FFCC,$0000
        dc.w    $DF20,$1FC0,$FFE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $0003,$0001,$0002,$0000,$FFF0,$FFFE,$1FFE,$0000
        dc.w    $CFFC,$7FFC,$8FFB,$0000,$8BF2,$49FC,$C7FE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $BFFF,$4FFF,$8FFF,$0000,$FFFE,$FFF0,$FFFE,$0000
        dc.w    $BFFF,$4FFF,$8FFF,$0000,$FFEC,$FFE0,$FFFC,$0000
        dc.w    $BFFF,$4FFF,$8FFF,$0000,$FFEC,$FFE0,$FFFC,$0000
        dc.w    $FF60,$1F80,$FFE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $0005,$0003,$0004,$0000,$FFF2,$FFFC,$3FFE,$0000
        dc.w    $EFFC,$FFFC,$0FFF,$0000,$C9F6,$29F8,$E7FE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $CFFF,$FFFF,$0FFF,$0000,$FFF2,$FFFC,$FFFE,$0000
        dc.w    $CFFF,$FFFF,$0FFF,$0000,$FFF8,$FFE6,$FFFE,$0000
        dc.w    $CFFF,$FFFF,$0FFF,$0000,$FFF8,$FFE6,$FFFE,$0000
        dc.w    $3FE0,$1F00,$FFE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $0008,$0007,$0008,$0000,$7FF6,$FFF8,$7FFE,$0000
        dc.w    $3FFE,$3FFE,$DFFF,$0000,$E5FC,$1DF0,$F3FE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $7FFF,$7FFF,$9FFF,$0000,$FFF0,$FFFE,$FFFE,$0000
        dc.w    $7FFF,$7FFF,$9FFF,$0000,$FFF0,$FFFE,$FFFE,$0000
        dc.w    $7FFF,$7FFF,$9FFF,$0000,$FFF0,$FFFE,$FFFE,$0000
        dc.w    $1FA0,$1F00,$FFE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $001F,$0000,$0010,$0000,$FFFE,$FFF0,$FFFE,$0000
        dc.w    $1FFF,$1FFF,$FFFF,$0000,$D3F8,$0FF0,$F1FE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $7F83,$7FFC,$9FFF,$0000,$CF00,$300E,$FFFE,$0000
        dc.w    $7F80,$7FFF,$9FFF,$0000,$0FF2,$F3FC,$FFFE,$0000
        dc.w    $7F80,$7FFF,$9FFF,$0000,$0FF2,$F3FC,$FFFE,$0000
        dc.w    $5F20,$5F00,$BFE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $003F,$0001,$0021,$0000,$F9FA,$FFF0,$FFFE,$0000
        dc.w    $DFFF,$DFFF,$3FFF,$0000,$C3F8,$87F0,$F9FE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $3F0C,$3FF0,$DFFF,$0000,$61C0,$1E06,$FFFE,$0000
        dc.w    $3F00,$3FFF,$DFFF,$0000,$F9F6,$03F8,$FDFE,$0000
        dc.w    $3F00,$3FFF,$DFFF,$0000,$F9F6,$03F8,$FDFE,$0000
        dc.w    $FF20,$FF00,$1FE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $007F,$0003,$0043,$0000,$FFF0,$F3F0,$FDFE,$0000
        dc.w    $FF3F,$FF3F,$1FFF,$0000,$C9F8,$C7F0,$F9FE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $3F03,$3FFC,$DFFF,$0000,$80E0,$7F02,$FFFE,$0000
        dc.w    $3F03,$3FFC,$DFFF,$0000,$13F8,$05F0,$F9FE,$0000
        dc.w    $3F03,$3FFC,$DFFF,$0000,$13F8,$05F0,$F9FE,$0000
        dc.w    $FF60,$FF00,$1FE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $00BF,$0047,$0087,$0000,$EBF4,$F3F4,$FDFA,$0000
        dc.w    $BF9F,$FF1F,$1FFF,$0000,$E9F8,$E3F0,$FDFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $9F00,$9FE0,$7FE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $9F00,$9FE0,$7FE0,$0000,$07F8,$09F0,$01FE,$0000
        dc.w    $9F00,$9FE0,$7FE0,$0000,$07F8,$09F0,$01FE,$0000
        dc.w    $BFC0,$FF20,$1FE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $013F,$00CF,$010F,$0000,$C1F4,$FFF4,$F9FA,$0000
        dc.w    $1F8F,$FF0F,$1FFF,$0000,$FDF8,$F3F0,$FDFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $5F00,$DFE0,$3FE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $5F00,$DFE0,$3FE0,$0000,$07F8,$09F0,$01FE,$0000
        dc.w    $5F00,$DFE0,$3FE0,$0000,$07F8,$09F0,$01FE,$0000
        dc.w    $1F80,$FF60,$1FE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $033F,$01DF,$021F,$0000,$95F0,$EFF0,$F1FE,$0000
        dc.w    $5FCF,$BF0F,$1FF7,$0000,$FDFC,$F9F0,$FFFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $3F60,$FF90,$1FF0,$0000,$0000,$0000,$0000,$0000
        dc.w    $3F60,$FF80,$1FE0,$0000,$0BF8,$0DF0,$01FE,$0000
        dc.w    $3F60,$FF80,$1FE0,$0000,$0BF8,$0DF0,$01FE,$0000
        dc.w    $5F20,$BFC0,$1FE0,$0000,$0000,$0000,$0000,$0000
        dc.w    $073F,$03FF,$043F,$0000,$0FFA,$DFF0,$E1FE,$0000
        dc.w    $FFCF,$1F0F,$1FF3,$0000,$FFFE,$FFF0,$FFFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $DFC8,$3F0F,$1FF0,$0000,$61C8,$9FF4,$0002,$0000
        dc.w    $DFC2,$3F0D,$1FF0,$0000,$6DFA,$EFF0,$11FE,$0000
        dc.w    $DFC2,$3F0D,$1FF0,$0000,$6DFA,$EFF0,$11FE,$0000
        dc.w    $5F43,$BFB0,$1FCF,$0000,$F8E0,$00FC,$FF02,$0000
        dc.w    $0BFF,$07FF,$087F,$0000,$FFFE,$FFF0,$FFFE,$0000
        dc.w    $FF6D,$1F8F,$1FF1,$0000,$FFFE,$FFF0,$FFFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $FF98,$1F1F,$1FE0,$0000,$F390,$0FEA,$0006,$0000
        dc.w    $FF97,$1F18,$1FE0,$0000,$65F6,$E7F8,$19FE,$0000
        dc.w    $FF97,$1F18,$1FE0,$0000,$65F6,$E7F8,$19FE,$0000
        dc.w    $1F88,$FF78,$1F87,$0000,$E180,$01FA,$FE06,$0000
        dc.w    $13FF,$0FFF,$10FF,$0000,$FFF6,$FFF8,$FFFE,$0000
        dc.w    $5F78,$BF8F,$1FF0,$0000,$FFF4,$FFFA,$FFFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $DFBC,$3FBF,$1FC0,$0000,$7220,$8FD6,$000E,$0000
        dc.w    $DFBF,$3FB0,$1FC0,$0000,$13F4,$F3FA,$0FFE,$0000
        dc.w    $DFBF,$3FB0,$1FC0,$0000,$13F4,$F3FA,$0FFE,$0000
        dc.w    $1F1C,$FFFC,$1F03,$0000,$0F02,$0FF4,$F00E,$0000
        dc.w    $23FF,$1FFF,$21FF,$0000,$FFF2,$FFFC,$FFFE,$0000
        dc.w    $1F28,$FFC7,$1FE8,$0000,$FFF0,$FFFE,$7FFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $1FFF,$FFFF,$1FFF,$0000,$FFF0,$FFFE,$FFFE,$0000
        dc.w    $1FFF,$FFFF,$1FFF,$0000,$FFF0,$FFFE,$FFFE,$0000
        dc.w    $1FFF,$FFFF,$1FFF,$0000,$FFF0,$FFFE,$FFFE,$0000
        dc.w    $9FFF,$FFFF,$1FFF,$0000,$FFF4,$FFF8,$FFFE,$0000
        dc.w    $73FC,$3FF0,$43FF,$0000,$03F2,$01FC,$FFFE,$0000
        dc.w    $1F25,$FFC3,$1FE4,$0000,$FFE0,$FFFE,$3FFE,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $BFFF,$FFFF,$0FFF,$0000,$FFF2,$FFFC,$FFFE,$0000
        dc.w    $BFFF,$FFFF,$0FFF,$0000,$FFE0,$FFFE,$FFFE,$0000
        dc.w    $BFFF,$FFFF,$0FFF,$0000,$FFE0,$FFFE,$FFFE,$0000
        dc.w    $FFFF,$FFFF,$1FFF,$0000,$FFFC,$FFF0,$FFFE,$0000
        dc.w    $9FE7,$7FF8,$87FF,$0000,$0FF0,$03FE,$FDFE,$0000
        dc.w    $BF23,$FFC1,$1FE2,$0000,$FFF0,$FFEC,$1FFC,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $EFFF,$6FFF,$9FFF,$0000,$FFF6,$FFF8,$FFFE,$0000
        dc.w    $EFFF,$6FFF,$9FFF,$0000,$FFF0,$FFEC,$FFFC,$0000
        dc.w    $EFFF,$6FFF,$9FFF,$0000,$FFF0,$FFEC,$FFFC,$0000
        dc.w    $DFFF,$FFFF,$1FFF,$0000,$FFFC,$FFF0,$FFFE,$0000
        dc.w    $8FC1,$FFFE,$0FFF,$0000,$BDF0,$07FE,$F9FE,$0000
        dc.w    $FF01,$FFE0,$1FE1,$0000,$CFD8,$CFC4,$3FFC,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $4FFF,$CFFF,$B7FF,$0000,$FFFC,$FFF0,$FFFE,$0000
        dc.w    $4FFF,$CFFF,$B7FF,$0000,$FFD8,$FFC4,$FFFC,$0000
        dc.w    $4FFF,$CFFF,$B7FF,$0000,$FFD8,$FFC4,$FFFC,$0000
        dc.w    $9FFF,$FFFF,$0FFF,$0000,$FFF6,$FFF8,$FFFE,$0000
        dc.w    $7F80,$7FF8,$9FF8,$0000,$0BF0,$0DFE,$01FE,$0000
        dc.w    $FF00,$FFE0,$1FE0,$0000,$CFC8,$4304,$BFFC,$0000
        dc.w    $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
        dc.w    $53FF,$1FFF,$61FF,$0000,$FFF0,$FFF0,$FFFE,$0000
        dc.w    $53FF,$1FFF,$61FF,$0000,$FFC8,$FF04,$FFFC,$0000
        dc.w    $53FF,$1FFF,$61FF,$0000,$FFC8,$FF04,$FFFC,$0000
        dc.w    $B7F