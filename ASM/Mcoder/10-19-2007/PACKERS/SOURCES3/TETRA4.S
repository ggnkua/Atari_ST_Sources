;
; ceci est un packer AMIGA (originellement)
;
; il marche trŠs bien, mais contrairement … ce qui est annonc‚
;  il n'est pas 100% Bugfree. J'ai d‚j… corrig‚ un bug tout bete
;  mais il y en a quelques autres.
; Le plus visible est qu'on ne peut pas sauver plus d'une fois
;  un fichier compress‚ !!!
;
	OUTPUT	TETRA.TOS
;
DEBUTCODE
	PEA	(FINCODE-DEBUTCODE+256).W
	PEA	DEBUTCODE-256(PC)
	CLR	-(SP)
	MOVE	#$4A,-(SP)
	TRAP	#1
	LEA	PILE(PC),SP

	LEA	L1252(PC),A5
	BSR	PRINT

	BSR	L184
	BSR	L72C
	BSR	L814

	MOVE.L	L1B36(PC),-(sp)
	MOVE	#$49,-(SP)	;FREE_MEM
	TRAP	#1
	ADDQ	#6,SP
	CLR	-(SP)
	TRAP	#1

PRINT	MOVEM.L	D0-D2/A0-A2,-(A7)
	pea	(A5)
	move	#9,-(sp)
	trap	#1
	addq	#6,sp
	MOVEM.L	(A7)+,D0-D2/A0-A2
	RTS
L78
	pea	buffer1-2(pc)
	move	#10,-(sp)	;GET_LINE
	trap	#1
	addq	#6,sp
	CMP	#8,D0
	BHS.S	LC0
	LEA	buffer1(pc),A5
	SUBQ	#1,D0
	MOVEQ	#0,D4
L9E	MOVE.B	(A5)+,D1
	LEA	L104E(PC),A4
	MOVEQ	#$1F,D6
LA6	CMP.B	(A4)+,D1
	DBEQ	D6,LA6
	NOT	D6
	BEQ.S	LC0
	AND	#$F,D6
	ASL.L	#4,D4
	OR	D6,D4
	DBF	D0,L9E
	MOVE.L	D4,D0
	RTS
LC0	MOVEQ	#0,D0
	RTS
LC4
	PEA	buffer2-2(pc)
	move	#10,-(sp)
	trap	#1
	addq	#6,sp
	lea	buffer2(pc),a0
	CLR.B	(A0,D0.W)

	move	#$a,-(sp)
	move	#2,-(sp)
	trap	#1
	addq	#4,sp

	MOVE.B	buffer2(pc),D0
	RTS
L11A	MOVEM.L	D0-D7/A0-A6,-(A7)
	MOVE.L	D0,-(SP)
	MOVE	#' ',-(SP)
	MOVE	#2,-(SP)
	TRAP	#1
	ADDQ	#4,SP
	MOVE	#'$',-(SP)
	MOVE	#2,-(SP)
	TRAP	#1
	ADDQ	#4,SP
	MOVE.L	(SP)+,D0
	MOVEQ	#7,D4
	MOVE.L	D0,D6
L12C
	ROL.L	#4,D6
	MOVE	D6,D0
	AND	#$F,D0
	ADD	#$30,D0
	CMP	#$3A,D0
	BLO.S	L12D
	ADDQ	#7,D0
L12D
	MOVE	D0,-(SP)
	MOVE	#2,-(SP)
	trap	#1
	addq	#4,sp
	DBF	D4,L12C
	MOVEM.L	(A7)+,D0-D7/A0-A6
	RTS
L184
	LEA	L16F8(PC),A5
	BSR	PRINT
	BSR	L78
	BEQ	L184
	MOVE.L	D0,L11C2
	MOVE.L	D0,LF94
	LEA	L1706(PC),A5
	BSR	PRINT
	BSR	L78
	BEQ	L184
	MOVE.L	D0,L11C6
	ADD.L	#$108,D0
	SUB.L	L11C2(PC),D0
	MOVE.L	#$10000,D1
	MOVE.L	D0,L1B3A

	MOVE.L	D0,-(SP)
	MOVE	#$48,-(SP)	;MEMORY ALLOC
	TRAP	#1
	ADDQ	#6,SP

	TST.L	D0
	BPL.S	L2F8
	LEA	L15C5(PC),A5
	BSR	PRINT
	MOVEQ	#1,D0
	BRA	L184
L2F8	MOVE.L	D0,L1B36
	MOVE.L	D0,D7
	LEA	L106E(PC),A5
	BSR	PRINT
	MOVE.L	D7,D0
	BSR	L11A
	LEA	L1081(PC),A5
	BSR	PRINT
	MOVE.L	L11C6(PC),D0
	SUB.L	L11C2(PC),D0
	ADD.L	L1B36(PC),D0
	ADD.L	#$100,D0
	BSR	L11A
	LEA	L10AA(PC),A5
	BSR	PRINT
	LEA	L1713(PC),A5
	BSR	PRINT
	MOVE.L	L11C2(PC),A0
	SUB.L	L11C2(PC),A0
	ADD.L	L1B36(PC),A0
	MOVE.L	L11C6(PC),A1
	SUB.L	L11C2(PC),A1
	ADD.L	L1B36(PC),A1
	LEA	$100(A1),A1
L35A	CLR.B	(A0)+
	CMP.L	A1,A0
	BLO.S	L35A
L360	LEA	L17F4(PC),A5
	BSR	PRINT
	BSR	L78
	MOVE.L	D0,L11DE
	BEQ.S	L360
	CMP.L	#$10,D0
	BLO.S	L360
	CMP.L	#$8000,D0
	BGT.S	L360
	BSR	L4D0
	LEA	L1727(PC),A5
	BSR	PRINT
L390
	LEA	L179A(PC),A5
	BSR	PRINT
	BSR	LC4
	BEQ	L4CE

	CLR	-(SP)
	PEA	buffer2(pc)
	move	#$3d,-(sp)	;open file
	trap	#1
	addq	#8,sp
	ext.l	d0
	BMI.S	L390
	MOVE.L	D0,L11D2
L3F0	LEA	L17D4(PC),A5
	BSR	PRINT
	BSR	L78
	BEQ.S	L390
	CMP.L	L11C2(PC),D0
	BLO.S	L40A
	CMP.L	L11C6(PC),D0
	BLO.S	L414
L40A	LEA	L15E9(PC),A5
	BSR	PRINT
	BRA.S	L3F0
L414	SUB.L	L11C2(PC),D0
	ADD.L	L1B36(PC),D0
	ADD.L	#$100,D0
	MOVE.L	D0,L11D6
	MOVE.L	D0,D2
	MOVE.L	L11D2(PC),D1
	MOVE.L	L11C6(PC),D3
	SUB.L	L11C2(PC),D3
	ADD.L	L1B36(PC),D3
	ADD.L	#$101,D3
	SUB.L	D2,D3

	move.l	d2,-(sp)
	move.l	d3,-(sp)
	move	d1,-(sp)
	move	#$3f,-(sp)	;read file
	trap	#1
	lea	12(sp),sp
	ADD.L	L11D6(PC),D0
	SUB.L	L1B36(PC),D0
	ADD.L	L11C2(PC),D0
	SUB.L	#$100,D0
	MOVE.L	D0,L11DA
	MOVE.L	L11D2(PC),D1
	move	d1,-(sp)
	move	#$3e,-(sp)	;close file
	trap	#1
	addq	#4,sp
L4A8	MOVE.L	L11DA(PC),D0
	CMP.L	L11C6(PC),D0
	BLE.S	L4BA
	LEA	L15FE(PC),A5
	BSR	PRINT
L4BA	LEA	L17E4(PC),A5
	BSR	PRINT
	MOVE.L	L11DA(PC),D0
	BSR	L11A
	BRA	L390
L4CE	RTS
L4D0	SUBQ	#1,D0
	MOVEQ	#$11,D1
L4D4	SUBQ.L	#1,D1
	ADD	D0,D0
	BCC.S	L4D4
	MOVE	D1,LC68
	MOVE.B	D1,L196D
	MOVE.B	D1,L1B31
	CMP	#$A,D1
	BGE.S	L4F8
	MOVE	D1,LC66
L4F8	CMP	#9,D1
	BGT.S	L52A
	MOVE	D1,LC64
	MOVE.B	D1,L192B
	MOVE.B	D1,L1AED
	MOVE	LC66,D7
	SUB	D1,D7
	BNE.S	L52A
	MOVE	#$4E71,L192E
	MOVE	#$4E71,L1AF0
L52A	CMP	#8,D1
	BGE.S	L542
	MOVE	D1,LC62
	MOVE.B	D1,L18EB
	MOVE.B	D1,L1AAD
L542	RTS

L6B6	MOVE.L	L11C2(PC),A5
	SUB.L	L11C2(PC),A5
	ADD.L	L1B36(PC),A5
	LEA	$100(A5),A5
	MOVE.L	L11C6(PC),A4
	SUB.L	L11C2(PC),A4
	ADD.L	L1B36(PC),A4
	LEA	$100(A4),A4
	MOVEQ	#0,D7
	MOVEQ	#0,D6
	LEA	freqs(pc),A0
	MOVE.L	A0,A1
	MOVEQ	#$7F,D0
L6E6	CLR.L	(A1)+
	DBF	D0,L6E6
L6EC	MOVEQ	#0,D0
	MOVE.B	(A5)+,D0
	ADD	D0,D0
	ADDQ	#1,0(A0,D0.W)
	BNE.S	L6FC
	SUBQ	#1,0(A0,D0.W)
L6FC	CMP.L	A4,A5
	BLO.S	L6EC
	MOVEQ	#0,D0
	MOVE.L	#$FFFF,D1		;pour corriger bug
	MOVEQ	#0,D3
L708	MOVE	D0,D2
	ADD	D2,D2
	MOVEQ	#0,D5
	MOVE	0(A0,D2.W),D5
	CMP.L	D5,D1
	BLE.S	L71A
	MOVE.L	D0,D3
	MOVE	D5,D1
L71A	ADDQ.B	#1,D0
	BNE.S	L708
	MOVE.B	D3,L11CA
	MOVE	D1,L11D0
	RTS
L72C	LEA	L11E4(PC),A5
	BSR	PRINT
	BSR	L6B6
	BSR	L748
	BSR	LAF4
	MOVE.L	A2,LF98
	RTS
L748	MOVE.L	L11C2(PC),A0
	SUB.L	L11C2(PC),A0
	ADD.L	L1B36(PC),A0
	MOVE.L	A0,A1
	LEA	$100(A0),A0
	LEA	$80(A1),A1
	MOVE.L	L11C6(PC),A2
	SUB.L	L11C2(PC),A2
	ADD.L	L1B36(PC),A2
	LEA	$100(A2),A2
	MOVE.B	-1(A2),(A2)
	ADDQ.B	#1,(A2)
	MOVEQ	#0,D7
	MOVE.B	L11CA(PC),D7
	MOVEQ	#0,D0
	MOVEQ	#0,D1
L784	MOVE.B	(A0)+,D0
	BSR	L800
	CMP.L	#4,D1
	BLT.S	L7AE
	CMP.L	#$102,D1
	BLE.S	L7A0
	MOVE.L	#$102,D1
L7A0	SUBQ	#3,D1
	MOVE.B	D7,(A1)+
	MOVE.B	D1,(A1)+
	MOVE.B	D0,(A1)+
	ADDQ.L	#2,A0
	ADD.L	D1,A0
	BRA.S	L7BA
L7AE	CMP.B	D7,D0
	BNE.S	L7B8
	MOVE.B	D7,(A1)+
	CLR.B	(A1)+
	BRA.S	L7BA
L7B8	MOVE.B	D0,(A1)+
L7BA	CMP.L	A2,A0
	BLO.S	L784
	MOVE.L	A1,L11CC
	MOVE.L	L11C2(PC),L197E
	MOVE.L	L11C6(PC),L1984
	MOVE.L	L11C2(PC),L1A68
	MOVE.L	L11C6(PC),L1A6E
	MOVE.B	L11CA(PC),L197B
	MOVE.B	L11CA(PC),L1A65
	SUB.L	#$80,LF94
	RTS
L800	MOVE.L	A0,A3
	MOVE	#$102,D5
L806	CMP.B	(A3)+,D0
	BNE.S	L80E
	DBF	D5,L806
L80E	SUB.L	A0,A3
	MOVE.L	A3,D1
	RTS
L814	BSR	LA6E
L818	LEA	L1200(PC),A5
	BSR	PRINT
	BSR	L78
	BEQ.S	L818
	MOVE.L	D0,L19A8
	MOVE.L	D0,L1A20

	LEA	L1535(PC),A5
	BSR	PRINT
	BSR	LC4
	CMP.B	#'y',buffer2
	BEQ.S	L878
	CMP.B	#'Y',buffer2
	BNE	L8EE
L878
	ST	L1B34
	LEA	L1597(PC),A5
	BSR	PRINT
	BSR	L78
	MOVE	D0,L1A26
	LEA	L157E(PC),A5
	BSR	PRINT
	BSR	L78
	BEQ	L818
	MOVE.L	D0,L19FE
	LEA	L15AC(PC),A5
	BSR	PRINT
	BSR	L78
	MOVE.L	D0,L1A04
L8EE	MOVE.L	LF98(PC),D3
	MOVE.L	LF94(PC),D2
	ADD.L	#$100,D2
	MOVE.L	L11CC(PC),D5
	SUB.L	D2,D5
	ADD.L	#$80,D5
	MOVE.L	L11C6(PC),D6
	SUB.L	D5,D6
	MOVE.L	D6,L18D8
	MOVE.L	D6,L1A4C
	SUB.L	#$100,D2
	SUB.L	D2,D3
	MOVE.L	D3,L18C0
	MOVE.L	D3,L1A34
	LEA	L1246(PC),A5
	BSR	PRINT
	BSR	LC4
	BEQ	L9E6

	pea	buffer2(pc)
	move	#$41,-(sp)	;delete file
	trap	#1
	addq	#6,sp

	clr	-(sp)
	pea	buffer2(pc)
	move	#$3c,-(sp)
	trap	#1
	addq	#8,sp

	ext.l	d0
	MOVE.L	D0,L1624
	BMI	L818
	MOVE.L	D0,D1
	TST.B	L1B34
	BEQ.S	L9AC

	pea	L19B0(PC)
	PEA	(L1B34-L19B0).W
	MOVE	D1,-(SP)
	MOVE	#$40,-(SP)	;WRITE FILE
	TRAP	#1
	LEA	12(SP),SP
	BRA.S	L9BC
L9AC
	pea	L188C(PC)
	PEA	(L19AC-L188C).W
	MOVE	D1,-(SP)
	MOVE	#$40,-(SP)	;WRITE FILE
	TRAP	#1
	LEA	12(SP),SP
L9BC	MOVE.L	L1624(PC),D1
	MOVE.L	LF98(PC),D3
	MOVE.L	LF94(PC),D2
	SUB.L	D2,D3

	MOVE.L	D2,-(SP)
	MOVE.L	D3,-(SP)
	MOVE	D1,-(SP)
	MOVE	#$40,-(SP)	;WRITE FILE
	TRAP	#1
	LEA	12(SP),SP

	MOVE.L	L1624(PC),D1
	MOVE.L	#L19AC,D2
	MOVEQ	#4,D3
	MOVE.L	D2,-(SP)
	MOVE.L	D3,-(SP)
	MOVE	D1,-(SP)
	MOVE	#$40,-(SP)	;WRITE FILE
	TRAP	#1
	LEA	12(SP),SP

	MOVE.L	L1624(PC),D1
	MOVE	D1,-(SP)
	MOVE	#$3E,-(SP)	;CLOSE FILE
	TRAP	#1
	ADDQ	#4,SP
L9E6	LEA	L1232(PC),A5
	BSR	PRINT
	BSR	LC4
	MOVE.B	buffer2(pc),D0
	CMP.B	#'y',D0
	BEQ	L818
	CMP.B	#'Y',D0
	BEQ	L818
	RTS
LA6E	LEA	L1630(PC),A5
	BSR	PRINT
	MOVE.L	LF98(PC),D0
	SUB.L	LF94(PC),D0
	BSR	L11A
	MOVE.L	LF94(PC),D0
	SUB.L	L1B36(PC),D0
	ADD.L	L11C2(PC),D0
	BSR	L11A
	MOVE.L	LF98(PC),D0
	SUB.L	L1B36(PC),D0
	ADD.L	L11C2(PC),D0
	BSR	L11A
	LEA	L1690(PC),A5
	BSR	PRINT
	MOVE.L	L11C6(PC),D0
	SUB.L	L11C2(PC),D0
	BSR	L11A
	MOVE.L	L11C2(PC),D0
	BSR	L11A
	MOVE.L	L11C6(PC),D0
	BSR	L11A
	LEA	L169E(PC),A5
	BSR	PRINT
	MOVE.L	LF98(PC),D0
	SUB.L	LF94(PC),D0
	MOVE.L	L11C6(PC),D1
	SUB.L	L11C2(PC),D1
	EXG	D0,D1
	SUB.L	D1,D0
	BSR	L11A
	LEA	L16D6(PC),A5
	BSR	PRINT
	BSR	LC4
	RTS
LAF4
	MOVE.L	L11C2(PC),A0
	SUB.L	L11C2(PC),A0
	ADD.L	L1B36(PC),A0
	MOVE.L	A0,A2
	LEA	$80(A0),A0
	MOVE.L	L11CC(PC),A1
	MOVE.L	A2,LF94
	MOVEQ	#1,D2
	CLR	D1
LB26	BSR	LB6C
	TST.B	D0
	BEQ.S	LB3A
	ADDQ	#1,D1
	CMP	#$88,D1
	BNE.S	LB3A
	BSR	LC82
LB3A	CMP.L	A0,A1
	BGT.S	LB26
	BSR	LC82
	BSR	LCB0
	MOVE.L	LF94(PC),A0
	MOVE.L	L11CC(PC),A1
	MOVE.L	A1,D2
	SUB.L	A0,D2
	SUB.L	#$80,D2
	MOVE.L	D2,(A2)+
	RTS
LB6C	MOVE.L	A0,A3
	ADD.L	L11DE(PC),A3
	CMP.L	A1,A3
	BLE.S	LB78
	MOVE.L	A1,A3
LB78	MOVEQ	#1,D5
	MOVE.L	A0,A5
	ADDQ	#1,A5
LB7E	MOVE.B	(A0),D3
	MOVE.B	1(A0),D4
LB84	CMP.B	(A5)+,D3
	BNE.S	LB8C
	CMP.B	(A5),D4
	BEQ.S	LB92
LB8C	CMP.L	A5,A3
	BGT.S	LB84
	BRA.S	LC08
LB92	SUBQ	#1,A5
	MOVE.L	A0,A4
	PEA	(A6)
	LEA	$107(A5),A6
	CMP.L	A1,A6
	BLO.S	LBA6
	MOVE.L	A1,A6
LBA6	MOVE.B	(A4)+,D3
	CMP.B	(A5)+,D3
	BNE.S	LBB0
	CMP.L	A5,A6
	BGT.S	LBA6
LBB0	MOVE.L	(A7)+,A6
	MOVE.L	A4,D3
	SUB.L	A0,D3
	SUBQ.L	#1,D3
	CMP.L	D3,D5
	BGE	LC02
	MOVE.L	A5,D4
	SUB.L	A0,D4
	SUB.L	D3,D4
	SUBQ	#1,D4
	CMP.L	#4,D3
	BLE.S	LBDE
	MOVEQ	#6,D6
	CMP.L	#$105,D3
	BLT.S	LBDC
	MOVE	#$104,D3
LBDC	BRA.S	LBE4
LBDE	MOVE	D3,D6
	SUBQ	#2,D6
	ADD	D6,D6
LBE4	LEA	LC5A(PC),A6
	CMP	0(A6,D6.W),D4
	BGE.S	LC02
	MOVE.L	D3,D5
	MOVE.L	D4,LC54
	MOVE.B	D6,LC58
	CMP	#$104,D3
	BGE.S	LC08
LC02	CMP.L	A5,A3
	BGT	LB7E
LC08	CMP.L	#1,D5
	BEQ.S	LC48
	BSR.S	LC82
	MOVE.B	LC58(PC),D6
	MOVE.L	LC54(PC),D3
	MOVE	8(A6,D6.W),D0
	BSR	LCA2
	MOVE	$10(A6,D6.W),D0
	BEQ.S	LC30
	MOVE.L	D5,D3
	SUBQ	#5,D3
	BSR	LCA2
LC30	MOVE	$18(A6,D6.W),D0
	MOVE	$20(A6,D6.W),D3
	BSR	LCA2
	ADD.L	D5,A0
	CLR.B	D0
	RTS
LC48	MOVE.B	(A0)+,D3
	MOVEQ	#8,D0
	BSR	LCA2
	MOVEQ	#1,D0
	RTS
LC54	DC.L	0
LC58	DC.W	0
LC5A	DC.W	$100
	DC.W	$200,$400,$1000
LC62	DC.W	8
LC64	DC.W	9
LC66	DC.W	$A
LC68	DC.W	$C,0
	DC.W	0,0,8,2
	DC.W	3,3,3,1
	DC.W	4,5,6
LC82	TST	D1
	BEQ.S	LC96
	MOVE	D1,D3
	CLR	D1
	CMP	#9,D3
	BGE.S	LC98
	SUBQ	#1,D3
	MOVEQ	#5,D0
	BRA.S	LCA2
LC96	RTS
LC98	SUB	#9,D3
	OR	#$380,D3
	MOVEQ	#$A,D0
LCA2	SUBQ	#1,D0
LCA4	LSR.L	#1,D3
	ADDX.L	D2,D2
	BCS.S	LCB2
	DBF	D0,LCA4
	RTS
LCB0	CLR	D0
LCB2	MOVE.L	D2,(A2)+
	MOVEQ	#1,D2
	DBF	D0,LCA4
	RTS

LF94	DC.L	0
LF98	DC.L	0
L11C2	DC.L	0
L11C6	DC.L	0
L11CA	DC.W	0
L11CC	DC.L	0
L11D0	DC.W	0
L11D2	DC.L	0
L11D6	DC.L	0
L11DA	DC.L	0
L11DE	DC.L	$1000
L1624	DC.L	0
L1B34	DC.W	0
L1B36	DC.L	0
L1B3A	DC.L	0

L104E	DC.B	'0123456789ABCDEF0123456789abcdef'
L106E	DC.B	13,10,'Allocated memory ',0
L1081	DC.B	'-',0
L10AA	DC.B	13,10,0
L11E4	DC.B	13,10,13,10,'Please wait... crunching',13,10,0
L1200	DC.B	$C,13,10,9,9,'SAVE FILE.',13,10,9,9,'----------',13,10,13,10
	DC.B	'JMP (JSR) Address: $',0
L1232	DC.B	13,10,'Save again (y/n)? ',0
L1246	DC.B	13,10,'Filename: ',0
L1252	DC.B	13,10,9
	DC.B	'            TETRAPACK V2.2',13,10,9
	DC.B	'      --------------------------',13,10,9
	DC.B	'         Written By AntiAction',13,10,13,10,9
	DC.B	'          ',$BD,' 1988 By TETRAGON.',13,10,13,10,9
	DC.B	'100% Bugfree, Better than RSI & ByteKiller!!',13,10,13,10,0
L1535	DC.B	13,10,'DO YOU WANT PRO-DECRUNCHER? (Y/N): ',0
L157E	DC.B	13,10,'Locate stack (A7) at: $',0
L1597	DC.B	13,10,'Status Reg. (SR): $',0
L15AC	DC.B	13,10,'Locate decruncher at: $',0
L15C5	DC.B	13,10,'INSUFFICIENT MEMORY FOR WORKSPACE.',0
L15E9	DC.B	'NOT WITHIN RANGE!!!',13,10,0
L15FE	DC.B	'WARNING: FILE ENDED OUTSIDE RANGE!!',13,10,0
L1630	DC.B	13,10,13,10,'              Length    Begin     End',13,10
	DC.B	'------------------------------------------',13,10
	DC.B	'Crunched    ',0
L1690	DC.B	13,10,'Uncrunched  ',0
L169E	DC.B	13,10,'------------------------------------------'
	DC.B	13,10,'Bytes won: ',0
L16D6	DC.B	13,10,13,10,'       Press RETURN to continue',0
L16F8	DC.B	13,10,13,10,'Low-mem:  $',0
L1706	DC.B	13,10,'High-mem: $',0
L1713	DC.B	13,10,'Clearing memory...',0
L1727	DC.B	13,10,'File reading phase, enter all filenames'
	DC.B	13,10,'required, and their loading addresses,'
	DC.B	13,10,'then press RETURN alone to crunch.',0
L179A	DC.B	13,10,13,10,'Filename: ',0
L17D4	DC.B	'Load-address: $',0
L17E4	DC.B	'End-address:',0
L17F4	DC.B	13,10,13,10,'Scan-Width ($0010-$8000): $',0

	DC.B	50
	DC.B	0
buffer1	ds.b	51

	DC.B	48
	DC.B	0
buffer2	ds.b	50

	EVEN
;
; DEBUT DU PREMIER DECOMPACTEUR
;
L188C
	LEA	L19AC(PC),A1
	MOVE.L	L197E(PC),A4
	MOVE.L	A4,A0
L18C0	EQU	*+2
	ADD.L	#0,A0
	CMP.L	A4,A1
	BGT.S	L18D0
	MOVE.L	A1,A0
	ADD.L	L18C0(PC),A0
	BRA.S	L18D6
L18D0	MOVE.B	(A1)+,(A4)+
	CMP.L	A0,A4
	BLO.S	L18D0
L18D8	EQU	*+2
L18D6	LEA	0,A1
	MOVE.L	-(A0),A2
	ADD.L	A1,A2
	MOVE.L	-(A0),D0
L18E2	LSR.L	#1,D0
	BNE.S	L18E8
	BSR.S	L191C
L18E8	BCS.S	L1954
L18EB	EQU	*+1
	MOVEQ	#8,D1
	MOVEQ	#1,D3
	LSR.L	#1,D0
	BNE.S	L18F4
	BSR.S	L191C
L18F4	BCS.S	L1932
	MOVEQ	#3,D1
	MOVEQ	#0,D4
L18FA	BSR.S	L1942
	MOVE	D2,D3
	ADD	D4,D3
L1900	MOVEQ	#7,D1
L1902	LSR.L	#1,D0
	BNE.S	L1908
	BSR.S	L191C
L1908	ADDX.L	D2,D2
	DBF	D1,L1902
	MOVE.B	D2,-(A2)
	DBF	D3,L1900
	BRA.S	L193C
L1916	MOVEQ	#7,D1
	MOVEQ	#8,D4
	BRA.S	L18FA
L191C	MOVE.L	-(A0),D0
	MOVE.B	#$10,CCR
	ROXR.L	#1,D0
	RTS
L192B	EQU	*+1
L192A	MOVEQ	#9,D1
	MOVE	D2,D3
L192E	ADD	D2,D1
	ADDQ	#2,D3
L1932	BSR.S	L1942
L1934	MOVE.B	-1(A2,D2.W),-(A2)
	DBF	D3,L1934
L193C	CMP.L	A2,A1
	BLO.S	L18E2
	BRA.S	L197A
L1942	SUBQ	#1,D1
	MOVEQ	#0,D2
L1946	LSR.L	#1,D0
	BNE.S	L194C
	BSR.S	L191C
L194C	ADDX.L	D2,D2
	DBF	D1,L1946
	RTS
L1954	MOVEQ	#2,D1
	BSR.S	L1942
	CMP.B	#2,D2
	BLT.S	L192A
	CMP.B	#3,D2
	BEQ.S	L1916
	MOVEQ	#8,D1
	BSR.S	L1942
	MOVE	D2,D3
	ADDQ	#4,D3
L196D	EQU	*+1
	MOVEQ	#$C,D1
	BRA.S	L1932
L197B	EQU	*+1
L197A	MOVEQ	#0,D7
L197E	EQU	*+2
	LEA	0,A0
L1984	EQU	*+2
	LEA	0,A2
L1988	MOVE.B	(A1)+,D0
	CMP.B	D7,D0
	BNE.S	L199E
	MOVEQ	#0,D1
	MOVE.B	(A1)+,D1
	BEQ.S	L199E
	MOVE.B	(A1)+,D0
	MOVE.B	D0,(A0)+
L1998	MOVE.B	D0,(A0)+
	DBF	D1,L1998
L199E
	MOVE.B	D0,(A0)+
	CMP.L	A2,A1
	BLO.S	L1988
L19A8	EQU	*+2
	JMP	0
L19AC
;
; FIN DU PREMIER DECOMPACTEUR
;
;
; DEBUT DU DEUXIEME DECOMPACTEUR
;
L19B0
L19FE	EQU	*+2
	LEA	$7FFFE,A7
L1A04	EQU	*+2
	LEA	0,A1
	MOVE.L	A1,A3
	LEA	L1A64(PC),A0
	MOVE	#L1B34-L1A64-1,D0
L1A18	MOVE.B	(A0)+,(A1)+
	DBF	D0,L1A18
L1A20	EQU	*+2
	PEA	0
L1A26	EQU	*+2
	PEA	0.W
	LEA	L1B34(PC),A1
	MOVE.L	L1A68(PC),A4
	MOVE.L	A4,A0
L1A34	EQU	*+2
	ADD.L	#0,A0
	CMP.L	A4,A1
	BGT.S	L1A44
	MOVE.L	A1,A0
	ADD.L	L1A34(PC),A0
	BRA.S	L1A4A
L1A44	MOVE.B	(A1)+,(A4)+
	CMP.L	A0,A4
	BLO.S	L1A44
L1A4C	EQU	*+2
L1A4A	LEA	0,A1
	MOVE.L	-(A0),A2
	ADD.L	A1,A2
	MOVE.L	-(A0),D0
	JMP	L1AA4-L1A64(A3)
L1A65	EQU	*+1
L1A64	MOVEQ	#0,D7
L1A68	EQU	*+2
	LEA	0,A0
L1A6E	EQU	*+2
	LEA	0,A2
L1A72	MOVE.B	(A1)+,D0
	CMP.B	D7,D0
	BNE.S	L1A88
	MOVEQ	#0,D1
	MOVE.B	(A1)+,D1
	BEQ.S	L1A88
	MOVE.B	(A1)+,D0
	MOVE.B	D0,(A0)+
L1A82	MOVE.B	D0,(A0)+
	DBF	D1,L1A82
L1A88
	MOVE.B	D0,(A0)+
	CMP.L	A2,A1
	BLO.S	L1A72
	RTE
L1AA4	LSR.L	#1,D0
	BNE.S	L1AAA
	BSR.S	L1ADE
L1AAA	BCS.S	L1B18
L1AAD	EQU	*+1
	MOVEQ	#8,D1
	MOVEQ	#1,D3
	LSR.L	#1,D0
	BNE.S	L1AB6
	BSR.S	L1ADE
L1AB6	BCS.S	L1AF4
	MOVEQ	#3,D1
	MOVEQ	#0,D4
L1ABC	BSR.S	L1B06
	MOVE	D2,D3
	ADD	D4,D3
L1AC2	MOVEQ	#7,D1
L1AC4	LSR.L	#1,D0
	BNE.S	L1ACA
	BSR.S	L1ADE
L1ACA	ADDX.L	D2,D2
	DBF	D1,L1AC4
	MOVE.B	D2,-(A2)
	DBF	D3,L1AC2
	BRA.S	L1AFE
L1AD8	MOVEQ	#7,D1
	MOVEQ	#8,D4
	BRA.S	L1ABC
L1ADE	MOVE.L	-(A0),D0
	MOVE.B	#$10,CCR
	ROXR.L	#1,D0
	RTS
L1AED	EQU	*+1
L1AEC	MOVEQ	#9,D1
	MOVE	D2,D3
L1AF0	ADD	D2,D1
	ADDQ	#2,D3
L1AF4	BSR.S	L1B06
L1AF6	MOVE.B	-1(A2,D2.W),-(A2)
	DBF	D3,L1AF6
L1AFE	CMP.L	A2,A1
	BLO.S	L1AA4
	BRA	L1A64
L1B06	SUBQ	#1,D1
	MOVEQ	#0,D2
L1B0A	LSR.L	#1,D0
	BNE.S	L1B10
	BSR.S	L1ADE
L1B10	ADDX.L	D2,D2
	DBF	D1,L1B0A
	RTS
L1B18	MOVEQ	#2,D1
	BSR.S	L1B06
	CMP.B	#2,D2
	BLO.S	L1AEC
	CMP.B	#3,D2
	BEQ.S	L1AD8
	MOVEQ	#8,D1
	BSR.S	L1B06
	MOVE	D2,D3
	ADDQ	#4,D3
L1B31	EQU	*+1
	MOVEQ	#$C,D1
	BRA.S	L1AF4
;
; FIN DU DEUXIEME DECOMPACTEUR
;
	SECTION	BSS
freqs	ds.w	256	;comptage des fr‚quences
	DS.L	50
PILE
FINCODE
