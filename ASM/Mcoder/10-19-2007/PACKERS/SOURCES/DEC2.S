;
	OPT	O+
O:	equ	$40000

	LEA	O,A0
	BSR.S	DEPACK
	LEA	O,A0
	MOVE.L	LONGDECR,D0
	MOVE.L	LONGCR,D1
	MOVE.L	A0,A1
	ADD.L	D0,A1
	ILLEGAL

LONGDECR:DC.L	0
LONGCR:	DC.L	0
DEPACK:
	LEA	O,A0
	LEA	$F(A0),A2
	LEA	O+124000,A1
	MOVE.B	-(A2),D7
	ROL	#8,D7
	MOVE.B	-(A2),D7
	SWAP	D7
	MOVE.B	-(A2),D7
	ROL	#8,D7
	MOVE.B	-(A2),D7
	MOVE.L	D7,LONGDECR
	MOVEQ	#0,D0
	MOVE.B	(A0)+,D0
	LEA	1(A0,D0.W),A0
	MOVE.L	A1,A6
	ADD.L	D7,A6

	MOVE.B	-(A2),D0
	ROL	#8,D0
	MOVE.B	-(A2),D0
	SWAP	D0
	MOVE.B	-(A2),D0
	ROL	#8,D0
	MOVE.B	-(A2),D0
	MOVE.L	D0,LONGCR

	BSR	L370
	LEA	BUF,A2
	BSR	L31A
	LEA	BUF200,A2
	BSR	L34C
	MOVEQ	#$20,D0
	MOVE	#$FC3,D1
	LEA	BUF1528,A2
.L68:	MOVE.B	D0,(A2)+
	DBF	D1,.L68
	MOVE	#$FC4,D6
	LEA	BUF8E8,A2
	MOVE.L	A2,USP
	MOVE.L	D7,-(A7)
	MOVE.B	#$80,D7
	LEA	BUF1528,A5
L8E:	MOVE.L	USP,A2
	MOVE	$4E4(A2),D0
	MOVE	#$273,D2
L98:	ADD.B	D7,D7
	BNE.S	LA0
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
LA0:	BCC.S	LAE
	ADD	D0,D0
	MOVE	2(A2,D0.W),D0
	CMP	D2,D0
	BCS.S	L98
	BRA.S	LB8
LAE:	ADD	D0,D0
	MOVE	0(A2,D0.W),D0
	CMP	D2,D0
	BCS.S	L98
LB8:	MOVE	D0,D5
	LEA	BUF400,A2
	CMP	#$8000,$4E4(A2)
	BEQ	L24E
LCA:	LEA	BUFDCE,A2
	ADD	D0,D0
	MOVE	0(A2,D0.W),D0
LD6:	LEA	BUF400,A2
	ADD	D0,D0
	MOVE.L	A2,A3
	ADD	D0,A3
	ADDQ	#1,(A3)
	MOVE	(A3)+,D1
	CMP	(A3)+,D1
	BLS.S	L142
LEC:	CMP	(A3)+,D1
	BHI.S	LEC
	SUBQ.L	#4,A3
	MOVE	(A3),0(A2,D0.W)
	MOVE	D1,(A3)
	SUB.L	A2,A3
	MOVE	A3,D2
	MOVE.L	USP,A2
	LEA	BUFDCE,A3
	MOVE	0(A2,D0.W),D3
	ADD	D3,D3
	LSR	#1,D2
	MOVE	D2,0(A3,D3.W)
	CMP	#$4E6,D3
	BCC.S	L11A
	MOVE	D2,2(A3,D3.W)
L11A:	ADD	D2,D2
	MOVE	0(A2,D2.W),D4
	LSR	#1,D3
	MOVE	D3,0(A2,D2.W)
	LSR	#1,D0
	ADD	D4,D4
	MOVE	D0,0(A3,D4.W)
	CMP	#$4E6,D4
	BCC.S	L138
	MOVE	D0,2(A3,D4.W)
L138:	ADD	D0,D0
	LSR	#1,D4
	MOVE	D4,0(A2,D0.W)
	MOVE	D2,D0
L142:	LEA	BUFDCE,A2
	MOVE	0(A2,D0.W),D0
	BNE.S	LD6
	CMP	#$373,D5
	BGE.S	L16E
	SUB	#$273,D5
	MOVE.B	D5,(A1)+
	MOVE.B	D5,0(A5,D6.W)
	ADDQ	#1,D6
	AND	#$FFF,D6
	CMP.L	A1,A6
	BGT	L8E
	BRA	L214
L16E:	MOVEQ	#0,D4
	ADD.B	D7,D7
	BNE.S	L178
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L178:	ADDX.B	D4,D4
	ADD.B	D7,D7
	BNE.S	L182
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L182:	ADDX.B	D4,D4
	ADD.B	D7,D7
	BNE.S	L18C
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L18C:	ADDX.B	D4,D4
	ADD.B	D7,D7
	BNE.S	L196
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L196:	ADDX.B	D4,D4
	ADD.B	D7,D7
	BNE.S	L1A0
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L1A0:	ADDX.B	D4,D4
	ADD.B	D7,D7
	BNE.S	L1AA
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L1AA:	ADDX.B	D4,D4
	ADD.B	D7,D7
	BNE.S	L1B4
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L1B4:	ADDX.B	D4,D4
	ADD.B	D7,D7
	BNE.S	L1BE
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L1BE:	ADDX.B	D4,D4
	MOVE	D4,D1
	ADD	D1,D1
	LEA	BUF200,A2
	MOVE	0(A2,D1.W),D2
L1CE:	ADD.B	D7,D7
	BNE.S	L1D6
	MOVE.B	(A0)+,D7
	ADDX.B	D7,D7
L1D6:	ADDX	D4,D4
	DBF	D2,L1CE
	AND	#$3F,D4
	LEA	BUF,A2
	OR	0(A2,D1.W),D4
	MOVE	D6,D1
	SUB	D4,D1
	SUBQ	#1,D1
	SUB	#$371,D5
	MOVE	#$FFF,D4
L1F8:	AND	D4,D1
	MOVE.B	0(A5,D1.W),D0
	MOVE.B	D0,(A1)+
	MOVE.B	D0,0(A5,D6.W)
	ADDQ	#1,D6
	AND	D4,D6
	ADDQ	#1,D1
	DBF	D5,L1F8
	CMP.L	A1,A6
	BGT	L8E
L214:	MOVE.L	(A7)+,D7

	LEA	O+124000,A0
	LEA	O,A1
	MOVEQ	#0,D0
L234:	MOVE.L	(A0),(A1)+
	MOVE.L	D0,(A0)+
	MOVE.L	(A0),(A1)+
	MOVE.L	D0,(A0)+
	MOVE.L	(A0),(A1)+
	MOVE.L	D0,(A0)+
	MOVE.L	(A0),(A1)+
	MOVE.L	D0,(A0)+
	SUB.L	#$10,D7
	BGT.S	L234
	RTS
L24E:	MOVEM.L	D5/A5,-(A7)
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVE.L	USP,A2
	LEA	BUF400,A3
L25E:	MOVE	0(A2,D1.W),D3
	CMP	#$273,D3
	BCS.S	L27A
	MOVE	0(A3,D1.W),D4
	ADDQ	#1,D4
	ASR	#1,D4
	MOVE	D4,0(A3,D2.W)
	MOVE	D3,0(A2,D2.W)
	ADDQ	#2,D2
L27A:	ADDQ	#2,D1
	CMP	#$4E6,D1
	BLT.S	L25E
	MOVEQ	#0,D1
	MOVE	#$274,D2
L288:	MOVE	0(A3,D1.W),D3
	ADD	2(A3,D1.W),D3
	MOVE	D3,0(A3,D2.W)
	MOVE	D2,D4
L296:	SUBQ	#2,D4
	CMP	0(A3,D4.W),D3
	BCS.S	L296
	ADDQ	#2,D4
	LEA	0(A3,D4.W),A4
	LEA	2(A4),A5
	MOVE	D2,D5
	SUB	D4,D5
	BEQ.S	L2D2
	MOVE	D5,D0
	ADD	D0,A4
	ADD	D0,A5
	SUBQ	#1,D0
L2B6:	MOVE.B	-(A4),-(A5)
	DBF	D0,L2B6
	LEA	0(A2,D4.W),A4
	LEA	2(A4),A5
	MOVE	D5,D0
	ADD	D0,A4
	ADD	D0,A5
	SUBQ	#1,D0
L2CC:	MOVE.B	-(A4),-(A5)
	DBF	D0,L2CC
L2D2:	MOVE	D3,0(A3,D4.W)
	MOVE	D1,D0
	LSR	#1,D0
	MOVE	D0,0(A2,D4.W)
	ADDQ	#4,D1
	ADDQ	#2,D2
	CMP	#$4E6,D2
	BLT.S	L288
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	LEA	BUFDCE,A3
L2F2:	MOVE	0(A2,D2.W),D3
	ADD	D3,D3
	CMP	#$4E6,D3
	BCC.S	L302
	MOVE	D1,2(A3,D3.W)
L302:	MOVE	D1,0(A3,D3.W)
	ADDQ	#2,D2
	ADDQ	#1,D1
	CMP	#$273,D1
	BLT.S	L2F2
	MOVEM.L	(A7)+,D5/A5
	MOVE	D5,D0
	BRA	LCA
L31A:	LEA	L33E(PC),A3
	MOVEQ	#0,D0
	MOVEQ	#$20,D1
	MOVE	(A3)+,D2
L324:	MOVE	D1,D3
	SUBQ	#1,D3
L328:	MOVE	D0,(A2)+
	DBF	D3,L328
	ADD	#$40,D0
	DBF	D2,L324
	ASR	#1,D1
	MOVE	(A3)+,D2
	BPL.S	L324
	RTS
L33E:	DC.B	0,0,0,2,0,7,0,$B
	DC.B	0,$17,0,$F,$FF,$FF
L34C:	LEA	L362(PC),A3
	MOVEQ	#0,D0
	MOVE	(A3)+,D1
.L354:	MOVE	D0,(A2)+
	DBF	D1,.L354
	ADDQ	#1,D0
	MOVE	(A3)+,D1
	BPL.S	.L354
	RTS
L362:	DC.B	0,$1F,0,$2F,0,$3F,0,$2F
	DC.B	0,$2F,0,$F,$FF,$FF
L370:	MOVEQ	#0,D0
	LEA	BUF400,A2
	LEA	BUF8E8,A3
	LEA	BUFDCE,A4
.L384:	MOVE	#1,(A2)+
	MOVE	D0,D1
	ADD	#$273,D1
	MOVE	D1,(A3)+
	ADD	D1,D1
	MOVE	D0,0(A4,D1.W)
	ADDQ	#1,D0
	CMP	#$13A,D0
	BLT.S	.L384

	MOVEQ	#0,D0
	MOVE	#$13A,D1
	LEA	BUF400,A2
	LEA	BUF8E8,A3
.L3B0:	MOVE	D0,D2
	ADD	D2,D2
	MOVE	0(A2,D2.W),D3
	ADD	2(A2,D2.W),D3
	MOVE	D1,D2
	ADD	D2,D2
	MOVE	D3,0(A2,D2.W)
	MOVE	D0,0(A3,D2.W)
	MOVE	D0,D2
	ADD	D2,D2
	MOVE	D1,0(A4,D2.W)
	MOVE	D1,2(A4,D2.W)
	ADDQ	#2,D0
	ADDQ	#1,D1
	CMP	#$272,D1
	BLE.S	.L3B0
	LEA	BUF400,A2
	MOVE	#$FFFF,$4E6(A2)
	LEA	BUFDCE,A2
	CLR	$4E4(A2)
	RTS
	SECTION	BSS
	LIST
BUF:	DS.B	$200
BUF200:	DS.B	$200
BUF400:	DS.B	$8E8-$400
BUF8E8:	DS.B	$DCE-$8E8
BUFDCE:	DS.B	$1528-$DCE
BUF1528:DS.B	$FC4
