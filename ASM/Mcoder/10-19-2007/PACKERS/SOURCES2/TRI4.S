;
PRINT	MACRO
	PEA	\1
	MOVE	#9,-(SP)	;PRINT
	TRAP	#1
	ADDQ	#6,SP
	ENDM

L0
	LEA	PILE(PC),SP
	PEA	PILE-L0+256
	PEA	L0-256(PC)
	CLR	-(SP)
	MOVE	#$4A,-(SP)
	TRAP	#1
	LEA	12(SP),SP

	PRINT	L492(PC)
L34	PRINT	L51F(PC)
	BSR	L36E
	TST.L	L482
	BEQ.S	L34

	CLR	-(SP)
	PEA	L450(PC)
	MOVE	#$4E,-(SP)	;SEARCH_FIRST
	TRAP	#1
	ADDQ	#8,SP
	TST	D0
	BNE.S	L34

	MOVE	#$2F,-(SP)	;GET_DTA
	TRAP	#1
	ADDQ	#2,SP
	MOVE.L	D0,A0
	MOVE.L	26(A0),L67E	;NB OCTETS DU FICHIER

	CLR	-(SP)
	PEA	L450(PC)
	MOVE	#$3D,-(SP)
	TRAP	#1
	ADDQ	#8,SP
	TST.L	D0
	BMI.S	L34

	MOVE	D0,L486

	MOVE.L	L67E(PC),D0
	ADD.L	#$2710,D0
	MOVE.L	D0,-(SP)
	MOVE	#$48,-(SP)
	TRAP	#1
	ADDQ	#6,SP
	TST.L	D0
	BPL.S	LDC

	MOVE	L486(PC),-(SP)
	MOVE	#$3E,-(SP)	;CLOSE_FILE
	TRAP	#1
	ADDQ	#4,SP

	PRINT	L531(PC)
	BRA	L34
LDC	MOVE.L	D0,L6A6
	ADD.L	#$2710,D0
	MOVE.L	D0,L6A2

	MOVE.L	L6A2(PC),-(SP)
	MOVE.L	L67E(PC),-(SP)
	MOVE	L486(PC),-(SP)
	MOVE	#$3F,-(SP)	;READ_FILE
	TRAP	#1
	LEA	12(SP),SP

	MOVE	L486(PC),-(SP)
	MOVE	#$3E,-(SP)	;CLOSE_FILE
	TRAP	#1
	ADDQ	#4,SP

L10E	PRINT	L54C(PC)
	BSR	L36E
	TST.L	L482
	BEQ.S	L10E
	BSR	L39A
	MOVE.L	L67E(PC),D1
	CMP.L	D1,D0
	BCS.S	L130
	MOVEQ	#0,D0
L130	MOVE.L	D0,L6AA
	BSR	L636
	PRINT	L5A6(PC)
	MOVE.L	L67E,D0
	BSR	L3D0
	PRINT	L5BC(PC)
	MOVE.L	L68E,D0
	BSR	L3D0
L16A	PRINT	L5D0(PC)
	BSR	L36E
	TST.L	L482
	BEQ.S	L16A
	MOVE.B	L450(PC),D0
	CMP.B	#$4E,D0
	BEQ	L314
	CMP.B	#$6E,D0
	BEQ	L314
	CMP.B	#'Y',D0
	BEQ.S	L19E
	CMP.B	#'y',D0
	BNE.S	L16A
L19E	PRINT	L5EA(PC)
	BSR	L36E
	TST.L	L482
	BEQ.S	L19E
	BSR	L39A
	MOVE.L	D0,L696
L1BC	PRINT	L5F5(PC)
	BSR	L36E
	TST.L	L482
	BEQ.S	L1BC
	BSR	L39A
	MOVE.L	D0,L818
L1E4	PRINT	L602(PC)
	BSR	L36E
	TST.L	L482
	BEQ.S	L1E4
	BSR	L39A
	MOVE.L	D0,L6AE
L202	PRINT	L614(PC)
	BSR	L36E
	TST.L	L482
	BEQ.S	L202
	BSR	L39A
	TST.L	D0
	BNE.S	L232
	MOVE.L	#$264A4E71,L6DE
	MOVE	#$4E71,L6E2
	BRA.S	L238
L232	MOVE.L	D0,L6E0
L238	PRINT	L62B(PC)
	BSR	L36E
	TST.L	L482
	BEQ.S	L238
	MOVEQ	#0,D1
	MOVE.L	L68E(PC),D2
L252	MOVE.L	D2,D0
	ADD.L	#$59A,D0
	AND.L	#3,D0
	BEQ.S	L266
	ADDQ.L	#1,D2
	BRA.S	L252
L266	MOVE.L	D2,L48E

	PEA	L450(PC)
	MOVE	#$41,-(SP)	;DELETE_FILE
	TRAP	#1
	ADDQ	#6,SP

	CLR	-(SP)
	PEA	L450(PC)
	MOVE	#$3C,-(SP)	;CREATE FILE
	TRAP	#1
	ADDQ	#8,SP
;
; BUG : TEST D'ERREUR ???
;
	MOVE	D0,L48A

	MOVE.L	LF2A(PC),L692
	MOVE.L	L6AE,L2932

	PEA	L6B2(PC)
	PEA	(L2936-L6B2).W
	MOVE	L48A(PC),-(SP)
	MOVE	#$40,-(SP)	;WRITE_FILE
	TRAP	#1
	LEA	12(SP),SP

	MOVE.L	L6A6(PC),-(SP)		;DEBUT FICHIER COMPRESSE
	MOVE.L	L48E(PC),-(SP)		;LONGUEUR
	MOVE	L48A(PC),-(SP)
	MOVE	#$40,-(SP)		;WRITE_FILE
	TRAP	#1
	LEA	12(SP),SP

	MOVE	L48A(PC),-(SP)
	MOVE	#$3E,-(SP)	;CLOSE_FILE
	TRAP	#1
	ADDQ	#4,SP
L314
	MOVE.L	L6A6(PC),D0
	BEQ.S	L346
	MOVE.L	D0,-(SP)
	MOVE	#$49,-(SP)	;M_FREE
	TRAP	#1
	ADDQ	#6,SP
L346
	CLR	-(SP)
	TRAP	#1

L36E
	PEA	L450-2(PC)	;POINTE SUR LONGUEUR TAMPON
	MOVE	#$A,-(SP)	;READ_LINE
	TRAP	#1
	ADDQ	#6,SP
	LEA	L450(PC),A0
	CLR.B	0(A0,D0.W)
	SWAP	D0
	CLR	D0
	SWAP	D0
	MOVE.L	D0,L482
	PRINT	CR(PC)
	RTS
L39A	LEA	L450(PC),A0
	MOVEQ	#0,D0
	MOVE.L	L482(PC),D2
L3AA	MOVE.B	(A0)+,D1
	AND	#$4F,D1
	CMP.B	#$40,D1
	BCS.S	L3C0
	ADD.B	#9,D1
L3C0	AND.B	#$F,D1
	ASL.L	#4,D0
	OR.B	D1,D0
	SUBQ.L	#1,D2
	BNE.S	L3AA
	RTS
L3D0	MOVEQ	#7,D1
	LEA	L450(PC),A0
L3D6
	ROL.L	#4,D0
	MOVE	D0,D3
	AND	#$F,D3
	ADD.B	#$30,D3
	CMP.B	#$3A,D3
	BLO.S	L3FC
	ADD.B	#$57-$30,D3
L3FC	MOVE.B	D3,(A0)+
	DBF	D1,L3D6
	MOVE.B	#$D,(A0)+
	MOVE.B	#$A,(A0)+
	CLR.B	(A0)+
	PRINT	L450(PC)
	RTS

	DC.B	$28		;LONGUEUR DU TAMPON
	DC.B	0
L450	DS.B	$32
L482	DC.L	0
L486	DC.W	0		;HANDLE FILE LECTURE
L48A	DC.W	0		;HANDLE FILE ECRITURE
L48E	DC.L	0
L492	DC.B	'Tryit v1.01 - release date:21/3/89'
	DC.B	$D,$A,'if you have any questions, ideas for'
	DC.B	$D,$A,'improvement or find any bugs please'
	DC.B	$D,$A,'call 49-511-738470 (Bernd)',$D,$A,$A,0
L51F	DC.B	'program to load: ',0
L531	DC.B	"couldn't allocate memory",$D,$A,0
L54C	DC.B	'offset (0=biggest):$',0
L5A6	DC.B	'original length:  $',0
L5BC	DC.B	'compressed length:$',0
L5D0	DC.B	'wanna save this (y/n)? ',0
L5EA	DC.B	'location:$',0
L5F5	DC.B	'jump in at:$',0
L602	DC.B	'stackpointer at:$',0
L614	DC.B	'locate decruncher at:$',0
L62B	DC.B	'savename: ',0
attente	dc.b	'please wait...',13,10,0
CR	DC.B	13,10,0
	even
L636
;
; coupe interruptions
;
	PRINT	attente(pc)
	LEA	L0(PC),A6
	MOVE.L	L6A2(PC),A0
	MOVE.L	L6A6(PC),A1
	MOVE.L	L67E(PC),D0
	BSR	L908
	MOVE.L	L996(PC),L686-L0(A6)
	BSR	L84C
	BSR	L99E
	MOVE.L	L68A(PC),LF2E-L0(A6)
	MOVE.L	L6A6(PC),A0

	LEA	L2136(PC),A2
	MOVE	#$FF,D0
LC30	CLR.L	(A2)+
	DBF	D0,LC30
	MOVE.L	LF2E(PC),D6
	LEA	LF32(PC),A3
	MOVE.L	A0,A1
LC40
	MOVEQ	#0,D0
	MOVE.B	(A1)+,D0
	MOVE	D0,D2
	ADD	D0,D0
	ADD	D0,D0
	LEA	L2136(PC),A2
	ADD	D0,A2
	MOVE	#$FF,D7
	LEA	LF32(PC),A4
LC6E	CMP.L	(A4)+,A2
	BEQ.S	LC86
	DBF	D7,LC6E
	MOVE	#$FF,D7
	LEA	LF32(PC),A4
LC7E	TST.L	(A4)+
	BNE.S	LC7E
	MOVE.L	A2,-4(A4)
LC86
	ADDQ.L	#1,(A2)+
	MOVE.B	D2,-4(A2)
	TAS.B	-3(A2)
	SUBQ.L	#1,D6
	BNE.S	LC40

	LEA	LF32(PC),A0
	MOVEQ	#0,D0
	MOVE	#$FF,D7
LC92	TST.L	(A0)+
	BEQ.S	LC98
	ADDQ	#1,D0
LC98	DBF	D7,LC92
LCA0
	MOVE	D0,-(SP)
	SUB.L	A4,A4
	BSR	LCF6
	MOVE.L	A5,LD2A-L0(A6)
	MOVE.L	A2,LD2E-L0(A6)
	MOVE.L	D7,LD32-L0(A6)
	MOVE.L	A5,A4
	BSR	LCF6
	MOVE.L	A5,LD36-L0(A6)
	MOVE.L	A2,LD3A-L0(A6)
	MOVE.L	D7,LD3E-L0(A6)

	MOVE.L	L1332(PC),A2
	MOVE.L	A2,A3
	MOVE.L	LD32(PC),D0
	ADD.L	LD3E(PC),D0
	MOVE.L	D0,(A2)+
	MOVE.L	LD2E(PC),D0
	SUB.L	#L1936,D0
	MOVE	D0,(A2)+
	MOVE.L	LD3A(PC),D0
	SUB.L	#L1936,D0
	MOVE	D0,(A2)+
	MOVE.L	A2,L1332-L0(A6)
	MOVE.L	LD2A(PC),A0
	MOVE.L	LD36(PC),A1
	MOVE.L	A3,(A1)
	CLR.L	(A0)
	MOVE	(SP)+,D0
	SUBQ	#1,D0
	CMP	#1,D0
	BNE.S	LCA0

	SUB.L	A5,A5
	MOVEQ	#0,D0
LD78	MOVE.L	D0,-(A7)
	MOVE.L	A5,D5
	BNE.S	LDC0
	LEA	LF32(PC),A0
LDAC	TST.L	(A0)+
	BEQ.S	LDAC
	MOVE.L	-4(A0),A5
	MOVE.L	A5,LF2A-L0(A6)
	SUB.L	#L1936,LF2A-L0(A6)
LDC0	MOVE.L	A5,A0
	MOVE.L	D0,D5
	MOVEQ	#1,D1
	MOVEQ	#0,D2
LDC8	ADD.L	D0,D0
	ADDX.L	D2,D2
	MOVE	D2,D3
	NOT	D3
	AND	#1,D3
	ADD	D3,D3
	ADDQ	#4,D3
	ADD	D3,A0

	MOVE	(A0),D3
	LEA	L1936(PC),A0
	ADD	D3,A0

	MOVE.B	1(A0),D7
	BMI.S	LDF8
	ADDQ.L	#1,D1
	BRA.S	LDC8
LDF8
	MOVEQ	#0,D4
	MOVE.B	(A0),D4
	ADD	D4,D4
	MOVE	D4,D7
	ADD	D4,D4
	ADD	D7,D4
	LEA	L1336(PC),A1
	ADD	D4,A1
	TST.B	(A1)
	BNE.S	LE30
	MOVE.B	D1,(A1)+
	MOVE.B	(A0),(A1)+
	AND.L	#$F,D1
	MOVE.L	D1,D7
	SUBQ	#1,D1
LE24	ADD.L	D5,D5
	ROXR.L	#1,D4
	DBF	D1,LE24
	ROL.L	D7,D4
	MOVE.L	D4,(A1)+
LE30
	MOVE.L	(A7)+,D0
	ADD.L	#$10000,D0
	CMP.L	#$FFFF0000,D0
	BNE	LD78
	MOVE.L	L6A2(PC),A5
	ADD.L	L67E(PC),A5
	MOVE.L	A5,-(A7)
	MOVEQ	#-$80,D5
	MOVE.L	L6A6(PC),A0
	MOVE.L	LF2E(PC),D0
	ADD.L	D0,A0
LE4A	MOVEQ	#0,D1
	MOVE.B	-(A0),D1
	ADD	D1,D1
	MOVE	D1,D2
	ADD	D1,D1
	ADD	D2,D1
	LEA	L1336(PC),A1
	ADD	D1,A1
	MOVEQ	#0,D6
	MOVE.B	(A1),D6
	MOVE.L	2(A1),D7
	SUBQ	#1,D6
LEBC	LSR.L	#1,D7
	ROXR.B	#1,D5
	BCS.S	LEC8
	DBF	D6,LEBC
	BRA.S	LEC2
LEC8	MOVE.B	D5,-(A5)
	MOVEQ	#-$80,D5
	DBRA	D6,LEBC
LEC2
	SUBQ.L	#1,D0
	BNE.S	LE4A

	CMP.B	#$80,D5
	BEQ.S	LE80
LE78	LSR.B	#1,D5
	BCC.S	LE78
	MOVE.B	D5,-(A5)
LE80	MOVE.L	A5,D7
	MOVE.L	A5,D5
	MOVE.L	(A7)+,A5
	MOVE.L	A5,D2
LE88	MOVE.L	D2,A5
	SUB.L	D5,A5
	MOVE.L	A5,D1
	BTST	#0,D1
	BEQ.S	LE9E
	MOVE.L	D7,A5
	CLR.B	-(A5)
	MOVE.L	A5,D7
	MOVE.L	A5,D5
	BRA.S	LE88
LE9E	MOVE.L	A5,L68E-L0(A6)
	MOVE.L	A5,D5
	MOVE.L	D7,A5
	MOVE.L	L6A6(PC),A1
LEAA	MOVE.B	(A5)+,(A1)+
	SUBQ.L	#1,D5
	BNE.S	LEAA
	CLR.B	(A1)+
	CLR.B	(A1)+
	CLR.B	(A1)+
	CLR.B	(A1)+

	LEA	L2536(PC),A0
	LEA	L1936(PC),A1
	MOVE	#$FF,D0
LEE2	MOVEQ	#0,D1
	MOVE	4(A1),D1
	BEQ.S	LEFE
	CMP	#$800,D1
	BCS.S	LEFE
	SUB	#$800,D1
	LSR	#2,D1
	ADD	#$400,D1
	MOVE	D1,(A0)+
	BRA.S	LF02
LEFE	LSR	#1,D1
	MOVE	D1,(A0)+
LF02	MOVEQ	#0,D1
	MOVE	6(A1),D1
	BEQ.S	LF1E
	CMP	#$800,D1
	BCS.S	LF1E
	SUB	#$800,D1
	LSR	#2,D1
	ADD	#$400,D1
	MOVE	D1,(A0)+
	BRA.S	LF22
LF1E	LSR	#1,D1
	MOVE	D1,(A0)+
LF22	ADDQ.L	#8,A1
	DBF	D0,LEE2
;
; r‚autorise interruptions
;
	RTS

L6A2	DC.L	0
L6A6	DC.L	0
L6AA	DC.L	$80
L6AE	DC.L	0
;
; DEBUT DU CODE DU DECOMPACTEUR
;
L6B2
	LEA	L2936(PC),A1
	MOVE.L	-4(A1),D7
	LEA	L6F2(PC),A2
L6E0	EQU	*+2
L6E2	EQU	*+4
L6DE	LEA	0,A3
	MOVE.L	A3,A4
	MOVE	#$579,D0
L6EA	MOVE.B	(A2)+,(A3)+
	DBF	D0,L6EA
	JMP	(A4)
L6F2
	MOVE.L	L696(PC),A2
	CMP.L	A2,A1
	BLE.S	L70E
	MOVE.L	A2,A0
	MOVE.L	L68E(PC),D1
L706	MOVE.B	(A1)+,(A0)+
	SUBQ.L	#1,D1
	BNE.S	L706
	MOVE.L	A2,A1
L70E	MOVE.L	L692(PC),D0
	MOVE.L	L68A(PC),D3
	ADD.L	D3,A2
	LEA	L2536(PC),A0
	TST.L	D7
	BEQ.S	L722
	MOVE.L	D7,A7
L722	ADD.L	L68E(PC),A1
	MOVE.L	A0,A4
	MOVEQ	#$1F,D7
	MOVE.L	-(A1),D5
	MOVE.L	-(A1),D4
	LSR.L	#1,D0
	ADD.L	D0,A0
L732	MOVE.L	A0,A3
L734	MOVEQ	#1,D0
	MOVEQ	#0,D6
L738	LSR.L	#1,D5
	ADDX.L	D6,D6
	SUBQ	#1,D7
	BMI.S	L746
L740	SUBQ	#1,D0
	BNE.S	L738
	BRA.S	L74E
L746	MOVEQ	#$1F,D7
	MOVE.L	D4,D5
	MOVE.L	-(A1),D4
	BRA.S	L740
L74E	EOR.B	#1,D6
	ADD.L	D6,D6
	ADD.L	D6,A3
	MOVEQ	#0,D6
	MOVE	(A3),D6
	CMP	#$400,D6
	BCC.S	L766
	LEA	0(A4,D6.L),A3
	BRA.S	L734
L766	MOVE.B	D6,-(A2)
	SUBQ.L	#1,D3
	BNE.S	L732
	MOVE.L	L696(PC),A1
	MOVE.L	L682(PC),D0
	LEA	0(A1,D0.L),A0
	MOVE.L	A1,A2
	ADD.L	L68A(PC),A2
L784	MOVEQ	#0,D0
	MOVE.B	-(A2),D0
	CMP.B	L6A0(PC),D0
	BNE.S	L79E
	MOVE.B	-(A2),D1
	BEQ.S	L7EA
	MOVE.B	-(A2),D0
	MOVE.B	D0,-(A0)
	MOVE.B	D1,-(A0)
	MOVE.B	D0,-(A0)
	MOVE.B	D1,-(A0)
	BRA.S	L7EC
L79E	CMP.B	L69F(PC),D0
	BNE.S	L7A8
	MOVEQ	#2,D4
	BRA.S	L7B0
L7A8	CMP.B	L6A1(PC),D0
	BNE.S	L7B8
	MOVEQ	#3,D4
L7B0	MOVEQ	#0,D1
	MOVE.B	-(A2),D1
	BEQ.S	L7EA
	BRA.S	L7DE
L7B8	CMP.B	L69E(PC),D0
	BNE.S	L7C8
	MOVEQ	#3,D4
	MOVEQ	#0,D1
	MOVE.B	-(A2),D1
	BEQ.S	L7EA
	BRA.S	L7D8
L7C8	CMP.B	L689(PC),D0
	BNE.S	L7EA
	MOVEQ	#0,D4
	MOVE.B	-(A2),D4
	BEQ.S	L7EA
	MOVEQ	#0,D1
	MOVE.B	-(A2),D1
L7D8	ROL	#8,D1
	MOVE.B	-(A2),D1
	ROL	#8,D1
L7DE	LEA	0(A0,D1.L),A3
L7E2	MOVE.B	-(A3),-(A0)
	DBF	D4,L7E2
	BRA.S	L7EC
L7EA	MOVE.B	D0,-(A0)
L7EC	CMP.L	A2,A1
	BLT.S	L784
	MOVE.L	L696(PC),A0
	MOVE.L	A0,A1
	ADD.L	L67E(PC),A0
	ADD.L	L682(PC),A1
	MOVE.B	-(A1),D1
L7FE	CMP.B	L686(PC),D1
	BEQ.S	L81C
	CMP.B	L687(PC),D1
	BEQ.S	L81C
	MOVE.B	D1,D2
	MOVE.B	-(A1),D1
	MOVE.B	D2,-(A0)
L810	CMP.L	L696(PC),A0
	BGT.S	L7FE
L818	EQU	*+2
	JMP	0
L81C	MOVE.B	D1,D2
	MOVEQ	#0,D4
	MOVE.B	-(A1),D4
	CMP.B	#3,D4
	BCC.S	L82E
	MOVE.B	D2,D3
	MOVE.B	-(A1),D1
	BRA.S	L840
L82E	CMP.B	L687(PC),D2
	BNE.S	L83C
	MOVE.B	-(A1),D1
	MOVE.B	L688(PC),D3
	BRA.S	L840
L83C	MOVE.B	-(A1),D3
	MOVE.B	-(A1),D1
L840	MOVE.B	D3,-(A0)
	DBF	D4,L840
	BRA.S	L810
L67E	DC.L	0	;NB OCTETS APRES DECOMPRESSION
L682	DC.L	0
L686	DC.B	0
L687	DC.B	0
L688	DC.B	0
L689	DC.B	0
L68A	DC.L	0
L68E	DC.L	0
L692	DC.L	0
L696	DC.L	0
L69E	DC.B	0
L69F	DC.B	0
L6A0	DC.B	0
L6A1	DC.B	0
L2536	DS.B	$400-4
L2932	DS.L	1
L2936
;
; FIN DU DECOMPACTEUR
;
L84C	MOVE.L	A1,L682-L0(A6)
	MOVE.L	A0,-(A7)
	LEA	0(A0,D0.L),A2
L856	MOVE.B	(A0)+,D1
	CMP.L	A2,A0
	BCC	L8D8
	CMP.B	(A0),D1
	BEQ.S	L87A
	CMP.B	L996-L0(A6),D1
	BNE.S	L870
L868	CLR.B	(A1)+
	MOVE.B	D1,(A1)+
	BRA.S	L856
L870	CMP.B	L997-L0(A6),D1
	BEQ.S	L868
L876	MOVE.B	D1,(A1)+
	BRA.S	L856
L87A	MOVEQ	#2,D2
	MOVE.L	A0,A3
	ADDQ.L	#1,A3
	BRA.S	L886
L882	CMP.B	(A3)+,D1
	BNE.S	L88E
L886	CMP.L	A2,A3
	BCC.S	L88E
	ADDQ.B	#1,D2
	BNE.S	L882
L88E	TST.B	D2
	BNE.S	L89C
	LEA	$FF(A0),A0
	SUBQ.B	#1,D2
	BRA.S	L8BC
L89C	CMP.B	#5,D2
	BCC.S	L8B8
	CMP.B	L996-L0(A6),D1
	BEQ.S	L8AE
	CMP.B	L997-L0(A6),D1
	BNE.S	L876
L8AE	SUBQ.B	#2,D2
	ADD.L	D2,A0
	MOVE.B	D2,(A1)+
	MOVE.B	D1,(A1)+
	BRA.S	L856
L8B8	SUBQ.B	#2,D2
	ADD.L	D2,A0
L8BC	CMP.B	L998-L0(A6),D1
	BEQ.S	L8CE
	MOVE.B	D1,(A1)+
	MOVE.B	D2,(A1)+
	MOVE.B	L996-L0(A6),(A1)+
	BRA	L856
L8CE	MOVE.B	D2,(A1)+
	MOVE.B	L997(PC),(A1)+
	BRA	L856
L8D8	MOVE.B	D1,(A1)+
	CMP.B	L996(PC),D1
	BEQ.S	L8E6
	CMP.B	L997(PC),D1
	BNE.S	L8EA
L8E6	CLR.B	(A1)+
L8EA	MOVE.L	(A7)+,A0
	MOVE.L	L682(PC),A2
	SUB.L	A2,A1
	CMP.L	#0,A1
	BPL.S	L900
	SUB.L	A3,A3
	SUB.L	A1,A3
	MOVE.L	A3,A1
L900	MOVE.L	A1,L682-L0(A6)
	MOVE.L	A2,A1
	RTS
L908	MOVEM.L	D0/A0,-(A7)
	MOVE.L	A0,A2
	MOVE.L	D0,D2
	LEA	L2136(PC),A4
	MOVE.L	A4,A5
	MOVE	#$FF,D7
L91A	CLR.L	(A5)+
	DBF	D7,L91A
L920	MOVEQ	#0,D1
	MOVE.B	(A2)+,D1
	ADD	D1,D1
	ADD	D1,D1
	ADDQ.L	#1,0(A4,D1.L)
	SUBQ.L	#1,D2
	BNE.S	L920
	MOVEQ	#0,D0
	MOVEQ	#0,D1
L934	CMP.L	(A4)+,D1
	BEQ.S	L93A
	BCC.S	L942
L93A	MOVE.L	-4(A4),D1
	MOVE.B	D0,L998-L0(A6)
L942	ADDQ.B	#1,D0
	BNE.S	L934
	BSR	L974
	MOVE.B	D0,L996-L0(A6)
	BSR	L974
	MOVE.B	D0,L997-L0(A6)
	BSR	L974
	MOVE.B	D0,L99A-L0(A6)
	BSR	L974
	MOVE.B	D0,L99C-L0(A6)
	BSR	L974
	MOVE.B	D0,L99B-L0(A6)
	MOVEM.L	(A7)+,D0/A0
	RTS
L974	LEA	L2136(PC),A4
	MOVEQ	#0,D0
	MOVEQ	#-1,D1
L97C	CMP.L	(A4)+,D1
	BCS.S	L988
	MOVE.L	A4,A3
	SUBQ.L	#4,A3
	MOVE.L	(A3),D1
	MOVE.B	D0,D2
L988	ADDQ.B	#1,D0
	BNE.S	L97C
	MOVE.L	#$FFFFFFFF,(A3)
	MOVE.B	D2,D0
	RTS
L996	DC.B	0
L997	DC.B	0
L998	DC.B	0
	DC.B	0
L99A	DC.B	0
L99B	DC.B	0
L99C	DC.B	0
	DC.B	0
L99E	MOVEM.L	A0-A1,-(A7)
	MOVE.L	L682(PC),D0
	LEA	0(A0,D0.L),A2
	LEA	0(A1,D0.L),A3
L9AE	MOVE.B	-(A3),-(A2)
	SUBQ.L	#1,D0
	BNE.S	L9AE
	MOVE.L	L682(PC),D0
	BSR	L908
	MOVE.B	L99A(PC),D4
	MOVE.B	L996(PC),L99A-L0(A6)
	MOVE.B	L997(PC),L996-L0(A6)
	MOVE.B	D4,L997-L0(A6)
	MOVE.L	L6AA(PC),D4
	BMI.S	L9D8
	BNE.S	L9F2
L9D8	CMP.L	#$10000,L682-L0(A6)
	BLE.S	L9EC
	MOVE.L	#$10000,L6AA-L0(A6)
	BRA.S	L9F2
L9EC	MOVE.L	L682(PC),L6AA-L0(A6)
L9F2	MOVE.L	L6AA(PC),D4
	CMP.L	#4,D4
	BCC.S	LA06
	MOVE.L	#4,L6AA-L0(A6)
LA06	MOVE.L	L6AA(PC),D4
	CMP.L	L682(PC),D4
	BLE.S	LA16
	MOVE.L	L682(PC),L6AA-L0(A6)
LA16	MOVE.L	A0,A5
	ADD.L	L682(PC),A5
LA1C	CLR.L	LBFA-L0(A6)
	CLR.L	LBF6-L0(A6)
	CLR.L	LBFE-L0(A6)
	CLR	LC02-L0(A6)
	MOVE.B	(A0)+,D0
	CMP.L	A5,A0
	BCC	LBB4
	MOVE.L	A0,D4
	ADD.L	L6AA(PC),D4
	CMP.L	A5,D4
	BCS.S	LA40
	MOVE.L	A5,D4
LA40	MOVE.L	A0,A2
	ADDQ.L	#4,A2
	CMP.L	A5,A2
	BCC.S	LAB2
LA48	MOVE.B	(A2)+,D1
	CMP.L	D4,A2
	BCC.S	LAB2
	CMP.B	D1,D0
	BNE.S	LA48
	MOVE.L	A0,A3
	MOVE.L	A2,A4
	MOVEQ	#0,D2
LA58	MOVE.B	(A3)+,D3
	CMP.B	(A4)+,D3
	BNE.S	LA74
	CMP.L	D4,A4
	BCC.S	LA74
	ADDQ.B	#1,D2
	CMP.B	#$FF,D2
	BNE.S	LA58
	MOVE.L	D2,LBF6-L0(A6)
	MOVE.L	A2,LBFA-L0(A6)
	BRA.S	LAB2
LA74	TST.L	LBF6-L0(A6)
	BNE.S	LA98
	CMP	#2,D2
	BNE.S	LA98
	MOVE.L	A2,D5
	SUB.L	A0,D5
	TST.B	D5
	BEQ.S	LA48
	AND.L	#$FF00,D5
	BNE.S	LA48
	MOVE.L	A2,LBFE-L0(A6)
	BRA.S	LA48
LA98	CMP	#3,D2
	BLT.S	LA48
	CMP.L	LBF6(PC),D2
	BLE.S	LA48
	CLR.L	LBFE-L0(A6)
	MOVE.L	D2,LBF6-L0(A6)
	MOVE.L	A2,LBFA-L0(A6)
	BRA.S	LA48
LAB2	MOVE.L	LBFE(PC),D2
	BEQ.S	LACE
	SUB.L	A0,D2
	MOVE.B	D2,(A1)+
	MOVEQ	#2,D2
	MOVE.B	L99A(PC),(A1)+
	BRA	LB4E
LACE	TST.L	LBF6-L0(A6)
	BEQ	LB58
	MOVE.L	LBF6(PC),D2
	MOVE.L	LBFA(PC),A2
	MOVE.L	D2,-(A7)
	MOVE.L	A2,D2
	SUB.L	A0,D2
	CMP.L	#3,(A7)
	BNE.S	LB00
	TST.B	D2
	BEQ.S	LB04
	MOVE.L	D2,D1
	AND.L	#$FF00,D1
	BNE.S	LB08
	MOVE	#$FFFF,LC02-L0(A6)
LB00	TST.B	D2
	BNE.S	LB08
LB04	MOVE.L	(A7)+,D2
	BRA.S	LB58
LB08	TST	LC02-L0(A6)
	BNE.S	LB14
	ROL	#8,D2
	MOVE.B	D2,(A1)+
	ROL	#8,D2
LB14	MOVE.B	D2,(A1)+
	MOVE.L	(A7)+,D2
	CMP	#3,D2
	BNE.S	LB40
	TST	LC02-L0(A6)
	BEQ.S	LB32
	MOVE.B	L99C(PC),(A1)+
	BRA.S	LB4E
LB32	MOVE.B	L997(PC),(A1)+
	BRA.S	LB4E
LB40	MOVE.B	D2,(A1)+
	MOVE.B	L996(PC),(A1)+
LB4E	ADD.L	D2,A0
	CMP.L	A5,A0
	BCS	LA1C
	BCC.S	LBB6
LB58	TST.B	D0
	BEQ.S	LB86
	MOVE.L	A0,A3
	ADDQ.L	#1,A3
	CMP.L	A5,A3
	BCC.S	LB86
	CMP.B	(A3)+,D0
	BNE.S	LB86
	CMP.L	A5,A3
	BCC.S	LB86
	MOVE.B	(A0),D2
	CMP.B	(A3),D2
	BNE.S	LB86
	MOVE.B	D2,(A1)+
	MOVE.B	D0,(A1)+
	MOVE.B	L99B(PC),(A1)+
	MOVEQ	#3,D2
	BRA.S	LB4E
LB86	CMP.B	L99C(PC),D0
	BEQ.S	LBA4
	CMP.B	L99B(PC),D0
	BEQ.S	LBA4
	CMP.B	L996(PC),D0
	BEQ.S	LBA4
	CMP.B	L997(PC),D0
	BEQ.S	LBA4
	CMP.B	L99A(PC),D0
	BNE.S	LBA8
LBA4	CLR.B	(A1)+
LBA8	MOVE.B	D0,(A1)+
	BRA	LA1C
LBB4	MOVE.B	D0,(A1)+
LBB6	MOVE.B	L996(PC),L689-L0(A6)
	MOVE.B	L997(PC),L69E-L0(A6)
	MOVE.B	L99A(PC),L69F-L0(A6)
	MOVE.B	L99B(PC),L6A0-L0(A6)
	MOVE.B	L99C(PC),L6A1-L0(A6)
	MOVE.L	A1,L68A-L0(A6)
	MOVEM.L	(A7)+,A0-A1
	MOVE.L	L68A(PC),A2
	SUB.L	A1,A2
	CMP.L	#0,A2
	BPL.S	LBF0
	SUB.L	A3,A3
	SUB.L	A2,A3
	MOVE.L	A3,A2
LBF0	MOVE.L	A2,L68A-L0(A6)
	RTS
LBF6	DC.L	0
LBFA	DC.L	0
LBFE	DC.L	0
LC02	DC.W	0

LCF6	LEA	LF32(PC),A0
	MOVEQ	#-1,D7
	MOVE	#$FF,D0
LD00	CMP.L	A0,A4
	BEQ.S	LD20
	MOVE.L	(A0),D1
	BEQ.S	LD20
	MOVE.L	D1,A1
	MOVE.L	(A1),D1
	AND.L	#$7FFFFF,D1
	CMP.L	D1,D7
	BCS.S	LD20
	MOVE.L	D1,D7
	MOVE.L	A1,A2
	MOVE.L	A0,A5
LD20	ADDQ.L	#4,A0
	DBF	D0,LD00
	RTS
LD2A	DC.L	0
LD2E	DC.L	0
LD32	DC.L	0
LD36	DC.L	0
LD3A	DC.L	0
LD3E	DC.L	0
LF2A	DC.L	0
LF2E	DC.L	0
L1332	DC.L	L1936

	SECTION	BSS
LF32	DS.B	$400
L1336	DS.B	$600
L1936	DS.B	$800
L2136	DS.B	$400
	DS.L	100
PILE
