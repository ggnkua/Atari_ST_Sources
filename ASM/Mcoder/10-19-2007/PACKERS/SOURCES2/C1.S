;
; COMPACTEUR D'IMAGE DU STOS BASIC
;
	BRA	COMP
	BRA	DECOMP
COMP
	MOVE.L	A1,L1FCA4
	MOVE.L	#$6071963,0(A1)
	MOVE	D7,4(A1)
	MOVE	D2,6(A1)
	MOVE	D3,8(A1)
	MOVE	D4,$A(A1)
	MOVE	D5,$C(A1)
	MOVE	D1,$10(A1)
	MOVE	D6,$12(A1)
	MOVEQ	#$F,D0
	LEA	$7D00(A0),A2
	LEA	$26(A1),A3
L1FF96	MOVE	(A2)+,(A3)+
	DBF	D0,L1FF96
	MOVE.L	A0,A4
	LEA	$46(A1),A5
	LEA	$7D00(A5),A6
	PEA	(A6)
	SUBQ	#1,D5
	MOVE	D5,L1FCAC
	MOVE	D1,D5
	MOVE	4(A1),D0
	LSL	#3,D0
	LEA	L1FCB0(PC),A0
	MOVE	0(A0,D0.W),D7
	MOVE	2(A0,D0.W),D6
	MOVE	4(A0,D0.W),D0
	MOVE	D0,L1FCA8
	MOVE	D7,D0
	MULU	D5,D0
	MOVE	D0,L1FCAE
	SUBQ	#1,D5
	SUBQ	#1,D4
	MOVE	D4,A0
	MOVE	8(A1),D0
	MULU	D7,D0
	ADD	D0,A4
	MOVE	6(A1),D0
	MULU	D6,D0
	ADD	D0,A4
	MOVEQ	#7,D1
	CLR.B	(A5)
	CLR.B	(A6)
L1FFF6	MOVE.L	A4,A3
	MOVE	L1FCAC(PC),D4
L1FFFE	MOVE.L	A3,A2
	MOVE	A0,D3
L20002	MOVE.L	A2,A1
	MOVE	D5,D2
L20006	MOVE.B	(A1),D0
	CMP.B	(A5),D0
	BEQ.S	L20012
	ADDQ.L	#1,A5
	MOVE.B	D0,(A5)
	BSET	D1,(A6)
L20012	DBF	D1,L2001C
	MOVEQ	#7,D1
	ADDQ.L	#1,A6
	CLR.B	(A6)
L2001C	ADD	D7,A1
	DBF	D2,L20006
	MOVE.L	A2,A1
	MOVE	D5,D2
	MOVE.L	A2,A1
L20028	MOVE.B	1(A1),D0
	CMP.B	(A5),D0
	BEQ.S	L20036
	ADDQ.L	#1,A5
	MOVE.B	D0,(A5)
	BSET	D1,(A6)
L20036	DBF	D1,L20040
	MOVEQ	#7,D1
	ADDQ.L	#1,A6
	CLR.B	(A6)
L20040	ADD	D7,A1
	DBF	D2,L20028
	ADD	D6,A2
	DBF	D3,L20002
	ADD	L1FCAE(PC),A3
	DBF	D4,L1FFFE
	ADDQ.L	#2,A4
	SUBQ	#1,L1FCA8
	BNE.S	L1FFF6
	MOVE.L	L1FCA4(PC),A1
	ADDQ.L	#1,A5
	MOVE.L	A5,D0
	SUB.L	A1,D0
	MOVE.L	D0,$14(A1)
	MOVE.L	(A7)+,A4
	LEA	-1(A4),A3
	PEA	(A3)
	MOVEQ	#7,D1
	CLR.B	(A5)
	CLR.B	(A3)
L20080	MOVE.B	(A4)+,D0
	CMP.B	(A5),D0
	BEQ.S	L2008C
	ADDQ.L	#1,A5
	MOVE.B	D0,(A5)
	BSET	D1,(A3)
L2008C	DBF	D1,L20096
	MOVEQ	#7,D1
	ADDQ.L	#1,A3
	CLR.B	(A3)
L20096	CMP.L	A6,A4
	BLS.S	L20080
	ADDQ.L	#1,A5
	MOVE.L	A5,D0
	SUB.L	A1,D0
	MOVE.L	D0,$18(A1)
	MOVE.L	(A7)+,A4
L200A6	MOVE.B	(A4)+,(A5)+
	CMP.L	A3,A4
	BLS.S	L200A6
	MOVE.L	A5,D0
	SUB.L	A1,D0
	ADDQ.L	#1,D0
	RTS
DECOMP
	CMP.L	#$6071963,0(A0)
	BNE	L20246
	PEA	(A0)
	PEA	(A1)
	TST	D3
	BPL.S	L200CC
	MOVE	$12(A0),D3
L200CC	MOVE	D3,-(A7)
L200EA	SUBQ.L	#6,A7
	MOVE.L	A1,A4
	LEA	L1FCB0(PC),A2
	MOVE	4(A0),D0
	LSL	#3,D0
	MOVE	0(A2,D0.W),D7
	MOVE	2(A2,D0.W),D6
	MOVE	4(A2,D0.W),D5
	MOVE	6(A2,D0.W),D4
	MOVE	D5,L1FCA8
	TST	D1
	BPL.S	L20118
	MOVE	6(A0),D1
L20118	TST	D2
	BPL.S	L20120
	MOVE	8(A0),D2
L20120	MULU	D6,D1
	ADD	D1,A1
	MOVE	$A(A0),D0
	MULU	D6,D0
	ADD	D0,D1
	CMP	D7,D1
	BHI	L20242
	MOVE	$C(A0),D0
	MULU	$10(A0),D0
	ADD	D2,D0
	CMP	D4,D0
	BHI	L20242
	MULU	D7,D2
	ADD	D2,A1
	MOVE.L	A1,A3
	MOVE	$10(A0),D0
	MULU	D7,D0
	MOVE	D0,2(A7)
	MOVE	D6,(A7)
	MOVE	$10(A0),D6
	MOVE	$A(A0),D0
	SUBQ	#1,D0
	MOVE	D0,L1FCAA
	MOVE	$C(A0),D0
	MOVE	D0,L1FCAC
	LEA	$46(A0),A4
	MOVE.L	A0,A5
	MOVE.L	A0,A6
	ADD.L	$14(A0),A5
	ADD.L	$18(A0),A6
	MOVEQ	#7,D0
	MOVEQ	#7,D1
	MOVE.B	(A5)+,D2
	MOVE.B	(A4)+,D3
	BTST	D1,(A6)
	BEQ.S	L2018C
	MOVE.B	(A5)+,D2
L2018C	SUBQ	#1,D1
L2018E	MOVE.L	A3,A2
	MOVE	L1FCAC(PC),4(A7)
L20198	MOVE.L	A2,A1
	MOVE	L1FCAA(PC),D5
L201A0	MOVE.L	A1,A0
	MOVE	D6,D4
L201A4	SUBQ	#1,D4
	BMI.S	L201C8
	BTST	D0,D2
	BEQ.S	L201AE
	MOVE.B	(A4)+,D3
L201AE	MOVE.B	D3,(A0)
	ADD	D7,A0
	DBF	D0,L201A4
	MOVEQ	#7,D0
	BTST	D1,(A6)
	BEQ.S	L201BE
	MOVE.B	(A5)+,D2
L201BE	DBF	D1,L201A4
	MOVEQ	#7,D1
	ADDQ.L	#1,A6
	BRA.S	L201A4
L201C8	MOVE.L	A1,A0
	MOVE	D6,D4
L201CC	SUBQ	#1,D4
	BMI.S	L201F2
	BTST	D0,D2
	BEQ.S	L201D6
	MOVE.B	(A4)+,D3
L201D6	MOVE.B	D3,1(A0)
	ADD	D7,A0
	DBF	D0,L201CC
	MOVEQ	#7,D0
	BTST	D1,(A6)
	BEQ.S	L201E8
	MOVE.B	(A5)+,D2
L201E8	DBF	D1,L201CC
	MOVEQ	#7,D1
	ADDQ.L	#1,A6
	BRA.S	L201CC
L201F2	ADD	(A7),A1
	DBF	D5,L201A0
	ADD	2(A7),A2
	SUBQ	#1,4(A7)
	BNE	L20198
	ADDQ.L	#2,A3
	SUBQ	#1,L1FCA8
	BNE	L2018E
	ADDQ.L	#6,A7
	MOVE	(A7)+,D1
	MOVE.L	(A7)+,A1
	MOVE.L	(A7)+,A0
	LEA	$26(A0),A0
	LEA	$7D00(A1),A1
	MOVE.L	A1,A2
	MOVEQ	#$F,D0
L20228	MOVE	(A0)+,(A1)+
	DBF	D0,L20228
L2023E	MOVEQ	#0,D0
	RTS
L20242	LEA	$10(A7),A7
L20246	MOVEQ	#-1,D0
	RTS
L1FCA4	DS.L	1
L1FCA8	DS.W	1
L1FCAA	DS.W	1
L1FCAC	DS.W	1
L1FCAE	DS.W	1
L1FCB0
	DC.W	$A0,8,4,$C8
	DC.W	$A0,4,2,$C8
	DC.W	$50,2,1,$190
