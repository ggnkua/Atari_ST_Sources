	OPT	O+
DEBUT		EQU	$50000
LONGUEUR	EQU	$80000-$50000

	LEA	DEBUT,A6
	MOVE.L	#LONGUEUR,D6
	BSR	L114
	MOVE.L	D0,-(A7)
	MOVE.L	#DEBUT,D0
	BSR	L14A6

	LEA	L1F089(PC),A0
	BSR	L12E
	LEA	L20476(PC),A0
	BSR	L12E
	MOVE.L	(A7),D0
	BSR	L14A6
	LEA	L1F09E(PC),A0
	BSR	L12E
	LEA	L20476(PC),A0
	BSR	L12E
	MOVE.L	(A7)+,D0

	BSR	L1454
	LEA	LC4(PC),A0
	BSR	L12E
	MOVE	#2,-(A7)
	MOVE	#2,-(A7)
	TRAP	#13
	ADDQ	#4,A7
	MOVE	#$4C,-(A7)
	TRAP	#1
L114	BSR	LD78
	BSR	LDDA
	BSR	LE3E
	BSR	L1384
	BSR	L12FA
	BSR	L13EC
	RTS
L12E	MOVEM.L	D0-D7/A0-A6,-(A7)
	MOVE.L	A0,-(A7)
	DC.W	$A00A
	MOVE	#9,-(A7)
	TRAP	#1
	ADDQ	#6,A7
	DC.W	$A000
	MOVE.L	4(A0),A1
	CLR.L	2(A1)
	MOVE	#1,6(A1)
	MOVE.L	8(A0),A1
	CLR	(A1)
	DC.W	$A009
	MOVEM.L	(A7)+,D0-D7/A0-A6
	RTS
LD78	LEA	LD5C(PC),A0
	BSR	L12E
	LEA	L15C(PC),A0
	MOVEQ	#0,D0
LD86	MOVE	D0,(A0)
	CLR.L	2(A0)
	CLR	8(A0)
	CLR	$A(A0)
	MOVE	#$FFFF,6(A0)
	LEA	$C(A0),A0
	ADDQ.B	#1,D0
	BNE.S	LD86
	LEA	(A6),A0
	MOVE.L	D6,D7
	LEA	L15C(PC),A1
LDAA	MOVEQ	#0,D0
	MOVE.B	(A0)+,D0
	MULU	#$C,D0
	ADDQ.L	#1,2(A1,D0.W)
	SUBQ.L	#1,D7
	BNE.S	LDAA
	RTS
LDDA	LEA	LDBE(PC),A0
	BSR	L12E
	LEA	LDBC(PC),A1
LDE6	CLR.B	(A1)
	LEA	L15C(PC),A0
	MOVE	#$FE,D7
LDF0	MOVE.L	2(A0),D0
	MOVE.L	$E(A0),D1
	CMP.L	D0,D1
	BGE.S	LE10
	MOVE.L	D0,$E(A0)
	MOVE.L	D1,2(A0)
	MOVE	(A0),D0
	MOVE	$C(A0),(A0)
	MOVE	D0,$C(A0)
	ST	(A1)
LE10	LEA	$C(A0),A0
	DBF	D7,LDF0
	TST.B	(A1)
	BNE.S	LDE6
	RTS
LE3E	LEA	LE1E(PC),A0
	BSR	L12E
	LEA	LD5C(PC),A5
LE4A	BSR	LE8E
	MOVE.L	A1,D0
	BNE.S	LE54
	RTS
LE54	MOVE.L	A0,A2
	MOVEQ	#0,D0
	BSR	LE72
	MOVE.L	A1,A2
	MOVEQ	#-1,D0
	BSR	LE72
	MOVE.L	2(A1),D0
	ADD.L	D0,2(A0)
	CLR	6(A1)
	BRA.S	LE4A
LE72	MOVE	D0,D1
	ROXR	#1,D1
	ROXR	$A(A2)
	ADDQ	#1,8(A2)
	LEA	$C(A2),A2
	CMP.L	A5,A2
	BEQ.S	LE8C
	TST	6(A2)
	BEQ.S	LE72
LE8C	RTS
LE8E	MOVEQ	#-1,D7
	LEA	L15C-$C(PC),A1
	BSR	LEC6
	MOVE.L	A1,A0
	BSR	LEC6
	MOVE.L	A1,D0
	BNE.S	LEA4
	RTS
LEA4	MOVE.L	2(A0),D0
	ADD.L	2(A1),D0
	CMP.L	D7,D0
	BCC.S	LEB6
	MOVE.L	A0,A2
	MOVE.L	A1,A3
	MOVE.L	D0,D7
LEB6	MOVE.L	A1,A0
	BSR	LEC6
	MOVE.L	A1,D0
	BNE.S	LEA4
	MOVE.L	A2,A0
	MOVE.L	A3,A1
	RTS
LEC6	LEA	$C(A1),A1
	CMP.L	A5,A1
	BNE.S	LED2
	SUB.L	A1,A1
	RTS
LED2	TST	6(A1)
	BEQ.S	LEC6
	RTS
L12FA	LEA	LEDA(PC),A0
	BSR	L12E
	LEA	LEFA(PC),A5
	CLR.L	(A5)+
	MOVE	#$FF,D7
	LEA	L15C(PC),A4
L1310	MOVE	$A(A4),D0
	MOVE	8(A4),D1
	LEA	LEFA(PC),A0
L131C	CMP	#1,D1
	BEQ.S	L1340
	ADD	D0,D0
	BCC.S	L1328
	ADDQ	#2,A0
L1328	TST	(A0)
	BEQ.S	L1332
	ADD	(A0),A0
	SUBQ	#1,D1
	BRA.S	L131C
L1332	MOVE.L	A5,D2
	SUB.L	A0,D2
	MOVE	D2,(A0)
	MOVE.L	A5,A0
	ADDQ	#4,A5
	SUBQ	#1,D1
	BRA.S	L131C
L1340	ADD	D0,D0
	BCC.S	L1346
	ADDQ	#2,A0
L1346	MOVE	(A4),D0
	OR	#$FF00,D0
	MOVE	D0,(A0)
	LEA	$C(A4),A4
	DBF	D7,L1310
	LEA	LEFA(PC),A0
	SUB.L	A0,A5
	LEA	L12F6(PC),A0
	MOVE.L	A5,(A0)
	RTS
L1384	LEA	L1364(PC),A0
	BSR	L12E
	LEA	LDBC(PC),A1
L1390	CLR	(A1)
	LEA	L15C(PC),A0
	MOVE	#$FE,D7
L139A	MOVE	(A0),D0
	MOVE	$C(A0),D1
	CMP	D0,D1
	BGE.S	L13C8
	MOVE	D1,(A0)
	MOVE	D0,$C(A0)
	MOVE	$A(A0),D0
	MOVE	$16(A0),$A(A0)
	MOVE	D0,$16(A0)
	MOVE	8(A0),D0
	MOVE	$14(A0),8(A0)
	MOVE	D0,$14(A0)
	ST	(A1)
L13C8	LEA	$C(A0),A0
	DBF	D7,L139A
	TST.B	(A1)
	BNE.S	L1390
	RTS
L13EC	MOVEM.L	D6/A6,-(A7)
	LEA	L13D6(PC),A0
	BSR	L12E
	LEA	L15C(PC),A0
	LEA	$80000,A5
	MOVEQ	#7,D5
L1404	MOVEQ	#0,D0
	MOVE.B	(A6)+,D0
	MULU	#$C,D0
	MOVE	8(A0,D0.W),D1
	MOVE	$A(A0,D0.W),D0
L1414	BCLR	D5,(A5)
	ADD	D0,D0
	BCC.S	L141C
	BSET	D5,(A5)
L141C	SUBQ.B	#1,D5
	BPL.S	L1424
	MOVEQ	#7,D5
	ADDQ	#1,A5
L1424	SUBQ	#1,D1
	BNE.S	L1414
	SUBQ.L	#1,D6
	BNE.S	L1404
	MOVE.L	A5,D0
	LEA	$80000,A5
	SUB.L	A5,D0
	MOVEM.L	(A7)+,D6/A6
	RTS
L1454	LEA	L143C(PC),A0
	BSR	L12E
	LEA	$80000,A0
	LEA	$F8000,A2
	LEA	$7D00(A2),A3
	MOVEQ	#$F,D0
	MOVE	(A0)+,D1
L1470	LEA	LEFA(PC),A1
L1474	ADD	D1,D1
	BCC.S	L147A
	ADDQ	#2,A1
L147A	SUBQ	#1,D0
	BPL.S	L1482
	MOVEQ	#$F,D0
	MOVE	(A0)+,D1
L1482	MOVE	(A1),D2
	BMI.S	L148A
	ADD	D2,A1
	BRA.S	L1474
L148A	ADDQ	#1,(A2)+
	CMP.L	A3,A2
	BNE.S	L1496
	LEA	$F8000,A2
L1496	CMP.B	(A6)+,D2
	BNE.S	L14A0
	SUBQ.L	#1,D6
	BNE.S	L1470
	RTS
L14A0	MOVE	D0,1
L14A6	LEA	L20476+8(PC),A0
	LEA	L20466(PC),A1
	MOVEQ	#7,D7
L14B4	MOVE.B	D0,D1
	AND	#$F,D1
	MOVE.B	0(A1,D1.W),-(A0)
	LSR.L	#4,D0
	DBF	D7,L14B4
	RTS
L20466	DC.B	'0123456789ABCDEF'
L20476	DC.B	'        '
LC4	DC.B	$D,$A,$A,'It seems to work......press a key',0
L1F089	DC.B	$D,$A,$A,'Start location   ',0
L1F09E	DC.B	$D,$A,$A,'Length           ',0
LD5C	DC.B	$1B,'ECounting byte frequencies',0
LDBE	DC.B	$D,$A,'Sorting byte frequencies',0
LE1E	DC.B	$D,$A,'Generating code for each byte',0
LEDA	DC.B	$D,$A,'Generating the decoding tree',0
L1364	DC.B	$D,$A,'Sorting back into value order',0
L13D6	DC.B	$D,$A,'Crunching the data',0
L143C	DC.B	$D,$A,$A,'Verifying the crunch',0
	even
LDBC	DC.W	0
L12F6	DC.L	$3FC
	section	bss
L15C
	DS.B	$C00
L1FE9A
LEFA
	DS.B	$400-4
;
; ICI L12F6 ???
;
