LOAD=$40000
SAVE=$50000
FREQ=$65
;
; 1ERE PASSE : SCANNING DES SAMPLES UTILISES
;               +ON MET LA FREQUENCE APRES $EC
;
	LEA	LOAD,A0
	LEA	SAVE,A1
	MOVE	#20000,D0
MOV:	MOVE	(A0)+,(A1)+
	DBRA	D0,MOV

	LEA	SAVE,A6

	MOVE.L	4(A6),D0
	MOVE.L	A6,A0
	ADD	(A6,D0.W),A0

	MOVE.L	A6,A1
	ADD.L	8(A6),A1

	LEA	TABLE,A2
	MOVE.L	A2,A3

LOOP1:
	CMP.L	A1,A0
	BHS.S	FIN1

	CMP.B	#$EC,(A0)+
	BNE.S	LOOP1

	MOVEP	0(A0),D0
	MOVE.B	1(A0),D0

	MOVE.L	A2,A4
	MOVEQ	#-1,D1
SEARCH:
	ADDQ	#1,D1
	CMP.L	A3,A4
	BEQ.S	INS
	CMP	(A4)+,D0
	BNE.S	SEARCH
	MOVE.B	D1,(A0)+
	MOVE.B	#FREQ,(A0)+
	BRA.S	LOOP1
INS:	MOVE	D0,(A3)+
	MOVE.B	D1,(A0)+
	MOVE.B	#FREQ,(A0)+
	BRA.S	LOOP1
FIN1:
;
; ICI :
;	A2=(TABLE)
;	A3=FIN (TABLE)
;
	LEA	PTRSAMPLES,A4
	LEA	LOAD,A0
	MOVE	$3E(A0),D0
	ADD.L	28(A0),A0
GENPTR:
	LEA	LOAD,A1
	ADD	(A0)+,A1
	MOVE.L	A1,(A4)+
	SUBQ	#1,D0
	BNE.S	GENPTR

	MOVE.L	A3,D7
	SUB.L	A2,D7
	LSR	#1,D7		;D7=NOMBRE DE SAMPLES A GENERER
;
; A0=POINTEURS SUR DIGIT
;
	MOVE.L	28(A6),A0
	ADD.L	A6,A0
	MOVE.L	A0,A5
	ADD	D7,A5
	ADD	D7,A5
LOOP:
	CMP.L	A3,A2
	BHS.S	BUG

	CLR	D0
	MOVE.B	(A2)+,D0
	ADD	D0,D0
	ADD	D0,D0
	LEA	PTRSAMPLES,A1
	MOVE.L	(A1,D0.W),A1

	MOVE.B	(A2)+,D0
	MOVE.L	#$10000*FREQ/$3E,D6
	CMP.B	#$C8,D0
	BEQ.S	GOODFR
	MOVE.L	#$1428A*FREQ/$3E,D6
	CMP.B	#$CC,D0
	BEQ.S	GOODFR
	MOVE.L	#$28514*FREQ/$3E,D6
	CMP.B	#$D8,D0
	BEQ.S	GOODFR
	BRA	BUG
GOODFR:
	MOVE	A5,D0
	SUB	A6,D0
	MOVE	D0,(A0)+

	MOVE.L	A1,A4
FINDIG:	TST.B	(A4)+
	BPL.S	FINDIG

	MOVE.B	-1(A4),D5

	MOVE.L	A4,D1
	SUB.L	A1,D1

	MOVEQ	#0,D0
GEN:
	SWAP	D0
	ADD.L	D6,D0
	SWAP	D0
	CMP	D1,D0
	BHS.S	FIND

	MOVE.B	(A1,D0.W),(A5)+
	BPL.S	GEN
	BRA.S	SKIP
FIND:	MOVE.B	D5,(A5)+
SKIP:
	SUBQ	#1,D7
	BNE.S	LOOP
	MOVE.L	A6,A0
	MOVE.L	A5,A1
	MOVEQ	#0,D0
	ILLEGAL
BUG:	MOVEQ	#-1,D0
	ILLEGAL
TABLE:	BLK.B	100,0
PTRSAMPLES:BLK.L	100,0
