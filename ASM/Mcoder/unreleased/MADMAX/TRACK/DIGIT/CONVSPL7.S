LOAD=$40000
SAVE=$50000
FREQ=$3E
FRQSRC=FREQ
FRQDST=$3E
;
; 1ERE PASSE : SCANNING DES SAMPLES UTILISES
;               +ON MET LA FREQUENCE APRES $EC
;
	LEA	LOAD,A0
	LEA	SAVE,A1
	MOVE	#20000,D0
MOV:	MOVE	(A0)+,(A1)+
	DBRA	D0,MOV

	LEA	SAVE,A6

	MOVE.L	4(A6),D0
	MOVE.L	A6,A0
	ADD	(A6,D0.W),A0

	MOVE.L	A6,A1
	ADD.L	8(A6),A1

	LEA	TABLE,A2
	MOVE.L	A2,A3

LOOP1:
	CMP.L	A1,A0
	BHS.S	FIN1

	CMP.B	#$EC,(A0)+
	BNE.S	LOOP1

	MOVEP	0(A0),D0
	MOVE.B	1(A0),D0

	MOVE.L	A2,A4
	MOVEQ	#-1,D1
SEARCH:
	ADDQ	#1,D1
	CMP.L	A3,A4
	BEQ.S	INS
	CMP	(A4)+,D0
	BNE.S	SEARCH
	MOVE.B	D1,(A0)+
	MOVE.B	#FREQ,(A0)+
	BRA.S	LOOP1
INS:	MOVE	D0,(A3)+
	MOVE.B	D1,(A0)+
	MOVE.B	#FREQ,(A0)+
	BRA.S	LOOP1
FIN1:
;
; ICI :
;	A2=(TABLE)
;	A3=FIN (TABLE)
;
	LEA	PTRSAMPLES,A4
	LEA	LOAD,A0
	MOVE	$3E(A0),D0
	ADD.L	28(A0),A0
GENPTR:
	LEA	LOAD,A1
	ADD	(A0)+,A1
	MOVE.L	A1,(A4)+
	SUBQ	#1,D0
	BNE.S	GENPTR

	MOVE.L	A3,D7
	SUB.L	A2,D7
	LSR	#1,D7		;D7=NOMBRE DE SAMPLES A GENERER
;
; A0=POINTEURS SUR DIGIT
;
	MOVE.L	28(A6),A0
	ADD.L	A6,A0
	MOVE.L	A0,A5
	ADD	D7,A5
	ADD	D7,A5
LOOP:
	CMP.L	A3,A2
	BHS.S	BUG

	CLR	D0
	MOVE.B	(A2)+,D0
	ADD	D0,D0
	ADD	D0,D0
	LEA	PTRSAMPLES,A1
	MOVE.L	(A1,D0.W),A1

	CLR	D0
	MOVE.B	(A2)+,D0
	BPL.S	GOODFR

	BRA	BUG
GOODFR:
	LEA	CONVTBL(PC),A4
	ADD	D0,D0
	ADD	D0,D0
	MOVE.L	(A4,D0.W),D6

	MOVE	A5,D0
	SUB	A6,D0
	MOVE	D0,(A0)+

	MOVE.L	A1,A4
FINDIG:	TST.B	(A4)+
	BPL.S	FINDIG

	MOVE.B	-1(A4),D5

	MOVE.L	A4,D1
	SUB.L	A1,D1

	MOVEQ	#0,D0
GEN:
	SWAP	D0
	ADD.L	D6,D0
	SWAP	D0
	CMP	D1,D0
	BHS.S	FIND

	MOVE.B	(A1,D0.W),(A5)+
	BPL.S	GEN
	BRA.S	SKIP
FIND:	MOVE.B	D5,(A5)+
SKIP:
	SUBQ	#1,D7
	BNE.S	LOOP
	MOVE.L	A6,A0
	MOVE.L	A5,A1
	MOVEQ	#0,D0
	ILLEGAL
BUG:	MOVEQ	#-1,D0
	ILLEGAL
CONVTBL:
	DC.L	$400*FRQSRC/FRQDST,$43C*FRQSRC/FRQDST
	DC.L	$47D*FRQSRC/FRQDST,$4C1*FRQSRC/FRQDST
	DC.L	$50A*FRQSRC/FRQDST,$556*FRQSRC/FRQDST
	DC.L	$5A8*FRQSRC/FRQDST,$5FE*FRQSRC/FRQDST
	DC.L	$659*FRQSRC/FRQDST,$6BA*FRQSRC/FRQDST
	DC.L	$720*FRQSRC/FRQDST,$78D*FRQSRC/FRQDST
	DC.L	$800*FRQSRC/FRQDST,$879*FRQSRC/FRQDST
	DC.L	$8FA*FRQSRC/FRQDST,$983*FRQSRC/FRQDST
	DC.L	$A14*FRQSRC/FRQDST,$AAD*FRQSRC/FRQDST
	DC.L	$B50*FRQSRC/FRQDST,$BFC*FRQSRC/FRQDST
	DC.L	$CB2*FRQSRC/FRQDST,$D74*FRQSRC/FRQDST
	DC.L	$E41*FRQSRC/FRQDST,$F1A*FRQSRC/FRQDST
	DC.L	$1000*FRQSRC/FRQDST,$10F3*FRQSRC/FRQDST
	DC.L	$11F5*FRQSRC/FRQDST,$1306*FRQSRC/FRQDST
	DC.L	$1428*FRQSRC/FRQDST,$155B*FRQSRC/FRQDST
	DC.L	$16A0*FRQSRC/FRQDST,$17F9*FRQSRC/FRQDST
	DC.L	$1965*FRQSRC/FRQDST,$1AE8*FRQSRC/FRQDST
	DC.L	$1C82*FRQSRC/FRQDST,$1E34*FRQSRC/FRQDST
	DC.L	$2000*FRQSRC/FRQDST,$21E7*FRQSRC/FRQDST
	DC.L	$23EB*FRQSRC/FRQDST,$260D*FRQSRC/FRQDST
	DC.L	$2851*FRQSRC/FRQDST,$2AB7*FRQSRC/FRQDST
	DC.L	$2D41*FRQSRC/FRQDST,$2FF2*FRQSRC/FRQDST
	DC.L	$32CB*FRQSRC/FRQDST,$35D1*FRQSRC/FRQDST
	DC.L	$3904*FRQSRC/FRQDST,$3C68*FRQSRC/FRQDST
	DC.L	$4000*FRQSRC/FRQDST,$43CE*FRQSRC/FRQDST
	DC.L	$47D6*FRQSRC/FRQDST,$4C1B*FRQSRC/FRQDST
	DC.L	$50A2*FRQSRC/FRQDST,$556E*FRQSRC/FRQDST
	DC.L	$5A82*FRQSRC/FRQDST,$5FE4*FRQSRC/FRQDST
	DC.L	$6597*FRQSRC/FRQDST,$6BA2*FRQSRC/FRQDST
	DC.L	$7208*FRQSRC/FRQDST,$78D0*FRQSRC/FRQDST
	DC.L	$8000*FRQSRC/FRQDST,$879C*FRQSRC/FRQDST
	DC.L	$8FAC*FRQSRC/FRQDST,$9837*FRQSRC/FRQDST
	DC.L	$A145*FRQSRC/FRQDST,$AADC*FRQSRC/FRQDST
	DC.L	$B504*FRQSRC/FRQDST,$BFC8*FRQSRC/FRQDST
	DC.L	$CB2F*FRQSRC/FRQDST,$D744*FRQSRC/FRQDST
	DC.L	$E411*FRQSRC/FRQDST,$F1A1*FRQSRC/FRQDST
	DC.L	$10000*FRQSRC/FRQDST,$10F38*FRQSRC/FRQDST
	DC.L	$11F59*FRQSRC/FRQDST,$1306F*FRQSRC/FRQDST
	DC.L	$1428A*FRQSRC/FRQDST,$155B8*FRQSRC/FRQDST
	DC.L	$16A09*FRQSRC/FRQDST,$17F91*FRQSRC/FRQDST
	DC.L	$1965F*FRQSRC/FRQDST,$1AE89*FRQSRC/FRQDST
	DC.L	$1C823*FRQSRC/FRQDST,$1E343*FRQSRC/FRQDST
	DC.L	$20000*FRQSRC/FRQDST,$21E71*FRQSRC/FRQDST
	DC.L	$23EB3*FRQSRC/FRQDST,$260DF*FRQSRC/FRQDST
	DC.L	$28514*FRQSRC/FRQDST,$2AB70*FRQSRC/FRQDST
	DC.L	$2D413*FRQSRC/FRQDST,$2FF22*FRQSRC/FRQDST
	DC.L	$32CBF*FRQSRC/FRQDST,$35D13*FRQSRC/FRQDST
	DC.L	$39047*FRQSRC/FRQDST,$3C686*FRQSRC/FRQDST

TABLE:	BLK.B	100,0
PTRSAMPLES:BLK.L	100,0
