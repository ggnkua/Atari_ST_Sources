LOAD=$40000
FREQ=$65
;
; 1ERE PASSE : SCANNING DES SAMPLES UTILISES
;               +ON MET LA FREQUENCE APRES $EC
;
	LEA	LOAD,A6

	MOVE.L	4(A6),D0
	MOVE.L	A6,A0
	ADD	(A6,D0.W),A0

	MOVE.L	A6,A1
	ADD.L	8(A6),A1

	LEA	TABLE,A2
	MOVE.L	A2,A3

LOOP1:
	CMP.L	A1,A0
	BHS.S	FIN1

	CMP.B	#$EC,(A0)+
	BNE.S	LOOP1

;	CLR	D0
;	MOVE.B	(A0)+,D0

;	MOVE.B	#FREQ,(A0)+
	MOVEP	0(A0),D0
	MOVE.B	1(A0),D0
	ADDQ	#2,A0

	MOVE.L	A2,A4
SEARCH:
	CMP.L	A3,A2
	BEQ.S	INS
	CMP	(A4)+,D0
	BNE.S	SEARCH
	BRA.S	LOOP1
INS:	MOVE	D0,(A3)+
	BRA.S	LOOP1
FIN1:
;
; A0=POINTEURS SUR DIGIT
;
	MOVE.L	28(A6),A0
	ADD.L	A6,A0
	MOVE	$3E(A6),D7
	MOVE.L	A0,A5
	ADD	D7,A5
	ADD	D7,A5
LOOP:
	MOVE.L	A6,A1
	ADD	(A0),A1

	MOVE	A5,D0
	SUB	A6,D0
	MOVE	D0,(A0)+

	MOVE.L	A1,A2
FINDIG:	TST.B	(A2)+
	BPL.S	FINDIG

	MOVE.B	-1(A2),D5

	MOVE.L	A2,D1
	SUB.L	A1,D1

	MOVEQ	#0,D0
GEN:
	SWAP	D0
	ADD.L	#$00028514*FREQ/$3E,D0
	SWAP	D0
	CMP	D1,D0
	BHS.S	FIND

	MOVE.B	(A1,D0.W),(A5)+
	BPL.S	GEN
	BRA.S	SKIP
FIND:	MOVE.B	D5,(A5)+
SKIP:
	SUBQ	#1,D7
	BNE.S	LOOP

	MOVE.L	A6,A0
	MOVE.L	A5,A1
	ILLEGAL
TABLE:	BLK.B	100,0
