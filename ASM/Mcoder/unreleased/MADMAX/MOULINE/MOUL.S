SOURCE=$80000
DEST=$90000

	LEA	DEST,A6
	MOVE	#$2F,-(SP)
	TRAP	#1
	ADDQ	#2,SP
	MOVE.L	D0,A5

	CLR	-(SP)
	PEA	FILES(PC)
	MOVE	#$4E,-(SP)
	TRAP	#1
	ADDQ	#8,SP
	TST	D0
	BNE	ERR
LOADING:
	LEA	30(A5),A0
	LEA	FILE(PC),A1
TRANS:	MOVE.B	(A0)+,(A1)+
	BNE.S	TRANS

	PEA	FILE(PC)
	MOVE	#9,-(SP)
	TRAP	#1
	ADDQ	#6,SP
	PEA	CR(PC)
	MOVE	#9,-(SP)
	TRAP	#1
	ADDQ	#6,SP

	CLR	-(SP)
	PEA	FILE(PC)
	MOVE	#$3D,-(SP)
	TRAP	#1
	ADDQ	#8,SP
	MOVE	D0,D7
	BMI	ERR

	PEA	SOURCE
	PEA	30000.W
	MOVE	D7,-(SP)
	MOVE	#$3F,-(SP)
	TRAP	#1
	LEA	12(SP),SP
	TST.L	D0
	BMI	ERR

	MOVE	D7,-(SP)
	MOVE	#$3E,-(SP)
	TRAP	#1
	ADDQ	#4,SP

	CMP.L	#'COSO',SOURCE
	BNE	ERR
	CMP.L	#'TFMX',SOURCE+32
	BNE	ERR
	CMP.L	#64,SOURCE+4
	BNE	ERR

	LEA	SOURCE+64,A3
	LEA	SOURCE,A4
	ADD	(A3),A4
	MOVE.L	A4,A1
BCL:
	LEA	SOURCE,A0
	ADD	(A3)+,A0
	CMP.L	A1,A0
	BEQ	NOERR
	SUBQ	#1,CPT
	BEQ.S	ERR
NOERR:
	BSR	TAKEINS
	CMP.L	A4,A3
	BLO.S	BCL

	MOVE	#$4F,-(SP)
	TRAP	#1
	ADDQ	#2,SP
	TST.L	D0
	BEQ	LOADING

	MOVEQ	#0,D0
	ILLEGAL
ERR:
;	MOVEQ	#-1,D0
	ILLEGAL
CPT:	DC.W	13

TAKEINS:
BC:
	MOVE.B	(A0)+,D0
	MOVE.B	D0,(A6)+
	CMP.B	#$E1,D0
	BEQ.S	FINI
	CMP.B	#$E0,D0
	BNE.S	BC
	MOVE.B	(A0)+,(A6)+
FINI:
	MOVE.L	A0,A1
	RTS
FILES:	DC.B	'*.MUS',0
CR:	DC.B	13,10,0
FILE:
