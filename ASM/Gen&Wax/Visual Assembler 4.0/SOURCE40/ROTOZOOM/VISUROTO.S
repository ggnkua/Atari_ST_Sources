	TEXT
ROTO_INIT
	MOVE.W	D0,SCREENX
	MOVE.W	D1,SCREENY
	MOVE.L	A0,MY_BUF
	MOVEQ	#0,D0
	MOVE.L	D0,D1
	MOVE.L	D0,D2
	MOVE.L	D0,D3
	MOVE.L	D0,D4
	MOVE.L	D0,D5
	MOVE.L	D0,D6
	MOVE.L	D0,D7
	
	MOVE.W	#0,Y
	LEA	TAB_ZOOM,A5
	LEA	FIN_TAB_ZOOM,A4
	
	MOVEM.L	D0-D7/A0-A6,PARAM
	RTS
	
ROTOZOOM
	MOVEM.L	PARAM,D0-D7/A0-A6
	MOVE.L	(A5)+,INCX	* .L -> INCX & INCY  
	CMP.L	A4,A5
	BNE.S	NOT_FIN_TABLE
	LEA	TAB_ZOOM,A5	
NOT_FIN_TABLE
	MOVE.L	MY_BUF,A1
	LEA	MAP_IMG+128*512,A0
	
	MOVE.W	INCX,D6
	MOVE.W	SCREENX,D1
	MULS.W	D6,D1
	
	MOVE.W	D1,POSX	* POSX= (SCREENX/2)*INCX
	
	MOVE.W	INCY,D7
	MOVE.W	SCREENY,D1
	MULS.W	D7,D1
	NEG.W	D1
	
	MOVE.W	D1,POSY	* POSY= -(SCREENY/2)*INCY

	ADD.W	D7,D7
	ADD.W	D6,D6
	
	MOVE.W	SCREENY,D5
	SUBQ	#1,D5
	MOVE.W	#0,A6
	

MAP_LOOP
	MOVE.W	SCREENX,D0
	SUBQ	#1,D0
	MOVE.L	INCX,D1	* D1=[INCX|INCY]
	MOVE.L	POSX,D2	* D2=[POSX|POSY]
	ADD.L	D1,D1
		
X_LOOP	
	ADD.L	D1,D2

	MOVE.L	D2,D3
	ROL.L	#8,D3
	MOVE.W	D2,D4
	MOVE.B	D3,D4

	MOVE.W	(A0,D4.W*2),(A1)+

	DBRA	D0,X_LOOP
	
	ADD.W	D7,POSX
	SUB.W	D6,POSY
	ADDQ.W	#1,A6
	DBRA	D5,MAP_LOOP

	MOVEM.L	D0-D7/A0-A6,PARAM
	RTS
	
	DATA

MAP_IMG	
	INCBIN	MAP.BIN
TAB_ZOOM	INCBIN	TAB_ZOOM.BIN
FIN_TAB_ZOOM	DC.L	0	

	BSS
MY_BUF	DS.L	1	
PARAM	DS.L	32
POSX	DS.W	1
POSY	DS.W	1
Y	DS.W	1
INCX	DS.W	1
INCY	DS.W	1
SCREENX	DS.W	1
SCREENY	DS.W	1
	TEXT
