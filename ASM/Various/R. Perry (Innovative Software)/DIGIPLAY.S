*
* (C)1987 INNOVATED SOFTWARE
* THE FAST BASIC PROGRAM DUMP OF FSTPLAY.BIN
*
* THIS PROGRAM CAN BE USED QUITE EFFECTIVELY IN YOUR BASIC PROGRAMS
* OR ASSEMBLY, 'C' LANGAUGES ETC.
* THE CODE CAN BE PLACED ANYWHERE IN MEMORY AS IT IS NOT 'POSITION'
* DEPENDENT.
*
* IF YOU USE ANY PART OF THIS PROGRAM IN YOUR OWN PROGRAM THEN PLEASE
* ACKNOWLEDGE INNOVATED SOFTWARE SOME WHERE IN THE TITLE PAGE.
*
* REVISION 1.0					BY R.PERRY.
*

* IMPORTANT SET-UP REGISTERS:

*	A4 = START ADDRESS OF BUFFER
*	D6 = LENGTH OF BUFFER
* 	D5 = LOOP DELAY NUMBER FOR REPLAY SPEED

DIGIOUT		MOVEM.L D0-D4/A0-A6,-(SP)	* SAVE SOME REGISTERS
		ADD.L A4,D6			* FIND DATA END ADDRS
		LEA TTP(PC),A0
		MOVE.W D5,2(A0)			* SET DELAY LOOP VALUE
		CLR.L -(SP)
		MOVE.W #$20,-(SP)		* DO SOME SUPERVISOR
		TRAP #1				* STUFF MAN!
		ADDQ.L #6,SP
		LEA STATUS(PC),A0
		MOVE.W SR,(A0)			* SAVE SR REGISTER
		LEA STACKST(PC),A0
		MOVE.L D0,(A0)			* SAVE OLD STACK VALUE
		MOVE.W SR,D3
		MOVE.W #$2700,SR		* KILL 'ALL' INTERUPTS
		MOVEQ #10,D0
SETREGS		MOVE.B D0,$FFF8800		* CLEAR AND SET
		CLR.B $FFF8802			* SOUND AND FREQ.
		DBF D0,SETREGS
		CLR.B $FFF8800
		CLR.B $FFF8802			* NOT FORGETING REG. 0
		MOVE.B #7,$FFF8800		* REG. 7 OF SND CHIP
		MOVE.B #$F8,$FFF8802		* ALL CHANELS ON
		LEA CHANEL_A(PC),A3		* SET TABLES A,B,C
		LEA CHANEL_B(PC),A2
		LEA CHANEL_C(PC),A1
		MOVE.W D3,SR
		ANDI.W #$F8FF,SR
		ORI.W #$500,SR			* DO NOT DISTURB SOUND
		AND.W #$FD,$484

MUSICLP		MOVE.B $FFFC02,D0		* LOOK AT KEYBOARD
		CMP.B #$39,D0			* SPACE BAR HIT?
		BEQ EXIT_TWO			* YEA HAA...

		MOVE.B (A4)+,D0			* GET SAMPLED DATA
		CMPA.L D6,A4			* END OF BUFFER
		BLT.S OUTPUT			* NO.
		MOVE.B #$FF,D0
		BRA.S EXIT			* DONE, SET FLAG

OUTPUT		AND.W #$FF,D0
		MOVE.B #8,$FFFF8800
		MOVE.B 0(A3,D0.W),$FFFF8802	* CHANEL A NOTE
		MOVE.B #9,$FFFF8800
		MOVE.B 0(A2,D0.W),$FFFF8802	* B
		MOVE.B #10,$FFFF8800
		MOVE.B 0(A1,D0.W),$FFFF8802	* C

TTP		MOVE.W #0,D0			* DELAY LOOP
LOOPME		NOP				* NOT MUCH HERE
		DBF D0,LOOPME

		BRA.S MUSICLP			* KEEP IT UP

EXIT_TWO	CLR.B D5
EXIT		ORI.B #3,$484
		LEA STATUS(PC),A0
		MOVE.W (A0),SR			* UP-DATE SR
		LEA STACKST(PC),A0
		MOVE.L (A0),-(SP)
		MOVE.W #$20,-(SP)		* SET TO USER MODE
		TRAP #1
		ADDQ.L #6,SP
		MOVEM.L (SP)+,D0-D4/A0-A6	* PULL'EM OFF
		RTS

		EVEN

*
* SOUND CHANEL VOLUME DUMP TABLES
*

CHANEL_A 	DC.L    $00000000,$00000000,$00000000,$00000000
        	DC.L    $00010000,$00000001,$00000000,$00000001
        	DC.L    $02000000,$00010000,$01020001,$00010203
        	DC.L    $00010000,$00000100,$01020000,$00010203
        	DC.L    $00010204,$00000001,$02000100,$00010001
        	DC.L    $02030001,$00010200,$01020403,$03000102
        	DC.L    $06050300,$00010001,$02000000,$01020001
        	DC.L    $02000100,$01020000,$01020203,$00010204
        	DC.L    $05030001,$02060503,$00010200,$01020207
        	DC.L    $03030504,$04050000,$00010200,$01020001
        	DC.L    $00010203,$00010202,$04000102,$04000100
        	DC.L    $01020305,$03040404,$00010206,$07030304
        	DC.L    $04040505,$05060600,$00010207,$0B030309
        	DC.L    $04080001,$02020603,$03000001,$02020303
        	DC.L    $06080404,$05070706,$06060908,$07070707
        	DC.L    $0B0B0000,$00000102,$00010200,$01000100

CHANEL_B 	DC.L    $00000001,$02000102,$00010001,$02030001
        	DC.L    $02020400,$01020404,$03000102,$06050303
        	DC.L    $03040001,$02020703,$03030404,$05050504
        	DC.L    $06060001,$02070703,$03030408,$05050504
        	DC.L    $06060608,$00010202,$02030308,$04040505
        	DC.L    $05040606,$09090907,$07070607,$07080808
        	DC.L    $0607080A,$0A0A0909,$09000102,$02020303
        	DC.L    $03040405,$05050A06,$0606060A,$07070706
        	DC.L    $0A070808,$08060708,$0B0B0B09,$09090907
        	DC.L    $09090B09,$09090001,$02020203,$03030404
        	DC.L    $05050504,$06060606,$05070707,$060B0B08
        	DC.L    $08080B07,$080B0808,$0909090B,$07090909
        	DC.L    $09090909,$0909090A,$0A0A0A09,$0B0A0A0B
        	DC.L    $0A090C0C,$0C0C0A0C,$0C0B0B0B,$0B0B0B0B
        	DC.L    $0C0A0B0B,$0B0C0C0B,$0B0B0A0C,$0B0B0B0B
        	DC.L    $0B0B0000,$01020202,$03030304,$0405050C

CHANEL_C 	DC.L    $00010202,$02030303,$04040505,$05040606
        	DC.L    $06060507,$07070606,$07080808,$06070808
        	DC.L    $08080909,$09090709,$09090909,$09090909
        	DC.L    $09090A0A,$0A09090A,$0A0A0A09,$0A0A0A0A
        	DC.L    $0A0A0A09,$0B0B0B0B,$0B0B0B0A,$0B0B0B0B
        	DC.L    $0B0B0B0B,$0A0A0A0B,$0B0B0B0B,$0B0B0B0B
        	DC.L    $0B0B0B0A,$0A0A0B0B,$0B0C0C0C,$0C0C0C0C
        	DC.L    $0C0C0C0C,$0C0C0B0C,$0C0C0C0B,$0C0C0C0C
        	DC.L    $0B0C0C0C,$0C0C0C0C,$0B0B0B0C,$0C0C0C0C
        	DC.L    $0C0C0B0C,$0C0C0D0D,$0D0D0D0D,$0D0D0D0D
        	DC.L    $0D0D0D0D,$0D0D0D0D,$0D0D0D0D,$0D0C0C0D
        	DC.L    $0D0D0C0D,$0D0C0D0D,$0D0D0D0C,$0D0D0D0D
        	DC.L    $0D0D0D0D,$0D0D0D0D,$0D0D0D0D,$0B0D0D0C
        	DC.L    $0D0D0C0C,$0C0C0D0C,$0C0D0D0D,$0D0D0D0D
        	DC.L    $0C0D0D0D,$0D0C0C0D,$0D0D0D0C,$0D0D0D0D
        	DC.L    $0C0C0E0E,$0E0E0E0E,$0E0E0E0E,$0E0E0E0D

		EVEN

*
* SYSTEM VARIABLES FOR ABOVE PROGRAM
*

STATUS		DS.W 1
STACKST		DS.W 1

* THIS IS THE END FOLKS.....