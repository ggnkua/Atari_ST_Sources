* This is a highly modified version of the STOS Maestro playback
* routine.  SO highly modified, in fact, that it is hard to
* recognise it as such...

* To play a sample, set the relevant bit of newsam..

* Bit:	Sample:
* 0	Explosion
* 1	Clank
* 2	bullet fired
* 3	bomb fired
* 4	timer shield
* 5	finish sound
* 6	cloak
* 7	destroyed a block

SAMSTOP	MOVE.W SR,D7		; SAVE STATUS
	MOVE.W #$2700,SR	; KILL INTERRUPTS
	BCLR #5,$FFFA07		; TIMER A INTERRUPT OFF
	BCLR #5,$FFFA0B		; TIMER A PENDING CLEAR
	BCLR #5,$FFFA0F		; TIMER A INTERRUPT IN SERVICE CLR
	BCLR #5,$FFFA13		; TIMER A MASK OFF
	MOVE.W D7,SR		; STATUS BACK
	MOVE.L	OLDTHNG,$134
	MOVE.L	OLDVBL,$70
	RTS

PLAYSAM	PEA	SNDINIT
	MOVE.W 	#32,-(SP)
	TRAP 	#14
	ADDQ.L 	#6,SP
	MOVE.L	#1,LENGTH
	MOVE.L	#NOSAM,ADDR
	MOVE.L	$134,OLDTHNG
	MOVE.L	$70,OLDVBL
	MOVE.W 	SR,D7
	MOVE.W 	#$2700,SR
	CLR.B 	$FFFA19
	MOVE.B 	#131,$FFFA1F
	MOVE.B	#1,$FFFA19
	ORI.B 	#$20,$FFFA13
	ORI.B 	#$20,$FFFA07
	BCLR.B 	#3,$FFFA17
	MOVE.L 	#SAMPLAY,$134
	MOVE.L	#SAMVBL,$70
	MOVE.W 	D7,SR
	RTS

SAMVBL	MOVE.W	#$2700,SR
	BSR	STANDARD_VBL
	CMP.L	#1,LENGTH
	BNE	NOTZ
	MOVE.W	#0,PLAYING
NOTZ	CMP.B	#0,NEWSAM
	BEQ	OUTVBL
	BTST.B	#5,NEWSAM
	BNE	FINSPL
	BTST.B	#0,NEWSAM
	BNE	EXPLSON
	BTST.B	#1,NEWSAM
	BNE	CLUNK
	BTST.B	#4,NEWSAM
	BNE	SHIELDD
	BTST.B	#6,NEWSAM
	BNE	CLOAKD
	BTST.B	#7,NEWSAM
	BNE	DESTSAM
	BTST.B	#3,NEWSAM
	BNE	BOMBFD
	BTST.B	#2,NEWSAM
	BNE	LITBUL
	MOVE.W	#0,NEWSAM
OUTVBL	MOVE.W	#0,NEWSAM
	MOVE.W	#$2300,SR
	*MOVE.L	#OLDVBL,-(SP)
	RTE
FINSPL	MOVE.W	#10,PLAYING
	MOVE.L	#FINISH,ADDR
	MOVE.L	#CLOAKSD-FINISH,LENGTH
	BRA	OUTVBL
EXPLSON	CMP.W	#9,PLAYING
	BGT	OUTVBL
	MOVE.W	#9,PLAYING
	MOVE.L	#EXPLOS,ADDR
	MOVE.L	#SHOT1-EXPLOS,LENGTH
	BRA	OUTVBL
LITBUL	CMP.W	#1,PLAYING
	BGT	OUTVBL
	MOVE.W	#1,PLAYING
	MOVE.L	#SHOT1,ADDR
	MOVE.L	#CLANK-SHOT1,LENGTH
	BRA	OUTVBL	
SHIELDD	CMP.W	#6,PLAYING
	BGT	OUTVBL
	MOVE.W	#6,PLAYING
	MOVE.L	#WOP,ADDR
	MOVE.L	#FINISH-WOP,LENGTH
	BRA	OUTVBL
CLOAKD	CMP.W	#6,PLAYING
	BGT	OUTVBL
	MOVE.W	#6,PLAYING
	MOVE.L	#CLOAKSD,ADDR
	MOVE.L	#DESTSND-CLOAKSD,LENGTH
	BRA	OUTVBL
DESTSAM	CMP.W	#5,PLAYING
	BGT	OUTVBL
	MOVE.W	#5,PLAYING
	MOVE.L	#DESTSND,ADDR
	MOVE.L	#endsamples-DESTSND,LENGTH
	BRA	OUTVBL
CLUNK	CMP.W	#6,PLAYING
	BGT	OUTVBL
	MOVE.W	#6,PLAYING
	MOVE.L	#CLANK,ADDR
	MOVE.L	#BOMBF-CLANK,LENGTH
	BRA	OUTVBL
BOMBFD	CMP.W	#3,PLAYING
	BGT	OUTVBL
	MOVE.W	#3,PLAYING
	MOVE.L	#BOMBF,ADDR
	MOVE.L	#WOP-BOMBF,LENGTH
	BRA	OUTVBL

FINSAM	MOVE.L	#1,LENGTH
	MOVEM.L	(SP)+,D7/A3
SAMOUT	RTE
SAMPLAY	BTST	#6,FLAGS
	BNE	SAMOUT
	MOVEM.L	D7/A3,-(SP)
	SUBQ.L 	#1,LENGTH
	BEQ.S 	FINSAM
	MOVEA.L	ADDR,A3
	MOVE.B	(A3),D7
	ADDQ.L	#1,ADDR
	ANDI.W 	#$FF,D7
	LSL.W 	#4,D7
	LEA	VOLDAT2,A3
	MOVE.L 	(A3,D7.W),PSG
	MOVE.L 	4(A3,D7.W),PSG
	MOVE.L 	8(A3,D7.W),PSG
	MOVEM.L (SP)+,D7/A3
	RTE

ADDR	DC.L	NOSAM
LENGTH	DC.L 	1
OLDVBL	DC.L	0
OLDTHNG	DC.L	0
PLAYING	DC.W	0
NEWSAM	DC.W	0

VOLDAT2	DC.L $08000000,$09000000,$0A000000,0
	DC.L $08000000,$09000000,$0A000100,0
	DC.L $08000100,$09000100,$0A000000,0
	DC.L $08000100,$09000100,$0A000100,0
	DC.L $08000200,$09000200,$0A000000,0
	DC.L $08000200,$09000200,$0A000100,0
	DC.L $08000300,$09000100,$0A000000,0
	DC.L $08000300,$09000100,$0A000100,0
	DC.L $08000400,$09000000,$0A000000,0
	DC.L $08000400,$09000100,$0A000100,0
	DC.L $08000400,$09000200,$0A000000,0
	DC.L $08000400,$09000200,$0A000100,0
	DC.L $08000500,$09000000,$0A000000,0
	DC.L $08000500,$09000100,$0A000100,0
	DC.L $08000500,$09000200,$0A000000,0
	DC.L $08000500,$09000200,$0A000100,0
	DC.L $08000500,$09000300,$0A000000,0
	DC.L $08000500,$09000300,$0A000100,0
	DC.L $08000600,$09000200,$0A000000,0
	DC.L $08000600,$09000200,$0A000100,0
	DC.L $08000600,$09000300,$0A000000,0
	DC.L $08000600,$09000300,$0A000000,0
	DC.L $08000600,$09000300,$0A000100,0
	DC.L $08000600,$09000300,$0A000100,0
	DC.L $08000600,$09000300,$0A000100,0
	DC.L $08000600,$09000300,$0A000200,0
	DC.L $08000600,$09000300,$0A000200,0
	DC.L $08000600,$09000300,$0A000200,0
	DC.L $08000700,$09000000,$0A000000,0
	DC.L $08000700,$09000100,$0A000100,0
	DC.L $08000700,$09000200,$0A000100,0
	DC.L $08000700,$09000200,$0A000200,0
	DC.L $08000700,$09000400,$0A000000,0
	DC.L $08000700,$09000400,$0A000100,0
	DC.L $08000700,$09000400,$0A000200,0
	DC.L $08000700,$09000400,$0A000300,0
	DC.L $08000800,$09000300,$0A000000,0
	DC.L $08000800,$09000300,$0A000200,0
	DC.L $08000800,$09000400,$0A000000,0
	DC.L $08000800,$09000400,$0A000200,0
	DC.L $08000800,$09000500,$0A000000,0
	DC.L $08000800,$09000500,$0A000100,0
	DC.L $08000800,$09000500,$0A000200,0
	DC.L $08000800,$09000500,$0A000300,0
	DC.L $08000900,$09000000,$0A000100,0
	DC.L $08000900,$09000000,$0A000100,0
	DC.L $08000900,$09000200,$0A000200,0
	DC.L $08000900,$09000200,$0A000200,0
	DC.L $08000A00,$09000300,$0A000000,0
	DC.L $08000A00,$09000300,$0A000100,0
	DC.L $08000A00,$09000300,$0A000200,0
	DC.L $08000A00,$09000300,$0A000200,0
	DC.L $08000A00,$09000400,$0A000100,0
	DC.L $08000A00,$09000400,$0A000100,0
	DC.L $08000A00,$09000400,$0A000200,0
	DC.L $08000A00,$09000400,$0A000200,0
	DC.L $08000A00,$09000400,$0A000200,0
	DC.L $08000A00,$09000400,$0A000300,0
	DC.L $08000A00,$09000400,$0A000300,0
	DC.L $08000A00,$09000400,$0A000400,0
	DC.L $08000A00,$09000400,$0A000400,0
	DC.L $08000A00,$09000400,$0A000400,0
	DC.L $08000A00,$09000400,$0A000500,0
	DC.L $08000A00,$09000400,$0A000500,0
	DC.L $08000A00,$09000400,$0A000500,0
	DC.L $08000A00,$09000500,$0A000000,0
	DC.L $08000A00,$09000500,$0A000200,0
	DC.L $08000A00,$09000500,$0A000300,0
	DC.L $08000A00,$09000500,$0A000400,0
	DC.L $08000A00,$09000600,$0A000000,0
	DC.L $08000A00,$09000600,$0A000200,0
	DC.L $08000A00,$09000600,$0A000300,0
	DC.L $08000A00,$09000600,$0A000400,0
	DC.L $08000A00,$09000600,$0A000500,0
	DC.L $08000A00,$09000700,$0A000000,0
	DC.L $08000A00,$09000700,$0A000000,0
	DC.L $08000A00,$09000700,$0A000100,0
	DC.L $08000A00,$09000700,$0A000200,0
	DC.L $08000A00,$09000700,$0A000200,0
	DC.L $08000A00,$09000700,$0A000300,0
	DC.L $08000A00,$09000700,$0A000400,0
	DC.L $08000B00,$09000000,$0A000000,0
	DC.L $08000B00,$09000100,$0A000000,0
	DC.L $08000B00,$09000100,$0A000100,0
	DC.L $08000B00,$09000200,$0A000000,0
	DC.L $08000B00,$09000200,$0A000100,0
	DC.L $08000B00,$09000300,$0A000000,0
	DC.L $08000B00,$09000300,$0A000200,0
	DC.L $08000B00,$09000400,$0A000000,0
	DC.L $08000B00,$09000400,$0A000200,0
	DC.L $08000B00,$09000400,$0A000300,0
	DC.L $08000B00,$09000400,$0A000400,0
	DC.L $08000B00,$09000600,$0A000000,0
	DC.L $08000B00,$09000600,$0A000200,0
	DC.L $08000B00,$09000600,$0A000300,0
	DC.L $08000B00,$09000600,$0A000400,0
	DC.L $08000B00,$09000800,$0A000000,0
	DC.L $08000B00,$09000800,$0A000100,0
	DC.L $08000B00,$09000800,$0A000300,0
	DC.L $08000B00,$09000800,$0A000400,0
	DC.L $08000B00,$09000900,$0A000000,0
	DC.L $08000B00,$09000900,$0A000200,0
	DC.L $08000B00,$09000900,$0A000300,0
	DC.L $08000B00,$09000900,$0A000400,0
	DC.L $08000C00,$09000400,$0A000000,0
	DC.L $08000C00,$09000400,$0A000000,0
	DC.L $08000C00,$09000400,$0A000100,0
	DC.L $08000C00,$09000400,$0A000100,0
	DC.L $08000C00,$09000500,$0A000200,0
	DC.L $08000C00,$09000500,$0A000200,0
	DC.L $08000C00,$09000500,$0A000300,0
	DC.L $08000C00,$09000500,$0A000300,0
	DC.L $08000C00,$09000500,$0A000400,0
	DC.L $08000C00,$09000500,$0A000400,0
	DC.L $08000C00,$09000600,$0A000000,0
	DC.L $08000C00,$09000600,$0A000100,0
	DC.L $08000C00,$09000600,$0A000200,0
	DC.L $08000C00,$09000600,$0A000400,0
	DC.L $08000C00,$09000700,$0A000000,0
	DC.L $08000C00,$09000700,$0A000200,0
	DC.L $08000C00,$09000700,$0A000400,0
	DC.L $08000C00,$09000800,$0A000000,0
	DC.L $08000C00,$09000800,$0A000200,0
	DC.L $08000C00,$09000800,$0A000300,0
	DC.L $08000C00,$09000800,$0A000400,0
	DC.L $08000C00,$09000900,$0A000000,0
	DC.L $08000C00,$09000900,$0A000200,0
	DC.L $08000C00,$09000900,$0A000300,0

	DC.L $08000D00,$09000000,$0A000000,0
	DC.L $08000D00,$09000100,$0A000000,0
	DC.L $08000D00,$09000100,$0A000100,0
	DC.L $08000D00,$09000200,$0A000100,0
	DC.L $08000D00,$09000300,$0A000100,0
	DC.L $08000D00,$09000300,$0A000200,0
	DC.L $08000D00,$09000400,$0A000000,0
	DC.L $08000D00,$09000400,$0A000200,0
	DC.L $08000D00,$09000400,$0A000300,0
	DC.L $08000D00,$09000400,$0A000400,0
	DC.L $08000D00,$09000500,$0A000300,0
	DC.L $08000D00,$09000500,$0A000400,0
	DC.L $08000D00,$09000600,$0A000300,0
	DC.L $08000D00,$09000600,$0A000400,0
	DC.L $08000D00,$09000700,$0A000000,0
	DC.L $08000D00,$09000700,$0A000200,0
	DC.L $08000D00,$09000700,$0A000300,0
	DC.L $08000D00,$09000700,$0A000400,0
	DC.L $08000D00,$09000700,$0A000500,0
	DC.L $08000D00,$09000700,$0A000500,0
	DC.L $08000D00,$09000800,$0A000000,0
	DC.L $08000D00,$09000800,$0A000200,0
	DC.L $08000D00,$09000800,$0A000400,0
	DC.L $08000D00,$09000800,$0A000500,0
	DC.L $08000D00,$09000900,$0A000100,0
	DC.L $08000D00,$09000900,$0A000300,0
	DC.L $08000D00,$09000900,$0A000400,0
	DC.L $08000D00,$09000900,$0A000500,0
	DC.L $08000D00,$09000900,$0A000500,0
	DC.L $08000D00,$09000900,$0A000600,0
	DC.L $08000D00,$09000900,$0A000600,0
	DC.L $08000D00,$09000900,$0A000600,0
	DC.L $08000D00,$09000A00,$0A000100,0
	DC.L $08000D00,$09000A00,$0A000200,0
	DC.L $08000D00,$09000A00,$0A000300,0
	DC.L $08000D00,$09000A00,$0A000300,0
	DC.L $08000D00,$09000A00,$0A000400,0
	DC.L $08000D00,$09000A00,$0A000500,0
	DC.L $08000D00,$09000A00,$0A000500,0
	DC.L $08000D00,$09000A00,$0A000600,0
	DC.L $08000D00,$09000B00,$0A000000,0
	DC.L $08000D00,$09000B00,$0A000100,0
	DC.L $08000D00,$09000B00,$0A000200,0
	DC.L $08000D00,$09000B00,$0A000300,0
	DC.L $08000D00,$09000B00,$0A000400,0
	DC.L $08000D00,$09000B00,$0A000400,0
	DC.L $08000D00,$09000B00,$0A000500,0
	DC.L $08000D00,$09000B00,$0A000500,0
	DC.L $08000E00,$09000000,$0A000000,0
	DC.L $08000E00,$09000000,$0A000100,0
	DC.L $08000E00,$09000300,$0A000000,0
	DC.L $08000E00,$09000400,$0A000300,0
	DC.L $08000E00,$09000400,$0A000500,0
	DC.L $08000E00,$09000500,$0A000400,0
	DC.L $08000E00,$09000500,$0A000500,0
	DC.L $08000E00,$09000700,$0A000000,0
	DC.L $08000E00,$09000700,$0A000300,0
	DC.L $08000E00,$09000700,$0A000400,0
	DC.L $08000E00,$09000700,$0A000400,0
	DC.L $08000E00,$09000800,$0A000200,0
	DC.L $08000E00,$09000800,$0A000400,0
	DC.L $08000E00,$09000800,$0A000500,0
	DC.L $08000E00,$09000800,$0A000500,0
	DC.L $08000E00,$09000900,$0A000000,0
	DC.L $08000E00,$09000900,$0A000100,0
	DC.L $08000E00,$09000900,$0A000200,0
	DC.L $08000E00,$09000900,$0A000300,0
	DC.L $08000E00,$09000900,$0A000500,0
	DC.L $08000E00,$09000900,$0A000500,0
	DC.L $08000E00,$09000900,$0A000600,0
	DC.L $08000E00,$09000900,$0A000700,0
	DC.L $08000E00,$09000A00,$0A000000,0
	DC.L $08000E00,$09000A00,$0A000500,0
	DC.L $08000E00,$09000A00,$0A000800,0
	DC.L $08000E00,$09000A00,$0A000900,0
	DC.L $08000E00,$09000B00,$0A000300,0
	DC.L $08000E00,$09000B00,$0A000600,0
	DC.L $08000E00,$09000B00,$0A000800,0
	DC.L $08000E00,$09000B00,$0A000900,0
	DC.L $08000E00,$09000C00,$0A000000,0
	DC.L $08000E00,$09000C00,$0A000100,0
	DC.L $08000E00,$09000C00,$0A000200,0
	DC.L $08000E00,$09000C00,$0A000300,0
	DC.L $08000E00,$09000C00,$0A000400,0
	DC.L $08000E00,$09000C00,$0A000400,0
	DC.L $08000E00,$09000C00,$0A000500,0
	DC.L $08000E00,$09000C00,$0A000500,0
	DC.L $08000E00,$09000C00,$0A000600,0
	DC.L $08000E00,$09000C00,$0A000600,0
	DC.L $08000E00,$09000C00,$0A000600,0
	DC.L $08000E00,$09000C00,$0A000600,0
	DC.L $08000E00,$09000C00,$0A000700,0
	DC.L $08000E00,$09000C00,$0A000700,0
	DC.L $08000E00,$09000C00,$0A000700,0
	DC.L $08000E00,$09000C00,$0A000700,0
	DC.L $08000E00,$09000D00,$0A000000,0
	DC.L $08000E00,$09000D00,$0A000100,0
	DC.L $08000E00,$09000D00,$0A000200,0
	DC.L $08000E00,$09000D00,$0A000200,0
	DC.L $08000E00,$09000D00,$0A000300,0
	DC.L $08000E00,$09000D00,$0A000400,0
	DC.L $08000E00,$09000D00,$0A000500,0
	DC.L $08000E00,$09000D00,$0A000500,0
	DC.L $08000E00,$09000D00,$0A000600,0
	DC.L $08000E00,$09000D00,$0A000600,0
	DC.L $08000E00,$09000D00,$0A000700,0
	DC.L $08000E00,$09000D00,$0A000700,0
	DC.L $08000E00,$09000D00,$0A000700,0
	DC.L $08000E00,$09000D00,$0A000700,0
	DC.L $08000E00,$09000D00,$0A000800,0
	DC.L $08000E00,$09000D00,$0A000800,0
	DC.L $08000E00,$09000E00,$0A000000,0
	DC.L $08000E00,$09000E00,$0A000000,0
	DC.L $08000E00,$09000E00,$0A000100,0
	DC.L $08000E00,$09000E00,$0A000100,0
	DC.L $08000E00,$09000E00,$0A000200,0
	DC.L $08000E00,$09000E00,$0A000200,0
	DC.L $08000E00,$09000E00,$0A000300,0
	DC.L $08000E00,$09000E00,$0A000300,0
	DC.L $08000E00,$09000E00,$0A000400,0
	DC.L $08000E00,$09000E00,$0A000500,0
	DC.L $08000E00,$09000E00,$0A000600,0
	DC.L $08000E00,$09000E00,$0A000600,0
	DC.L $08000E00,$09000E00,$0A000700,0
	DC.L $08000E00,$09000E00,$0A000700,0
	DC.L $08000E00,$09000E00,$0A000700,0
	DC.L $08000E00,$09000E00,$0A000700,0

SNDINIT	DC.B 0,0,1,0,2,0,3,0,4,0,5,0,6,0,7,255,8,0,9,0,10,0,11,0,12,0,13,0,255,0

PSG	EQU	$FF8800
NOSAM	DC.W	0
EXPLOS	INCBIN	"a:\grav_2\data\EXPLODE.SPL"
SHOT1	INCBIN	"a:\grav_2\data\SHOT.SPL"
CLANK	INCBIN	"a:\grav_2\data\CLANK.SPL"
BOMBF	INCBIN	"a:\grav_2\data\LASER.SPL"
WOP	INCBIN	"a:\grav_2\data\WOP.SPL"
FINISH	INCBIN	"a:\grav_2\data\FINISH.SPL"
CLOAKSD	INCBIN	"a:\grav_2\data\CLOAK.SPL"	
DESTSND	INCBIN	"a:\grav_2\data\DESTBLK.SPL"
endsamples