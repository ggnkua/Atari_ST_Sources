-----------------------------------------------------------------------------
File name:	PFXAFX.DOC		Revised:	1995.02.07
Author:		Ulf Ronald Andersson	Created:	1992.08.22
Version:	2.1			Revision:	K
-----------------------------------------------------------------------------

NB: Neither PFXPAK nor AFX are my creations, but they were both developed by
NB: Thomas Quester simultaneous with his LHARC ST adaption.
NB: Unfortunately PFXPAK and AFX were never released in debugged form, and
NB: both contained several severe bugs that often would crash the system.

NB: I have now removed those bugs and added some improvements, but to avoid
NB: any copyright conflict I hereby release this work as full PD freeware.
NB: This does not affect the copyright of Thomas Quester who created the
NB: original programs, so even with my alterations these programs remain
NB: SHAREWARE as released by him.

NB: To avoid mixups I have of course renamed the rewritten programs.

-----------------------------------------------------------------------------

The expression "packed data file" is throughout this document used only
to mean "data file packed by XPFX.PRG", since other packers are off-topic.

In the text below some sections are marked, to show from which revision the
information derives, by having a revision tag in the left margin.

rev.B:
    This line, for example, was obviously added in revision 'B'.

Thus, to find what's new in revision 'D', simply search for lines that
contain the string 'rev.D:' and read those sections.

If this is your first aquaintance with this document, I suggest that you
read it through completely, at least twice, to avoid misunderstandings.
 
-----------------------------------------------------------------------------
Release manifest:
-----------------------------------------------------------------------------

FILE_ID.DIZ	== Archive description in RATSOFT BBS format
PFXAFX  .DOC	== This document file
XPFX    .PRG	== GEM program  "eXtended PFXPAK"  (may be used as ACC)

AUTO\		== folder containing the two programs below
SUPX.PRG	== AUTO program to fix a bug in MagiX (xbios Supexec bug)
XAFX    .PRG	== TOS program  "eXtended AFX"  for the AUTO-folder

TOOLS\		== folder containing four tool programs with source code
AFX_PASS.PRG	== TOS program to turn xAFX to PASSive mode  \  / Modes are
AFX_PACK.PRG	== TOS program to turn xAFX to PACKer mode    \/  explained
AFX_FAST.PRG	== TOS program to turn xAFX to FAST mode      /\  later in
AFX_SHOW.PRG	== TOS program to turn xAFX to SHOW mode     /  \ this doc
AFX_PASS.S	== DevPac source code for AFX_PASS.PRG
AFX_PACK.S	== DevPac source code for AFX_PACK.PRG
AFX_FAST.S	== DevPac source code for AFX_FAST.PRG
AFX_SHOW.S	== DevPac source code for AFX_SHOW.PRG

Totally 13 files.
-----------------------------------------------------------------------------
End of release manifest.
-----------------------------------------------------------------------------
Test environments:
-----------------------------------------------------------------------------

  1:	ST 520 expanded to 2.5 MByte with 16 MHz CPU speeder & Auto LaceScan
	with PAL-compatible monitor (no mono).
	Running: TOS 1.0, TOS 1.04, TOS 2.06, and TOS 2.06 + WINX patch

  2:	Mega ST2 expanded to 4 MByte with 16 MHz CPU speeder, RAM cache,
	and Auto LaceScan with SM124 and colour monitors.
	Running: TOS 1.04 + WINX patch and TOS 2.06 + WINX patch
	 -''-	 MultiTOS 1.08
	 -''-	 MagiX 2.01	(NB: MagiX Supexec bug needs SUPX.PRG !)
	 -''-	 Geneva 2.3 release 003
	 -''-	 NeoDesk 4  release 001

  3:    Atari TT running TOS 3.06 (of 24/9 1991).
	TT tests performed by Anders Holmberg (Thanks again Anders!).

-----------------------------------------------------------------------------
Revision summary:
-----------------------------------------------------------------------------

NB:	xPFX & xAFX, will always be updated simultaneously by me, so users
	can rely on them to cooperate well, when of the same revision.
	Mixing revisions will usually work fine, since xPFX is intended to
	be independent of xAFX, which so far works with all xPFX's.
	Nevertheless, I recommend all xAFX users always to update both xAFX
	and xPFX to the same release for guaranteed mutual compatibility.
	Those who only use xPFX to pack programs, obviously do not need to
	bother with xAFX at all, since its main use is for data unpacking.

	-------------------------------------------------------------

rev.A:	xPFX and xAFX debugged to a point of reasonable safety.

	Tested OK on ST with TOS 1.4, TOS 2.06 and MultiTOS rev:8.0.

Report:	xAFX was later reported inoperational on TT.

	-------------------------------------------------------------

rev.B:	xPFX and xAFX improved considerably.

	xPFX made able to run also as '.ACC'.

	xAFX made transparent and MUCH safer to use.

	Both programs tested OK on ST like rev.A, but not yet on TT.

Report:	Some xAFX transparency errors showed up as incorrect size sums
	when desktop showed 'Info' on folders with subfolders.

	-------------------------------------------------------------

rev.C:	xPFX and xAFX slightly (but vitally) improved.

	xPFX default path handling improved for '.ACC' mode.

	xAFX finally fully transparent in SHOW mode.

	Both programs tested OK on ST like rev.A, but not yet on TT.

Ooops:	An error in the installation of cookie jar on older TOS was hidden
	by similar installation by another utility.
	Future tests will be made both with, and without, such utilities.

	-------------------------------------------------------------

rev.D:	Cookie jar installation for TOS 1.4 and older corrected in xAFX.

	All tests now made on TOS 1.0, TOS 1.4, TOS 2.6, and MultiTOS.

Report:	Anders Holmberg  (author of ASASTART, the _best_ boot utility)
	has reported this version operational on his Atari TT.

	-------------------------------------------------------------

rev.E:	xAFX subdirectory handling speed-optimized, especially in the new
        mode FAST (like SHOW but without transparent size on "wildcards").

	xPFX adapted to display the new xAFX mode FAST.
	The order of display forms and alerts in xPFX has been changed to
	a more logical sequence.  (Size info before file selector etc.).

	A new tool program, AFX_FAST.PRG, has been added to the release.

	-------------------------------------------------------------

rev.F:	xAFX unaltered from rev.E, except for revision number & date.

	xPFX corrected to avoid damage to TT-RAM flags of packed programs.
	(Though the packed file itself still will have ONLY fastload bit.)

Report:	Anders Holmberg reports a problem with writing to packed files.
	He also supplied a test program to trigger this bug, to simplify
	my work on the next revision !!!

	-------------------------------------------------------------

rev.G:	xAFX corrected to prevent errors that previously ocurred, when
	a program made partial updates of afx-packed data files.
	This now really does, as originally intended, update the data
	correctly after first unpacking the entire file.
	If there is not room to unpack it, there will of course be some
	error messages anyway.

	xPFX unaltered from rev.F, except for revision number & date.

Report:	Several users have been in touch, with no complaints on rev.G !

	-------------------------------------------------------------

rev.H:	xAFX improved to be able to execute AFX-packed programs, so that
	programs that  "selfcheck"  may be packed  (eg: "Calamus" ).
	This also allows safely packed desktop accessories.

	xPFX improved to be able to pack programs as AFX files.
	This is done by selecting the button [AFX pack all], before also
	activating the [Pack] button.  ([Unpack] button is unaffected.)

	-------------------------------------------------------------

rev.I:	xAFX improved to let user define size of internal buffers, so
	programs that hog memory (illegal) may still use packed data.

	xPFX unaltered from rev.H, except for revision number & date.

	-------------------------------------------------------------

rev.J:	xAFX unaltered from rev.H, except for revision number & date.

	xPFX improved with ARGV-protocol for batch packing, and also
	equipped with keyboard control for packing modes.

	-------------------------------------------------------------

rev.K:	xAFX unaltered from rev.J, except for revision number & date.

	xPFX corrected to avoid errors with zero-size files.
	Unpacking will now bypass such files, whereas packing will bypass
	all files smaller than 1025 bytes (since no storage gain possible).

	xPFX corrected to avoid problems with "unpaired" form_dial calls.

	xPFX corrected to avoid spurious return values in batch mode.

	xPFX now allows use of right shift key instead of 'Alternate' to
	choose AFX packing in batch operation.

-----------------------------------------------------------------------------
End of revision summary.
-----------------------------------------------------------------------------
xPFX Description:
-----------------------------------------------------------------------------


XPFX.PRG is the packer that creates both selfextracting packed programs, and
    packed data files to be transparently unpacked by xAFX (if installed).
    The packed files are identical to those of PFXPAK, and compatible with
    Thomas Quester's LHARC.TTP, which will list them as using pack methods
    'lz5' (program file) and 'afx' (data file) and can also unpack them.
rev.H:
    It is now possible to pack programs as well using 'afx' method, and
    these are of course also compatible to PFXPAK and LHARC as above.
    
    xPFX is quite similar to PFXPAK 2.1, except that the many bugs have
    been removed, and the language altered to English instead of German.
    The program even claims to be PFXPAK, since that is its origin.

rev.H:
    Well, not quite so similar any more, since the immunizer is now removed
    completely, and replaced with the new packing option: "AFX pack all".
    
	-------------------------------------------------------------

    The major PFXPAK bugs removed in xPFX were:

    1: PFXPAK never closed the VDI virtual workstation at program exit.
    2: PFXPAK never made any AES appl_exit at program exit.
    3: PFXPAK used >30 char strings in alerts, though maximum legal is 29.
    4: PFXPAK often mistook programs for data, and vice versa.
    5: PFXPAK's virus immunizer used AES calls without 'appl_init',
       and even did so from TOS programs, which are both fatal bugs.
       This I could not fix, but have instead disabled the immunizer.

NB: ALL of the above bugs could cause the computer to 'bomb', although
    due to the interaction with GEM this would often occur when some
    other program was started, giving it the blame...!

	-------------------------------------------------------------

    Further improvements were:

    PFXPAK trashed date and time info both in packing and unpacking.
    xPFX preserves the date and time info, such that the output file has the
    same info as the input file had.  Thus, a packed file can always be
    completely restored as it originally was, including time info.
    This is often important in keeping track of versions/revisions.

    PFXPAK used line-A routines, which I have replaced with VDI calls.
    This is not a bug fix, but required by Atari for TOS compatibility.

    Like most programs that rely on alerts and forms, PFXPAK suffers from
    poor window handling under MultiTOS (The other bugs made it crash too).
    This has been fixed in xPFX, which is fully MultiTOS compatible.
    The change is not visible in the user interface, except as an absence
    of the problems which made PFXPAK unusable with MultiTOS, even for the
    short moments it could run at all without crashing.

	-------------------------------------------------------------

rev.B:
    xPFX now copies only the relevant part (the name) of a filepath into
    the header of a packed file, which saves trouble if that file is to
    be unpacked by LHARC at some future time, and also makes each file a
    few bytes shorter.

rev.B:
    xPFX will also run as an ACCessory, either by itself, or loaded by one
    of the excellent ACCessory handlers 'MultiDesk' and 'Chameleon'.
    No patching is needed, but of course you must rename it to XPFX.ACC,
    if you want the TOS to load it automatically.

rev.B:
    xPFX now reassigns default button to be the latest one used, if it is
    either [PACK] or [UNPACK], any other button sets [EXIT] as default.
    This makes multiple file handling much easier, since the latest command
    can be repeated simply by pressing <Return> or <Enter>.
    The [EXIT] button remains initial default so one can escape if ever
    entering the program with "dead mouse" as sometimes happens in old TOS.

rev.B:
    xPFX now reports the correct size of destination files, and does so
    after writing either a packed or an unpacked file.
    PFXPAK was inconsistent in this, and also gave erroneous size info.
rev.E:
    This has been changed, so size info is shown _before_ saving.

rev.B:
    The main dialog form of xPFX includes a line showing the presence or
    absence of AFX/xAFX in the booted system, and if present also shows
    which it is, and its current mode of operation (documented below).
    'Clicking' on the displayed mode info will alter the mode displayed,
    although the setting will take full effect only when the dialog is
    'Exited', since xPFX forces 'SHOW' mode off while active.
NB: To pack data files for transparent xAFX use, you should run xPFX with
    xAFX in either SHOW mode or PACK mode, so FILESIZE.AFX is updated.
    Otherwise the packed data size will not become transparent, although
    the auto-unpacking will function as usual.
rev.E:
    Here the new FAST mode has the same characteristics as SHOW mode.

	-------------------------------------------------------------

rev.C:
    My intention was that xPFX should use default directory when started.
    Unfortunately, the GEMDOS functions Dgetdrv and Dgetpath do not work
    as usual when called by an ACCessory, and will then only return the
    drive code and path to the directory where desktop loads accs.
    With normal TOS this is always 'A:\' or 'C:\', but with MultiTOS it
    can also be some folder, like 'A:\ACCS\'.  That path is evidently
    always returned by those functions when called by an ACCessory, even
    if the real default drive and directory has been altered !!!
    xPFX now uses variables to remember what path it was used with last,
    when reawakened in ACCessory mode, which improves the response.
    Since reawakening only happens in ACC mode, the PRG operation should
    remain as it was (ie: use true defaults on entry).
rev.H:
    Ooops, I was a bit wrong about the above.  It turns out that each ACC
    has an individual set of default paths, that do _not_ respond to any
    path changes on the desktop.  In any case the problem is TOS-inherent.

    It's also slightly 'illegal' to use any packer program as an accessory,
    since Atari still maintain that accessories may not Malloc any memory.

rev.C:
    A lot of unused routines have been removed from xPFX, and the program
    structure again uses a BSS section (was removed in rev.B).

	-------------------------------------------------------------

rev.D:
    No significant changes to xPFX were made in this revision.

	-------------------------------------------------------------

rev.E:
    The display order of various forms and alerts has been altered to make
    better sense from the users point of view.  Thus size info will now be
    shown before destination file selector, with new 'Cancel' option added.

	-------------------------------------------------------------

rev.F:
    The 'Fastload' option, which only affects a packed program for later
    unpacking, also affected 15 other bits in the packed program header.
    When such a file was unpacked, it might not behave like the original
    did, when run on a TT where these bits may be used.
    This has been corrected, so as to preserve those bits.

NB: The header spoken of here is that of the program inside the lz5-archive,
    not the one seen by gemdos while loading the packed program, which will
    always have the fastload bit ONLY.

rev.F:
    One form corrected which referred to a 'packed program', even when it
    referred to a data file.  This is now simply altered to 'packed file'.

	-------------------------------------------------------------

rev.G:
    No significant changes to xPFX were made in this revision.

	-------------------------------------------------------------

rev.H:
    A new pack option has replaced the dysfunctional button [Immunize],
    and is used to force 'afx' method to be used for packing all files.
    Programs packed with this option will be normal xAFX files, so they
    appear and behave as unpacked while xAFX is in SHOW mode.

    When executed (GemDos Pexec) they will be automatically unpacked in
    all xAFX modes except PASSive, but when read as normal data they will
    behave like normal xAFX files (because that's what they are!).

    The motivation for this mode is threefold:

    1: Accessories can not be safely packed with other methods.
    2: Program that "selftest" report (false) viruses with other methods.
    3: Correct file sizes of programs are not given by other methods.

NB: xPFX can pack programs as AFX files on any ST, STE, or TT,
    but you need a modern TOS (1.4 or later) to use them with xAFX.

	-------------------------------------------------------------

rev.I:
    No significant changes to xPFX were made in this revision.

	-------------------------------------------------------------

rev.J:
    It is now possible to batch pack entire folders and partitions with xPFX.

    Atari's standard ARGV-protocol is implemented, in addition to the older
    command-line argument passing.
    Each argument should be a complete file or folder path.

    If a path contains a filename, or wildcards, that path will be searched
    single-level for matching files, so any subfolders will be ignored.
    If the path contains neither filename nor wildcards, the path will be
    searched multi-level (<8), for files and subfolders to process.

	In the checks above, a path will be considered multi-level when it
	ends with '\', or with the name of an existing folder.
	These cases are treated identically, for compatibility with MultiTOS,
	as well as single-tasking TOS, since they pass folders differently.


    In the batch mode, most normal forms and dialogs do not appear, unless an
    error occurs, causing an alert-box to inform the user.
    In GEM batch mode the form showing ongoing packing is displayed, now also
    including the name of the file being processed.
    Similar text is displayed on the 'bios_screen' (or MINIWIN) of TOS batch.

    In TOS batch mode any errors needing to be displayed by alerts are shown
    through a "simulated" form_alert routine using VT-52 codes only.
    This may seem primitive, but is guaranteed compatible with all programs.


    Packing modes for batch operation are chosen by keyboard control, and the
    same means can also be used in non-batch operation to enter the program
    with chosen default settings.  The keyboard controls are given below:
    
    Alternate
	Hold this key down while xPFX starts to demand that xPFX pack program
	files by '-afx-' method instead of the usual '-lz5-'.
	This corresponds to the 'AFX pack all' button of the main dialog in
	non-batch mode, and will in that mode preset this selection.
      Warning:
	It is usually best to avoid packing 'AUTO' folders this way, since
	programs in '-afx-' format require xAFX to be active when they load.
	Thus an unpacked xAFX.PRG must precede any '-afx-' programs in boot.
	(I always pack MINT.PRG and GEM.SYS this way, works fine!)
      Tip:
	This mode allows most files allergic to packers to be packed.
	This includes ACC files, CPX files, RSC files and even CALAMUS.
	The only hitch is that xAFX must be active to run them.

    Control
	Hold this key down while starting xPFX to specify that you want xPFX
	to unpack files that already are packed as '-lz5-' or '-afx-'.
	This corresponds to the 'Unpack' button of the main dialog in normal
	mode, and will then set that button as the default button.

    Left Shift
	This key has the same effect as 'Control' described above, and was
	added only because 'Control' is lethal to accessories in MultiTOS,
	whereas 'shifts' interfere with running xPFX by function keys.
	Since both keys are available, users should be able to run xPFX
	by whatever method they prefer.

rev.K:
    Right Shift
	This key has the same effect as 'Alternate' described above, and was
	added because some desktops will interpret 'Alternate' as a special
	command when launching a program.

rev.J:
    Since batch mode does not query the user as to whether a file was packed
    efficiently enough to motivate replacing the unpacked version, the code
    has been improved to correctly recognize whether packing saves disk area.

    No packed file will be saved unless this will reduce the cluster count
    of the file as stored on standard disks with 1024 bytes per cluster.
    xPFX may of course be used with any cluster sizes, but this particular
    efficiency check is always made relative to the older standard.
    

    xPFX is now able to run as any kind of program except CPX.
    
    TOS/TTP operation is only legal in batch mode, however, and will probably
    be horribly inefficient in MultiTOS due to MINIWIN limitations.
    MINIWIN also retains a tendency to fragment memory, even in the latest
    versions (currently MultiTOS 1.08).

    ACC operation has given me no trouble whatsoever, but may be slightly
    illegal since according to Atari accessories are forbidden to use
    Malloc to reserve memory even temporarily (I cannot see why!).
    It nevertheless works fine both with MultiTOS and with older systems.
    I would really like some clarification on this subject, since that rule
    seems ridiculously exaggerated.

    As I see it:
	Permanent Mallocs are obviously illegal in ACCs, since the desktop
	has the right to 'deregister' unwanted accessories.
	Temporary Mallocs, released before the next evnt_multi of the ACC
	should always work and ought to be legal, so why aren't they...?

    APP/PRG/GTP operation is of course the normal usage that I recommend.
    Note that with modern TOS there is little difference in how you use these
    from desktop, since you can always drag a folder to drop it on a program
    when you want that folders path as command-line argument of the program.
    GTP is only needed when you wish to enter the arguments by hand.

WARNING 1:
    There is a bug in the current implementation of ARGV in MultiTOS desktop,
    causing all characters beyond the capacity of the old-style command line
    to be truncated.
    This will be a problem with xPFX only if you drag several files at a time
    to drop onto xPFX for batch processing, single files/folders will be OK.
    You can also circumvent this problem by entering the arguments manually.

    This is a simple string process problem in that desktop, that ought to be
    corrected in some future release of MultiTOS.
    Other alternative desktops (eg: TERADESK) have fully functional ARGV, and
    these never give problems with xPFX.

WARNING 2:
    NEVER pack your entire boot partition to '-afx-' mode, since this will
    make it impossible to boot, since XAFX.PRG has to boot before any files
    in '-afx-' format can be loaded.

    The same warning of course applies to all programs that are intended to
    run without xAFX active.  Pack such to '-lz5-' instead, or not at all.

    If you always have an unpacked version of xPFX on diskette, you can of
    course recover mistakenly packed partitions, so back it up !!!

	-------------------------------------------------------------

rev.K:
    xPFX corrected to avoid errors with zero-size files.
    These errors were a problem when processing folders in batch mode,
    since a zero-size file in any sub-folder would interrupt the batch.

    Unpacking will now bypass such files, whereas packing will bypass
    all files smaller than 1025 bytes (since no storage gain possible).

    xPFX corrected to avoid problems with "unpaired" form_dial calls.
    The display form used to show packing progress did not correctly pair
    each form_dial(0,...) with a corresponding form_dial(3,...), which
    could cause compatibility problems in some multitasking environments.

    The form now uses only 1 such pair of form_dial calls per file handled.

    xPFX corrected to avoid spurious return values in batch mode.
    This is mainly a cosmetic change, since they gave no real problems.

    Right shift key may now be used instead of 'Alternate' to control xPFX.
    Thus R-shift == Alternate == AFX_pack, but L-shift == Control == Unpack.

    If more than one of these keys are pressed xPFX ignores them all, so that
    data files are afx-packed (-afx-), but programs are pfx-packed (-lz5-).

NB: NeoDesk 4 appears to reserve ALL of the special keys at program launches,
    so do not then press the key until immediately after the launch command
    (drag-drop, double-click etc). NeoDesk loses interest in the keys as you
    complete the sequence, so you have the time until xPFX is loaded and run
    to press down the key you want. This works for me, but if you run xPFX
    from a RAM-disk you will need _very_ fast reflexes.

-----------------------------------------------------------------------------
End of xPFX description.
-----------------------------------------------------------------------------
xAFX Description:
-----------------------------------------------------------------------------

XAFX.PRG is the transparent unpacker which, when booted in auto-folder,
    makes the unpacking of data files fully automatic and transparent.

    xAFX == eXtended Automatic File eXtractor

    Its unpacking is identical to that of AFX.PRG, although most other
    parts of the program required (very) extensive debugging.

	-------------------------------------------------------------

    xAFX links into (replaces) several functions of GEMDOS, so as to be
    able to make the unpacking of packed files fully transparent.

    Thus, file sizes returned by Fsfirst/Fsnext will be the sizes that the
    files had before they were packed. Similarily Fseek will set the file
    position as if the file was unpacked, and likewise most file access
    functions (notably Fread, & Pexec) will access the original data.

    Fwrite is a special case, which causes the file to be unpacked before
    the write operation completes, whereafter the file remains unpacked.
    This means that afx-packing is not useful for files you often update.

    Note that xAFX does not alter any of the BIOS functions, so programs
    that use these (disk-copiers, Kobold, etc) will bypass xAFX completely.
    Kobold, for example, is the tool I use to backup application folders
    where most files are afx-packed, so they arrive without unpacking.
    (Desktop copying would deliver the unpacked files instead)

NB: NEVER mix the BIOS level of operation with the GEMDOS level, since this
    means that the data accessed does not fit your information about it.

Eg: If you calculate a files size by counting sectors in FAT (BIOS level),
    and reserve that amount of storage, then you cannot read the file using
    Fread until EOF (GEMDOS level), since that may overflow your buffer.
    Also remember that some GEMDOS file systems have no BIOS level at all !

	-------------------------------------------------------------

    The major bugs removed from original AFX were:

rev.A:
    1: AFX made erroneous TSR exits which often crashed system,
       which I have of course prevented in xAFX.

rev.A:
    2: AFX system RAM allocation routines never worked, which its author
       hid by increasing internal extra RAM > 200Kbyte.  In xAFX these bugs
       are removed, so the internal extra RAM is now reduced to 20 Kbyte.
   NB: AFX/xAFX really need dynamic system RAM allocation, so any TOS
   NB: older than TOS 1.4 is unsuitable with this kind of program.

rev.A:
    3: The AFX cookie had a control character (NUL) first in its name, which
       makes that cookie invisible to C-type string handlers. Only visible
       characters are legal so xAFX uses the cookie name 'xAFX'.
       (The cookie search in xPFX allows for both versions)

	-------------------------------------------------------------

rev.B:
    4: AFX never succeeded in the task of making use of packed files
       fully transparent, and some of the erroneous methods used were
       capable of crashing the system, and disks, completely.
       I have completely redesigned these parts of xAFX.

rev.B:
    5: AFX used almost no error checking in its internal file system,
       and much of what was there was erroneous.  I have corrected those
       errors, and added the missing checks everywhere except in the
       deepest unpacker routines, which would require a complete rewrite
       of all of them (I may do that later, if I have time).

rev.B:
    6: AFX did not protect against multiple booting, whereas xAFX refuses
       to boot more than once (with an error message if this is attempted).

	-------------------------------------------------------------

rev.B:
    xAFX is now able to make use of packed files fully transparent.
    All file operations made with xAFX in ether SHOW mode or PACKer mode
    will also update an extra file 'FILESIZE.AFX' as and when needed.
    (i.e: one such file in each folder that holds packed data files)
    That file is hidden by xAFX (except in PASSive mode), and its data
    used to bluff GEMDOS into accepting the original size of packed
    data files when xAFX is in SHOW mode.

NB: This scheme had been partially implemented in AFX, but was never fully
    functional. The bugs in that implementation were often fatal (bombed).

NB: Obviously, the extra file is only used for folders holding afx-files,
    and will automatically be deleted if all those afx-files are removed.

	-------------------------------------------------------------

rev.C:
    In revision "B" of xAFX the 'Fsnext' function made one small
    mistake.  In SHOW mode, when filesize info in the dta's should be
    the size of unpacked data, the filesize returned would sometimes
    be the packed size.  This would occur when some 'Fsnext' relating
    to another dta and path had reached the end of a folder, between
    the time of 'Fsfirst' and 'Fsnext' of the dta receiving the mistake.
    This was observed when desktop reported too short sums of sizes
    for folders holding both subfolders and packed data files.
    'Fsnext' has been corrected in revision "C", and should now always
    give the unpacked sizes when called in SHOW mode.

	-------------------------------------------------------------

rev.B:
    xAFX now has three modes of operation, as follows:
rev.E:
    No, xAFX now has four modes of operation, as follows:

	-------------------------------------------------------------

PASS mode behaves as if xAFX never booted, except that it is still
    possible to activate it by using either of the two programs
    AFX_SHOW.PRG and AFX_PACK.PRG.
rev.E:
    AFX_FAST.PRG can also be used to leave PASS mode.

    This mode is most useful when copying entire folders of data, since
    individual data files would be copied without their filesize info.
    The same kind of copying can also be done in other modes, by the use
    of programs that work entirely on the BIOS level, such as 'KoBold'.

    Use PASS mode also to turn xAFX off when errors are suspected,
    so that the disk can be inspected with original GEMDOS behaviour.

NB: This mode neither hides, nor updates any FILESIZE.AFX , so if you copy
    any individual afx-packed files in this mode, the new copies will not
    be size transparent even when SHOW mode is reactivated.

    Also, if you delete any afx-files in PASS mode, their entries in
    FILESIZE.AFX will remain. If you later wish to erase the folder involved
    you must set PASS mode again and erase the erroneous FILESIZE.AFX .

	-------------------------------------------------------------

PACK mode is the same one which is (temporarily) used automatically
    by the packer XPFX.PRG .  In this mode, no automatic unpacking of
    packed files will occur, and the file sizes returned by GEMDOS will
    represent storage on disk instead of unpacked data.
    xAFX does, however, still hide FILESIZE.AFX and updates it if
    needed during any file operations.

    PACK mode is useful for copying packed data files that are intended
    to arrive at the destination in their packed form, and with their
    filesize information added to that in FILESIZE.AFX .
    Similarily deleting, moving, renaming, etc. also updates FILESIZE.AFX .

    This is the best mode for copying individual packed files, without any
    unpacking, such that the new copy becomes size transparent in SHOW mode.
    Copying entire folders has the same effect, but is faster in PASS mode.

	-------------------------------------------------------------

SHOW mode is the default, activated during the booting of xAFX.PRG.
    All file operations of GEMDOS will in this mode access, or refer to,
    the original unpacked data, of any packed data files.
    All file operations will also update FILESIZE.AFX when needed.
    It will thus appear as if no files were packed, except for the fact
    that the sum of used and free room on disk seems too large.

NB: Remember that any afx-packed files copied in SHOW mode will
    arrive at their destination in the unpacked (expanded) form.

rev.E:
NB: The speed of SHOW mode has been improved considerably.  Try it !!!

	-------------------------------------------------------------

rev.E:
FAST mode is a later addition which unpacks files automatically, just like
    SHOW mode does.  It also updates any FILESIZE.AFX as and when needed.
    The difference is that file sizes of packed data files will not be
    expanded to original sizes in the calls to gemdos function 'Fsnext'.
    The calls to Fsfirst, however, work just like in SHOW mode.
    Thus FAST mode will have better speed in searching with wildcards, so
    desktop directory windows will update faster, but with packed filesizes.

NB: Programs that need to know files sizes before using them will not work
    in FAST mode if they search for the files with Fsnext.

    In case you find any application allergic to this mode, please report
    this to me asap.  To run such applications, simply use SHOW mode instead,
    it is no longer as slow as in all previous versions.

rev.H:
    I do not recommend using FAST mode anymore, since the speed gain is
    too small to be worth sacrificing correct file size information.
    I never use it myself, but will let it remain in case anybody likes it.

	-------------------------------------------------------------

rev.B:
    The modes of xAFX can be controlled in 3 different ways:

 1: Simply leave xAFX in the default (SHOW) mode, and forget worries.
    Everything you do, and all files you create, will be as without xAFX,
    except that you are free to use packed files as if they were unpacked.
    (Except with programs operating at bios level, such as 'Kobold'.)
    The packer xPFX.PRG will switch modes automatically when packing,
    so you don't have to bother about modes unless you want to.

 2: Use the four support programs AFX_xxxx.PRG to activate needed modes.
    These tools are intended only for xAFX, and won't work with the old AFX.
    One reason to use them is when copying packed data files, since it will
    be the unpacked data which is copied otherwise.
NB: Remember to reactivate SHOW mode before using packed files.

 3: Use a special mechanism created in support of BBS systems that do not
    allow external programs to be called (eg: Michtron).
    The GEMDOS command Frename will under xAFX interpret new mode commands
    if the first parameter to Frename (old_name) is AFXSTATE.AFX, and the
    second parameter (new_name) is AFX_xxxx.AFX, where xxxx represents the
    specific command to be used.
    As yet only the three commands PASS, PACK, and SHOW exist, and have
    the same effect as running the corresponding programs mentioned above.
    Any path info of these 'pseudo' names is irrelevant (ignored), and so
    it doesn't matter if you even have any file named AFXSTATE.AFX or not,
    although some shells refuse to give the command if you do not.
    Frename returns without error (d0=0) after special commands.

rev.E:
    Well, since a new mode has been added, there is now a fourth command
    This is of course 'FAST', and activates the corresponding mode.
    Thus, using parameter 'AFX_FAST.AFX', as above, has the same result as
    running the new tool program 'AFX_FAST.PRG' .

	-------------------------------------------------------------

rev.D:
    In rearranging the entire structure of xAFX, I accidentally placed
    installation routine for cookie jar (for old TOS) before the release
    of RAM which that routine needs.  This error was hidden by another
    boot utility which created a cookie jar before xAFX was started.
    I have cured the bug, and will make future tests both with, and
    without, the above mentioned utility.
    From now on, I will also test xAFX under TOS 1.0 as well as those
    used with previous revisions (TOS 1.4, TOS 2.6, and MultiTOS).
    This is to guarantee compatibility, though I strongly discourage
    continued general use of the ancient and bugridden TOS 1.0 .

	-------------------------------------------------------------

    AFX also used inefficient routines for many things, which slowed the
    system down even when no unpacking was being done.
    Many such routines have been completely rewritten for xAFX.
    There remains some work to be done on these routines, since they still
    slow down MultiTOS considerably (normal TOS is less affected).

rev.E:
    This revision implements significant speedups in these routines, so that
    little (if any) slowdown  should be noticeable in operations that do not
    involve packed files.  Even operations that do involve packed files will
    be faster now, though they will always have some delaying effect.
    On floppy though, it should now act as a speeder, since the unpacking
    delays should be less than the time saved in loading fewer sectors.

	-------------------------------------------------------------

rev.H:
    The gemdos call "Pexec" has been implemented in xAFX, to allow running
    programs that are packed as AFX files.  These will be able to run in
    any of the modes except PASS mode, but if they need any RSC files that
    are also packed you must use SHOW mode or FAST mode.

NB: The AFX-packed program files can only be used with a modern TOS.
    They will work with TOS 1.4 or any later TOS.
    With other (obsolete) TOS versions there will be an error message.

	-------------------------------------------------------------

rev.I:
    The size of the internal RAM area, used for xAFX buffers, may now be set
    by the user in either of two ways.

    1: Rename XAFX.PRG to XAFX_nnn.PRG; where "nnn" represents the number of
       kilobytes you want for the buffers (default is 20).
       Thus:	XAFX_20.PRG uses 20 kilobyte, just like XAFX.PRG,
       but:	XAFX_512.PRG uses half a megabyte. (rather extreme! :-)

    2: Boot XAFX with a batch utility that can start it with command line
       argument specifying the number of kilobytes to be used.
       ( ASASTART.PRG by Anders Holmberg is excellent at this (and more!))

    If these methods are combined, the command line value will be used.

    Values greater than 20 Kbyte are only needed when many xAFX files must
    be open while some obsolete program hogs all system RAM (Illegal!!!).
    DevPac_3, for example, hogs all RAM during assemblies, causing errors
    if multi-level include-files (in AFX format) are used with xAFX rev.H.

    In such situations you will need appx. 8.5 Kbytes extra buffer area for
    each additional simultaneously open file.
    I myself, for example, use xAFX_64.PRG which lets me do all my program
    development (multi-linked files) without problems, even in MultiTOS.

	-------------------------------------------------------------

rev.J:
    This revision does not make any significant changes in xAFX.
    The revision code is updated to show the relationship to xPFX.

	-------------------------------------------------------------

rev.K:
    xAFX unaltered from rev.J, except for revision number & date.

    I currently use xAFX , successfully, in several different multitasking
    environments as specified below:

    MultiTOS  Version 1.08
    MagiX     Version 2.01  with  MagXDesk, Ease, or NeoDesk 4
    Geneva    Release 003   with  NeoDesk 4

NB: MagiX has an erroneous implementation of Supexec, that does not allow
    arguments to be passed on the stack (as all Atari versions do).
    This bug can be fixed by including my program SUPX.PRG in the auto
    folder, to link a new Supexec routine which is fully compatible to
    the routines by Atari but also reentrant like the MagiX routine.

	-------------------------------------------------------------

    I have now redesigned the entire program, apart from the unpacker
    kernel, and the data structures it requires.
    I plan to do that too at some later time, but for the present I have
    at least rendered the program fairly safe and efficient to use.

-----------------------------------------------------------------------------
End of xAFX description.
-----------------------------------------------------------------------------
xAFX support programs:
-----------------------------------------------------------------------------

AFX_PASS.PRG	== TOS program to turn xAFX to PASSive mode \  / These modes
AFX_PACK.PRG	== TOS program to turn xAFX to PACKer mode   \/  are explained
AFX_FAST.PRG	== TOS program to turn xAFX to FAST mode     /\  above
AFX_SHOW.PRG	== TOS program to turn xAFX to SHOW mode    /  \

These four programs simply switch xAFX into the corresponding modes.
They may be run either from desktop or from other programs.
No arguments are needed and if any are given they will be ignored.

They use no GEM features, and likewise neither keyboard nor screen,
and they have no effect at all if run without xAFX booted.
The only reason they are named '.PRG', instead of '.TOS', is that
they thus avoid the window manager (MW.PRG) of MultiTOS.

-----------------------------------------------------------------------------
Simple installation guide:
-----------------------------------------------------------------------------

Only 2 of the programs need installation, done by storage in the auto-folder.

'SUPX.PRG' (hereafter termed SupX) is only needed to fix a bug in MagiX,
so if you do not intend to use MagiX you do not need to install it.

'XAFX.PRG' (hereafter termed xAFX) the automatic file extractor is needed
to use the packed file system described in other sections of this document.
You do not need it to use xPFX to pack selfextracting programs.

If you install both SupX and xAFX, remember that SupX must come before xAFX
in the boot sequence, so as to fix the MagiX bug before xAFX runs.

If any device drivers, disk cache etc, are used, xAFX should run after those.
This is to make sure that xAFX can function properly with all gemdos devices.

xAFX uses both cookie-jar and XBRA vectors as recommended by Atari, but some
other programs do not (quite a lot actually...).
Any such non-standard program can break the older XBRA chains when it boots,
so booting suspect programs before safe ones maintains the chains best.

NB: To work with MultiTOS, xAFX must boot before MiNT.

NB: Universal Item Selector version 3.3 smashes 3 XBRA chains, but not the
    'gemdos' chain used by XAFX, so it may boot before or after XAFX.

NB: I strongly recommend the excellent file selector SLECTRIC.PRG, which
    follows Atari's recommendations for use of XBRA and cookie jar.
    It also allows full keyboard control of all selection operations,
    which makes it ideal for multiple file packing with xPFX.
    Do make sure you get 'Selectric V1.02' or later, since older versions
    did have some compatibility problems with various other programs.

-----------------------------------------------------------------------------
How to reach me:
-----------------------------------------------------------------------------

Although I do not promise any support whatsoever, since my part in this is
on a freeware basis, I normally enjoy being helpful to reasonable requests.
In case you have any questions or problems you can always try to reach me
by ordinary snailmail at this address:

	Ronald Andersson
	H”ders V„g 7
	145 70  Norsborg
	Sweden

In case you lost the swedish characters in that street address, you can also
use either of the alternative spellings below:

	Hoders Vag 7		(closest spelling)
or
	Hoeders Vaeg 7		(closest sound)

-----------------------------------------------------------------------------
	
Finally,I hope you will all find these programs as useful as I have !

-----------------------------------------------------------------------------
End of file:	PFXAFX.DOC
-----------------------------------------------------------------------------
