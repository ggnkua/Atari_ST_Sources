; JEK UNPACK
;
; A0 = FROM (END OF CMP)
; A1 = TO

	opt	p+

UNPACK	MOVE.W	$FF8240,D7
	MOVE.L	-(A0),D5
	MOVE.L	-(A0),D0
	MOVE.L	A1,A2
	ADD.L	D0,A2
	MOVE.L	-(A0),D5
	MOVE.L	-(A0),D0
	EOR.L	D0,D5
L1	NOT.W	$FF8240
	LSR.L	#1,D0
	BNE.S	L2
	BSR	L14
L2	BCS.S	L9
	MOVEQ	#8,D1
	MOVEQ	#1,D3
	LSR.L	#1,D0
	BNE.S	L3
	BSR	L14
L3	BCS.S	L11
	MOVEQ	#3,D1
	CLR.W	D4
L4	BSR	L15
	MOVE.W	D2,D3
	ADD.W	D4,D3
L5	MOVEQ	#7,D1
L6	LSR.L	#1,D0
	BNE.S	L7
	BSR	L14
L7	ROXL.L	#1,D2
	DBF	D1,L6
	MOVE.B	D2,-(A2)
	DBF	D3,L5
	BRA	L13
L8	MOVEQ	#8,D1
	MOVEQ	#8,D4
	BRA.S	L4
L9	MOVEQ	#2,D1
	BSR	L15
	CMP.B	#2,D2
	BLT.S	L10
	CMP.B	#3,D2
	BEQ.S	L8
	MOVEQ	#8,D1
	BSR	L15
	MOVE.W	D2,D3
	MOVE.W	#$C,D1
	BRA	L11
L10	MOVE.W	#9,D1
	ADD.W	D2,D1
	ADDQ.W	#2,D2
	MOVE.W	D2,D3
L11	BSR	L15
L12	SUBQ.W	#1,A2
	MOVE.B	0(A2,D2.W),(A2)
	DBF	D3,L12
L13	CMPA.L	A2,A1
	BLT	L1
	MOVE.W	D7,$FF8240
	RTS
L14	MOVE.L	-(A0),D0
	EOR.L	D0,D5
	MOVE.B	#$10,CCR
	ROXR.L	#1,D0
	RTS
L15	SUBQ.W	#1,D1
	CLR.W	D2
L16	LSR.L	#1,D0
	BNE.S	L17
	MOVE.L	-(A0),D0
	EOR.L	D0,D5
	MOVE.B	#$10,CCR
	ROXR.L	#1,D0
L17	ROXL.L	#1,D2
	DBF	D1,L16
	RTS
