;*************************************************************************
;
;                          THE FACE IN THE ABYSS
;
;*************************************************************************
;
; Code'n Gfxs by Zappy/Holocaust
; Les rasters ont ÇtÇ programmÇs pendant la Snork 1. C'est vous dire s'il
; sont VIEUX.
; Le zoom est plus rÇcent, mais bof.
; Les sprites, j'en parle meme pas.
;
; Le code n'est pas vraiment gÇnial... j'ai honte de certains passages de
; ce source!!! Ouarg!

NB_DECAL	EQU	8
NB_DEC	EQU	1
PAS	EQU	15*6

	SECTION TEXT
DEBUT:	MOVE.L  A7,A5
	LEA.L 	D_PILE,A7
	MOVE.L 	4(A5),A5
	MOVE.L 	$C(A5),D0
	ADD.L 	$14(A5),D0
	ADD.L 	$1C(A5),D0
	ADD.L 	#$100,D0	
	MOVE.L 	D0,-(SP)	
	MOVE.L 	A5,-(SP)
	MOVE.W 	#0,-(SP)
	MOVE.W 	#$4A,-(SP)
	TRAP 	#1
	LEA 	12(SP),SP
	
	PEA	0.W
	MOVE.W 	#$20,-(SP)
	TRAP 	#1
	ADDQ.L 	#6,SP
	MOVE.L 	D0,SAUVE

	LEA	DEB_BSS,A0
EFF_BSS	CLR.L	(A0)+
	CMP.L	#END_BSS,(A0)
	BLE.S	EFF_BSS

	MOVEQ	#1,D0
	JSR	ZIK

	MOVE.L	#8,NB_PART

	move.l	#BUFFER,d0
	CLR.B	D0
	move.l	d0,SCREEN1
	add.l	#32000,d0
	move.l	d0,SCREEN2

	MOVE.L	#TB0_IR,PNT
	ADD.L	#$14,PNT
	MOVE.L	#226,D0
	LEA	TB0_IR,A1
	
DO_TIM	LEA	DATA_RAST,A0
	
	MOVE	(A0)+,(A1)+
	MOVE.L	PNT,(A1)+
	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	MOVE	(A0)+,(A1)+
	ADD.L	#$14,PNT
	DBF	D0,DO_TIM

	CLR.L	POINTEUR

	CLR.L	TPS

	MOVE.L #MES_F3,MES_PNT3

	MOVE.L	#FIN,$008.W
	MOVE.L	#FIN,$00C.W
	MOVE.L	#FIN,$010.W
		
	JSR	SET_SCR
	
	CLR.L	PLUS
	MOVE.L	#15,D3

O2	MOVEA.L #DATA,A4
	JSR PREDECALE
	MOVEA.L #DATA,A0
	LEA	BUF1,A1
	ADDA.L	PLUS,A1

	MOVE.L	#7,D1
P2	MOVE.L	#3,D0
L2	MOVE.L	(A0)+,(A1)+
	DBF	D0,L2
	MOVEA.L #DATA,A0
	DBF	D1,P2
	
	MOVE.L	PLUS,D4
	ADD.L	#128,D4
	MOVE.L	D4,PLUS

	DBF	D3,O2

	MOVEA.L #DATA,A0
	LEA   MASQ,A1
	MOVE.L  #15,D7
QS1     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS1

	LEA   BUF1,A0
	LEA   MASQ2,A1
	MOVE.L  #15,D7
QS2	MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS2

	LEA   BUF2,A0
	LEA   MASQ3,A1
	MOVE.L  #15,D7
QS3	MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS3

	LEA   BUF3,A0
	LEA   MASQ4,A1
	MOVE.L  #15,D7
QS4	MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS4

	LEA   BUF4,A0
	LEA   MASQ5,A1
	MOVE.L  #15,D7
QS5	MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS5

	LEA   BUF5,A0
	LEA   MASQ6,A1
	MOVE.L  #15,D7
QS6     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS6

	LEA   BUF6,A0
	LEA   MASQ7,A1
	MOVE.L  #15,D7
QS7     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS7

	LEA   BUF7,A0
	LEA   MASQ8,A1
	MOVE.L  #15,D7
QS8     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS8

	LEA   BUF8,A0
	LEA   MASQ9,A1
	MOVE.L  #15,D7
QS9     MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS9

	LEA   BUF9,A0
	LEA   MASQ10,A1
	MOVE.L  #15,D7
QS10    MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS10

	LEA   BUF10,A0
	LEA   MASQ11,A1
	MOVE.L  #15,D7
QS11    MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
       DBF D7,QS11

	LEA   BUF11,A0
	LEA   MASQ12,A1
	MOVE.L  #15,D7
QS12    MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS12

	LEA   BUF12,A0
	LEA   MASQ13,A1
	MOVE.L  #15,D7
QS13    MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS13

	LEA   BUF13,A0
	LEA   MASQ14,A1
	MOVE.L  #15,D7
QS14    MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS14

	LEA   BUF14,A0
	LEA   MASQ15,A1
	MOVE.L  #15,D7
QS15    MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS15

	LEA   BUF15,A0
	LEA   MASQ16,A1
	MOVE.L  #15,D7
QS16    MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS16

	LEA   BUF16,A0
	LEA   MASQ17,A1
	MOVE.L  #15,D7
QS17    MOVE.W  (A0),D0
	MOVE.W  2(A0),D1
	MOVE.W  4(A0),D2
	MOVE.W  6(A0),D3
	OR.W	D0,D1
	OR.W	D1,D2
	OR.W	D2,D3
	MOVE	D3,(A1)
	MOVE	D3,2(A1)
	MOVE	D3,4(A1)
	MOVE	D3,6(A1)
	LEA     8(A1),A1
	LEA     8(A0),A0
	DBF D7,QS17

	LEA   MASQ,A1 
	MOVE.L  #544,D7       * 264*16=1184
QSS     NOT.L  (A1)+
	DBF D7,QSS

	MOVE.W	#4,-(SP)
	TRAP 	#14
	ADDQ.L	#2,SP
	MOVE.W	D0,RES
	
	MOVE.W	#2,-(SP)
	TRAP 	#14
	ADDQ.L 	#2,SP
	MOVE.L	D0,ANC_ECR
	
	MOVE.W 	#0,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.W 	#5,-(SP)
	TRAP 	#14
	LEA.L 	12(SP),SP

	LEA.L	$FFFF8240.W,A0
	MOVEM.L	(A0),D0-D7
	LEA.L	ANC_PAL,A0
	MOVEM.L	D0-D7,(A0)
	
	MOVE.L	$70,ANC_VBL
	MOVE.L	#VBLR_WAIT,$70
	MOVE.L	$120,ANC_TB
	MOVE.L	#TB0_IR,$120

	MOVE.B	$FFFFFA07.W,MFP1
	MOVE.B	$FFFFFA09.W,MFP2
	MOVE.B	$FFFFFA0F.W,MFP3
	MOVE.B	$FFFFFA13.W,MFP4
	MOVE.B	$FFFFFA1B.W,MFP5
	MOVE.B	$FFFFFA21.W,MFP6
	MOVE.B	$FFFFFA15.W,MFP7
	MOVE.B	$FFFFFA17.W,MFP8
	MOVE.B	$FFFFFA19.W,MFP9
	MOVE.B	$FFFFFA1F.W,MFP10

	MOVE.L	$68.W,SAUVE_HBL
	MOVE.L	$134.W,SAUVE_TMA
	MOVE.L	#INTER_RTE,$68.W

	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W
	CLR.B	$FFFFFA13.W
	CLR.B	$FFFFFA15.W
	
	DC.W	$A00A
	MOVE.B	#$12,$FFFFFC02.W
	
	CLR.B	$FFFFFA1B.W
	BSET	#0,$FFFFFA07.W
	BSET	#0,$FFFFFA13.W
	ANDI.B	#%11111000,$484.W

	MOVEA.L	SCREEN1,A1
	JSR	EFFACE
	
	MOVEA.L	SCREEN1,A1
	LEA	79*160(A1),A1
	LEA	TXT,A0
	JSR	INTERLUDE
	MOVEA.L	SCREEN1,A1
	LEA	(79+22)*160(A1),A1
	LEA	TXT,A0
	LEA	800(A0),A0
	JSR	INTERLUDE

	MOVE.L	#VBL_FAD,$70.W
BVC	CMPI.L	#0,FLAG_FAD
	BEQ.S	BVC
	CLR.L	PNT_FAD
	CLR.L	PNT_FAD2
	MOVE.L	#VBL_FAD2,$70.W
	CLR.L	FLAG_FAD
ABVC	CMPI.L	#0,FLAG_FAD
	BEQ.S	ABVC
	
	MOVE.L	#VBLR_WAIT,$70.W
	MOVEA.L	SCREEN1,A0
	JSR	EFFACE
	MOVE.L	#VBL_IR,$70.W

BOUCLE	CMPI.L	#0,PART_
	BEQ.S	BOUCLE
	MOVE.L	#VBLR_WAIT,$70.W
	move.l	#BUFFER,d0
	CLR.B	D0
	move.l	d0,SCREEN1
	add.l	#64000,d0
	move.l	d0,SCREEN2

	MOVEA.L	SCREEN1,A0
	JSR	EFFACE
	JSR	EFFACE
	
	MOVEA.L	SCREEN2,A0
	JSR	EFFACE
	JSR	EFFACE
	
	MOVEA.L	SCREEN1,A1
	LEA	79*160(A1),A1
	LEA	TXT,A0
	LEA	800*2(A0),A0
	JSR	INTERLUDE

	CLR.L	PNT_FAD
	CLR.L	PNT_FAD2
	CLR.L	FLAG_FAD
	
	MOVE.L	#VBL_FAD,$70.W
BVCG	CMPI.L	#0,FLAG_FAD
	BEQ.S	BVCG

	MOVE.L	#1,X_VALUE_ZOOM
	LEA	IMG,A0
	LEA	BUF_ZOOM_DAT,A1
	JSR	decrunch
	LEA	IMG2,A0
	LEA	BUF_ZOOM_DAT2,A1
	JSR	decrunch

	CLR.L	PNT_FAD
	CLR.L	PNT_FAD2
	MOVE.L	#VBL_FAD2,$70.W
	CLR.L	FLAG_FAD
ABVCG	CMPI.L	#0,FLAG_FAD
	BEQ.S	ABVCG
	
	MOVE.L	#VBLR_WAIT,$70.W

	MOVEA.L	SCREEN1,A0
	JSR	EFFACE
	
	MOVE.L	#VBLR_ZOOM,$70.W
BOUCLE2	CMPI.B	#$39,$FFFFFC02.W
	BNE.S	BOUCLE2

	MOVE.L	#VBLR_WAIT,$70.W

	move.l	#BUFFER,d0
	CLR.B	D0
	move.l	d0,SCREEN1
	add.l	#32000,d0
	move.l	d0,SCREEN2

	move.l	SCREEN1,d0
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)

	MOVEA.L	SCREEN1,A0
	JSR	EFFACE
	MOVEA.L	SCREEN2,A0
	JSR	EFFACE
	
	MOVEA.L	SCREEN1,A1
	LEA	79*160(A1),A1
	LEA	TXT,A0
	LEA	800*3(A0),A0
	JSR	INTERLUDE
	MOVEA.L	SCREEN1,A1
	LEA	(79+22)*160(A1),A1
	LEA	TXT,A0
	LEA	800*4(A0),A0
	JSR	INTERLUDE
	CLR.L	PNT_FAD
	CLR.L	PNT_FAD2
	CLR.L	FLAG_FAD

	MOVE.L	#VBL_FAD,$70.W
BVCQ	CMPI.L	#0,FLAG_FAD
	BEQ.S	BVCQ

	LEA	PIC,A0
	LEA	DECRUNCHED,A1
	JSR	decrunch
	LEA	DECRUNCHED+34+120,A0
	JSR	PREDECALET
	LEA	COURB,A0
	LEA	FIN_CRB,A1
	MOVE.L	-12(A1),-12(A0)
	MOVE.L	-8(A1),-8(A0)
	MOVE.L	-4(A1),-4(A0)	
	MOVE.W	#((PAS/6)*8)-2,D7
RECOP1	MOVE.L	(A0)+,(A1)+
	MOVE.W	(A0)+,(A1)+
	DBRA	D7,RECOP1
	MOVE.L	#-1,(A1)

	MOVE.L	#COURB,PNT_CRB

	CLR.L	PNT_FAD
	CLR.L	PNT_FAD2
	MOVE.L	#VBL_FAD2,$70.W
	CLR.L	FLAG_FAD
ABVCQ	CMPI.L	#0,FLAG_FAD
	BEQ.S	ABVCQ
	MOVE.L	#VBLR_WAIT,$70.W
	JSR	MAK_COD
	MOVE.L	SCREEN1,A0
	JSR	EFFACE
	MOVE.L	SCREEN2,A0
	JSR	EFFACE

	MOVEM.L	DECRUNCHED+2,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	MOVE.L	#VBL_SPR,$70.W
BOUCLE3	JMP	BOUCLE3
VBL_FAD	SF	$FFFF8240.W
	MOVEM.L	D0-A6,-(SP)
	move.l	SCREEN1,d0
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)

	JSR	ZIK+6
	LEA	FAD,A0
	ADDA.L	PNT_FAD,A0
	CMPI.B	#-1,(A0)
	BNE.S	NOIU
	MOVE.L	#1,FLAG_FAD
	JMP	POPO
NOIU	ADDQ.L	#1,PNT_FAD2
	CMPI.L	#5,PNT_FAD2
	BNE.S	POPO
	CLR.L	PNT_FAD2
	ADDQ.L	#2,PNT_FAD
	MOVE	(A0),$FFFF8242.W
POPO	MOVEM.L	(SP)+,D0-A6
	RTE
VBL_FAD2	SF	$FFFF8240.W
	MOVEM.L	D0-A6,-(SP)
	move.l	SCREEN1,d0
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)

	JSR	ZIK+6
	LEA	FAD2,A0
	ADDA.L	PNT_FAD,A0
	CMPI.B	#-1,(A0)
	BNE.S	NOIUA
	MOVE.L	#1,FLAG_FAD
	JMP	POPOA
NOIUA	ADDQ.L	#1,PNT_FAD2
	CMPI.L	#5,PNT_FAD2
	BNE.S	POPOA
	CLR.L	PNT_FAD2
	ADDQ.L	#2,PNT_FAD
	MOVE	(A0),$FFFF8242.W
POPOA	MOVEM.L	(SP)+,D0-A6
	RTE

SCROLL	MOVE.L	ADRTXT,A6
	LEA	-2(A6),A6
	LEA	BUF_LET,A1
	REPT	8
	ROXL	(A1)
	ROXL	154(A6)
	ROXL	146(A6)
	ROXL	138(A6)
	ROXL	130(A6)
	ROXL	122(A6)
	ROXL	114(A6)
	ROXL	106(A6)
	ROXL	98(A6)
	ROXL	90(A6)
	ROXL	82(A6)
	ROXL	74(A6)
	ROXL	66(A6)
	ROXL	58(A6)	
	ROXL	50(A6)
	ROXL	42(A6)
	ROXL	34(A6)
	ROXL	26(A6)
	ROXL	18(A6)
	ROXL	10(A6)
	ROXL	2(A6)
	LEA	160(A6),A6
	ADDQ.L	#2,A1
	ENDR
	ADDI.L	#1,NB_PART
	RTS

TEST_LET	MOVEQ	#0,D0
	LEA	TEXT1,A6	
	ADDA.L	POINT2,A6
	LEA	FONT8_8,A1
	CMPI.B	#$FF,(A6)
	BNE	SUITTST
	CLR.L	POINT2
	LEA	TEXT1,A6
SUITTST	MOVE.B	(A6),D0	
	SUBI.B	#32,D0	
	LSL.W	#3,D0	
	ADDA.L	D0,A1	
	LEA	BUF_LET,A2
	MOVE.B	(A1)+,(A2)
	MOVE.B	(A1)+,2(A2)
	MOVE.B	(A1)+,4(A2)
	MOVE.B	(A1)+,6(A2)
	MOVE.B	(A1)+,8(A2)
	MOVE.B	(A1)+,10(A2)
	MOVE.B	(A1)+,12(A2)
	MOVE.B	(A1)+,14(A2)
	ADDI.L	#1,POINT2
	RTS

	

VBL_IR
	CLR.B	$FFFFFA1B.W

	
	LEA	BUFFER_RAST,A0	3
	MOVEQ	#0,D0	1
	MOVEQ	#0,D1	1
	MOVEQ	#0,D2	1
	MOVEQ	#0,D3	1
	MOVEQ	#0,D4	1
	MOVEQ	#0,D5	1
	MOVEQ	#0,D6	1
	MOVEQ	#0,D7	1
	MOVEM.L	D0-D7,(A0)	18
	MOVEM.L	D0-D7,4*8(A0)	19
	MOVEM.L	D0-D7,4*8*2(A0)	19
	MOVEM.L	D0-D7,4*8*3(A0)	19
	MOVEM.L	D0-D7,4*8*4(A0)	19
	MOVEM.L	D0-D7,4*8*5(A0)	19
	MOVEM.L	D0-D7,4*8*6(A0)	19
	MOVEM.L	D0-D7,4*8*7(A0)	19
	MOVEM.L	D0-D7,4*8*8(A0)	19
	MOVEM.L	D0-D7,4*8*9(A0)	19
	MOVEM.L	D0-D7,4*8*10(A0)	19
	MOVEM.L	D0-D7,4*8*11(A0)	19

	MOVEM.L	D0-D7,4*8*12(A0)	19
	MOVEM.L	D0-D7,4*8*13(A0)	19


	MOVEM.L	D0-D3,4*8*14(A0)	11
;	T=249

	CLR	D1	1
	LEA	BARRE,A2	3
	LEA	BUFFER_RAST,A0	3
	LEA	Y_DAT,A1	3
	ADDA.L	POINTEUR,A1	6

	CMPI.B	#-1,80(A1)	4
	BNE.S	OK2	3/2
	CLR.L	POINTEUR	7
	LEA	Y_DAT,A1	3
	BRA.S	OK	3
OK2	DCB	12,$4E71

OK	MOVE.B	(A1),D1	2
	LSL	#1,D1	2
	ADD	D1,A0	2
	
;	MOVEM.L	(A2),D0-D7/A1/A3-A6	29
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)	28
	MOVEM.L	(A2),D0-D7	20
	MOVEM.L	D0-D7,(A0)	19		29+28+2
;	T=137
	
	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+3,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)
;	MOVEM.L	52(A2),D0-D7
;	MOVEM.L	D0-D7,52(A0)
;	T=118

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+6,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)


	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+9,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+12,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+15,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+18,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+21,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+24,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+27,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+30,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+33,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+36,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)

	CLR	D1
	LEA	BARRE,A2
	LEA	BUFFER_RAST,A0
	LEA	Y_DAT+39,A1
	ADDA.L	POINTEUR,A1
	MOVE.B	(A1),D1
	LSL	#1,D1
	ADD	D1,A0
;	MOVEM.L	(A2),D0-D7/A1/A3-A6
;	MOVEM.L	D0-D7/A1/A3-A6,(A0)
	MOVEM.L	(A2),D0-D7
	MOVEM.L	D0-D7,(A0)


	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+42,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59

	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59

	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*2,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*3,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59

	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*4,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*5,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*6,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*7,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*8,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*9,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
	moveq	#0,D1		
	LEA	BARRE,A2	
	LEA	BUFFER_RAST,A0	
	LEA	Y_DAT+45+3*10,A1	
	ADDA.L	POINTEUR,A1	
	MOVE.B	(A1),D1		
	LSL	#1,D1		
	ADD	D1,A0		
	MOVEM.L	(A2),D0-D7	
	MOVEM.L	D0-D7,(A0)	
;			T=59
;	moveq	#0,D1		
;	LEA	BARRE,A2	
;	LEA	BUFFER_RAST,A0	
;	LEA	Y_DAT+45+3*11,A1	
;	ADDA.L	POINTEUR,A1	
;	MOVE.B	(A1),D1		
;	LSL	#1,D1		
;	ADD	D1,A0		
;	MOVEM.L	(A2),D0-D7	
;	MOVEM.L	D0-D7,(A0)	
;			T=59



	LEA	BUFFER_RAST,A0
	ADD.L	#1,POINTEUR	9

;	TF=1940-8
	DCB	3088-11*59,$4E71
	
;	SF	$FFFF8240.W
	
	
	MOVE.B	#0,$FFFF820A.W
	DCB	18,$4E71
	MOVE.B	#2,$FFFF820A.W


	ADDQ.L	#1,TPS
	CMPI.L	#40,TPS
	BPL.S	GNAGNA

	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVEM.L	D0-D7,$FFFF8240.W
	BRA.S	PAS_COUL

GNAGNA  

	MOVEM.L	PALET,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	MOVE.B	#1,$FFFFFA21.W
	MOVE.B	#8,$FFFFFA1B.W

PAS_COUL
;	CMPI.B  #$3B,$FFFFFC02.W
;	BEQ.S LM
;	BRA.S LK
;LM	MOVE.W  #$777,$FFFF8240.W
;
;LK	CMPI.B	#$3C,$FFFFFC02.W
;	BEQ	OOPS





	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
INC	SET	0
	REPT	8
	MOVEM.L	D0-D7,INC(A6)
	MOVEM.L	D0-D7,INC+32(A6)
	MOVEM.L	D0-D7,INC+64(A6)
	MOVEM.L	D0-D7,INC+96(A6)
	MOVEM.L	D0-D7,INC+128(A6)
	MOVEM.L	D0-D1,INC+150(A6)
INC	SET	INC+160
	ENDR

	CLR.L	AUGMENTATION
	MOVEQ	#7,D7


PAR_ICI MOVEQ   #0,D1		*1
	MOVEA.L	MES_PNT3,A2	*5
	CMPI.B	#-1,4816(A2)	*4
	BEQ	 AGAIN3		*2 SI FAUX
			*3 SI OUI
	MOVE.L  (A2)+,KLM	*7
	MOVE.L  (A2)+,KLM2	*7
	MOVE.L  (A2)+,X_VALUE	*7
	MOVE.L  (A2)+,Y_VALUE	*7

	MOVE.L  320(A2),KLMB	*7
	MOVE.L  324(A2),KLM2B	*7
	MOVE.L  328(A2),X_VALUEB	*7

	MOVE.L  640(A2),KLMC	*7
	MOVE.L  644(A2),KLM2C	*7
	MOVE.L  648(A2),X_VALUEC	*7

	MOVE.L  960(A2),KLMD	*7
	MOVE.L  964(A2),KLM2D	*7
	MOVE.L  968(A2),X_VALUED	*7

	MOVE.L  1280(A2),KLME	*7
	MOVE.L  1284(A2),KLM2E	*7
	MOVE.L  1288(A2),X_VALUEE	*7

	MOVE.L  1600(A2),KLMF	*7
	MOVE.L  1604(A2),KLM2F	*7
	MOVE.L  1608(A2),X_VALUEF	*7

	MOVE.L  1920(A2),KLMG	*7
	MOVE.L  1924(A2),KLM2G	*7
	MOVE.L  1928(A2),X_VALUEG	*7

	MOVE.L  2240(A2),KLMH	*7
	MOVE.L  2244(A2),KLM2H	*7
	MOVE.L  2248(A2),X_VALUEH	*7

	MOVE.L  2560(A2),KLMI	*7
	MOVE.L  2564(A2),KLM2I	*7
	MOVE.L  2568(A2),X_VALUEI	*7

	MOVE.L  2880(A2),KLMJ	*7
	MOVE.L  2884(A2),KLM2J	*7
	MOVE.L  2888(A2),X_VALUEJ	*7

	MOVE.L  3200(A2),KLMK	*7
	MOVE.L  3204(A2),KLM2K	*7
	MOVE.L  3208(A2),X_VALUEK	*7

	MOVE.L  3520(A2),KLML	*7
	MOVE.L  3524(A2),KLM2L	*7
	MOVE.L  3528(A2),X_VALUEL	*7

	MOVE.L  3840(A2),KLMM	*7
	MOVE.L  3844(A2),KLM2M	*7
	MOVE.L  3848(A2),X_VALUEM	*7

	MOVE.L  4160(A2),KLMN	*7
	MOVE.L  4164(A2),KLM2N	*7
	MOVE.L  4168(A2),X_VALUEN	*7

	MOVE.L  4480(A2),KLMO	*7
	MOVE.L  4484(A2),KLM2O	*7
	MOVE.L  4488(A2),X_VALUEO	*7

	MOVE.L  4800(A2),KLMP	*7
	MOVE.L  4804(A2),KLM2P	*7
	MOVE.L  4808(A2),X_VALUEP	*7





	MOVE.L	A2,MES_PNT3
	REPT	11
	NOP
	ENDR

	BRA   LA_SUITE3	*3

	*= 46+2

AGAIN3	MOVE.L	#MES_F3,MES_PNT3	*7
	MOVEQ   #0,D1		*1
	MOVEA.L	MES_PNT3,A2	*5
	*3 SI OUI
	*3 SI OUI
	MOVE.L  (A2)+,KLM	*7
	MOVE.L  (A2)+,KLM2	*7
	MOVE.L  (A2)+,X_VALUE	*7
	MOVE.L  (A2)+,Y_VALUE	*7

	MOVE.L  320(A2),KLMB	*7
	MOVE.L  324(A2),KLM2B	*7
	MOVE.L  328(A2),X_VALUEB	*7

	MOVE.L  640(A2),KLMC	*7
	MOVE.L  644(A2),KLM2C	*7
	MOVE.L  648(A2),X_VALUEC	*7

	MOVE.L  960(A2),KLMD	*7
	MOVE.L  964(A2),KLM2D	*7
	MOVE.L  968(A2),X_VALUED	*7

	MOVE.L  1280(A2),KLME	*7
	MOVE.L  1284(A2),KLM2E	*7
	MOVE.L  1288(A2),X_VALUEE	*7

	MOVE.L  1600(A2),KLMF	*7
	MOVE.L  1604(A2),KLM2F	*7
	MOVE.L  1608(A2),X_VALUEF	*7

	MOVE.L  1920(A2),KLMG	*7
	MOVE.L  1924(A2),KLM2G	*7
	MOVE.L  1928(A2),X_VALUEG	*7

	MOVE.L  2240(A2),KLMH	*7
	MOVE.L  2244(A2),KLM2H	*7
	MOVE.L  2248(A2),X_VALUEH	*7

	MOVE.L  2560(A2),KLMI	*7
	MOVE.L  2564(A2),KLM2I	*7
	MOVE.L  2568(A2),X_VALUEI	*7

	MOVE.L  2880(A2),KLMJ	*7
	MOVE.L  2884(A2),KLM2J	*7
	MOVE.L  2888(A2),X_VALUEJ	*7

	MOVE.L  3200(A2),KLMK	*7
	MOVE.L  3204(A2),KLM2K	*7
	MOVE.L  3208(A2),X_VALUEK	*7

	MOVE.L  3520(A2),KLML	*7
	MOVE.L  3524(A2),KLM2L	*7
	MOVE.L  3528(A2),X_VALUEL	*7

	MOVE.L  3840(A2),KLMM	*7
	MOVE.L  3844(A2),KLM2M	*7
	MOVE.L  3848(A2),X_VALUEM	*7

	MOVE.L  4160(A2),KLMN	*7
	MOVE.L  4164(A2),KLM2N	*7
	MOVE.L  4168(A2),X_VALUEN	*7

	MOVE.L  4480(A2),KLMO	*7
	MOVE.L  4484(A2),KLM2O	*7
	MOVE.L  4488(A2),X_VALUEO	*7

	MOVE.L  4800(A2),KLMP	*7
	MOVE.L  4804(A2),KLM2P	*7
	MOVE.L  4808(A2),X_VALUEP	*7

	MOVE.L	A2,MES_PNT3	*5

	*=46+13


LA_SUITE3
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2,A1       	*5
	MOVEA.L	  KLM,A2		*5
	ADDA.L	X_VALUE,A6		*6


INC	SET	0
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

;	LEA	64(A1),A1
;	LEA	64(A2),A2
INC	SET	INC+160


	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2B,A1       	*5
	MOVEA.L	  KLMB,A2		*5
	ADDA.L	X_VALUEB,A6		*6


INC	SET	0
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

;	LEA	64(A1),A1
;	LEA	64(A2),A2
INC	SET	INC+160

	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2C,A1       	*5
	MOVEA.L	  KLMC,A2		*5
	ADDA.L	X_VALUEC,A6		*6


INC	SET	0
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

;	LEA	64(A1),A1
;	LEA	64(A2),A2
INC	SET	INC+160

	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2D,A1       	*5
	MOVEA.L	  KLMD,A2		*5
	ADDA.L	X_VALUED,A6		*6


INC	SET	0
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

;	LEA	64(A1),A1
;	LEA	64(A2),A2
INC	SET	INC+160



INC	SET	0
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2E,A1       	*5
	MOVEA.L	  KLME,A2		*5
	ADDA.L	X_VALUEE,A6		*6
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2F,A1       	*5
	MOVEA.L	  KLMF,A2		*5
	ADDA.L	X_VALUEF,A6		*6
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2G,A1       	*5
	MOVEA.L	  KLMG,A2		*5
	ADDA.L	X_VALUEG,A6		*6
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2H,A1       	*5
	MOVEA.L	  KLMH,A2		*5
	ADDA.L	X_VALUEH,A6		*6
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2I,A1       	*5
	MOVEA.L	  KLMI,A2		*5
	ADDA.L	X_VALUEI,A6		*6


INC	SET	0
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

;	LEA	64(A1),A1
;	LEA	64(A2),A2
INC	SET	INC+160


	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2J,A1       	*5
	MOVEA.L	  KLMJ,A2		*5
	ADDA.L	X_VALUEJ,A6		*6


INC	SET	0
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

;	LEA	64(A1),A1
;	LEA	64(A2),A2
INC	SET	INC+160

	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2K,A1       	*5
	MOVEA.L	  KLMK,A2		*5
	ADDA.L	X_VALUEK,A6		*6


INC	SET	0
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

;	LEA	64(A1),A1
;	LEA	64(A2),A2
INC	SET	INC+160

	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2L,A1       	*5
	MOVEA.L	  KLML,A2		*5
	ADDA.L	X_VALUEL,A6		*6


INC	SET	0
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

;	LEA	64(A1),A1
;	LEA	64(A2),A2
INC	SET	INC+160



INC	SET	0
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2M,A1       	*5
	MOVEA.L	  KLMM,A2		*5
	ADDA.L	X_VALUEM,A6		*6
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2N,A1       	*5
	MOVEA.L	  KLMN,A2		*5
	ADDA.L	X_VALUEN,A6		*6
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2O,A1       	*5
	MOVEA.L	  KLMO,A2		*5
	ADDA.L	X_VALUEO,A6		*6
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19
	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	ADDA.L	AUGMENTATION,A6
	MOVEA.L   KLM2P,A1       	*5
	MOVEA.L	  KLMP,A2		*5
	ADDA.L	X_VALUEP,A6		*6
	MOVEM.L	INC(A6),D0-D3
	AND.L	(A1)+,D0	
	AND.L	(A1)+,D1
	AND.L	(A1)+,D2
	AND.L	(A1)+,D3
	OR.L	(A2)+,D0
	OR.L	(A2)+,D1
	OR.L	(A2)+,D2
	OR.L	(A2)+,D3
	MOVEM.L	D0-D3,INC(A6)	*19

	ADD.L	#160,AUGMENTATION
	DBF	D7,PAR_ICI




	MOVE.L	SCREEN1,A6
	ADDA.L	#160*304,A6
	MOVE.L	SCREEN1,A2
	SUBA.L	#160*8,A2
INC	SET	0
	REPT	8
	MOVEM.L	INC(A6),D0-D7/A3-A5
	MOVEM.L	D0-D7/A3-A5,INC(A2)

	MOVEM.L	INC+44(A6),D0-D7/A3-A5
	MOVEM.L	D0-D7/A3-A5,INC+44(A2)

	MOVEM.L	INC+88(A6),D0-D7/A3-A5
	MOVEM.L	D0-D7/A3-A5,INC+88(A2)

	MOVEM.L	INC+144-12(A6),D0-D6
	MOVEM.L	D0-D6,INC+144-12(A2)
INC	SET	INC+160
	ENDR




	CMPI.L	#8,NB_PART
	BNE	SUITV0
	BSR	TEST_LET
	CLR.L	NB_PART
SUITV0	
	BSR	SCROLL
	BSR	SCROLL

	MOVE.L	SCREEN1,A1
	LEA	160*192(A1),A1
	LEA	160*30(A1),A1
	ADDA.L	AUGMENTATION,A1
	MOVE.L	ADRSAVE,A6
	
	REPT	40*8
	MOVE.L	(A6)+,(A1)+
	ENDR

	MOVE.L	SCREEN1,A1
	LEA	160*200(A1),A1
	LEA	160*30(A1),A1
	ADDA.L	AUGMENTATION,A1
	MOVE.L	ADRSAVE,A6
	REPT	40*8
	MOVE.L	(A1)+,(A6)+
	ENDR

	MOVE.L	SCREEN1,A1
	LEA	160*200(A1),A1
	LEA	160*30(A1),A1
	ADDA.L	AUGMENTATION,A1
	MOVE.L	ADRTXT,A6
N	SET	0
	REPT	20*8
	MOVE	N(A6),D0
	OR	D0,N(A1)
N	SET	N+8
	ENDR

	ADDI.L  #1280,SCREEN1
	MOVE.L  SCREEN1,D0
	MOVE.L  SCREEN2,D1
	CMP.L   D1,D0
	BNE     OOPS
	MOVE.L  SCREEN2,SCREEN1
	SUBI.L  #49920,SCREEN1
OOPS	MOVE.B  SCREEN1+1,$FFFF8201.W
	MOVE.B  SCREEN1+2,$FFFF8203.W

	JSR	ZIK+6

	CMPI.B	#$1,$FFFFFC02.W
	BEQ	FIN
	CMPI.B	#$B9,$FFFFFC02.W
	BNE.S	OUT
	CLR.L	POINT2
	MOVE.L	#1,PART_
OUT	RTE

VBLR_WAIT
	CLR.L	$FFFF8240.W
	CLR.L	$FFFF8244.W
	CLR.L	$FFFF8248.W
	CLR.L	$FFFF824C.W
	CLR.L	$FFFF8250.W
	CLR.L	$FFFF8254.W
	CLR.L	$FFFF8258.W
	CLR.L	$FFFF825C.W
	MOVEM.L	D0-A6,-(SP)
	move.l	SCREEN1,d0
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)
	JSR	ZIK+6
	MOVEM.L	(SP)+,D0-A6
	CMPI.B	#$1,$FFFFFC02.W
	BNE.S	LMLM
	JMP	FIN
LMLM	RTE

FIN:	
	MOVE	#$2700,SR
	MOVE.B	#8,$FFFFFC02.W
	MOVE.B	MFP1,$FFFFFA07.W
	MOVE.B	MFP2,$FFFFFA09.W
	MOVE.B	MFP3,$FFFFFA0F.W
	MOVE.B	MFP4,$FFFFFA13.W
	MOVE.B	MFP5,$FFFFFA1B.W
	MOVE.B	MFP6,$FFFFFA21.W
	MOVE.B	MFP7,$FFFFFA15.W
	MOVE.B	MFP8,$FFFFFA17.W
	MOVE.B	MFP9,$FFFFFA19.W
	MOVE.B	MFP10,$FFFFFA1F.W
	MOVE.L	ANC_VBL,$70.W
	MOVE.L	SAUVE_TMA,$134.W
	MOVE.L	SAUVE_HBL,$68.W

	MOVE	#$2300,SR


	MOVEM.L	ANC_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W

	MOVE.L	#$8080000,$FFFF8800.W
	MOVE.L	#$9090000,$FFFF8800.W
	MOVE.L	#$A0A0000,$FFFF8800.W

	BSET	#0,$484.W
	BSET	#1,$484.W
	BSET	#2,$484.W

	MOVE.B	#8,$FFFFFC02.W
	MOVE.B  #2,$FFFF820A.W
	
	MOVE.W 	RES,-(SP)
	MOVE.L	ANC_ECR,-(SP)
	MOVE.L	ANC_ECR,-(SP)
	MOVE.W 	#5,-(SP)
	TRAP 	#14
	LEA.L 	12(SP),SP
	
	MOVE.L	SAUVE,-(SP)
	MOVE.W 	#$20,-(SP)
	TRAP 	#1
	ADDQ.L 	#6,SP

	CLR.W 	-(SP)
	TRAP	#1

VBLR_ZOOM
	CLR.B	$FFFFFA1B.W

	MOVE.B	#0,$FFFFFA19.W
	MOVE.B	#99,$FFFFFA1F.W
	MOVE.B	#4,$FFFFFA19.W
	BCLR	#3,$FFFFFA17.W
	MOVE.L	#INTER_TMA,$134.W
	ORI.B	#$20,$FFFFFA13.W
	ORI.B	#$20,$FFFFFA07.W


	MOVEQ	#0,D0
	LEA	Z_DAT,A0
	ADDA.L	CNT_ZOOM2,A0
	CMPI.L	#-1,(A0)
	BNE.S	NO_PB
	CLR.L	CNT_ZOOM2
	LEA	Z_DAT,A0
NO_PB	MOVE	(A0),D0
	MOVE.L	D0,LIGNE

	MOVE	(A0),D0
	DIVU	#160,D0
	MOVE.L	D0,LIGNE2
	
	CMPI.B	#$3B,$FFFFFC02.W
	BEQ.S	K
	ADDQ.L	#2,CNT_ZOOM2
K	
	lea	z,a0

	LEA	BUF_ZOOM_DAT,A1
	ADDA.L	LIGNE,A1
	
	REPT	7
	MOVE	(A1),(A0)+
	LEA	8(A1),A1
	MOVE	(A1),(A0)+
	LEA	8(A1),A1
	endr

	LEA	BUF_ZOOM_DAT2,A1
	ADDA.L	LIGNE,A1
	
	REPT	7
	MOVE	(A1),(A0)+
	LEA	8(A1),A1
	MOVE	(A1),(A0)+
	LEA	8(A1),A1
	endr
	
NO_ZOOM2
	MOVE	#$000,$FFFF8242.W
	MOVE	#$200,$FFFF8244.W

	MOVE.L	#$06770677,$FFFF8248.W
	MOVE.L	#$06770677,$FFFF824C.W
	MOVE.L	#$06770677,$FFFF8250.W
	MOVE.L	#$06770677,$FFFF8254.W
	MOVE.L	#$06770677,$FFFF8258.W
	MOVE.L	#$06770677,$FFFF825C.W
	
	move.l	SCREEN1,d0
	MOVE.L	SCREEN2,SCREEN1
	MOVE.L	D0,SCREEN2
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)

	MOVEQ.L	#0,D7
	MOVEQ	#0,D4
	MOVE.L	#256/2,D5
	LEA	BUFFER_,A6
	LEA	BUFFER_,A1
	LEA	128*2(A6),A6
	LEA	128*2(A1),A1
	LEA	BUFFER2,A5
	LEA	BUFFER2,A2
	LEA	128*2(A5),A5
	LEA	128*2(A2),A2
	
	LEA	PALETTE2,A0
	MOVE.L	LIGNE2,D6
	SUBQ.L	#1,D6
OP	MOVE.L	D6,D0
	MOVE.L	D6,D1
REMPLIT_BUF	MOVE	(A0),(A6)+
	MOVE	D4,-(A1)
	MOVE	D4,(A5)+
	MOVE	(A0),-(A2)
	ADDQ.L	#1,D7
	CMP.L	D5,D7
	BEQ.S	OK_GO
	DBF	D0,REMPLIT_BUF
	
	LEA	2(A0),A0
	EXG.L	A6,A5
	EXG.L	A1,A2
	BRA.S	OP
OK_GO
	ADDQ.L	#1,CNT_ZOOM
	CMPI.L	#4,CNT_ZOOM
	BNE.S	POPOGAGA
	BSR.S	TEST_LET_ZOOM
	CLR.L	CNT_ZOOM
POPOGAGA

	LEA	BUFFER_,A6
	LEA	BUFFER2,A5
INTER_RTE	RTE


TEST_LET_ZOOM	MOVEQ	#0,D0
	LEA	TEXT1_ZOOM,A0	
	ADDA.L	POINT,A0
	LEA	FONT8_8,A1
	CMPI.B	#$FF,(A0)
	BEQ	STOP_TXTZ
	CMPI.B	#$D,(A0)
	BNE.S	SUITST2
	ADD.L	#230*8,Y_VALUE_ZOOM
	BRA	POIPOI
SUITST2
	CMPI.B	#$A,(A0)
	BNE.S	SUITST3
	CLR.L	X_VALUE_ZOOM2
	CLR.L	FLAG	
	MOVE.L	#1,X_VALUE_ZOOM
	BRA	POIPOI
	
SUITST3	
	CMPI.B	#$B,(A0)
	BNE.S	SUITST4
	MOVEA.L	SCREEN1,A2
	LEA	164(A2),A2
	ADDA.L	Y_VALUE_ZOOM,A2
	MOVE.L	#6,D1
LIGNEA	MOVE.L	#27,D0
EFFL	CLR	(A2)
	LEA	8(A2),A2
	DBF	D0,EFFL
	LEA	6(A2),A2
	DBF	D1,LIGNEA
	BRA	POIPOI
	

SUITST4	
	CMPI.B	#$C,(A0)
	BNE.S	SUITST5
	SUB.L	#230*8,Y_VALUE_ZOOM
	BRA	POIPOI
	
SUITST5	MOVE.B	(A0),D0	
	SUBI.B	#32,D0	
	LSL.W	#3,D0	
	ADDA.L	D0,A1
	MOVEA.L	SCREEN1,A2
	LEA	164(A2),A2
	ADDA.L	Y_VALUE_ZOOM,A2
	ADDA.L	X_VALUE_ZOOM,A2
	MOVEA.L	SCREEN2,A3
	LEA	164(A3),A3
	ADDA.L	Y_VALUE_ZOOM,A3
	ADDA.L	X_VALUE_ZOOM,A3
	
	MOVE.B	(A1),(A2)
	MOVE.B	(A1)+,(A3)
	MOVE.B	(A1),230(A2)
	MOVE.B	(A1)+,230(A3)
	MOVE.B	(A1),230*2(A2)
	MOVE.B	(A1)+,230*2(A3)
	
	MOVE.B	(A1),230*3(A2)
	MOVE.B	(A1)+,230*3(A3)
	
	MOVE.B	(A1),230*4(A2)
	MOVE.B	(A1)+,230*4(A3)

	MOVE.B	(A1),230*5(A2)
	MOVE.B	(A1)+,230*5(A3)

	MOVE.B	(A1),230*6(A2)
	MOVE.B	(A1)+,230*6(A3)

	MOVE.B	(A1),230*7(A2)
	MOVE.B	(A1)+,230*7(A3)
	
	CMPI.L	#1,FLAG
	BEQ.S	OTHER
	ADD.L	#7,X_VALUE_ZOOM
	MOVE.L	#1,FLAG
	BRA.S	GOGO
OTHER	ADD.L	#1,X_VALUE_ZOOM
	CLR.L	FLAG
GOGO	
	ADD.L	#8,X_VALUE_ZOOM2
	CMPI.L	#224*2,X_VALUE_ZOOM2
	BNE.S	POIPOI
	ADD.L	#8*230,Y_VALUE_ZOOM
	MOVE.L	#1,X_VALUE_ZOOM
	CLR.L	X_VALUE_ZOOM2
POIPOI	
	ADDI.L	#1,POINT
STOP_TXTZ	RTS

INTER_TMA:	CLR.B	$FFFFFA07.W
	CLR.B	$FFFFFA09.W
	MOVE	#$2100,SR

	MOVE.L	A6,USP
	
full
	MOVE.L	#$FFFF8209,A6
	MOVE.L	#$FFFF8260,A4
	MOVE.L	#$FFFF820A,A3

	MOVEQ	#0,D0
	MOVEQ	#2,D1

	STOP	#$2100
	MOVE	#$2700,SR
	MOVE	#$2300,(SP)

	MOVEQ	#29,D2
SYNCHROA:	DBF	D2,SYNCHROA
	NOP

	MOVE.B	D0,(A3)
	REPT	6
	NOP
	ENDR
	MOVE.B	D1,(A3)


	CLR.L	D7
	MOVEQ	#0,D1
	MOVEQ	#$10,D6
	MOVE	#$2700,SR

SYNCHRO	MOVE.B	(A6),D7     * SYNCHRO
	BEQ.S	SYNCHRO
	SUB.W	D7,D6	
	LSL.W	D6,D1	

	DCB	97-5-2-1-5,$4E71
	move.l	SCREEN2,a0	5
	LEA	160(A0),A0	2
	MOVE.L	USP,A6
FULLSCREEN
	rept	198+29
	JSR	ROUT_FULL
	ENDR
	DCB	5,$4E71
	
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	MOVE	(a6),$ffff8250.W
	MOVE	(a6)+,$ffff8242.W	
	MOVE	(a5)+,$FFFF8240.W	

	lea	z,a1	3

n	set	6
	rept	12
	move.l	(a1)+,n(a0)	6
n	set	n+16
	endr
	
	DCB	88-3-6*12-12,$4E71
	
	MOVE.b	#0,(A3)
	MOVE	a4,(A3)

	rept	2
	move.l	(a1)+,n(a0)	6
n	set	n+16
	endr

	DCB	13-12,$4E71
	
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)

	CLR.B	$FFFF820A.W 
	DCB	12-2-4,$4E71
	LEA	230(A0),A0

	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	MOVE	(a6),$ffff8250.W
	MOVE.B	#2,$FFFF820A.W
	MOVE	(a6)+,$ffff8242.W	
	MOVE	(a5)+,$FFFF8240.W	

	lea	z,a1	3

n	set	6
	rept	11
	move.l	(a1)+,n(a0)	6
n	set	n+16
	endr
	
	DCB	88-3-6*11-12-4,$4E71
	
	MOVE.b	#0,(A3)
	MOVE	a4,(A3)

	rept	2
	move.l	(a1)+,n(a0)	6
n	set	n+16
	endr

	DCB	13-12,$4E71
	
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	move.l	(a1)+,n(a0)	6
n	set	n+16

	DCB	12-2-6,$4E71
	LEA	230(A0),A0
**
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	MOVE	(a6),$ffff8250.W
	MOVE	(a6)+,$ffff8242.W	
	MOVE	(a5)+,$FFFF8240.W	

	lea	z,a1	3
n	set	6
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16	
	move.l	(a1)+,n(a0)	6
n	set	n+16	
	DCB	88-3-6*12-12,$4E71
	MOVE.b	#0,(A3)
	MOVE	a4,(A3)

	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16

	NOP
	
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	LEA	230(A0),A0
	DCB	5,$4E71

	rept	26
	JSR	ROUT_FULL
	ENDR
	
	CLR.L	$FFFF8240.W
	CLR.L	$FFFF8244.W
	CLR.L	$FFFF8248.W
	CLR.L	$FFFF824C.W
	CLR.L	$FFFF8250.W
	CLR.L	$FFFF8254.W
	CLR.L	$FFFF8258.W
	CLR.L	$FFFF825C.W

	JSR	ZIK+6

	CMPI.B	#$1,$FFFFFC02.W
 	BEQ	FIN
 
	RTE
ROUT_FULL
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	MOVE	(a6),$ffff8250.W
	MOVE	(a6)+,$ffff8242.W	
	MOVE	(a5)+,$FFFF8240.W	

	lea	z,a1	3
n	set	6
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16	
	move.l	(a1)+,n(a0)	6
n	set	n+16	
	DCB	88-3-6*12-12,$4E71
	MOVE.b	#0,(A3)
	MOVE	a4,(A3)

	move.l	(a1)+,n(a0)	6
n	set	n+16
	move.l	(a1)+,n(a0)	6
n	set	n+16

	NOP
	
	MOVE	a4,(A4)
	MOVE.B	#0,(A4)
	LEA	230(A0),A0
	NOP
	RTS

VBL_SPR	
	MOVE.L	PNT_CRB,A5
	SUBA.L	#12,A5
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
	MOVEQ	#0,D5
	MOVEQ	#0,D6
	MOVEQ	#0,D7
	MOVE.L	#0,A0
	MOVE.L	#0,A1
	MOVE.L	#0,A2
	MOVE.L	#0,A3

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR
	LEA	PAS(A5),A5

	MOVE.L	SCREEN2,A4
	ADDA.W	4(A5),A4
N	SET	0
	REPT	81
	MOVEM.L	D0-D7/A0-A3,N(A4)
N	SET	N+160
	ENDR

	MOVE.L	PNT_CRB,A5

	LEA	PREDEC_TAB,A4
	MOVE.W	(A5),D0
	LSR	#1,D0
	MOVE.L	(A4,D0.W),A0
	MOVE.L	SCREEN2,A1
	ADDA.W	4(A5),A1
N	SET	0
	REPT	81
	MOVEM.L	(A0)+,D0-D7/A2-A5
	MOVEM.L	D0-D7/A2-A5,N(A1)
N	SET	N+160
	ENDR

	MOVE.L	PNT_CRB,A5
	LEA	PAS(A5),A5
	MOVE.L	#0,A4

	MOVE.L	SCREEN2,A3

	LEA	TABLE_GEN,A6
	LEA	24*8(A6),A6
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2
	MOVE.L	(A6),A6
	JSR	(A6)

	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6
	LEA	24*8(A6),A6
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2
	MOVE.L	(A6),A6
	JSR	(A6)

	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6
	LEA	12*8(A6),A6
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2
	MOVE.L	(A6),A6
	JSR	(A6)

	LEA	PAS(A5),A5

	LEA	TABLE_GEN,A6
	ADDA.W	2(A5),A6
	MOVE.L	A3,A0
	ADDA.W	4(A5),A0
	MOVE.L	A3,A1
	ADDA.W	4(A5),A1
	MOVE.L	(A6)+,A2
	MOVE.L	(A6),A6
	JSR	(A6)

	SF	$FFFF8240.W

	move.l	SCREEN2,d0
	MOVE.L	SCREEN1,SCREEN2
	MOVE.L	D0,SCREEN1
	lsr.l	#8,d0
	move.l	#$ffff8201,a0
	movep	d0,(a0)

	ADDQ.L	#6,PNT_CRB

	MOVE.L	PNT_CRB,A0
	CMPI.W	#-1,(PAS*8)-6(A0)
	BNE.S	FINF
	MOVE.L	#COURB,PNT_CRB
FINF	JSR	ZIK+6

	CMPI.B	#$39,$FFFFFC02.W
	BEQ	FIN2
	RTE
FIN2	JMP	FIN
	
TB0_IR	
	DS.B	20*227
;	CLR.B	$FFFFFA1B.W
;	MOVE.B	#1,$FFFFFA21.W
;	MOVE.B	#8,$FFFFFA1B.W
;	MOVE.L	#TB0_IR,$120
;	MOVE	(A0)+,$FFFF8240.W
;	BCLR	#0,$FFFFFA0F.W
;	RTE

TB1_IR	
	MOVE	(A0)+,$FFFF8240.W
	SF	$FFFF8240.W
     REPT 127-4-4+128
	NOP		
     ENDR
	MOVE.B	#0,$FFFF820A.W	
     REPT 8
     	NOP		
     ENDR
	MOVE.B	#2,$FFFF820A.W	
	CLR.B	$FFFFFA1B.W
	
	MOVE.L	#TB0_IR,$120	
	BCLR	#0,$FFFFFA0F.W	
	RTE		

PREDECALE:
DECAL	MOVE.L	#3,D7
DECAL2	MOVE.L	#19,D6
DECAL3	roxl.w	152(a4)
	LEA	-8(A4),A4
	DBF	D6,DECAL3
	LEA	152(A4),A4    
	LEA	2(A4),A4
	DBF	D7,DECAL2
	LEA	-6(A4),A4
	RTS

SET_SCR:	move.l	#BUFFER,d0
	and.l	#$ffffff00,d0
	move.l	d0,SCREEN1
	add.l	#64000,d0
	move.l	d0,SCREEN2
	move.l	#BUFFERSCR,d0
	and.l	#$ffffff00,d0
	MOVE.L	D0,SCREEN3
	
	MOVE.L	#BUFSCR,D1
	MOVE.L	D1,ADRTXT
	MOVE.L	#BUFSAVE,D1
	MOVE.L	D1,ADRSAVE

	rts		

MAK_COD	MOVE.L	#TABLE_SPR,ANNEX
	LEA	BUF_COD,A2
	LEA	TABLE_GEN,A6
	LEA	FIC_OPT,A3
	BSR 	CODING
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT+512,A3
	BSR	CODING
	ADDQ.L	#4,ANNEX
	LEA	FIC_OPT+1024,A3
	BSR	CODING
	RTS

CODING	
RECOMGENSPR	MOVE.L	ANNEX,A0
	MOVE.L	(A0),A0
	MOVE.L	SCREEN1,A1
	MOVE.L	SCREEN2,A5
CHANGEY1	MOVE.W	#81-1,D6
CHANGE1
REAF2	MOVE.W	#6-2,D7
REAF1	MOVE.L	(A0),(A1)+
	MOVE.L	4(A0),(A1)+
	MOVE.W	(A0),D0
	MOVE.W	2(A0),D1
	MOVE.W	4(A0),D2
	OR.W	D2,D0
	OR.W	D1,D0
	NOT.W	D0
	MOVE.W	D0,(A5)+
	ADDQ.L	#8,A0
	DBRA	D7,REAF1
	CLR.L	(A1)+
	CLR.L	(A1)+
	MOVE.W	#-1,(A5)+
CHANGE2	LEA	160-((6-1)*8)(A0),A0
	DBRA	D6,REAF2

	MOVE.L	A3,(A6)+
	MOVE.L	A2,(A6)+
	BSR	COD_GEN
	MOVE.L	A2,(A6)+
	BSR	MAK_EFF
	REPT	NB_DECAL-1
	BSR	DECAL_SPR
	MOVE.L	A3,(A6)+
	MOVE.L	A2,(A6)+
	BSR	COD_GEN
	MOVE.L	A2,(A6)+
	BSR	MAK_EFF
	ENDR
	RTS

DECAL_SPR	MOVE.L	SCREEN2,A1
	MOVE.W	#NB_DEC,D4
RECOM_DEC	MOVE.L	SCREEN1,A0
CHANGEY2	MOVE.W	#81-1,D5
DEC3	MOVE.W	#3,D6
CHANGE3
DEC2	MOVE.W	#6-1,D7
DEC1	ROXR	(A0)
	ADDQ.L	#8,A0
	DBRA	D7,DEC1
CHANGE4	LEA	-((6*8)-2)(A0),A0
	DBRA	D6,DEC2
CHANGE5	LEA	(6-1)*8(A0),A0
	DBRA	D5,DEC3
	DBRA	D4,RECOM_DEC
	MOVE.L	SCREEN1,A0
CHANGEY3	MOVE.W	#81-1,D6
CHANGE6
MSK2	MOVE.W	#6-1,D7
MSK1	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.W	(A0)+,D2
	ADDQ.L	#2,A0
	OR.W	D1,D0
	OR.W	D2,D0
	NOT.W	D0
	MOVE.W	D0,(A1)+
	DBRA	D7,MSK1
	DBRA	D6,MSK2
	RTS

COD_GEN	MOVE.L	SCREEN1,A0
	MOVE.L	SCREEN2,A1
	MOVE.L	#$4CDA00FF,(A2)+
CHANGEY4	MOVE.W	#81-1,D6
CHANGE7	
CDG2	MOVE.W	#6-1,D7
CDG1	BSR	ANDS
	DBRA	D7,CDG1
	MOVE.W	#$41E8,(A2)+
CHANGE8	MOVE.W	#160-(6*8),(A2)+
	BSR	OPTI_ADDQ_ANDS
 	DBRA	D6,CDG2
	LEA	32(A3),A3
	MOVE.L	SCREEN1,A0
	MOVE.L	SCREEN2,A1
	MOVE.L	#$4CDA00FF,(A2)+
CHANGEY5	MOVE.W	#81-1,D6
CHANGE9
CDG4	MOVE.W	#6-1,D7
CDG3	BSR	ORS
	DBRA	D7,CDG3
	MOVE.W	#$43E9,(A2)+
CHANGE10	MOVE.W	#160-(6*8),(A2)+
	BSR	OPTI_ADDQ_ORS
	DBRA	D6,CDG4
	LEA	32(A3),A3
	MOVE.W	#$4E75,(A2)+
	RTS

ANDS	TST.W	(A1)
	BEQ.S	NO_MASK
	CMPI.W	#-1,(A1)
	BEQ.S	NO_MASK
	MOVE.W	#$C158,D4
	MOVE.W	#$C198,D5
	CLR.W	ADD1
	MOVE.W	(A1),D0
	MOVE.W	#7,D3
CHERCHMSK	CMP.W     	(A3),D0
	BEQ.S	MSKTROUVê
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	ADDI.W	#$200,D5
	ADDQ.W	#4,ADD1
	DBRA	D3,CHERCHMSK
	LEA	-32(A3),A3
	MOVE.W	#$0298,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$0258,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$5448,(A2)+
;	ADDQ.W	#1,ADD
	BRA.S	FIN_MASK
MSKTROUVê	SUBA.W	ADD1,A3
	MOVE.W	D5,(A2)+
	MOVE.W	D4,(A2)+
	MOVE.W	#$5448,(A2)+
;	ADDQ.W	#1,ADD
	BRA.S	FIN_MASK
NO_MASK	MOVE.W	#$5048,(A2)+
	BSR	OPTI_ADDQ_ANDS
;	ADDQ.W	#1,ADD
FIN_MASK	ADDQ.L	#2,A1
	ADDQ.L	#8,A0
	RTS

AND1	MOVE.W	#$0258,(A2)+
	MOVE.W	(A1),(A2)+
	MOVE.W	#$5C48,(A2)+
	BRA	FIN_MASK

OPTI_ADDQ_ANDS:
	CLR.W	VARI
	MOVE.W	#$5048,D1
	MOVE.W	#$5448,D2
	MOVE.W	#$41E8,D3
CONTANDQ	CMP.W	-2(A2),D1
	BNE.S	ANDQ2
	ADDQ.W	#8,VARI
	SUBQ.L	#2,A2
	BRA	CONTANDQ
ANDQ2	CMP.W	-2(A2),D2
	BNE.S	ANDQ3
	ADDQ.W	#2,VARI
	SUBQ.L	#2,A2
	BRA	CONTANDQ
ANDQ3	CMP.W	-4(A2),D3
	BNE.S	FINANDQ
	MOVE.W	-2(A2),D4
	ADD.W	D4,VARI
	SUBQ.L	#4,A2
	BRA	CONTANDQ
FINANDQ	TST.W	VARI
	BEQ	SORTANDQ
	CMPI.W	#8,VARI
	BGT	CHANDQ2
	CMPI.W	#2,VARI
	BNE.S	CH1
	MOVE.W	#$5448,(A2)+
	BRA.S	SORTANDQ
CH1	CMPI.W	#4,VARI
	BNE.S	CH11
	MOVE.W	#$5848,(A2)+
	BRA.S	SORTANDQ
CH11	CMPI.W	#6,VARI
	BNE.S	CH111
	MOVE.W	#$5C48,(A2)+
	BRA.S	SORTANDQ
CH111	MOVE.W	#$5048,(A2)+
	BRA.S	SORTANDQ
CHANDQ2	MOVE.W	#$41E8,(A2)+
	MOVE.W	VARI,(A2)+
SORTANDQ	RTS

OPTI_ADDQ_ORS:
	CLR.W	VARI
	MOVE.W	#$5449,D0
	MOVE.W	#$5849,D1
	MOVE.W	#$5C49,D2
	MOVE.W	#$5049,D3
	MOVE.W	#$43E9,D4
CONTORQ	CMP.W	-2(A2),D0
	BNE.S	ORQ2
	ADDQ.W	#2,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ2	CMP.W	-2(A2),D1
	BNE.S	ORQ3
	ADDQ.W	#4,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ3	CMP.W	-2(A2),D2
	BNE.S	ORQ4
	ADDQ.W	#6,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ4	CMP.W	-2(A2),D3
	BNE.S	ORQ5
	ADDQ.W	#8,VARI
	SUBQ.L	#2,A2
	BRA.S	CONTORQ
ORQ5	CMP.W	-4(A2),D4
	BNE.S	SORTORQ
	MOVE.W	-2(A2),D0
	ADD.W	D0,VARI
	MOVE.W	#$5449,D0
	SUBQ.L	#4,A2
	BRA.S	CONTORQ
SORTORQ	TST.W	VARI
	BEQ	FINORQ
	CMPI.W	#8,VARI
	BGT	CHORQ2
	CMPI.W	#2,VARI
	BNE.S	ORQ11
	MOVE.W	#$5449,(A2)+
	BRA	FINORQ
ORQ11	CMPI.W	#4,VARI
	BNE.S	ORQ111
	MOVE.W	#$5849,(A2)+
	BRA	FINORQ
ORQ111	CMPI.W	#6,VARI
	BNE.S	ORQ1111
	MOVE.W	#$5C49,(A2)+
	BRA	FINORQ
ORQ1111	MOVE.W	#$5049,(A2)+
	BRA	FINORQ
CHORQ2	MOVE.W	#$43E9,(A2)+
	MOVE.W	VARI,(A2)+
FINORQ	RTS

ORS	TST.W	(A1)
	BEQ	AFF_MOV
	CMPI.W	#-1,(A1)
	BEQ	NO_AFF
	TST.L	(A0)
	BEQ	AFF3
	TST.L	2(A0)
	BEQ	AFF1
	TST.W	(A0)
	BEQ	AFF23
	TST.W	4(A0)
	BEQ	AFF12
;	TST.W	2(A0)
;	BEQ	AFF13
	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE1
	BRA	NOT1SAME
APRES1COMP	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP1	CMP.L	(A3),D0
	BEQ.S	TROUVê1
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP1
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE1	CLR.W	ADD1
	SWAP	D0
	MOVE.W	2(A0),D0
	MOVE.W	#$8199,D4
	MOVE.W	#7,D3
CHERCHCOMP1	CMP.L	(A3),D0
	BEQ.S	TROUVêC1
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHCOMP1
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES1COMP
TROUVêC1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES1COMP

NOT1SAME	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSPA	CMP.L	(A3),D0
	BEQ.S	TROUVêA
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSPA
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES1COMP
TROUVêA	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSPB	CMP.L	(A3),D0
	BEQ.S	TROUVêB
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSPB
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	2(A0),(A2)+
	BRA	APRES1COMP
TROUVêB	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES1COMP


AFF13	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP13	CMP.L	(A3),D0
	BEQ.S	TROUVê13
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP13
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	CONT2
TROUVê13	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD

CONT2	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP1_3	CMP.L	(A3),D0
	BEQ.S	TROUVê1_3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP1_3
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê1_3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	
	BRA	FIN_AFF

AFF3	MOVE.W	#$5849,(A2)+
	BSR	OPTI_ADDQ_ORS
;	ADDQ.W	#1,ADD
	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP3	CMP.L	(A3),D0
	BEQ.S	TROUVê3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP3
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF1	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP11	CMP.L	(A3),D0
	BEQ.S	TROUVê11
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP11
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5C49,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê11	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5C49,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF12	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE2
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
APRES2COMP	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE2	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHCOMP2	CMP.L	(A3),D0
	BEQ.S	TROUVêC2
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHCOMP2
	LEA	-32(A3),A3
	MOVE.W	#$0099,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES2COMP
TROUVêC2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	D4,(A2)+
	BRA	APRES2COMP

AFF23	BSR	OPTI_ADDQ_ORS
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	TST.W	4(A0)
	BEQ	AFF2
	MOVE.W	#$0099,(A2)+
	MOVE.L	2(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
AFF2	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$8159,D4
	MOVE.W	#7,D3
CHERCHSP2	CMP.L	(A3),D0
	BEQ.S	TROUVê2
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#$200,D4
	DBRA	D3,CHERCHSP2
	LEA	-32(A3),A3
	MOVE.W	#$0059,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVê2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5849,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

AFF_MOV	TST.L	(A0)
	BEQ	MOV3
;	TST.L	2(A0)
;	BEQ	MOV1
	TST.W	(A0)
	BEQ	MOV23
	TST.W	4(A0)
	BEQ	MOV12
;	TST.W	2(A0)
;	BEQ	MOV13
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE3
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV66	CMP.L	(A3),D0
	BEQ.S	TROUVêMV66
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV66
	LEA	-32(A3),A3
	BRA	CONT6
TROUVêMV66	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+

	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV77	CMP.L	(A3),D0
	BEQ.S	TROUVêMV77
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV77
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	BRA	APRES3COMP
TROUVêMV77	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES3COMP

CONT6	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
APRES3COMP	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV33	CMP.L	(A3),D0
	BEQ.S	TROUVêMV33
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV33
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV33	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE3	SWAP	D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$22C0,D4
	MOVE.W	#7,D3
CHERCHCOMP3	CMP.L	(A3),D0
	BEQ.S	TROUVêC3
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP3
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES3COMP
TROUVêC3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES3COMP


MOV13	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV13	CMP.L	(A3),D0
	BEQ.S	TROUVêMV13
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV13
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	BRA	CONT3
TROUVêMV13	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32CC,(A2)+
CONT3	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV1_3	CMP.L	(A3),D0
	BEQ.S	TROUVêMV1_3
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV1_3
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV1_3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
MOV3	MOVE.W	#$22CC,(A2)+
	MOVEQ	#0,D0
	MOVE.W	4(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV3	CMP.L	(A3),D0
	BEQ.S	TROUVêMV3
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV3
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV3	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
MOV1	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV1	CMP.L	(A3),D0
	BEQ.S	TROUVêMV1
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV1
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	4(A0),(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV1	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
	MOVE.W	#$32FC,(A2)+
	MOVE.W	(A0),(A2)+
	MOVE.W	#$22CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF


MOV23	MOVE.W	#$32CC,(A2)+
	TST.W	4(A0)
	BEQ	MOV2

	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CMP.W	4(A0),D0
	BEQ	COMPARE5
	MOVE.W	#$22FC,(A2)+
	MOVE.L	2(A0),(A2)+
APRES5COMP	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE5	CLR.W	ADD1
	SWAP	D0
	MOVE.W	4(A0),D0
	MOVE.W	#$22C0,D4
	MOVE.W	#7,D3
CHERCHCOMP5	CMP.L	(A3),D0
	BEQ.S	TROUVêC5
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP5
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	2(A0),(A2)+
	BRA	APRES5COMP
TROUVêC5	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	BRA	APRES5COMP

MOV2	MOVEQ	#0,D0
	MOVE.W	2(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMV2	CMP.L	(A3),D0
	BEQ.S	TROUVêMV2
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMV2
	LEA	-32(A3),A3
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMV2	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF


MOV12	MOVEQ	#0,D0
	MOVE.W	(A0),D0
	CMP.W	2(A0),D0
	BEQ	COMPARE4
	MOVE.W	(A0),D0
	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHMVD	CMP.L	(A3),D0
	BEQ.S	TROUVêMVD
	ADDQ.L	#4,A3
	ADDQ.W	#4,ADD1
	ADDQ.W	#1,D4
	DBRA	D3,CHERCHMVD
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
TROUVêMVD	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	#$32FC,(A2)+
	MOVE.W	2(A0),(A2)+
	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF
	
APRES4COMP	MOVE.W	#$32CC,(A2)+
	MOVE.W	#$5449,(A2)+
;	ADDQ.W	#1,ADD
	BRA	FIN_AFF

COMPARE4	CLR.W	ADD1
	MOVE.W	#$32C0,D4
	MOVE.W	#7,D3
CHERCHCOMP4	CMP.L	(A3),D0
	BEQ.S	TROUVêC4
	ADDQ.W	#4,ADD1
	ADDQ.L	#4,A3
	ADDI.W	#1,D4
	DBRA	D3,CHERCHCOMP4
	LEA	-32(A3),A3
	MOVE.W	#$22FC,(A2)+
	MOVE.L	(A0),(A2)+
	BRA	APRES4COMP
TROUVêC4	SUBA.W	ADD1,A3
	MOVE.W	D4,(A2)+
	MOVE.W	D4,(A2)+
	BRA	APRES4COMP

NO_AFF	MOVE.W	#$5049,(A2)+	
	BSR	OPTI_ADDQ_ORS
;	ADDQ.W	#1,ADD
FIN_AFF	ADDQ.L	#8,A0
	ADDQ.L	#2,A1
	RTS

PREDECALET	LEA	BUF_ZOOM_DAT,A1
	LEA	PREDEC_TAB,A6
CHANGEY6	MOVE.W	#81-1,D6
CHANGE11
RECOP2	MOVE.W	#6-2,D7
RECOP11	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	DBRA	D7,RECOP11
	CLR.L	(A1)+
	CLR.L	(A1)+
CHANGE12	LEA	160-((6-1)*8)(A0),A0
	DBRA	D6,RECOP2

	LEA	BUF_ZOOM_DAT,A0
	MOVE.L	A0,(A6)+
	MOVE.W	#6,D3
CHANGE13
CHANGEY7
DECPGEN	LEA	6*8*81(A0),A1
	MOVE.L	A1,(A6)+
CHANGEY8
CHANGE14	MOVE.W	#(6*81)-1,D7
RECOP3	MOVE.L	(A0)+,(A1)+
	MOVE.L	(A0)+,(A1)+
	DBRA	D7,RECOP3

	MOVE.W	#1,D4
CHANGEY9
DECPG1	MOVE.W	#81-1,D5
DECP3	MOVE.W	#3,D6
CHANGE15
DECP2	MOVE.W	#6-1,D7
DECP1	ROXR	(A0)
	ADDQ.L	#8,A0
	DBRA	D7,DECP1
CHANGE16	LEA	-((6*8)-2)(A0),A0
	DBRA	D6,DECP2
CHANGE17	LEA	(6-1)*8(A0),A0
	DBRA	D5,DECP3
CHANGEY10
CHANGE18	LEA	-(6*8*81)(A0),A0
	DBRA	D4,DECPG1
	DBRA	D3,DECPGEN
	RTS

MAK_EFF	TST.W	FLAG_EFF
	BEQ	FLAGEFF_OFF
	MOVE.L	SCREEN2,A0
	MOVE.L	SCREEN1,A1
CHANGEY11	MOVE.W	#81-1,D6
CHANGE19
RECOMEF2	MOVE.W	#6-1,D7
RECOMEF1	CMPI.W	#-1,(A0)
	BEQ	QQQ
	TST.L	(A1)
	BEQ	EFF3
	TST.L	2(A1)
	BEQ	EFF1
	TST.W	(A1)
	BEQ	EFF23
	TST.W	2(A1)
	BEQ	EFF13
	TST.W	4(A1)
	BEQ	EFF12
EFF_ALL	MOVE.W	#$20C0,(A2)+
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA.S	NO_EFF
QQQ	MOVE.W	#$5048,(A2)+
	BSR	OPTI_ADDQ_EFF
NO_EFF	ADDQ.L	#8,A1
	ADDQ.L	#2,A0
	DBRA	D7,RECOMEF1
	MOVE.W	#$41E8,(A2)+
CHANGE20	MOVE.W	#160-(6*8),(A2)+
	BSR	OPTI_ADDQ_EFF
	DBRA	D6,RECOMEF2
	MOVE.W	#$4E75,(A2)+
FLAGEFF_OFF	RTS

EFF3	MOVE.W	#$5848,(A2)+
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF

EFF1	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5C48,(A2)+
	BRA	NO_EFF

EFF23	TST.W	4(A1)
	BEQ	EFF2
	MOVE.W	#$5448,(A2)+
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$20C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF
EFF2	MOVE.W	#$5448,(A2)+
	BSR	OPTI_ADDQ_EFF
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5848,(A2)+
	BRA	NO_EFF

EFF13	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5448,(A2)+
	MOVE.W	#$30C0,(A2)+
	MOVE.W	#$5448,(A2)+
	BRA	NO_EFF

EFF12	MOVE.W	#$20C0,(A2)+
	MOVE.W	#$5848,(A2)+
	BRA	NO_EFF

OPTI_ADDQ_EFF
	MOVE.W	#$5448,D0
	MOVE.W	#$5848,D1
	MOVE.W	#$5C48,D2
	MOVE.W	#$5048,D3
	MOVE.W	#$41E8,D4
	CLR.W	ADD1
CONT_OPTEF	CMP.W	-2(A2),D0
	BNE.S	ADEF2
	ADDQ.W	#2,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF2	CMP.W	-2(A2),D1
	BNE.S	ADEF3
	ADDQ.W	#4,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF3	CMP.W	-2(A2),D2
	BNE.S	ADEF4
	ADDQ.W	#6,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF4	CMP.W	-2(A2),D3
	BNE.S	ADEF5
	ADDQ.W	#8,ADD1
	SUBQ.L	#2,A2
	BRA	CONT_OPTEF
ADEF5	CMP.W	-4(A2),D4
	BNE.S	FIN_OPTEF
	MOVE.W	-2(A2),D0
	ADD.W	D0,ADD1
	MOVE.W	#$5448,D0
	SUBQ.L	#4,A2
	BRA	CONT_OPTEF
FIN_OPTEF	TST.W	ADD1
	BEQ	FINI_OPTEF
	CMPI.W	#8,ADD1
	BGT	MAK_LEAEF
	CMPI.W	#2,ADD1
	BNE.S	TESTEF2
	MOVE.W	#$5448,(A2)+
	BRA	FINI_OPTEF
TESTEF2	CMPI.W	#4,ADD1
	BNE.S	TESTEF3
	MOVE.W	#$5848,(A2)+
	BRA	FINI_OPTEF
TESTEF3	CMPI.W	#6,ADD1
	BNE.S	TESTEF4
	MOVE.W	#$5C48,(A2)+
	BRA	FINI_OPTEF
TESTEF4	MOVE.W	#$5048,(A2)+
	BRA	FINI_OPTEF
MAK_LEAEF	MOVE.W	#$41E8,(A2)+
	MOVE.W	ADD1,(A2)+
FINI_OPTEF	RTS

EFFACE	MOVE	#7999,D0
EFF_	CLR.L	(A0)+
	DBF	D0,EFF_
	RTS
INTERLUDE
	MOVE	#19,D1
KK	MOVE	#19,D0
AK	MOVE	(A0)+,(A1)
	LEA	8(A1),A1
	DBF	D0,AK
	DBF	D1,KK
	RTS

decrunch:	movem.l d0-a6,-(sp)
	cmpi.l	#'Ice!',(a0)+
	bne.s	ice_03
	move.l	(a0)+,d0
	lea	-8(a0,d0.l),a5
	move.l	(a0)+,(sp)
	movea.l a1,a4
	movea.l a1,a6
	adda.l	(sp),a6
	movea.l a6,a3
	bsr.s	ice_08
	bsr.s	ice_04
	bsr	ice_0c
	bcc.s	ice_03
	move.w	#$0f9f,d7
ice_00:	moveq	#3,d6
ice_01:	move.w	-(a3),d4
	moveq	#3,d5
ice_02:	add.w	d4,d4
	addx.w	d0,d0
	add.w	d4,d4
	addx.w	d1,d1
	add.w	d4,d4
	addx.w	d2,d2
	add.w	d4,d4
	addx.w	d3,d3
	dbra	d5,ice_02
	dbra	d6,ice_01
	movem.w d0-d3,(a3)
	dbra	d7,ice_00
ice_03:	movem.l (sp)+,d0-a6
	rts
ice_04:	bsr.s	ice_0c
	bcc.s	ice_07
	moveq	#0,d1
	bsr.s	ice_0c
	bcc.s	ice_06
	lea	ice_1a(pc),a1
	moveq	#4,d3
ice_05:	move.l	-(a1),d0
	bsr.s	ice_0f
	swap	d0
	cmp.w	d0,d1
	dbne	d3,ice_05
	add.l	20(a1),d1
ice_06:	move.b	-(a5),-(a6)
	dbra	d1,ice_06
ice_07:	cmpa.l	a4,a6
	bgt.s	ice_12
	rts
ice_08:	moveq	#3,d0
ice_09:	move.b	-(a5),d7
	ror.l	#8,d7
	dbra	d0,ice_09
	rts
ice_0a:	move.w	a5,d7
	btst	#0,d7
	bne.s	ice_0b
	move.l	-(a5),d7
	addx.l	d7,d7
	bra.s	ice_11
ice_0b:	move.l	-5(a5),d7
	lsl.l	#8,d7
	move.b	-(a5),d7
	subq.l	#3,a5
	add.l	d7,d7
	bset	#0,d7
	bra.s	ice_11
ice_0c:	add.l	d7,d7
	beq.s	ice_0d
	rts
ice_0d:	move.w	a5,d7
	btst	#0,d7
	bne.s	ice_0e
	move.l	-(a5),d7
	addx.l	d7,d7
	rts
ice_0e:	move.l	-5(a5),d7
	lsl.l	#8,d7
	move.b	-(a5),d7
	subq.l	#3,a5
	add.l	d7,d7
	bset	#0,d7
	rts
ice_0f:	moveq	#0,d1
ice_10:	add.l	d7,d7
	beq.s	ice_0a
ice_11:	addx.w	d1,d1
	dbra	d0,ice_10
	rts
ice_12:	lea	ice_1b(pc),a1
	moveq	#3,d2
ice_13:	bsr.s	ice_0c
	dbcc	d2,ice_13
	moveq	#0,d4
	moveq	#0,d1
	move.b	1(a1,d2.w),d0
	ext.w	d0
	bmi.s	ice_14
	bsr.s	ice_0f
ice_14:	move.b	6(a1,d2.w),d4
	add.w	d1,d4
	beq.s	ice_16
	lea	ice_1c(pc),a1
	moveq	#1,d2
ice_15:	bsr.s	ice_0c
	dbcc	d2,ice_15
	moveq	#0,d1
	move.b	1(a1,d2.w),d0
	ext.w	d0
	bsr.s	ice_0f
	add.w	d2,d2
	add.w	6(a1,d2.w),d1
	bra.s	ice_18
ice_16:	moveq	#0,d1
	moveq	#5,d0
	moveq	#0,d2
	bsr.s	ice_0c
	bcc.s	ice_17
	moveq	#8,d0
	moveq	#$40,d2
ice_17:	bsr.s	ice_0f
	add.w	d2,d1
ice_18:	lea	2(a6,d4.w),a1
	adda.w	d1,a1
	move.b	-(a1),-(a6)
ice_19:	move.b	-(a1),-(a6)
	dbra	d4,ice_19
	bra	ice_04
	DC.B $7f,$ff,$00,$0e,$00,$ff,$00,$07
	DC.B $00,$07,$00,$02,$00,$03,$00,$01
	DC.B $00,$03,$00,$01
ice_1a:	DC.B $00,$00,$01,$0d,$00,$00,$00,$0e
	DC.B $00,$00,$00,$07,$00,$00,$00,$04
	DC.B $00,$00,$00,$01
ice_1b:	DC.B $09,$01,$00,$ff,$ff,$08,$04,$02
	DC.B $01,$00
ice_1c:	DC.B $0b,$04,$07,$00,$01,$20,$00,$00
	DC.B $00,$20
;***************************************************************************

	DATA
ZIK	INCBIN	SICKEST.MUS
DATA:	INCBIN	A:\IDAT.DAT
	DS.B	160-32

TEXT1	
	DC.B	"      YO POSERS !  ENJOY THE WILD WINGS OF THE WIND..."
	DC.B	"  THIS THUNDER WAVE WAS CODED BY "
	DC.B	"\ZAPPY/ OF \HOLOCAUST/.    IT CAMES OUT OF MY GLOOMY BRAINS"
	DC.B	" LONG MONTHS AGO... AND IN A STATE OF TOTAL MADNESS, SOME CURSED WORDS"
	DC.B	" SUCCEEDED IN MAKING HEADWAY WITHIN MY HEADS.  I HEARD ABOUT THEM.  AND THEY"
	DC.B	" TOLD ME TO CODE.  SO I DID IT.        ...    LORD...    WOT'S...  "
	DC.B	"   SIGNS OF IMPENDING MENTAL COLLAPSE...    TROUBLE VISION...     "
	DC.B	"              ANYHOW, I LIKE THESE RAGING RASTERS. THEY'RE QUITE OLD, I CODED THEM JUST AFTER THE FIRST"
	DC.B	" SNORK PARTY.   BUT I WON'T SPEAK A LOT ABOUT THEM, THERE'S NO USE FOR THIS."
	DC.B	"  YOU JUST HAVE TO PRESS SPACE, NOW.   BECAUSE I STOP HERE. "

	DC.B	"                            ",$FF
	EVEN


DATA_RAST	
	DC.L	$21FC0120
	DC.L	$31D88240
	DC.L	$08B80000
	DC.L	$FA0F4E73

BARRE
COLORS	
	DC	$002,$112,$223,$334,$445,$556,$667,$777
	DC	$767,$756,$645,$534,$423,$312,$201,$100

	DCB	4*7-2,$0

BUFFER_RAST
	DCB	300,$000

Y_DAT
 DC.B 106
 DC.B 109
 DC.B 113
 DC.B 116
 DC.B 120
 DC.B 124
 DC.B 127
 DC.B 131
 DC.B 134
 DC.B 138
 DC.B 141
 DC.B 145
 DC.B 148
 DC.B 152
 DC.B 155
 DC.B 158
 DC.B 161
 DC.B 164
 DC.B 167
 DC.B 170
 DC.B 173
 DC.B 176
 DC.B 178
 DC.B 181
 DC.B 184
 DC.B 186
 DC.B 188
 DC.B 190
 DC.B 193
 DC.B 195
 DC.B 196
 DC.B 198
 DC.B 200
 DC.B 201
 DC.B 203
 DC.B 204
 DC.B 205
 DC.B 206
 DC.B 207
 DC.B 208
 DC.B 209
 DC.B 209
 DC.B 210
 DC.B 210
 DC.B 210
 DC.B 211
 DC.B 210
 DC.B 210
 DC.B 210
 DC.B 209
 DC.B 209
 DC.B 208
 DC.B 207
 DC.B 206
 DC.B 205
 DC.B 204
 DC.B 203
 DC.B 201
 DC.B 200
 DC.B 198
 DC.B 196
 DC.B 195
 DC.B 193
 DC.B 190
 DC.B 188
 DC.B 186
 DC.B 184
 DC.B 181
 DC.B 178
 DC.B 176
 DC.B 173
 DC.B 170
 DC.B 167
 DC.B 164
 DC.B 161
 DC.B 158
 DC.B 155
 DC.B 152
 DC.B 148
 DC.B 145
 DC.B 141
 DC.B 138
 DC.B 134
 DC.B 131
 DC.B 127
 DC.B 124
 DC.B 120
 DC.B 116
 DC.B 113
 DC.B 109
 DC.B 105
 DC.B 102
 DC.B 98
 DC.B 95
 DC.B 91
 DC.B 87
 DC.B 84
 DC.B 80
 DC.B 77
 DC.B 73
 DC.B 70
 DC.B 66
 DC.B 63
 DC.B 59
 DC.B 56
 DC.B 53
 DC.B 50
 DC.B 47
 DC.B 44
 DC.B 41
 DC.B 38
 DC.B 35
 DC.B 33
 DC.B 30
 DC.B 27
 DC.B 25
 DC.B 23
 DC.B 21
 DC.B 18
 DC.B 16
 DC.B 15
 DC.B 13
 DC.B 11
 DC.B 10
 DC.B 8
 DC.B 7
 DC.B 6
 DC.B 5
 DC.B 4
 DC.B 3
 DC.B 2
 DC.B 2
 DC.B 1
 DC.B 1
 DC.B 1
 DC.B 1
 DC.B 1
 DC.B 1
 DC.B 1
 DC.B 2
 DC.B 2
 DC.B 3
 DC.B 4
 DC.B 5
 DC.B 6
 DC.B 7
 DC.B 8
 DC.B 10
 DC.B 11
 DC.B 13
 DC.B 15
 DC.B 16
 DC.B 18
 DC.B 21
 DC.B 23
 DC.B 25
 DC.B 27
 DC.B 30
 DC.B 33
 DC.B 35
 DC.B 38
 DC.B 41
 DC.B 44
 DC.B 47
 DC.B 50
 DC.B 53
 DC.B 56
 DC.B 59
 DC.B 63
 DC.B 66
 DC.B 70
 DC.B 73
 DC.B 77
 DC.B 80
 DC.B 84
 DC.B 87
 DC.B 91
 DC.B 95
 DC.B 98
 DC.B 102
;
 DC.B 106
 DC.B 109
 DC.B 113
 DC.B 116
 DC.B 120
 DC.B 124
 DC.B 127
 DC.B 131
 DC.B 134
 DC.B 138
 DC.B 141
 DC.B 145
 DC.B 148
 DC.B 152
 DC.B 155
 DC.B 158
 DC.B 161
 DC.B 164
 DC.B 167
 DC.B 170
 DC.B 173
 DC.B 176
 DC.B 178
 DC.B 181
 DC.B 184
 DC.B 186
 DC.B 188
 DC.B 190
 DC.B 193
 DC.B 195
 DC.B 196
 DC.B 198
 DC.B 200
 DC.B 201
 DC.B 203
 DC.B 204
 DC.B 205
 DC.B 206
 DC.B 207
 DC.B 208
 DC.B 209
 DC.B 209
 DC.B 210
 DC.B 210
 DC.B 210
 DC.B 211
 DC.B 210
 DC.B 210
 DC.B 210
 DC.B 209
 DC.B 209
 DC.B 208
 DC.B 207
 DC.B 206
 DC.B 205
 DC.B 204
 DC.B 203
 DC.B 201
 DC.B 200
 DC.B 198
 DC.B 196
 DC.B 195
 DC.B 193
 DC.B 190
 DC.B 188
 DC.B 186
 DC.B 184
 DC.B 181
 DC.B 178
 DC.B 176
 DC.B 173
 DC.B 170
 DC.B 167
 DC.B 164
 DC.B 161
 DC.B 158
 DC.B 155
 DC.B 152
 DC.B 148
 DC.B 145
	DC.L	-1

MES_F3
	INCLUDE	COURBRAS.S

PALET	DC.W	$000,$002,$112,$223,$334,$445,$556,$667
	DC.W	$777,$772,$762,$650,$540,$430,$320,$210

	
TEXT1_ZOOM
	DC.B "                            ",$A
	DC.B "                            ",$A
	DC.B "                            ",$A
	DC.B "  THIS ZOOMER WAS CODED BY \ZAPPY/ OF *HOLOCAUST* ",$A,$D,$D
	DC.B "  I SEND GREETINGS TO SOME FRIENDS:",$A,$D
	DC.B "        * OXYGENE ( SYSOP OF LEADER: 34.66.03.57 )",$A,$D
	DC.B "        * MEGA1 ( AND ISABELLE...... )",$A,$D
	DC.B "        * PANZERBOY ( NICE SENDINGS! )",$A,$D
	DC.B "        * TOUBAB ( HOW DO YA LIKE THIS ? )",$A,$D
	DC.B "        * MARCO POLO ( THANKS FOR ALL!)",$A,$D
	DC.B "        * CRAM ( YOUHOU! )",$A,$D
	DC.B "        * MIC DAX ( HOPE U'LL READ THIS! )",$A,$D
	DC.B "        * THE U-EMPIRE ( ALL CRAZY MEMBERS )",$A,$D
	DC.B "        * KILLER D ( AND ALAIN... )",$A,$D
	DC.B "        * IKI ( ART RULES, LET'S DREAM! )",$A,$D
	DC.B "        * SKAVEN OF THE MASTERS ( THANKS FOR ALL! )",$A,$D
	DC.B "        * SARAYAN ( HI TO THE POWERHEADS! )",$A,$D
	DC.B "        * BRAIN ( THANKS A LOT FOR YOUR HELP! )",$A,$D
	DC.B "        * ROBOCAMP OF VMAX",$A,$D
	DC.B "        * DARKNESS ( NO! I DON'T FORGET YA! )",$A,$D
	DC.B "        * SLIDE NEUROX ( HI! )",$A,$D
	DC.B "        * GERONIMO ( HI! )",$A,$D
	DC.B "        * STS",$A,$D
	DC.B "        * ODC",$A,$D
	DC.B "        * SURFWILLY",$A,$D
	DC.B "        * CEDRIC AND HIS BROTHERS... ",$A,$D
	DC.B "                            ",$A
	DC.B $D,"   AND OF COURSE TO...  \FRIZOTUS/ ! "
	
	DC.B	$FF

FONT8_8	
	DC.B	0,0,0,0,0,0,0,0
	DC.B 24,24,48,48,0,96,96,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B 24,24,48,0,0,0,0,0
	DC.B 24,56,48,48,48,56,24,0
	DC.B 48,56,24,24,24,56,48,0
	DC.B 18,84,56,254,56,84,144,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B 0,0,0,0,48,48,96,0
	DC.B 0,0,0,126,126,0,0,0
	DC.B 0,0,0,0,0,48,48,0
	DC.B 254,0,252,0,248,0,240,0
	DC.B 124,198,206,214,230,198,124,0
	DC.B 24,56,56,24,24,60,60,0
 DC.B 60,94,102,12,24,54,126,0
 DC.B 126,126,6,28,6,126,124,0
 DC.B 28,60,108,204,254,254,12,0
 DC.B 126,126,64,124,6,126,124,0
 DC.B 60,102,96,124,102,102,60,0
 DC.B 126,118,76,12,24,24,24,0
 DC.B 60,102,102,60,102,102,60,0
 DC.B 60,102,102,62,6,6,60,0
 DC.B 0,0,48,48,0,48,48,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	0,0,0,0,0,0,0,0
 DC.B 60,102,102,12,0,24,24,0
	DC.B	0,0,0,0,0,0,0,0
	DC.B	124,230,230,254,230,230,230,0	;A
	DC.B	252,230,230,252,230,230,252,0	;B
	DC.B	124,230,224,224,224,230,124,0	;C
	DC.B	252,230,230,230,230,230,252,0	;D
	DC.B	254,224,224,248,224,224,254,0	;E
	DC.B	254,224,224,248,224,224,224,0	;F
	DC.B	124,230,224,224,238,230,124,0	;G
	DC.B	230,230,230,254,230,230,230,0	;H
	DC.B	124,56,56,56,56,56,124,0	;I
	DC.B	14,14,14,14,14,206,124,0	;J
	DC.B	230,238,252,248,252,238,230,0	;K
	DC.B	224,224,224,224,224,224,254,0	;L
	DC.B	198,238,246,230,230,230,230,0	;M
	DC.B	252,230,230,230,230,230,230,0	;N
	DC.B	124,230,230,230,230,230,124,0	;O
	DC.B	252,230,230,252,224,224,224,0	;P
	DC.B	121,230,230,230,238,252,118,0	;Q
	DC.B	252,230,230,252,236,230,230,0	;R
	DC.B	124,230,224,124,14,206,124,0	;S
	DC.B	254,56,56,56,56,56,56,0	;T
	DC.B	230,230,230,230,230,230,124,0	;U
	DC.B	230,230,230,230,230,124,56,0	;V
	DC.B	230,230,230,230,254,238,198,0	;W
	DC.B	198,238,124,56,124,238,198,0	;X
	DC.B	230,230,230,124,56,56,56,0	;Y
	DC.B	254,206,28,56,112,230,254,0	;Z
	DC.B	0,0,0,0,0,0,0,0
 DC.B 254,0,126,0,62,0,30,0

IMG	INCBIN	ZOOM_.DAT
	EVEN
IMG2	INCBIN	ZOOM2_.DAT
	EVEN
PALETTE2
	REPT	2
	DC.W	$100,$200,$300,$400,$500,$600,$700
	DC.W	$710,$720,$730,$740,$750,$760,$770
	DC.W	$771,$772,$773,$774,$775,$776,$777
	DC.W	$677,$577,$477,$377,$277,$177,$077
	DC.W	$066,$055,$044,$033,$022,$011,$001,$001
	ENDR
	EVEN
Z_DAT
n	set	145
	rept	140
	dc	n*160
n	set	n-1
	endr
	
	rept	140
	dc	n*160
n	set	n+1
	endr
	DC.L	-1

PIC	INCBIN	zappy80_.PI1
FIC_OPT	INCBIN	zappy1.OPT
	DS.L	100
COURB	INCBIN	BIGGIE4.CRB
FIN_CRB	DS.L	200
	DC.W	-1

TABLE_SPR	DC.L	DECRUNCHED+34
	DC.L	DECRUNCHED+34+40
	DC.L	DECRUNCHED+34+80

TXT	INCBIN	TXT.DAT
FAD	DC	$111,$222,$333,$444,$555,$666,$777
	DC.L	-1
FAD2	DC	$777,$666,$555,$444,$333,$222,$111
	DC.L	-1
 	SECTION BSS
 	EVEN
DEB_BSS
F_PILE	DS.L 	128
D_PILE	DS.L 	1
FLAG_FAD	DS.L	1
PNT_FAD	DS.L	1
PNT_FAD2	DS.L	1
SAUVE	DS.L	1
ANC_VBL	DS.L	1
ANC_TB	DS.L	1
ANC_ECR	DS.L	1
RES	DS.W	1
ANC_PAL	DS.W	16
SCREEN1:	ds.l	1
SCREEN2:	ds.l	1
MFP1	DS.B	1
MFP2	DS.B	1
MFP3	DS.B	1
MFP4	DS.B	1
MFP5	DS.B	1
MFP6	DS.B	1
MFP7	DS.B	1
MFP8	DS.B	1
MFP9	DS.B	1
MFP10	DS.B	1
SAUVE_HBL	DS.L	1
SAUVE_TMA	DS.L	1
BUF_ZOOM_DAT	DS.B	32000
PREDEC_TAB	DS.L	8
;BUF_DEC	DS.L	(12*81)*8
PNT_CRB	DS.L	1
VARI	DS.W	1
ADD1	DS.W	1
ANNEX	DS.L	1
FLAG_EFF	DS	1
TABLE_GEN	DS.B	600
DECRUNCHED2
DECRUNCHED	DS.B	128*160+66
	DS.B	256
	DS.B	160*8
BUFFER	DS.B	64000
BUF_COD
	DS.B	64000
BUFFERSCR	DS.B	160*8

ADRTXT	DS.L	1
BUFSCR	DS.B	160*8
ADRSAVE	DS.L	1
BUFSAVE	DS.B	160*8
SAVER	DS.L	15
ADRLOGO 	DS.L	1
ADRFONT 	DS.L	1
POINTEUR	DS.L	1
MES_PNT 	DS.L	1
MES_PNT2 	DS.L	1
BIDON   	DS.L	1
TPS	DS.L	1
SCREEN3	DS.L	1
AUGMENTATION	DS.L	1
MEM_LET:	ds.l	1
PART_AFF:	ds.l	1
SAVEA5A6	DS.L	2
POINTA4	DS.L	1
POINTA6	DS.L	1
SAVEA0	DS.L	1
COUL1	DS.W	1
COUL2	DS.W	1
COUL3	DS.W	1
PLUS	DS.L	1
BUF1	DS.L	32
BUF2	DS.L	32
BUF3	DS.L	32
BUF4	DS.L	32
BUF5	DS.L	32
BUF6	DS.L	32
BUF7	DS.L	32
BUF8	DS.L	32
BUF9	DS.L	32
BUF10	DS.L	32
BUF11	DS.L	32
BUF12	DS.L	32
BUF13	DS.L	32
BUF14	DS.L	32
BUF15	DS.L	32
BUF16	DS.L	32
MASQ	DS.L	32
MASQ2	DS.L	32
MASQ3	DS.L	32
MASQ4	DS.L	32
MASQ5	DS.L	32
MASQ6	DS.L	32
MASQ7	DS.L	32
MASQ8	DS.L	32
MASQ9	DS.L	32
MASQ10	DS.L	32
MASQ11	DS.L	32
MASQ12	DS.L	32
MASQ13	DS.L	32
MASQ14	DS.L	32
MASQ15	DS.L	32
MASQ16	DS.L	32
MASQ17	DS.L	32
KLM	DS.L	1
KLM2	DS.L	1
Y_VALUE	DS.L	1
X_VALUE	DS.L	1
KLMB	DS.L	1
KLM2B	DS.L	1
Y_VALUEB	DS.L	1
X_VALUEB	DS.L	1
KLMC	DS.L	1
KLM2C	DS.L	1
Y_VALUEC	DS.L	1
X_VALUEC	DS.L	1
KLMD	DS.L	1
KLM2D	DS.L	1
Y_VALUED	DS.L	1
X_VALUED	DS.L	1
KLME	DS.L	1
KLM2E	DS.L	1
Y_VALUEE	DS.L	1
X_VALUEE	DS.L	1
KLMF	DS.L	1
KLM2F	DS.L	1
Y_VALUEF	DS.L	1
X_VALUEF	DS.L	1
KLMG	DS.L	1
KLM2G	DS.L	1
Y_VALUEG	DS.L	1
X_VALUEG	DS.L	1
KLMH	DS.L	1
KLM2H	DS.L	1
Y_VALUEH	DS.L	1
X_VALUEH	DS.L	1
KLMI	DS.L	1
KLM2I	DS.L	1
Y_VALUEI	DS.L	1
X_VALUEI	DS.L	1
KLMJ	DS.L	1
KLM2J	DS.L	1
Y_VALUEJ	DS.L	1
X_VALUEJ	DS.L	1
KLMK	DS.L	1
KLM2K	DS.L	1
Y_VALUEK	DS.L	1
X_VALUEK	DS.L	1
KLML	DS.L	1
KLM2L	DS.L	1
Y_VALUEL	DS.L	1
X_VALUEL	DS.L	1
KLMM	DS.L	1
KLM2M	DS.L	1
Y_VALUEM	DS.L	1
X_VALUEM	DS.L	1
KLMN	DS.L	1
KLM2N	DS.L	1
Y_VALUEN	DS.L	1
X_VALUEN	DS.L	1
KLMO	DS.L	1
KLM2O	DS.L	1
Y_VALUEO	DS.L	1
X_VALUEO	DS.L	1
KLMP	DS.L	1
KLM2P	DS.L	1
Y_VALUEP	DS.L	1
X_VALUEP	DS.L	1
MES_PNT3	DS.L	1
PNT	DS.L	1	
POINT2	DS.L	1
NB_PART	DS.L	1
BUF_LET	DS.B	(1*8)*2
LIGNE	DS.L	1
LIGNE2	DS.L	1
CNT_ZOOM	DS.L	1
CNT_ZOOM2	DS.L	1
FLAG	DS.L	1
POINT	DS.L	1
PART_	DS.L	1
X_VALUE_ZOOM	DS.L	1
X_VALUE_ZOOM2	DS.L	1
Y_VALUE_ZOOM	DS.L	1
BUFFER_	DS	256
BUFFER2	DS	256
z	ds.l	7*2
BUF_ZOOM_DAT2	DS.B	32000
*
	DS.B	95000
END_BSS