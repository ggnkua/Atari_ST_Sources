*********************************************************
*SPECIAL ROUTINE THAT PRECALCS A PIECE OF CODE TO ERASE *
* THE SIDES                                             *
*********************************************************

PREPARE_SIDES:
	MOVEQ	#$5C,D0
	MOVEQ	#$2E,D1
	MOVEQ	#-$5C,D3
	MOVEQ	#$3E,D4			HEIGHT OF POLYGON
	MOVEQ	#$7C,D5

	LEA	GRAD_TABLE+640(PC),A1
	LEA	POLYGON_IMG,A2
	
	MULS	(A1,D5.W),D3
	ADD.L	D3,D3

	SWAP	D3
	MOVEQ	#0,D7
	MOVEQ	#61,D4
.M_LOOP
	MOVE.W	D0,(A2)+
	ADD.L	D3,D0
	ADDX.W	D7,D0
	DBF	D4,.M_LOOP

	LEA	START_CODE_HERE(PC),A0
	LEA	POLYGON_IMG,A1
	LEA	.RIGHT_MASKS(PC),A2
	MOVE.L	#(Y_MIDDLE+45)*160,D0
	MOVEQ	#61,D7
.LINE_GEN_LOOP
	MOVE.L	D0,D3
	MOVE.L	D0,D4
	ADD.L	#152,D4

	MOVE.W	(A1)+,D1
	MOVE.W	D1,D5
	AND.W	#$F,D5
	SUB.W	D5,D1
	ADD.W	D5,D5
	ADD.W	D5,D5
	MOVE.W	2(A2,D5.W),D6		RIGHT MASK
	MOVE.W	(A2,D5.W),D5		LEFT MAKS
	LSR.W	#4,D1
	BEQ.S	.NO_LINE_CODE	
	SUBQ.W	#1,D1
.INST_GEN_LOOP:
	MOVE.W	#$3147,(A0)+
	MOVE.W	D3,(A0)+
	MOVE.W	#$3147,(A0)+
	MOVE.W	D4,(A0)+
	ADDQ.W	#8,D3
	SUBQ.W	#8,D4
	DBF	D1,.INST_GEN_LOOP
.NO_LINE_CODE:
	MOVE.W	#$317C,(A0)+
	MOVE.W	D5,(A0)+
	MOVE.W	D3,(A0)+
	MOVE.W	#$317C,(A0)+
	MOVE.W	D6,(A0)+
	MOVE.W	D4,(A0)+

	ADD.L	#160,D0
	DBF	D7,.LINE_GEN_LOOP
	MOVE.W	#$4E75,(A0)+
	RTS
	
.RIGHT_MASKS
	DC.W	%1111111111111111,%1111111111111111
	DC.W	%0111111111111111,%1111111111111110
	DC.W	%0011111111111111,%1111111111111100
	DC.W	%0001111111111111,%1111111111111000
	DC.W	%0000111111111111,%1111111111110000
	DC.W	%0000011111111111,%1111111111100000
	DC.W	%0000001111111111,%1111111111000000
	DC.W	%0000000111111111,%1111111110000000
	DC.W	%0000000011111111,%1111111100000000
	DC.W	%0000000001111111,%1111111000000000
	DC.W	%0000000000111111,%1111110000000000
	DC.W	%0000000000011111,%1111100000000000
	DC.W	%0000000000001111,%1111000000000000
	DC.W	%0000000000000111,%1110000000000000
	DC.W	%0000000000000011,%1100000000000000
	DC.W	%0000000000000001,%1000000000000000

GRAD_TABLE:	INCBIN	N:\LANDGAME.TLB\GRAD_TAB.DAT

