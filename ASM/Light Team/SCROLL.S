; ****************************************************************
; *    A VBL INTERRUPT SCROLLINE FOR 16X16 FOUR BITPLANE FONTS   *
; *  CODED BY THE DISK BUSTER OF THE MEGA MIGHTY LIGHT TEAM 1989 *
; ****************************************************************

 MOVE.L A7,A5
 MOVE.L 4(A5),A5
 MOVE.L $C(A5),D0
 ADD.L $14(A5),D0
 ADD.L $1C(A5),D0
 ADD.L #$1100,D0
 MOVE.L A5,D1
 ADD.L D0,D1
 AND.L #-2,D1
 MOVE.L D1,A7
 MOVE.L D0,-(SP)
 MOVE.L A5,-(SP)
 MOVE.W D0,-(SP)
 MOVE.W #$4A,-(SP)
 TRAP #1
 ADD.L #12,SP

 MOVE.W #0,-(SP)
 MOVE.L #-1,-(SP)
 MOVE.L #-1,-(SP)
 MOVE.W #5,-(SP)
 TRAP #14
 ADD.L #12,SP

 MOVE.W #2,-(SP)
 TRAP #14
 ADDQ.L #2,SP
 MOVE.L D0,SCREEN

 MOVE.L FONTPOINT,A4
 MOVE.W #0,D4
 MOVE.W #15,D5
COLORS:
 MOVE.W 4(A4),-(SP)
 MOVE.W D4,-(SP)
 MOVE.W #7,-(SP)
 TRAP #14
 ADDQ.L #6,SP
 ADD.L #2,A4
 ADD.W #1,D4
 DBRA D5,COLORS
 ADD.L #128,FONTPOINT
 MOVE.L #SCROLLTXT,BOKSTAV
 CLR.W COUNTER

 CLR.L -(SP)
 MOVE.W #$20,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 MOVE.L D0,SUPER
 
MAIN:
 CMP.W #0,COUNTER
 BNE INTE
 MOVE.W #16,COUNTER
 BSR GETBOK
INTE:
 BSR SCROLL
 BSR SCROLL
 BSR COPY
 CMP.B #185,$FFFC02
 BEQ QUIT
 BRA MAIN

GETBOK: MOVE.L BOKSTAV,A0
 ADD.L #1,BOKSTAV
 CLR.L D0
 MOVE.B (A0),D0
 CMP.B #0,D0
 BNE NEXT2
 MOVE.L #SCROLLTXT,BOKSTAV
 BRA GETBOK
NEXT2: CMP.B #32,D0
 BNE NEXT4
 MOVE.L #BOKADR,A0
 MOVE.L (A0),ADDSUM
 RTS
NEXT4: SUB.L #32,D0
 MULU #4,D0
 MOVE.L #BOKADR,A0
 ADD.L D0,A0
 MOVE.L (A0),ADDSUM
 RTS

SCROLL:
 MOVE.L #BUFFER,A1
 ADDA.L #160,A1
 MOVE.L FONTPOINT,A0
 ADDA.L ADDSUM,A0
 MOVE.L #15,D1
LINES16:
 MOVE.L A1,-(SP)
 MOVE.L #3,D2
BITPL:
 CLR.L D0
 ROXL.W #1,D0
 CLR.L D0
 MOVE.W (A0),D0
 ROL.W #1,D0
 MOVE.W D0,(A0)+
 ROXR.W #1,D0
 ROXL.W 152(A1)
 ROXL.W 144(A1)
 ROXL.W 136(A1)
 ROXL.W 128(A1)
 ROXL.W 120(A1)
 ROXL.W 112(A1)
 ROXL.W 104(A1)
 ROXL.W 96(A1)
 ROXL.W 88(A1)
 ROXL.W 80(A1)
 ROXL.W 72(A1)
 ROXL.W 64(A1)
 ROXL.W 56(A1)
 ROXL.W 48(A1)
 ROXL.W 40(A1)
 ROXL.W 32(A1)
 ROXL.W 24(A1)
 ROXL.W 16(A1)
 ROXL.W 8(A1)
 ROXL.W (A1)
 ADDQ.L #2,A1
 DBRA D2,BITPL
 MOVE.L (SP)+,A1
 ADDA.L #160,A1
 ADDA.L #152,A0
 DBRA D1,LINES16
 SUBQ.W #1,COUNTER
 RTS

COPY:
 MOVE.W #37,-(SP)
 TRAP #14
 ADDQ.L #2,SP
 MOVE.L #BUFFER,A0
 MOVE.L SCREEN,A1
 ADDA.L #160*183,A1
 MOVE.L #2559,D5
MOVE:
 MOVE.W (A0)+,(A1)+
 DBRA D5,MOVE
 RTS

QUIT:
 MOVE.L SUPER,-(SP)
 MOVE.W #$20,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 CLR.W -(SP)
 TRAP #1

FONTBUF:                INCBIN 16X16_02.NEO
FONTPOINT:              DC.L FONTBUF
SCREEN:                 DC.L 0
BOKSTAV:                DC.L 0
ADDSUM:                 DC.L 0
COUNTER:		DC.W 0
SUPER:			DC.L 0
VSAVE:			DC.L 0
BOKADR: DC.L 12800,5136,5144,5176,5168,12800,5184,12800
        DC.L 2704,2712,0,5352,2696,5360,2688,5368,2680,2608,2616
        DC.L 2624,2632,2640,2648,2656,2664,2672,5120,5128
        DC.L 2712,0,0,5160,0
        DC.L 0,8,16,24,32,40,48,56,64,72
        DC.L 80,88,96,104,112,120,128,136,144,152
        DC.L 2560,2568,2576,2584,2592,2600
SCROLLTXT:  DC.B 'YEAH! THE SCROLLINE REALLY MOVES!!   ',0
BUFFER:			DS.W 2560
 END 
; ****************************************************************
; *    A VBL INTERRUPT SCROLLINE FOR 16X16 FOUR BITPLANE FONTS   *
; *  CODED BY THE DISK BUSTER OF THE MEGA MIGHTY LIGHT TEAM 1989 *
; ****************************************************************

 MOVE.L A7,A5
 MOVE.L 4(A5),A5
 MOVE.L $C(A5),D0
 ADD.L $14(A5),D0
 ADD.L $1C(A5),D0
 ADD.L #$1100,D0
 MOVE.L A5,D1
 ADD.L D0,D1
 AND.L #-2,D1
 MOVE.L D1,A7
 MOVE.L D0,-(SP)
 MOVE.L A5,-(SP)
 MOVE.W D0,-(SP)
 MOVE.W #$4A,-(SP)
 TRAP #1
 ADD.L #12,SP

 MOVE.W #0,-(SP)
 MOVE.L #-1,-(SP)
 MOVE.L #-1,-(SP)
 MOVE.W #5,-(SP)
 TRAP #14
 ADD.L #12,SP

 MOVE.W #2,-(SP)
 TRAP #14
 ADDQ.L #2,SP
 MOVE.L D0,SCREEN

 MOVE.L FONTPOINT,A4
 MOVE.W #0,D4
 MOVE.W #15,D5
COLORS:
 MOVE.W 4(A4),-(SP)
 MOVE.W D4,-(SP)
 MOVE.W #7,-(SP)
 TRAP #14
 ADDQ.L #6,SP
 ADD.L #2,A4
 ADD.W #1,D4
 DBRA D5,COLORS
 ADD.L #128,FONTPOINT
 MOVE.L #SCROLLTXT,BOKSTAV
 CLR.W COUNTER

 CLR.L -(SP)
 MOVE.W #$20,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 MOVE.L D0,SUPER
 
MAIN:
 CMP.W #0,COUNTER
 BNE INTE
 MOVE.W #16,COUNTER
 BSR GETBOK
INTE:
 BSR SCROLL
 BSR SCROLL
 BSR COPY
 CMP.B #185,$FFFC02
 BEQ QUIT
 BRA MAIN

GETBOK: MOVE.L BOKSTAV,A0
 ADD.L #1,BOKSTAV
 CLR.L D0
 MOVE.B (A0),D0
 CMP.B #0,D0
 BNE NEXT2
 MOVE.L #SCROLLTXT,BOKSTAV
 BRA GETBOK
NEXT2: CMP.B #32,D0
 BNE NEXT4
 MOVE.L #BOKADR,A0
 MOVE.L (A0),ADDSUM
 RTS
NEXT4: SUB.L #32,D0
 MULU #4,D0
 MOVE.L #BOKADR,A0
 ADD.L D0,A0
 MOVE.L (A0),ADDSUM
 RTS

SCROLL:
 MOVE.L #BUFFER,A1
 ADDA.L #160,A1
 MOVE.L FONTPOINT,A0
 ADDA.L ADDSUM,A0
 MOVE.L #15,D1
LINES16:
 MOVE.L A1,-(SP)
 MOVE.L #3,D2
BITPL:
 CLR.L D0
 ROXL.W #1,D0
 CLR.L D0
 MOVE.W (A0),D0
 ROL.W #1,D0
 MOVE.W D0,(A0)+
 ROXR.W #1,D0
 ROXL.W 152(A1)
 ROXL.W 144(A1)
 ROXL.W 136(A1)
 ROXL.W 128(A1)
 ROXL.W 120(A1)
 ROXL.W 112(A1)
 ROXL.W 104(A1)
 ROXL.W 96(A1)
 ROXL.W 88(A1)
 ROXL.W 80(A1)
 ROXL.W 72(A1)
 ROXL.W 64(A1)
 ROXL.W 56(A1)
 ROXL.W 48(A1)
 ROXL.W 40(A1)
 ROXL.W 32(A1)
 ROXL.W 24(A1)
 ROXL.W 16(A1)
 ROXL.W 8(A1)
 ROXL.W (A1)
 ADDQ.L #2,A1
 DBRA D2,BITPL
 MOVE.L (SP)+,A1
 ADDA.L #160,A1
 ADDA.L #152,A0
 DBRA D1,LINES16
 SUBQ.W #1,COUNTER
 RTS

COPY:
 MOVE.W #37,-(SP)
 TRAP #14
 ADDQ.L #2,SP
 MOVE.L #BUFFER,A0
 MOVE.L SCREEN,A1
 ADDA.L #160*183,A1
 MOVE.L #2559,D5
MOVE:
 MOVE.W (A0)+,(A1)+
 DBRA D5,MOVE
 RTS

QUIT:
 MOVE.L SUPER,-(SP)
 MOVE.W #$20,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 CLR.W -(SP)
 TRAP #1

FONTBUF:                INCBIN 16X16_02.NEO
FONTPOINT:              DC.L FONTBUF
SCREEN:                 DC.L 0
BOKSTAV:                DC.L 0
ADDSUM:                 DC.L 0
COUNTER:		DC.W 0
SUPER:			DC.L 0
VSAVE:			DC.L 0
BOKADR: DC.L 12800,5136,5144,5176,5168,12800,5184,12800
        DC.L 2704,2712,0,5352,2696,5360,2688,5368,2680,2608,2616
        DC.L 2624,2632,2640,2648,2656,2664,2672,5120,5128
        DC.L 2712,0,0,5160,0
        DC.L 0,8,16,24,32,40,48,56,64,72
        DC.L 80,88,96,104,112,120,128,136,144,152
        DC.L 2560,2568,2576,2584,2592,2600
SCROLLTXT:  DC.B 'YEAH! THE SCROLLINE REALLY MOVES!!   ',0
BUFFER:			DS.W 2560
 END 
