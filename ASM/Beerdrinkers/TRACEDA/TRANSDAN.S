; NEODIGI.S
; Beerdrinkers


 MOVE.L A7,A5
 MOVE.L 4(A5),A5
 MOVE.L $C(A5),D0
 ADD.L $14(A5),D0
 ADD.L $1C(A5),D0
 ADD.L #$1100,D0
 MOVE.L A5,D1
 ADD.L D0,D1
 AND.L #-2,D1
 MOVE.L D1,A7
 MOVE.L D0,-(SP)
 MOVE.L A5,-(SP)
 MOVE.W D0,-(SP)
 MOVE.W #$4A,-(SP)
 TRAP #1
 ADD.L #12,SP

; Init graphics.

 MOVE.W #4,-(SP)
 TRAP #14
 ADDQ.L #2,SP
 CMPI.W #2,D0
 BEQ TERM
 DC.W $A000
 DC.W $A00A
 MOVE.W #0,-(SP)
 MOVE.L #-1,-(SP)
 MOVE.L #-1,-(SP)
 MOVE.W #5,-(SP)
 TRAP #14
 ADD.L #12,SP
 MOVE.W #2,-(SP)
 TRAP #14
 ADDQ.L #2,SP
 MOVE.L D0,SCREEN

; Reserve memory for picture data.

 MOVE.L #32128,-(SP)
 MOVE.W #$48,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 MOVE.L D0,NEOPICADR

; OPEN-READ-CLOSE

 MOVE.W #0,-(SP)
 MOVE.L #FILENAME,-(SP)
 MOVE.W #$3D,-(SP)
 TRAP #1
 ADDQ.L #8,SP
 MOVE.W D0,HANDLE

 MOVE.L NEOPICADR,-(SP)
 MOVE.L #32128,-(SP)
 MOVE.W HANDLE,-(SP)
 MOVE.W #$3F,-(SP)
 TRAP #1
 ADD.L #12,SP

 MOVE.W HANDLE,-(SP)
 MOVE.W #$3E,-(SP)
 TRAP #1
 ADDQ.L #4,SP

; Set colors.

 MOVE.L NEOPICADR,A4
 MOVE.W #0,D4
 MOVE.W #15,D5
COLORS:
 MOVE.W 4(A4),-(SP)
 MOVE.W D4,-(SP)
 MOVE.W #7,-(SP)
 TRAP #14
 ADDQ.L #6,SP
 ADD.L #2,A4
 ADD.W #1,D4
 DBRA D5,COLORS

; Put picture to screen smoothly.

RESTART:

 MOVE.L NEOPICADR,A4
 ADD.L #128,A4
 MOVE.L SCREEN,A5
 MOVE.W #199,D4
LINES160:
 CLR.L D5
 MOVE.L #39,D5
LONGW40:
 MOVE.L (A4)+,(A5)+
 DBRA D5,LONGW40
 MOVE.W #37,-(SP)
 TRAP #14
 ADDQ.L #2,SP
 DBRA D4,LINES160
;
 MOVE.L #2757,-(SP)
 MOVE.W #$48,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 MOVE.L D0,PLAY

 MOVE.L #242216,-(SP)
 MOVE.W #$48,-(SP)
 TRAP #1
 ADDQ.L #6,SP
 MOVE.L D0,BUFFER

 CLR.W -(SP)
 MOVE.L #PLAY_FILE,-(SP)
 MOVE.W #$3D,-(SP)
 TRAP #1
 ADDQ.L #8,SP
 MOVE.W D0,HANDLE
 MOVE.L PLAY,-(SP)
 MOVE.L #2757,-(SP)
 MOVE.W HANDLE,-(SP)
 MOVE.W #$3F,-(SP)
 TRAP #1
 ADD.L #12,SP
 MOVE.W HANDLE,-(SP)
 MOVE.W #$3E,-(SP)
 TRAP #1
 ADDQ.L #4,SP
 CLR.W -(SP)
 MOVE.L #BUFFER_FILE,-(SP)
 MOVE.W #$3D,-(SP)
 TRAP #1
 ADDQ.L #8,SP
 MOVE.W D0,HANDLE
 MOVE.L BUFFER,-(SP)
 MOVE.L #242216,-(SP)
 MOVE.W HANDLE,-(SP)
 MOVE.W #$3F,-(SP)
 TRAP #1
 ADD.L #12,SP
 MOVE.W HANDLE,-(SP)
 MOVE.W #$3E,-(SP)
 TRAP #1
 ADDQ.L #4,SP
MAIN:
 MOVE.L PLAY,A0
 ADD.L #28,A0
 MOVE.L BUFFER,2(A0)
 MOVE.L #242216,6(A0)
 MOVE.L #2,10(A0)
 JSR (A0)
 BRA MAIN
TERM:
 CLR.W -(SP)
 TRAP #1
;
 ALIGN
PLAY: DC.L 0
BUFFER: DC.L 0
HANDLE: DC.W 0
PLAY_FILE: DC.B 'PLAY.DAT',0
BUFFER_FILE: DC.B 'GOGOOOOO.SAM',0
 ALIGN
NEOPICADR: DC.L 0
 ALIGN
FILENAME: DC.B 'DIGIDEMO.NEO',0
 ALIGN
SCREEN: DC.L 0

 END

?