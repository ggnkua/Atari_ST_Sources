MODULE tmath;
__IMP_SWITCHES__
__DEBUG__
#ifdef HM2
#ifdef __LONG_WHOLE__
(*$!i+: Modul muss mit $i- uebersetzt werden! *)
(*$!w+: Modul muss mit $w- uebersetzt werden! *)
#else
(*$!i-: Modul muss mit $i+ uebersetzt werden! *)
(*$!w-: Modul muss mit $w+ uebersetzt werden! *)
#endif
#endif

(* 05-Jan-95, Holger Kleinschmidt *)

#if (defined MM2)
IMPORT GEMDOSIO; (*$E MOS *)
#if (defined __DEBUG_CODE__)
IMPORT TOSDebug;
#endif
#endif

FROM PORTAB IMPORT
(* TYPE *) SIGNED;

FROM RealMath IMPORT
(* CONST*) pi,
(* PROC *) sqrt, exp, ln, sin, cos, tan, arcsin, arccos, arctan, power, round;

FROM TMathUtil IMPORT
(* VAR  *) MaxErr, Digs, procname, procR2R, procR2I, procRR2R,
(* PROC *) WriteErr, TestR2R, TestR2I, TestRR2R;

FROM InOut IMPORT WriteString, Write, WriteLn;
FROM pOUT IMPORT PutReal, PutInt;

(*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*)

(* Die fr die Tests verwendeten Argumente stammen aus den Testdateien
 * der pml (GNU-C).
 * Die Werte wurden mit CLISP und > 30 Dezimalstellen Genauigkeit
 * berechnet: (SETF (LONG-FLOAT-DIGITS) 100).
 * Die Werte in den pml-Tests stimmen manchmal nicht.
 *)
CONST
sin1 = 4.999999999999999999997916666666666E-11;
sin2 = 0.0E+0;
sin3 = 2.474039592545229295968487048493892E-1;
sin4 = 4.794255386042030002732879352155714E-1;
sin5 = 7.07106781186547524400844362104849E-1;
sin6 = -7.07106781186547524400844362104849E-1;
sin7 = 8.41470984807896506652502321630299E-1;
sin8 = 9.092974268256816953960198659117449E-1;
sin9 = 5.984721441039564940518547021861623E-1;
sin10 = -3.507832276896198481203688000436356E-1;
sin11 = -7.56802495307928251372639094511829E-1;
sin12 = -9.58924274663138468893154406155994E-1;
sin13 = -2.794154981989258728115554466118948E-1;
sin14 = 9.379999767747388579484637981490472E-1;
sin15 = 9.893582466233817778081235982452887E-1;
sin16 = 4.121184852417565697562725663524351E-1;
sin17 = -7.515112046180930728348250453400693E-2;
sin18 = -4.794255386042030002732879352155714E-1;
sin19 = -8.41470984807896506652502321630299E-1;
sin20 = -9.092974268256816953960198659117449E-1;
sin21 = -5.984721441039564940518547021861623E-1;
sin22 = 3.507832276896198481203688000436356E-1;
sin23 = 7.56802495307928251372639094511829E-1;
sin24 = 9.58924274663138468893154406155994E-1;
sin25 = 7.0554032557039190623191917552207E-1;
sin26 = -2.1511998808781552429694574907473173E-1;
sin27 = -9.379999767747388579484637981490472E-1;
sin28 = -9.893582466233817778081235982452887E-1;
sin29 = -4.121184852417565697562725663524351E-1;
sin30 = 7.515112046180930728348250453400693E-2;

cos1 = 9.9999999999999999999875E-1;
cos2 = 1.0E+0;
cos3 = 8.775825618903727161162815826038297E-1;
cos4 = 5.403023058681397174009366074429767E-1;
cos5 = -4.1614683654714238699756822950076215E-1;
cos6 = -8.011436155469337148335027904673516E-1;
cos7 = -9.364566872907963376986576266717605E-1;
cos8 = -6.536436208636119146391681830977504E-1;
cos9 = 2.836621854632262644666391715135573E-1;
cos10 = 7.086697742912600000274211813258438E-1;
cos11 = 9.765876257280234998863132539440693E-1;
cos12 = 3.466353178350258109716193361718955E-1;
cos13 = -1.4550003380861352586884138183119466E-1;
cos14 = -9.111302618846769883682947111811654E-1;
cos15 = -9.97172156196378472891601640177988E-1;
cos16 = 8.775825618903727161162815826038297E-1;
cos17 = 5.403023058681397174009366074429767E-1;
cos18 = -4.1614683654714238699756822950076215E-1;
cos19 = -8.011436155469337148335027904673516E-1;
cos20 = -9.364566872907963376986576266717605E-1;
cos21 = -6.536436208636119146391681830977504E-1;
cos22 = 2.836621854632262644666391715135573E-1;
cos23 = 9.601702866503660205456522979229243E-1;
cos24 = 9.765876257280234998863132539440693E-1;
cos25 = 3.466353178350258109716193361718955E-1;
cos26 = -1.4550003380861352586884138183119466E-1;
cos27 = -9.111302618846769883682947111811654E-1;
cos28 = -9.97172156196378472891601640177988E-1;

tan1 = 2.185039863261518991643306102313683E+0;
tan2 = -1.55740772465490223050697480745836E+0;
tan3 = -5.463024898437905132551794657802854E-1;
tan4 = 0.0E+0;
tan5 = 4.142135623730950488016887242096981E-1;
tan6 = 2.553419212210362665044822364904736E-1;
tan7 = 5.463024898437905132551794657802854E-1;
tan8 = 1.0E+0;
tan9 = -1.0E+0;
tan10 = 1.55740772465490223050697480745836E+0;
tan11 = -2.185039863261518991643306102313683E+0;

sqrt1 = 0.0E+0;
sqrt2 = 2.2360679774997896964091736687312763E-1;
sqrt3 = 5.0E-1;
sqrt4 = 7.07106781186547524400844362104849E-1;
sqrt5 = 1.0E+0;
sqrt6 = 1.414213562373095048801688724209698E+0;
sqrt7 = 3.162277660168379331998893544432719E+0;
sqrt8 = 5.477225575051661134569697828008021E+0;
sqrt9 = 8.366600265340755479781720257851875E+0;
sqrt10 = 1.4142135623730950488016887242096976E+1;
sqrt11 = 1.414213562373095048801688724209698E+16;
sqrt12 = 1.772453850905516027298167483341145E+0;

exp1 = 4.248354255291588995329234782858658E-18;
exp2 = 9.357622968840174604915832223378708E-14;
exp3 = 2.0611536224385578279659403801558216E-9;
exp4 = 4.53999297624848515355915155605506E-5;
exp5 = 1.353352832366126918939994949724844E-1;
exp6 = 3.678794411714423215955237701614609E-1;
exp7 = 7.788007830714048682451702669783207E-1;
exp8 = 1.0E+0;
exp9 = 1.2840254166877414840734205680624365E+0;
exp10 = 2.718281828459045235360287471352662E+0;
exp11 = 7.389056098930650227230427460575009E+0;
exp12 = 2.202646579480671651695790064528424E+4;
exp13 = 4.851651954097902779691068305415405E+8;
exp14 = 1.0686474581524462146990468650741403E+13;
exp15 = 2.353852668370199854078999107490348E+17;

ln1 = -2.995732273553990993435223576142541E+0;
ln2 = -1.386294361119890618834464242916353E+0;
ln3 = -6.931471805599453094172321214581766E-1;
ln4 = 0.0E+0;
ln5 = 6.931471805599453094172321214581766E-1;
ln6 = 1.386294361119890618834464242916353E+0;
ln7 = 2.302585092994045684017991454684364E+0;
ln8 = 3.40119738166215537541323669160689E+0;
ln9 = 3.912023005428146058618750787910551E+0;
ln10 = 5.298317366548036677453215030826904E+0;
ln11 = 7.437587015636940719799295867135784E+1;

arcsin1 = -1.570796326794896619231321691639751E+0;
arcsin2 = -7.753974966107530637403533527149874E-1;
arcsin3 = -2.013579207903307914551255522176234E-1;
arcsin4 = 0.0E+0;
arcsin5 = 2.013579207903307914551255522176234E-1;
arcsin6 = 7.753974966107530637403533527149874E-1;
arcsin7 = 1.570796326794896619231321691639751E+0;

arccos1 = 3.141592653589793238462643383279502E+0;
arccos2 = 2.3461938234056496829716750443547387E+0;
arccos3 = 1.7721542475852274106864472438573747E+0;
arccos4 = 1.570796326794896619231321691639751E+0;
arccos5 = 1.3694384060045658277761961394221278E+0;
arccos6 = 7.95398830184143555490968338924764E-1;
arccos7 = 0.0E+0;

arctan1 = 0.0E+0;
arctan2 = 4.995839572194276141000628703484487E-2;
arctan3 = 2.449786631268641541720824812112758E-1;
arctan4 = 3.366748193867271813966986313417664E-1;
arctan5 = 6.107259643892086165437588764902355E-1;
arctan6 = 7.85398163397448309615660845819876E-1;
arctan7 = 1.107148717794090503017065460178537E+0;
arctan8 = 1.4994888620096062927989507017866583E+0;
arctan9 = 1.537475330916649422075173902618357E+0;
arctan10 = 1.5507989928217460861705684947381548E+0;
arctan11 = 1.5565115842074999887948100780606037E+0;
arctan12 = 1.55968567289728914662229624053173E+0;
arctan13 = 1.5657963684609382970584856345706416E+0;

(*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*)

BEGIN (* tmath *)
 procname := "sqrt";
 procR2R  := sqrt;
 TestR2R(0.0, sqrt1);
 TestR2R(0.05, sqrt2);
 TestR2R(0.25, sqrt3);
 TestR2R(0.5, sqrt4);
 TestR2R(1.0, sqrt5);
 TestR2R(2.0, sqrt6);
 TestR2R(10.0, sqrt7);
 TestR2R(30.0, sqrt8);
 TestR2R(70.0, sqrt9);
 TestR2R(2.0E2, sqrt10);
#ifndef MM2
 TestR2R(2.0E32, sqrt11);
#endif
 TestR2R(pi, sqrt12);
 WriteLn;

 procname := "exp";
 procR2R  := exp;
 TestR2R(-40.0, exp1);
 TestR2R(-30.0, exp2);
 TestR2R(-20.0, exp3);
 TestR2R(-10.0, exp4);
 TestR2R(-2.0, exp5);
 TestR2R(-1.0, exp6);
 TestR2R(-0.25, exp7);
 TestR2R(0.0, exp8);
 TestR2R(0.25, exp9);
 TestR2R(1.0, exp10);
 TestR2R(2.0, exp11);
 TestR2R(10.0, exp12);
 TestR2R(20.0, exp13);
 TestR2R(30.0, exp14);
 TestR2R(40.0, exp15);
 WriteLn;

 procname := "ln";
 procR2R  := ln;
 TestR2R(0.05, ln1);
 TestR2R(0.25, ln2);
 TestR2R(0.5, ln3);
 TestR2R(1.0, ln4);
 TestR2R(2.0, ln5);
 TestR2R(4.0, ln6);
 TestR2R(10.0, ln7);
 TestR2R(30.0, ln8);
 TestR2R(50.0, ln9);
 TestR2R(2.0E2, ln10);
#ifndef MM2
 TestR2R(2.0E32, ln11);
#endif
 WriteLn;

 procname := "sin";
 procR2R  := sin;
 TestR2R(5.0E-11, sin1);
 TestR2R(0.0, sin2);
 TestR2R(0.25, sin3);
 TestR2R(0.5, sin4);
 TestR2R(pi / 4.0, sin5);
 TestR2R(-pi / 4.0, sin6);
 TestR2R(1.0, sin7);
 TestR2R(2.0, sin8);
 TestR2R(2.5, sin9);
 TestR2R(3.5, sin10);
 TestR2R(4.0, sin11);
 TestR2R(5.0, sin12);
 TestR2R(6.0, sin13);
 TestR2R(7.5, sin14);
 TestR2R(8.0, sin15);
 TestR2R(9.0, sin16);
 TestR2R(9.5, sin17);
 TestR2R(-0.5, sin18);
 TestR2R(-1.0, sin19);
 TestR2R(-2.0, sin20);
 TestR2R(-2.5, sin21);
 TestR2R(-3.5, sin22);
 TestR2R(-4.0, sin23);
 TestR2R(-5.0, sin24);
 TestR2R(-5.5, sin25);
 TestR2R(-6.5, sin26);
 TestR2R(-7.5, sin27);
 TestR2R(-8.0, sin28);
 TestR2R(-9.0, sin29);
 TestR2R(-9.5, sin30);
 WriteLn;

 procname := "cos";
 procR2R  := cos;
 TestR2R(5.0E-11, cos1);
 TestR2R(0.0, cos2);
 TestR2R(0.5, cos3);
 TestR2R(1.0, cos4);
 TestR2R(2.0, cos5);
 TestR2R(2.5, cos6);
 TestR2R(3.5, cos7);
 TestR2R(4.0, cos8);
 TestR2R(5.0, cos9);
 TestR2R(5.5, cos10);
 TestR2R(6.5, cos11);
 TestR2R(7.5, cos12);
 TestR2R(8.0, cos13);
 TestR2R(9.0, cos14);
 TestR2R(9.5, cos15);
 TestR2R(-0.5, cos16);
 TestR2R(-1.0, cos17);
 TestR2R(-2.0, cos18);
 TestR2R(-2.5, cos19);
 TestR2R(-3.5, cos20);
 TestR2R(-4.0, cos21);
 TestR2R(-5.0, cos22);
 TestR2R(-6.0, cos23);
 TestR2R(-6.5, cos24);
 TestR2R(-7.5, cos25);
 TestR2R(-8.0, cos26);
 TestR2R(-9.0, cos27);
 TestR2R(-9.5, cos28);
 WriteLn;

 procname := "tan";
 procR2R  := tan;
 TestR2R(-2.0, tan1);
 TestR2R(-1.0, tan2);
 TestR2R(-0.5, tan3);
 TestR2R(0.0, tan4);
 TestR2R(pi / 8.0, tan5);
 TestR2R(0.25, tan6);
 TestR2R(0.5, tan7);
 TestR2R(pi / 4.0, tan8);
 TestR2R(-pi / 4.0, tan9);
 TestR2R(1.0, tan10);
 TestR2R(2.0, tan11);
 WriteLn;

 procname := "arcsin";
 procR2R  := arcsin;
 TestR2R(-1.0, arcsin1);
 TestR2R(-0.7, arcsin2);
 TestR2R(-0.2, arcsin3);
 TestR2R(0.0, arcsin4);
 TestR2R(0.2, arcsin5);
 TestR2R(0.7, arcsin6);
 TestR2R(1.0, arcsin7);
 WriteLn;

 procname := "arccos";
 procR2R  := arccos;
 TestR2R(-1.0, arccos1);
 TestR2R(-0.7, arccos2);
 TestR2R(-0.2, arccos3);
 TestR2R(0.0, arccos4);
 TestR2R(0.2, arccos5);
 TestR2R(0.7, arccos6);
 TestR2R(1.0, arccos7);
 WriteLn;

 procname := "arctan";
 procR2R  := arctan;
 TestR2R(0.0, arctan1);
 TestR2R(0.05, arctan2);
 TestR2R(0.25, arctan3);
 TestR2R(0.35, arctan4);
 TestR2R(0.7, arctan5);
 TestR2R(1.0, arctan6);
 TestR2R(2.0, arctan7);
 TestR2R(14.0, arctan8);
 TestR2R(30.0, arctan9);
 TestR2R(50.0, arctan10);
 TestR2R(70.0, arctan11);
 TestR2R(90.0, arctan12);
 TestR2R(200.0, arctan13);
 WriteLn;

 procname := "round";
 procR2I  := round;
 TestR2I(0.0, LIC(0));
 TestR2I(0.1, LIC(0));
 TestR2I(-0.1, LIC(0));
 TestR2I(0.5, LIC(0));
 TestR2I(-0.5, LIC(0));
 TestR2I(0.7, LIC(1));
 TestR2I(-0.7, LIC(-1));
 TestR2I(1.4, LIC(1));
 TestR2I(-1.4, LIC(-1));
 TestR2I(1.5, LIC(2));
 TestR2I(-1.5, LIC(-2));
 TestR2I(1.6, LIC(2));
 TestR2I(-1.6, LIC(-2));
 TestR2I(1.0E5, LIC(100000));
 TestR2I(-1.0E5, LIC(-100000));
END tmath.

