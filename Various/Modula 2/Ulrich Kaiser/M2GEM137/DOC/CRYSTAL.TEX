%format latexg

\documentstyle[11pt,german,makeidx]{article}

\parindent 0pt

%\typein[\nr]{Welches Kapitel? }
%\includeonly{\nr}

\newcommand{\anf}[1]{"`#1"'}
\newcommand{\abk}[1]{#1\@}
\newcommand{\nopagenumber}{\renewcommand{\thepage}{}}
%
%Die folgenden %-Zeichen nicht entfernen!
%
\newcommand{\deflabel}[1]{\bf #1\hfill}%
\newenvironment{deflist}[1]%
{\begin{list}{}%
{\settowidth{\labelwidth}{\bf #1}%
\setlength{\leftmargin}{\labelwidth}%
\addtolength{\leftmargin}{\labelsep}%
\renewcommand{\makelabel}{\deflabel}}}%
{\end{list}}%

\makeindex

\begin{document}

\begin{titlepage}
\begin{center}
{\Huge\bf crystal}\\
\end{center}
\end{titlepage}
%
\tableofcontents

\newpage
\section{EinfÅhrung}
\subsection{Was ist \anf{crystal}?}
\anf{crystal} ist der Versuch, fÅr Modula-2 eine Standard - GEM -
Bibliothek zu schaffen. \anf{crystal}
\begin{itemize}
\item berÅcksichtigt
   \begin{itemize}
   \item ATARI-GEM 1.0, 1.2, 1.4, 3.x, 4.x
   \item MultiGEM, MagiC
   \item GDOS, AMCGDOS, FSMGDOS, SpeedoGDOS, NVDI 2.5
   \item ABC-GEM 2.x,
   \item KAOS-GEM 1.42,
   \item PC-GEM 1.2, PC-GEM 2.x, GEM/3,
   \item X/GEM,
   \item X/GemOnX,
   \end{itemize}
\item fÑngt Unterschiede zwischen den einzelnen GEM~- Versionen ab
\item ist hochportabel
\item ist vollstÑndig angepaût an TopSpeed~- M2, TDI~- M2,
      Megamax~- M2, HÑnisch~- M2/ST, SPC~- M2, LPR~- M2
\item ist teilweise angepaût Logitech~- M2,
      Software Developing System~- M2, Fitted Software Tools~- M2,
      Modular Software~- M2, ana~- M2/ST, FTL~- M2
\item bietet {\Large C}~- nahe Bezeichner,
      aber trotzdem kein Verzicht auf das
      Typenkonzept von Modula, d.h.\@
\item bietet neben Konstanten auch Mengen, AufzÑhlungen, Unterbereiche,
      Prozedurtypen und Pointertypen,
      \anf{QUALIFIED REEXPORT} von Typen und Konstanten,
      Typsynonyme
\item besitzt einen effizienten AES-Aufruf fÅr MC 680x0-Systeme (modifiziertes
      Seimet~ - Verfahren)\index{Seimet - Verfahren}
\item ist frei kopierbar -- der Quelltext liegt offen und kann
      an jedes geeignete Modula~- System angepaût werden
\item bietet eine stÑndig wachsende Zahl zusÑtzlicher Moduln
\end{itemize}

\newpage
\subsection{Vorgeschichte}
\anf{crystal} entstand aus der Situation, daû mit den meisten
ATARI~- Modula~- Systemen zwar GEM~- Programme erstellt werden konnten,
jedoch jeder Hersteller seine eigene Art und Weise, GEM~-
Aufrufe zu tÑtigen, anbot. Es gab also keinen Standard, hîchstens eine
Art \anf{TDI~- Standard}, da TDI wohl einer der ersten Modula~- Compiler
war, der fÅr den GEM~- Rechner ATARI ST verfÅgbar war. Man war sich
einig, daû ein GEM~- Standard aus der Taufe gehoben werden
muûte. Ein Streit entbrannte Åber die Namensgebung und die
Modulaufteilung bzw.\@ die Namensgebung der Moduln. Die originalen
C~- Aufrufe benutzen z.B.\@ einen Unterstrich (\_), den es jedoch im
damaligen Modula~- Standard nach Wirth nicht gab. Und es gab Compiler, die
erlaubten trotzdem einen Unterstrich, andere jedoch hielten sich an Wirth.
Nachdem der Grundstein fÅr \anf{crystal} gelegt worden war, hat es daher
noch einige Zeit gedauert, bis das Konzept von \anf{crystal} klar war.

\subsection{Das Konzept von \anf{crystal}}
Die Namensgebung \index{Namensgebung} bei \anf{crystal} ergibt sich aus dem
jeweiligen C~- Bezeichner,
aus dem die Unterstriche entfernt werden, bei dem die im Bezeichner
enthaltenen
AbkÅrzungen nach Modula~- Manier, sprich in Groû-/ Kleinschreibung
ausgeschrieben werden und dann unter Beibehaltung der Groû-/ Kleinschreibung
wieder zurÅckgekÅrzt werden. Zur Verdeutlichung dient ein Beispiel:

\begin{enumerate}
\item graf\_mkstate
\item grafmkstate
\item GraficsManagerMouseAndKeyboardState
\item GrafMKState
\end{enumerate}

Diese Vorgehensweise erscheint nicht unbedingt naheliegend, stellt jedoch
eine Mîglichkeit dar, aus einem \anf{C~- Look} einen
\anf{Modula~- Look} zu machen, ohne auf die aus der Literatur gelÑufigen
\anf{Buchstabenfolgen} verzichten zu mÅssen und dabei noch die Compiler,
die (noch) keinen Unterstrich zulassen, zu berÅcksichtigen.\\
Soweit Namen fÅr Typen vergeben werden muûten, die in den C~- Bindings
dank des spartanischen Typenkonzepts von C nicht vorgesehen waren,
wurden keine neuen, kÅnstlichen C~-Namen erfunden, sondern
\anf{Modula~- like} Namen gewÑhlt. Diese Namen stellen wohl die
eigentliche Schwierigkeit beim Umstieg von anderen Bibliotheken auf
\anf{crystal} dar.

\newpage
\section{öbersetzen von \anf{crystal}}
\subsection{Arbeiten mit dem PrÑprozessor}
\index{PrÑprozessor}
Was der Programmiersprache C zur PortabilitÑt verhilft, nÑmlich
der C~- PrÑprozessor, verhilft auch Modula~- 2 -- insbesondere bei
systemnahen Dingen wie GEM -- zur PortabilitÑt. Viele Unterschiede
zwischen den verschiedenen Modula~- Compilern (wie auch bei C~- Systemen)
kînnen abgefangen werden.
Es wurde jedoch Wert darauf gelegt, den PrÑprozessor~- Code umso mehr
zu verringern, je hîher ein Modul Åber der GEM~- Systemebene angesiedelt
ist. Hauptmoduln wie die beiliegenden Testprogramme kommen vîllig ohne
PrÑprozessor aus, desweiteren auch viele auf den GEM~- Aufrufen aufbauende,
hîhere Moduln. Dort markiert der PrÑprozessor u.U.\@ nur noch das Datum
und trÑgt die Compileroptionen ein.

Legen Sie von den unter Verwendung des C~- PrÑprocessors~- Codes erstellten
Quelltexten aus dem Verzeichnis \verb|...\src| Kopien an. Diese Kopien
Åbersetzen Sie dann mit einem Shell~- Script, daû z.B.\@ wie folgt lautet
(vgl.\@ \verb|...\bin\mupfel\c.mup|):

\begin{verbatim}
echo cpp $1 fÅr $2...
cpp $1 -D$2 -P -imacros C:\USR\INCLUDE\CRYSTAL.M2H > temp
x2d1 <temp >$1
rm temp
\end{verbatim}

Ein Aufruf dieses Shell~- Scripts kann z.B.\@

\begin{verbatim}
c aes.mod HM2
\end{verbatim}

lauten. Dabei ist \verb|aes.mod| in diesem Beispiel der Name des Quelltextes,
\verb|HM2| eine AbkÅrzung
fÅr einen ganz bestimmten Compiler, s.\@ Liste der Modula~- Compiler.

cpp \index{cpp} ist der C~- PrÑprozessor. Er sollte in einem Verzeichnis
abgelegt sein, in dem er auch von der verwendeten Shell gefunden wird. Das
gleiche gilt fÅr das Script. Meist
ist ein solches Verzeichnis in der Environmentvariablen \verb|PATH=|
aufgelistet. Angenommen, \verb|cpp.ttp| liegt im Verzeichnis
\verb|d:\bin\|
 und \verb|c.mup| im Verzeichnis \verb|d:\usr\local\bin\|,
dann schreiben Sie z.B.\@ im \verb|profile.mup|:
\begin{verbatim}
export PATH="d:\bin;d:\usr\bin;d:\usr\local\bin;."
\end{verbatim}

Mit Hilfe der Option \verb|-D| wird die an das
Script Åbergebene AbkÅrzung als PrÑprozessor~- Konstante definiert. Die
Option \verb|-P| unterdrÅckt unerwÅnschte Kommentare im Output des
PrÑprozessors, die Option \verb|-imacros| lÑdt ein Includefile \index{Includefile}
schon beim Aufruf des PrÑprozessors. Der Name des Verzeichnisses, in dem das
Includefile \verb|crystal.m2h| abgelegt ist, ist natÅrlich an Ihre
eigenen VerhÑltnisse anzupassen. \verb|x2d1| \index{x2d1} ist ein Beautifier,
der Zeilenenden mit \verb|CR LF| abschlieût und ÅberflÅssige Leerzeilen
entfernt. Er sollte ebenfalls in einem Verzeichnis liegen, in dem er von
der verwendeten Shell gefunden wird.
Um sÑmtliche Moduln mit dem PrÑprozessor zu bearbeiten, benutzen Sie am
besten das Script \verb|...\bin\c_all.mup|, das Sie z.B.\@ wie folgt aufrufen:

\begin{verbatim}
c_all HM2
\end{verbatim}

Dieses Script geht davon aus, daû zum aktuellen Verzeichnis die
Unterverzeichnisse \verb|crystal| und \verb|toolbox| existieren.
Passen Sie ggf.\@ dieses Script an Ihre VerhÑltnisse und WÅnsche an.

\newpage
\subsection{Hinweise zu Compilern}

\subsubsection{Fitted Software Tools - Modula V 3.1}
\index{Fitted Software Tools}
Die maximale Anzahl der Bezeichner pro Modul, maxIds, und der dafÅr
reservierte Speicherplatz, idSpace, ist doch etwas zu knapp bemessen.
Starten Sie daher FSTM2 mit der Batchdatei \verb|...\compiler\fstm2\fstm2.bat|.
Denken Sie
daran, daû eine GEM-Applikation noch etwas DOS-Speicher frei lassen
muû. Dies wird z.B.\@ in der Batchdatei \verb|...\compiler\fstm2\fstmake.bat|
gemacht.

Die Anpassung an diesen Compiler ist vorÅbergehend eingestellt, solange
keine Compiler~- Version zur VerfÅgung steht, bei der Prozeduren -- wie
bei anderen Compilern auch -- Sets zurÅckliefern dÅrfen.

\subsubsection{ana - Modula}
\index{ana - Modula}
Dieser Compiler (V 1.9) verlangt noch nach Exportlisten\index{Exportlisten}.
Weiterhin unterstÅtzt
er keinerlei 16~- Bit~- Zahlenoperationen, sondern nur
32~- Bit~- Arithmetik. Beide Features wurden
eine Zeit lang unterstÅtzt, z.B.\@ durch die PrÑprozessor~- Variable
\anf{export} (vgl.\@ noch \verb|PORTAB.DEF|) und \anf{long}, und es waren
portable GEM~- Programme lauffÑhig. Doch mit der Zeit setzte sich die
Meinung durch, daû das oft erforderlich Umwandeln von 16~- Bit~-
GEM~- Daten in 32~- Bit~- Daten und eventuell wieder zurÅck zwar
portabel, aber untragbar war. Wer will, kann \anf{crystal}
insoweit ergÑnzen, daû Quelltexte wieder portabel zu ana~- Modula
werden. Aber vielleicht gibt es mittlerweile eine neuere Version dieses
Compilers?

\subsubsection{TopSpeed - Modula V 1.17}
\index{TopSpeed - Modula V 1.17}
Um mit TopSpeed - Modula ein GEM - Programm linken zu kînnen, sind
die Hinweise in der Zusatzdokumentation unter dem Punkt
\anf{Controlling the Order of Classes} zu beachten, d.h.\@ es
muû die Datei \verb|order.obj| hinzugelinkt werden. Zur Erleichterung
dient die Batchdatei \verb|...\compiler\tsm2_1\gl.bat|. Denken Sie
daran, daû eine GEM-Applikation noch etwas DOS-Speicher frei lassen
muû. Dies wird ebenfalls exemplarisch in der Batchdatei \verb|gl.bat| gemacht.

Weiterhin ist zu beachten, daû die AES- und VDI-EinsprÅnge in den
Assemblermoduln AESSYS und VDISYS getÑtigt werden. Sie befinden sich
im gleichen Verzeichnis wie \verb|gl.bat|.

\subsubsection{HÑnisch - Modula}
\index{HÑnisch - Modula}
Im neuesten HÑnisch Compiler gibt es bereits BYTESET, LONGSET und VOID
als Standardbezeichner. Um einen Konflikt mit dem Modul INTRINSIC
\index{INTRINSIC} zu
vermeiden, muû \verb|HM.ACC| gepatcht werden, d.h.\@ ersetzen Sie obige
Bezeichner z.B.\@ durch BYTESet, LONGSet und Void.

\subsubsection{SPC - Modula}
\index{SPC - Modula}
Compilieren Sie


\begin{verbatim}
MAKE_1ST.CMD (Basis-Moduln)
MAKE_2ND.CMD (nur falls Sie M2POSIX besitzen)
MAKE_3RD.CMD (AES)
MAKE_4TH.CMD (VDI)
MAKE_5TH.CMD (ToolBox)
MAKE_6TH.CMD (Sonstige)
\end{verbatim}

in dieser Reihenfolge.

\subsubsection{TDI - Modula}
\index{TDI - Modula}
Compilieren Sie


\begin{verbatim}
MAKE_1ST.BAT (Basis-Moduln)
MAKE_2ND.BAT (nur falls Sie M2POSIX besitzen)
MAKE_3RD.BAT (AES)
MAKE_4TH.BAT (VDI)
MAKE_5TH.BAT (ToolBox)
MAKE_6TH.BAT (Sonstige)
\end{verbatim}

in dieser Reihenfolge.

\subsubsection{LPR - Modula}
\index{LPR - Modula}
Bei LPR - Modula kommt es beim Compilieren und Linken sowie beim Start des
Debuggers und eventuell auch des LPR~- Editors zu einem Konflikt
zwischen dem bereits vorhandenen
\verb|AES|~- Modul und dem \verb|AES|~- Modul von \anf{crystal}. Entweder
Sie verzichten auf den Debugger und Ñhnliche Programme und verschieben
die Original \verb|AES|~- Moduln (\verb|AES.SBM| und \verb|AES.OBM|)
in ein Verzeichnis, in dem die Dateien vom LPR~- System nicht
gefunden werden oder Sie mÅssen das LPR~- System patchen, siehe dazu
die Datei \verb|...\compiler\lprm2\lprm2.txt|.

Ein Programm, das nur Moduln aus \anf{crystal}
verwendet, benîtigt vom LPR~- System nur \verb|GEMX.OBM|, \verb|SYSTEM.OBM|,
\verb|TERMINAL.OBM| und \verb|HEAP.OBM|.

Mit Hilfe von Dateien, deren Extension auf \verb|*.CM?| lautet, kann man
dem Compiler eine Liste von zu Åbersetzenden Moduln Åbergeben. éndern
Sie zu diesem Zweck einfach die Suchmaske der Fileselektorbox bei
\anf{\verb|Modul auswÑhlen|} von
\verb|*.MOD| nach \verb|*.CM?|, wÑhlen z.B.\@ \verb|MAKE_1ST.CMP|
aus und rufen dann \anf{\verb|Åbersetzen   Ctrl+Å|} auf. öbersetzen Sie


\begin{verbatim}
MAKE_1ST.CMP (Basis-Moduln)
MAKE_2ND.CMP (nur falls Sie M2POSIX besitzen)
MAKE_3RD.CMP (AES)
MAKE_4TH.CMP (VDI)
MAKE_5TH.CMP (ToolBox)
MAKE_6TH.CMP (Sonstige)
\end{verbatim}

in dieser Reihenfolge. Die Reihenfolge dieser Dateien und auch die
darin enthaltene Reihenfolge von Moduln sollte nicht unÅberlegt
geÑndert werden, da in diesen Listen die AbhÑngigkeiten der Moduln
berÅcksichtigt sind.

Um den Heap eines LPRM2~- Compilates zu vergrîûern, muû der Linker
gepatcht werden. Dazu dient das Programm \verb|fixlink.tos| aus dem
Archiv \verb|LPR_UTL?.ZOO|, \index{\verb|LPR_UTL?.ZOO|} welches Sie
sich unbedingt besorgen sollten.
\index{fixlink.tos}

\subsubsection{Modular Software - Modula}
\index{Modular Software - Modula}
FÅr dieses System existiert nur eine grobe Anpassung, da der
Compiler doch sehr viel zu wÅnschen Åbrig lÑût.

\subsubsection{FTL - Modula}
\index{FTL - Modula}
Dieser Compiler scheint irgendwie Probleme mit dem Reexport \index{Reexport}
zu haben.
Tritt beim öbersetzten eines Implementationsmoduls die Fehlermeldung
\anf{Name mehrfach deklariert} auf, ist die angebliche
Mehrfachdeklaration im zugehîrigen Definitionsmodul zu suchen. Bei der
Anpassung an diesen Compiler wurde immerhin soweit Sorge getragen, daû
sich die Testprogramme Hello und VDITest Åbersetzen und ausfÅhren
lassen.

\subsubsection{Anpassung an andere Compiler}
\index{andere Compiler}
ZunÑchst mÅssen in \verb|CRYSTAL.M2H| \index{CRYSTAL.M2H}
alle systemnahen Eigenheiten des
Compilers, z.B. die Anordnung von AufzÑhlungstypen innerhalb von RECORDs,
angegeben werden. In \verb|PORTAB.DEF| mÅssen Typen wie
\verb|UNSIGNEDWORD| festgelegt werden. In \verb|AES.MOD| und \verb|VDI.MOD|
muû der (Assembler~- ) Aufruf von AES und VDI bewÑltigt werden. In
{\mbox AESTool.NewObject()} schlieûlich muû eine C~- kompatible Rahmenfunktion
bereitgestellt werden.

\newpage
\subsection{Hinweise zu den verschiedenen GEM - Versionen}
\subsubsection{ATARI - GEM}
\index{ATARI - GEM}
Das ATARI~- GEM wird mittlerweile von ATARI selbst weiterentwickelt.
Mit dem Betriebssytem TOS 1.04 kamen die neuen AES~- Aufrufe
fsel\_ex\-in\-put() und wind\_new. Mit dem neuen MultiTOS \index{MultiTOS}
werden die AES multi\-tasking\-fÑhig. Die MenÅ~- Bibliothek wird um
Popup~- und SubmenÅs erweitert. Es gibt eine Reihe von neuen
shel\_write()~- Modi.\\
Nicht zu vergessen ist das ABC~-GEM 2.2 \index{ABC - GEM}
der hollÑndischen Firma
ABC~- Software, welches PC~- GEM 2.2 fÅr den ATARI zur VerfÅgung
stellt, incl.\@ einer neuen GEM~- Draw~- Version, GEM~- Paint,
GEM~- Graph, GEM~- Wordchart \index{GEM - Wordchart} und einem neuen
GEM~- Output. Von allen diesen Programmen sind Demo~- Versionen erhÑltlich.

\subsubsection{PC - GEM}
\index{PC - GEM}
Die letzten PC~- GEM~- Versionen machten vor allem durch die
im VDI eingebauten Bezierfunktionen, von denen GEM~- Artline intensiven
Gebrauch machte, von sich reden. Seit GEM 2.x durfte der GEM~-
Desktop (nicht GEM an sich!) aufgrund eines Streites
mit Apple \index{Apple} nur noch zwei Fenster anbieten.

\subsubsection{X/GEM}
\index{X/GEM}
Dies ist ein Realtime - Multitasking~- GEM unter dem Realtime~-
Multitasking~- Operatingsystem FlexOS, beides von DRI. \index{DRI} Man
bedenke, daû es
sehr wenige Realtime~- Multitasking~- Operatingsysteme
\index{Realtime - Multitasking} gibt (UNIX \index{UNIX} ist bis
auf Spezialversionen nicht echtzeitfÑhig!). Daher bilden X/GEM und FlexOS
ein wirklich sehr exklusives Gespann! Es wird hauptsÑchlich zu Meû~-,
Steuer~- und Regelzwecken eingesetzt, z.B.\@ bei Siemens\index{Siemens}.\\
Rein Ñuûerlich ist X/GEM am \anf{PC~- Look} zu erkennen, jedoch ohne
EinschrÑnkung der Fensterzahl. Jede Applikation erhÑlt einen Desktop
in einem Fenster, das in der Grîûe verÑnderbar ist. Selbst der Desktop
des \anf{Desktop} befindet sich in einem Fenster. Darunter befindet sich
dann das Nichts, d.h.\ der blanke Bildschirm. öbrigens gibt es Adimens
auch fÅr X/GEM (Adimens GTX\index{Adimens GTX}).

Auf der Programmierebene bietet X/GEM einen erweiterten EvntMulti()~-
Aufruf: er heiût schlicht EvntEvent() \index{EvntEvent()} und ist
zu EvntMulti() abwÑrtskompatibel.

FlexOS \index{FlexOS} ist POSIX~- orientiert, \index{POSIX} netzwerkfÑhig
und bietet die
Mîglichkeit zur Laufzeit GerÑtetreiber einzubinden. FlexOS lÑuft erst ab
intel 80286 \index{intel 80286} aufwÑrts und hat mit DOS nur noch das
Dateisystem gemeinsam.

\subsubsection{X/GemOnX}
\index{X/GemOnX}
Diese GEM - Version stammt nicht von DRI, sondern von der bayrischen Firma
X/software \index{X/software}. X/GemOnX lÑuft~-- der Name lÑût es schon
vermuten~-- unter
UNIX \index{UNIX} und X~- Windows \index{X - Windows}.
X/GemOnX folgt der Server~- Client~- Architektur\index{Client - Server}.
Einer Applikation werden Libraryfunktionen hinzugelinkt, die Befehle und
Argumente in Pakete packen, Åber UNIX~- Interprozeû~- Kommunikation
(UNIX domain sockets \index{domain sockets} oder TCP/IP\index{TCP/IP}) an
den X/GemOnX~- Server senden, RÅckgabedaten auspacken und der Applikation
zur VerfÅgung stellen. Daneben gibt es asynchrone Mechanismen fÅr die
Events und die user defined objects. Wie bei X~- Windows mÅssen
X/GemOnX~- Clients und X/GemOnX~- Server nicht auf ein und demselben
Rechner laufen. Daraus ergibt sich, daû die Resource \index{Resource} sich im
Adreûraum des X/GemOnX~- Servers befindet, also nicht direkt im Speicher
der Applikation ansprechbar ist. Solange man als C~- Programmierer die
Makros aus \verb|taddr.h| \index{taddr.h} benutzt hat, gibt es keine
Probleme beim Portieren. Die wenigsten werden sich daran gehalten haben
(C~- Programmierer \index{C - Programmierer} halten C fÅr portabel,
programmieren aber zu oft unportable
Dinge damit). Bei \anf{crystal} ist u.a.\ deswegen der Zugriff auf AES~- Objekte Åber
Funktionen aus den Moduln GetObject \index{GetObject} und SetObject
\index{SetObject} obligatorisch.

\newpage
\subsection{\anf{crystal} und M2POSIX}
\index{M2POSIX}
Das M2POSIX~- Paket, erhÑltlich z.B.\@ von
\verb|ftp.atari.archive.umich.edu|, \verb|ftp.uni-kl.de| oder
\verb|ftp.cs.tu-berlin.de| (Dateiname: \verb|M2POSIX??.ZOO|),
enthÑlt wie \anf{crystal} die Moduln \verb|pSTORAGE| und \verb|PORTAB|.
\index{pSTORAGE}\index{PORTAB}
Diese sollte mit denjenigen von \anf{crystal} identisch sein, sodaû man
entweder die einen oder die anderen benutzen kann. NatÅrlich sollte man
\verb|PORTAB| und \verb|pSTORAGE| aus dem M2POSIX~- Paket nicht nochmal
Åbersetzen, nachdem man diejenigen aus \anf{crystal} Åbersetzt hat.
Im Falle von ATARI~- GEM
importiert \anf{crystal} aus dem M2POSIX~- Paket die Funktion
\verb|DosSystem.GetCookie()| sowie einige POSIX~- Funktionen fÅr das
Modul \verb|ScrpMgr|. Der PrÑprozessor gibt Warnmeldungen aus, sobald
Dinge aus M2POSIX benutzt werden.

\newpage
\section{Beschreibung der Moduln}
\subsection{Namensgebung}
SÑmtliche AES~- Moduln besitzen Namen der Form \verb|XXXXMGR.*|. SÑmtliche
VDI~- Moduln beginnen mit einem \verb|V|. Moduln namens \verb|XXXXTOOL.*|
stellen im allgemeinen Erweiterungen zu entsprechenden AES~- und VDI~-
Moduln zur VerfÅgung.

\subsection{Das Modul PORTAB}
\index{PORTAB}

Dieses systemabhÑngige Modul stellt Typen zur VerfÅgung, die jeweils
eine bestimmte Anzahl von Bytes belegen sollen um damit Datenstrukturen
von fremdem Code, z.B.\@ die AES~- und VDI~- Eingabearrays,
nachbilden zu kînnen. Wichtig ist, daû hier systemabhÑngige Dinge
an zentraler Stelle geÑndert werden kînnen. Damit wird dem Vorwurf
von Prof.\@ Wirth \index{Wirth}, daû Modula~- Programmierer zu oft auf
Dinge aus SYSTEM zugreifen, Rechnung getragen.\\
Beispiel fÅr irgendein herausgegriffenes System:

\begin{verbatim}

DEFINITION MODULE PORTAB;

IMPORT SYSTEM;

(* fixed Types *)

TYPE UNSIGNEDBYTE = [0..255];
     SIGNEDBYTE   = [-128..127];
     ANYBYTE      = SYSTEM.BYTE;

     UNSIGNEDWORD = SHORTCARD;
     SIGNEDWORD   = SHORTINT;
     ANYWORD      = SYSTEM.WORD;

     UNSIGNEDLONG = CARDINAL;
     SIGNEDLONG   = INTEGER;
     ANYLONG      = SYSTEM.LONGWORD;

     BYTESET = PACKEDSET OF [0..7];
     WORDSET = PACKEDSET OF [0..15];
     LONGSET = PACKEDSET OF [0..31];

\end{verbatim}

\index{UNSIGNEDBYTE}
\index{SIGNEDBYTE}
\index{ANYBYTE}
\index{UNSIGNEDWORD}
\index{SIGNEDWORD}
\index{ANYWORD}
\index{UNSIGNEDLONG}
\index{SIGNEDLONG}
\index{ANYLONG}
\index{BYTESET}
\index{WORDSET}
\index{LONGSET}

\begin{verbatim}

(* for open Arrays *)

TYPE ANYTYPE = SYSTEM.LOC;

\end{verbatim}

\index{ANYTYPE}

Je nach Compiler mÅssen fÅr typfreie, offene Felder \verb|BYTE|,
\verb|WORD| oder \verb|LOC| aus \verb|SYSTEM| importiert werden.
Der Typ \verb|ANYTYPE| stellt eine portablere Mîglichkeit dar, derartige
Felder zu verwenden.

\begin{verbatim}

(* avoiding SYSTEM.ADDRESS *)

TYPE ANYPOINTER = SYSTEM.ADDRESS;

\end{verbatim}

\index{ANYPOINTER}

Durch \verb|ANYPOINTER| macht man sich auch ein
kleines biûchen \anf{SYS\-TEM\-un\-ab\-hÑn\-gi\-ger}.

\begin{verbatim}

(* all Purpose Procedure Type *)

TYPE ANYPROC = PROCEDURE(ANYPOINTER);

\end{verbatim}

\index{ANYPROC}

\verb|ANYPROC| stellt den allgemeinsten Fall einer Prozedur dar.
Alle Parameter werden durch einen Zeiger auf dieselben Åbergeben.

\begin{verbatim}

(* C-compatible NIL *)

CONST NULL = NIL;

\end{verbatim}

\index{NULL}

Bei systemnaher Programmierung benîtigt man îfters einen Zeiger mit
dem Wert 0. Bei vielen Compilern ist dies gleichbedeutend mit
\verb|NIL|, bei einigen jedoch nicht.
Aus GrÅnden der PortabilitÑt benutze man \verb|NULL|.

\subsection{Das Modul pSTORAGE} \index{pSTORAGE}
Leider ist das gewîhnliche Storage~- Modul nicht portabel. pSTORAGE
schafft Abhilfe.

\subsection{Das Modul RcMgr} \index{RcMgr}
Dieses Modul stellt tatsÑchlich einen Ausschnitt aus dem Quelltext der
AES dar und ist auch ein Bestandteil (zumindest die GRECT~- Struktur
\index{GRECT - Struktur} und
die Funktion rc\_intersect) von C~- Bibliotheken.

\subsection{Das Modul VControl} \index{VControl}
Dieses Modul befaût sich mit den VDI~- Kontrollfunktionen, d.h. Aufrufe rund
um VDI~- Workstations und rund um GDOS.
Die Funktion VOpnWk() \index{VOpnWk()} ermîglicht es, Off-Screen-Bitmaps als
eigene VDI~- Workstation zu behandlen. Weiterhin ist es mîglich, eine
Auflîsung zu Åbergeben, welche bei bestimmten Treibern wirksam ist.
Die Funktion VSTLoadFonts() \index{VSTLoadFonts()} wurde um die unter PC~- GEM
\index{PC - GEM} vorhandenen Parameter erweitert.

\subsection{Das Modul SetObject} \index{SetObject}
\subsection{Das Modul GetObject} \index{GetObject}
Mit Hilfe dieser beiden Moduln kann auf portable Art und Weise auf
die AES~- Objektstrukturen zugegriffen werden, selbst wenn man nicht
so groûen Wert auf PortabilitÑt beispielsweise zu X/GemOnX legt.
Zumindest sollte man GetObject.Type() und SetObject.Type() sowie
GetObject.Extnd() und SetObject.Extnd() benutzen, da der Zugriff auf
den erweiterten Objekttyp \index{erweiterter Objekttyp}
von Compiler zu Compiler unterschiedlich sein kann.

\subsection{Das Modul MenuTool} \index{MenuTool}
Die Funktion MenuKey() behandelt MenÅ~- TastenkÅrzel. Die einem MenÅ\-punkt
zugeordneten TastenkÅrzel, die mit der Control~- oder Alternate~- Taste
gebildet sein mÅssen, werden aus der MenÅ~- Resource selber ausgelesen.
Sie sind somit mit Hilfe eines Resource Construction Sets verÑnderbar.
Die öbersetzung der in der Resource abgelegten TastenkÅrzel~- Zeichenkette
geschieht mit einer Art Tastaturtabelle, die ebenfalls in der Resourcedatei
vorhanden sein muû. Die Tastaturtabelle wird an Hand eines speziellen
Flag im Root~- Objekt erkannt. Diese Tastaturtabelle kann oder muû an
die verschiedenen landesspezifischen Tastaturen und Betriebssysteme
angepaût werden.

\subsection{Das Modul FormTool} \index{FormTool}
Dieses Modul stellt etwas erweiterte Funktionen zu FormMgr zur VerfÅgung,
insbesondere das Retten des Hintergrundrechtecks von Dialogboxen.

\subsection{Das Modul GrafTool} \index{GrafTool}
Dieses Modul stellt ein etwas komfortableres GrafMouse() zur VerfÅgung.
Es Åberwacht die Verschachtelungstiefe und speichert die letzte
Mausform.

\subsection{Das Modul ObjcTool} \index{ObjcTool}
Dieses Modul stellt Routinen zur Object~- Manipulation zur VerfÅgung,
die Åber ObjcMgr und SetObject/GetObject hinausgehen.

\subsection{Das Modul RsrcTool} \index{RsrcTool}
Wird dieses Modul importiert, wird RsrcMgr.RsrcLoad() durch eine
etwas erweiterte Funktion ersetzt, welche eventuelle Fehlermeldungen
in der TOS~- Landessprache ausgibt. Die Funktion GetTreePtr()
korrigiert einen Mangel der AES, welche zu faul sind, Icons und
Images an das physikalische Bildschirmformat \index{Bildschirmformat}
anzupassen. Dies ist wichtig bei PC~- GEM und Grafikkarten.

\subsection{Das Modul AESTool} \index{AESTool}
Dieses Modul ermîglicht die portable Erzeugung sog.\@ user-defined objects.

\subsection{Das Modul ApplTool} \index{ApplTool}
Dieses Modul stellt die ab MultiTOS vorhandene Funktion ApplGetInfo()
zur VerfÅgung. ApplGetInfo() wurde bewuût nicht in ApplMgr aufgenommen,
da die Emulation von ApplGetInfo() sehr viel andere AES~- und VDI~-
Aufrufe benîtigt und dies die Modulhierarchie einigermaûen verkomplizieren
wÅrde.

\newpage
\section{Liste der Modula - Compiler}
\index{Modula - Compiler}

\begin{table}[htbp]
\centering
\begin{tabular}[Standard]{l l l}
AbkÅrzung & Name                   & Hersteller/Vertrieb\\
          &                        &  \\
ANAM2     & ana Modula/ST          & ana systems\\
          &                        & P.O.\@ Box 4759\\
          &                        & Foster City, CA 94404-0759\\
          &                        & USA\\
CM2       & Collier Modula         &  \\
FSTM2     & Fitted Software Modula & Fitted Software Tools\\
          &                        & P.O.\@ Box 867403\\
          &                        & Plano, TX 75086\\
          &                        & USA\\
FTLM2     & FTL Modula/ST          & CCD\\
          &                        & Postfach 1164\\
          &                        & D-6228 Eltville\\
GPM2      & Gardens Point Modula   & A+L AG\\
          &                        & DÑderiz 61\\
          &                        & CH-2540 Grenchen/SO\\
HM2       & HÑnisch Modula/ST/TT   & MoSys G.b.R.\@\\
          &                        & c/o Thomas Uhl\\
          &                        & Obere Heerbergstr.\@ 17\\
          &                        & D-97078 WÅrzburg\\
HSM2      & HiSoft Modula          & HiSoft\\
ISOM2     & ISO-Modula             & - \\
\end{tabular}
\end{table}

\begin{table}[htbp]
\centering
\begin{tabular}[Standard]{l l l}
AbkÅrzung & Name                   & Hersteller/Vertrieb\\
          &                        & \\
JM2       & Jefferson Modula       & Jefferson Software\\
          &                        & 12416 North\\
          &                        & 28th Drive \#18-236\\
          &                        & Phoenix, AZ 85029-2434\\
          &                        & USA\\
LM2       & Logitech Modula        & Logitech Int.\@ S.A.\@\\
          &                        & CH-1122 Romanel/Morges\\
LPRM2     & LPR Modula             & TU MÅnchen\\
MM2       & Megamax Modula         & Application Systems\\
          &                        & Heidelberg GmbH\\
          &                        & Postfach 102646\\
          &                        & D-6900 Heidelberg 1\\
MAMM2     & MAMOS Modula           & Mammut Software\\
          &                        & Pfruendhofstr. 23\\
          &                        & CH-8910 Affoltern/Albis\\
MCSM2     & Modula Cross System    & Beech Tree Systems\\
          &                        & Sorpestr.\@ 41\\
          &                        & D-5788 Winterberg\\
MSM2      & Modular Software Modula& Heim Verlag\\
          & ST Modular             & Heidelberger Landstr.\@ 194\\
          &                        & D-6100 Darmstadt-Eberstadt\\
RM2       & Rowley Modula/ST/TT    & Real Time Associates Ltd. \\
          &                        & Canninghouse\\
          &                        & 59, Canningroad\\
          &                        & Croydon, Surrey (CR06QF)\\
          &                        & UK\\
SBM2      & Stony Brook Modula     & Stony Brook Software\\
SDSM2     & Software Developing    & Interface Technologies\\
          & System                 & Corp.\\
SPCM2     & SPC Modula             & Compo Software\\
TDIM2     & TDI Modula             & TDI Ltd.\@\\
\end{tabular}
\end{table}

\newpage
\begin{table}[htbp]
\centering
\begin{tabular}[Standard]{l l l}
AbkÅrzung & Name                   & Hersteller/Vertrieb\\
          &                        &  \\
TM2       & Taylor Modula          & Heynmîller\\
          &                        & Informationssysteme GmbH\\
          &                        & Oxfordstr. 10\\
          &                        & D-5300 Bonn 1\\
TSM2      & TopSpeed Modula        & A+L AG\\
          &                        & DÑderiz 61\\
          &                        & CH-2540 Grenchen/SO\\
XAM2      & ana Modula/UNIX        & ana systems, s.o.\\
XGPM2     & Gardens Point/UNIX     & A+L AG, s.o.\\
XHM2      & HÑnisch Modula/UNIX    & MoSys G.b.R.\@, s.o.\\
XRM2      & Rowley Modula/UNIX     & Real Time Associates Ltd.\@, s.o.\\
CBM2      & Cambridge Modula/UNIX  & University of Cambridge\\
MWM2      & Metrowerks Modula/UNIX & Metrowerks, Inc.\\
          &                        & The Trimex Building, Rte 11\\
          &                        & Mooers, NY 12958\\
          &                        & USA\\
XTM2      & Taylor Modula/UNIX     & Heynmîller, s.o.\\
MOCM2     & MoCKa/UNIX             & GMD\\
          &                        & c/o JÅrgen Vollmer\\
          &                        & Vincenz-Prieûnitz-Str.\@ 1\\
          &                        & D-76131 Karlsruhe 1
\end{tabular}
\end{table}

\newpage
\section{Literatur}
ATARI ST/TT - Profibuch, SYBEX - Verlag GmbH DÅsseldorf,
ISBN 3-88745-563-0

Obwohl ein ATARI-spezifisches Buch, steht sehr viel Wissenswertes
Åber GEM darin.

\bigskip
Vom AnfÑnger zum GEM-Profi, HÅthig Verlag Heidelberg,
ISBN 3-7785-1792-9

Ein Buch, in dem es nur um GEM geht. Es bietet eine umfangreiche,
jedoch leider in C geschriebene, auf GEM aufsetzende Fensterbibliothek.
Die Quelltexte warten auf ihre öbertragung nach Modula-2.

\bigskip
GEM Programmier-Handbuch, SYBEX - Verlag GmbH DÅsseldorf,
ISBN ?

Hier wird der Quelltext zu Doodle ausfÅhrlich erlÑutert. Die Autoren
sind ehemalige DRI-Mitarbeiter.

\bigskip
Professionell GEM (ProGEM), Antic Publishing

Hîchst interessante Artikelserie des RCS-Autors Tim Oren. ErhÑltlich
in mehreren Dateien aus verschiedenen îffentlichen Quellen.

\bigskip
X/GemOnX, unix/mail 9/91, S.\@ 36 ff.

Ein Artikel, der Åber X/GemOnX einiges berichtet.

\printindex

\end{document}
