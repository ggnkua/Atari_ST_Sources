'
' So, Du wolltst es nicht anders! Hier hast Du den ultimativen Soundplayer
' auf dem ATARI. (Ne', Quatsch)
'
' Dieses kleine Programm spielt Sounds in der XBIOS(32)-Routine ab.
' (Lies im Handbuch nach)
'
' Wie das mit den digitalen Samples geht, daran arbeite ich noch!
'
'
'
' *** Eindimensionale Index-Variable fr 8 Melodien
'
DIM sound$(8)
'
' *** Die Sounds von der Diskette lesen
'
FOR x=1 TO 8
  ' ' '
  OPEN "i",#1,"sound"+STR$(x)+".dat"
  sound$(x)=INPUT$(LOF(#1),#1)
  CLOSE #1
  ' ' '
NEXT x
'
' *** Das Player-Bild von Diskette lesen
'
OPEN "i",#1,"player"
FOR x=1 TO 2
  player$=INPUT$(CVI(INPUT$(2,#1)),#1)
  auswahl$=INPUT$(CVI(INPUT$(2,#1)),#1)
NEXT x
CLOSE #1
'
' *** Das Player-Bild anzeigen
'
PUT 137,85,player$
'
' *** Graphmode transparent
'
GRAPHMODE 3
'
' *** und ab dafr
'
@player
'
' *** es geht los
'
PROCEDURE player
  '
  ' *** kleine Sprungmarke
  '
auswahl:
  '
  ' *** an die Soundroutine (XBIOS(32)) wird ein extern eingeladener Sound-
  ' *** string bergeben
  '
  IF geladen=1
    a=XBIOS(32,L:VARPTR(sound$))
    geladen=0
    GOTO spielen
  ENDIF
  '
  ' *** Der User hat den Ausgang angeklickt und ist dann doch geblieben
  '
  IF aus=1
    OUT 2,7  ! Tastaturclick
    aus=0
    GOTO spielen
  ENDIF
  '
  ' *** Wurde vor dem Versuch das Programm zu verlassen eine Melodie
  ' *** gespielt, wird sie jetzt wiederholt
  '
  a=XBIOS(32,L:VARPTR(sound$(auswahl)))
  '
  ' *** Bildschirmabfrage
  '
spielen:
  DO
    MOUSE x,y,k
    '
    ' *** Feld AUSWAHL
    '
    IF x>160 AND x<259 AND y>148 AND y<169 AND k=1
      '
      ' *** Invers
      '
      PBOX 160,148,259,169
      '
      ' *** kurze Pause
      '
      PAUSE 10
      '
      ' *** wieder normal
      '
      PBOX 160,148,259,169
      '
      ' *** Hintergrund retten
      '
      SGET player$
      '
      ' *** den Auswahlbutton auf den Schirm bringen
      '
      PUT 366,188,auswahl$
      '
      ' *** zur PROCEDURE auswahl verzweigen
      '
      GOSUB auswahl
    ENDIF
    '
    ' *** n„chsten Sound spielen
    '
    IF x>160 AND x<260 AND y>171 AND y<192 AND k=1
      PBOX 160,171,260,192
      PAUSE 10
      PBOX 160,171,260,192
      INC auswahl
      IF auswahl=9
        auswahl=1
      ENDIF
      GOTO auswahl
    ENDIF
    '
    ' *** den Sound zuvor spielen
    '
    IF x>160 AND x<259 AND y>194 AND y<215 AND k=1
      PBOX 160,194,259,215
      PAUSE 10
      PBOX 160,194,259,215
      SUB auswahl,1
      IF auswahl=-1
        auswahl=0
      ENDIF
      GOTO auswahl
    ENDIF
    '
    ' *** anderes XBIOS(32)-File von Diskette laden
    '
    IF x>160 AND x<259 AND y>217 AND y<238 AND k=1
      PBOX 160,217,259,238
      PAUSE 10
      PBOX 160,217,259,238
      CHDIR "\"
      '
      ' *** Fileselectbox zur Verfgung stellen
      '
      FILESELECT "\*.*","",daten$
      '
      ' *** Abbruch angeklickt
      '
      IF daten$=""
        '
        ' *** Skrinkbox erzeugen (oder wie das Ding auch immer heižen mag!)
        '
        abg
        ALERT 1," | |Dann eben nicht! | ",1,"Oha",dummy
        abk
        GOTO auswahl
      ENDIF
      '
      ' *** Ausgesuchtes File ”ffnen
      '
      OPEN "i",#1,daten$
      '
      ' *** Die L„nge des Files feststellen
      '
      laenge=LOF(#1)
      '
      ' *** L„nger als 32000 Bytes geht nicht
      '
      IF laenge>32000
        abg
        ALERT 2," |Dieses File ist viel zu lang |  Was soll ich denn damit? ",1,"Sorry",dummy
        abk
        CLOSE #1
        GOTO auswahl
      ENDIF
      '
      ' *** Variable setzen
      '
      geladen=1
      '
      ' *** neuen Sound einlesen
      '
      sound$=INPUT$(LOF(#1),#1)
      CLOSE #1
      '
      ' *** wieder zur Auswahl zurck
      '
      GOTO auswahl
    ENDIF
    '
    ' *** Tastaturclick abschalten, die Musik wird dann nicht durch den
    ' *** Tastaturclick abgebrochen
    '
    IF x>160 AND x<259 AND y>240 AND y<261 AND k=1
      PBOX 160,240,259,261
      PAUSE 10
      PBOX 160,240,259,261
      abg
      ALERT 0," | Die Musik l„žt sich nicht|mehr durch Taste abschalten! | ",1,"Okey",dummy
      abk
      '
      ' *** n„mlich mit diesem Befehl
      '
      SPOKE 1156,PEEK(1156) AND 14
    ENDIF
    '
    ' *** Tastaturclick wieder ein
    '
    IF x>160 AND x<259 AND y>263 AND y<284 AND k=1
      PBOX 160,263,259,284
      PAUSE 10
      PBOX 160,263,259,284
      abg
      ALERT 0," |Die Musik l„žt sich durch |     Taste abschalten! | ",1,"Okey",dummy
      abk
      '
      ' *** und zwar mit diesem Befehl
      '
      SPOKE 1156,PEEK(1156) OR 1
    ENDIF
    '
    ' *** und Tschss
    '
    IF x>160 AND x<259 AND y>286 AND y<307 AND k=1
      PBOX 160,286,259,307
      PAUSE 10
      PBOX 160,286,259,307
      abg
      ALERT 2," |Das kann doch nicht dein|Ernst sein, oder doch? | ",1,"Nein|Naklar",dummy
      abk
      IF dummy=1
        GOTO auswahl
      ELSE
        END
      ENDIF
    ENDIF
    '
    ' *** Titelzeile angeklickt
    '
    IF x>180 AND x<518 AND y>100 AND y<129 AND k=1
      abg
      ALERT 1," |Hoffentlich nimmt mir das|keiner bel wegen der|Sound-Files!",1,"Schuft!",a
      abk
      ' info
    ENDIF
    '
    ' *** mein Bild angeklickt
    '
    IF x>329 AND x<498 AND y>144 AND y<303 AND k=1
      abg
      ALERT 1," |Ist das nicht ein sch”ner|junger Mann?? | ",1,"Na klar!| N” ",a
      IF a=1
        abg
        ALERT 0," |     DANKE!      |",1," Bitte ",a
        abk
      ELSE
        abg
        ALERT 2," |Du willst Dich wohl mit mir|anlegen?",1," Wut! ",a
        abk
        ' bild
      ENDIF
    ENDIF
  LOOP
RETURN
'
' *** eine bestimmte Melodie wird ausgew„hlt
'
PROCEDURE auswahl
  DO
    MOUSE x,y,k
    '
    ' *** Button 1 angeklickt
    '
    IF x>367 AND x<391 AND y>190 AND y<212 AND k=1
      '
      ' *** revers
      '
      PBOX 368,190,391,212
      '
      ' *** kleine Pause
      '
      PAUSE 10
      '
      ' *** wieder normal
      '
      PBOX 368,190,391,212
      '
      ' *** den geretteten Bildschirm restaurieren
      '
      SPUT player$
      auswahl=1
      '
      ' *** und zurck
      '
      GOSUB player
      ' 1
    ENDIF
    IF x>391 AND x<415 AND y>190 AND y<212 AND k=1
      PBOX 391,190,415,212
      PAUSE 10
      PBOX 391,190,415,212
      SPUT player$
      auswahl=2
      GOSUB player
      ' 2
    ENDIF
    IF x>415 AND x<439 AND y>190 AND y<212 AND k=1
      PBOX 415,190,439,212
      PAUSE 10
      PBOX 415,190,439,212
      SPUT player$
      auswahl=3
      GOSUB player
      ' 3
    ENDIF
    IF x>439 AND x<463 AND y>190 AND y<212 AND k=1
      PBOX 439,190,463,212
      PAUSE 10
      PBOX 439,190,463,212
      SPUT player$
      auswahl=4
      GOSUB player
      ' 4
    ENDIF
    IF x>367 AND x<391 AND y>212 AND y<234 AND k=1
      PBOX 368,212,391,234
      PAUSE 10
      PBOX 368,212,391,234
      SPUT player$
      auswahl=5
      GOSUB player
      ' 5
    ENDIF
    IF x>391 AND x<415 AND y>212 AND y<234 AND k=1
      PBOX 391,212,415,234
      PAUSE 10
      PBOX 391,212,415,234
      SPUT player$
      auswahl=6
      GOSUB player
      ' 6
    ENDIF
    IF x>415 AND x<439 AND y>212 AND y<234 AND k=1
      PBOX 415,212,439,234
      PAUSE 10
      PBOX 415,212,439,234
      SPUT player$
      auswahl=7
      GOSUB player
      ' 7
    ENDIF
    IF x>439 AND x<462 AND y>212 AND y<234 AND k=1
      PBOX 439,212,462,234
      PAUSE 10
      PBOX 439,212,462,234
      SPUT player$
      auswahl=8
      GOSUB player
      ' 8
    ENDIF
    IF x>367 AND x<463 AND y>234 AND y<256 AND k=1
      PBOX 369,235,463,255
      PAUSE 10
      PBOX 369,235,463,255
      SPUT player$
      auswahl=0
      aus=1
      GOSUB player
      ' ausgang
    ENDIF
  LOOP
RETURN
'
' *** hier werden die tollen Effekte erzeugt, wenn eine ALERT-Box zugeht
'
PROCEDURE abk
  @schrumpfbox(MOUSEX,MOUSEY,15,15,189,155,261,108)
RETURN
'
' *** oder wenn sie aufgeht
' *** Ausgehend von der Mausposition wird eine Box (15x15) auf die Gr”že der
' *** ALERT-Box aufgezogen
'
PROCEDURE abg
  @growbox(MOUSEX,MOUSEY,15,15,189,155,261,108)
RETURN
PROCEDURE growbox(xa,ya,b1,h1,xn,yn,b2,h2)
  DPOKE GINTIN,xa
  DPOKE GINTIN+2,ya
  DPOKE GINTIN+4,b1
  DPOKE GINTIN+6,h1
  DPOKE GINTIN+8,xn
  DPOKE GINTIN+10,yn
  DPOKE GINTIN+12,b2
  DPOKE GINTIN+14,h2
  GEMSYS 73+schrumpf%
  schrumpf%=0
RETURN
PROCEDURE schrumpfbox(xa,ya,b1,h1,xn,yn,b2,h2)
  schrumpf%=1
  @growbox(xa,ya,b1,h1,xn,yn,b2,h2)
RETURN
