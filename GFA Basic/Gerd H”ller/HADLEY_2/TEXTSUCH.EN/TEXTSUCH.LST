IF verzweigen=0
  CHDRIVE 1
  CHDIR "a:\hadley_2\textsuch.en"
  verzweigen=1
ENDIF
'
' Dieses kleine Programm ist ein Ausschnitt aus einem PD-Katalog, den ich
' fr einen hiesigen PD-H„ndler programmiert habe. Es wird ein Text geladen
' und auf dem Bildschirm ausgegeben. Das ist noch nichts aužergew”hnliches.
' Die Suchroutine ist mir aber sicherlich gelungen. (Und wieder alles ohne GEM)
'
' *** das Hauptbild laden
'
OPEN "I",#1,"TEXT.PIC"
bild$=INPUT$(32000,#1)
CLOSE #1
'
' *** und ausgeben
'
SPUT bild$
'
' *** der TExt darf max 1000 Zeilen haben
'
DIM pd_text$(1000),such$(1000)
@einlesen
'
' *** der Text wird eingelesen
'
PROCEDURE einlesen
  '
  ' *** kleine Box erzeugen (alles Pseudo, ohne GEM)
  '
  @textbox("Einlesen der gew„hlten Daten","","Geladene Datens„tze:","")
  '
  ' *** sicher ist sicher
  '
  LET text=0
  '
  ' *** datei ”ffnen (geht auch mit FILESELCECT)
  '
  OPEN "I",#1,"171_185.__j"
  '
  ' *** Wer weiž wieviele Zeilen noch kommen
  '
  FOR text=1 TO 1000
    '
    ' *** wieviel Zeilen wurden bereits gelesen?
    '
    PRINT AT(49,14);text
    '
    ' *** wir saugen alles auf und speichern ab in PD_TEXT$(x)
    '
    LINE INPUT #1,pd_text$(text)
    '
    ' *** fr die Suchroutine alles in Grožbuchstaben (komfortabel)
    '
    such$(text)=UPPER$(pd_text$(text))
    '
    ' *** da kommt eine Dateiende
    '
    EXIT IF EOF(#1)
  NEXT text
  '
  ' *** und wieder zu die Dateitr
  '
  CLOSE #1
  '
  ' *** Fllmuster weiž
  '
  DEFFILL 0,0
  '
  ' *** die Pseudobox berkleistern
  '
  PBOX 189,155,450,263
  '
  ' *** den Text ausgeben
  '
  @ausgeben
RETURN
'
' *** wer suchet der findet
'
PROCEDURE suchen
  '
  ' *** kleine Vorbereitung
  '
  aktuell=0
  textende=0
  textanfang=0
  '
  ' *** wir berschreiben alles
  '
  GRAPHMODE 1
  '
  ' *** die jetzt angesprungenen Routinen sind aus dem PD-Programm BCS
  ' *** (die ganze Suchbox wurde mit dem Programm erzeugt)
  ' *** dieses Programm war mal als Listing im ATARI-Magazin und ist auf
  ' *** verschiedenen PD-Serien zu finden
  '
  @double.box(85,33,626,321,2,4)
  @shadow.box(185,42,550,77,0,0)
  DEFTEXT ,0,,13
  TEXT 326,65,"Texte suchen"
  @double.box(97,95,276,268,0,0)
  @double.box(104,224,270,260,0,0)
  @double.box(105,185,270,220,0,0)
  @double.box(105,145,270,180,0,0)
  TEXT 147,125,"Suchen ab:"
  TEXT 122,168,"aktuellen Stelle"
  TEXT 147,208,"Textanfang"
  TEXT 155,248,"Textende"
  DEFTEXT ,0,,4
  TEXT 135,308,""
  @double.box(120,295,588,315,0,0)
  @double.box(290,95,615,180,0,0)
  DEFTEXT ,0,,13
  TEXT 378,117,"Suchstring eingeben"
  DEFTEXT ,0,,6
  TEXT 356,173,"(Leereingabe ist Abbruch)"
  @double.box(290,215,438,250,0,0)
  @double.box(448,190,616,225,0,0)
  @double.box(448,239,616,274,0,0)
  DEFTEXT ,0,,13
  TEXT 338,238,"ABBRUCH"
  TEXT 505,213,"Ausgeben"
  TEXT 490,260,"Weitersuchen"
  @double.box(120,270,313,291,0,0)
  DEFTEXT ,0,,6
  TEXT 155,283,"Gefundener String"
  '
  ' *** transparent, damits invers wird
  '
  GRAPHMODE 3
  DEFFILL 1,1
  '
  ' *** auch diese Mausabfrage entstammt BCS
  '
  DO
    MOUSE x,y,k
    '
    ' *** schon wieder abbrechen?
    '
    IF x>290 AND x<438 AND y>215 AND y<250 AND k=1
      '
      ' *** der angew„hlte Button wird revers
      '
      PBOX 290,215,438,250
      ALERT 0," | Bist Du sicher? | ",1,"Ja|Nein",a
      IF a=1
        SPUT bild$
        @ausgeben
      ELSE
        '
        ' *** der Button wird wieder weiž
        '
        PBOX 290,215,438,250
      ENDIF
    ENDIF
    '
    ' *** suchen ab aktuelle Stelle
    '
    IF x>107 AND x<268 AND y>147 AND y<178 AND k=1
      PBOX 107,147,268,178
      aktuell=1
      suchen=anfang
      '
      ' *** ab zum suchen
      '
      GOTO suchen
    ENDIF
    '
    ' *** suche ab Textanfang
    '
    IF x>107 AND x<268 AND y>187 AND y<218 AND k=1
      PBOX 107,187,268,218
      GOTO suchen
      textanfang=1
    ENDIF
    '
    ' suche ab Textende
    '
    IF x>106 AND x<268 AND y>226 AND y<258 AND k=1
      PBOX 107,226,268,258
      @textende
    ENDIF
  LOOP
  '
  ' *** WIE DIE PFADFINDER
  '
suchen:
  '
  ' *** kleiner Gong
  '
  OUT 2,7
  '
  ' *** nach was soll ich denn suchen?
  '
  PRINT AT(46,9);
  FORM INPUT 20,suchen$
  '
  ' *** nach gar nichts (Leereingabe)
  '
  IF suchen$=""
    ALERT 0," |Soll die Suche abgebrochen |     werden? | ",1,"Ja|Nein",a
    IF a=1
      DEFTEXT 1,,,6
      SPUT lesen$
      @ausgeben
    ELSE
      GOTO suchen
    ENDIF
  ENDIF
  '
  ' *** ab aktueller Stelle
  '
  IF aktuell=1
    suchen=anfang
  ENDIF
  '
  ' *** ab Textanfang
  '
  IF textanfang=1
    suchen=0
  ENDIF
  '
  ' *** also los
  '
  DO
  suchweiter:
    GRAPHMODE 1
    '
    ' *** w„hrend der Suche wurde eine der Maustasten gedrckt
    '
    IF MOUSEK=1 OR INKEY$=" "
      ALERT 0," |Soll die Suche abgebrochen |     werden? | ",1,"Nein|Ja",a
      IF a=2
        DEFTEXT 1,,,6
        SPUT lesen$
        @ausgeben
      ELSE
      ENDIF
    ENDIF
    '
    ' *** wer suchet der findet
    '
    INC suchen
    '
    ' *** der text ist zu Ende
    '
    IF suchen>text
      nix=1
      GOTO weitersuchen
    ENDIF
    '
    ' *** kleiner Text
    '
    DEFTEXT 1,,,4
    '
    ' *** Ausgabefeld l”schen
    '
    TEXT 140,307,SPACE$(65)
    '
    ' *** gerade durchsuchten String ausgeben
    '
    TEXT 140,307,pd_text$(suchen)
    '
    ' *** Jawoll, da wurden wir fndig (gefunden ist gr”žer 1)
    '
    gefunden=INSTR(1,such$(suchen),UPPER$(suchen$))
    IF gefunden>0
      GOTO weitersuchen
    ENDIF
  LOOP
weitersuchen:
  '
  ' ** wenn nichts gefunden, dann
  '
  IF nix=1
    nix=0
    ALERT 0," |Der Text ist zu Ende! | ",1,"Soso",a
    PRINT AT(30,14);SPACE$(21)
    DEFTEXT 1,,,6
    '
    ' *** nochmal versuchen?
    '
    ALERT 0," | Nochmal versuchen? | ",1,"Ja|Nein",a
    IF a=1
      @suchen
    ELSE
      SPUT lesen$
      @ausgeben
    ENDIF
  ENDIF
  '
  ' *** es wurde etwas gefunden, wie gehts nun weiter?
  '
  GRAPHMODE 3
  DEFFILL 1,1
  '
  ' *** den Button "Ausgeben" revers schalten
  '
  PBOX 122,272,311,289
  '
  ' *** den Button "Gefundener String" revers schalten
  '
  PBOX 450,192,614,225
  '
  ' *** den Button weitersuchen revers schalten
  '
  IF weitersuchen=1
    PBOX 450,241,614,272
    weitersuchen=0
  ENDIF
  '
  ' *** noch ein Gong
  '
  OUT 2,7
  '
  ' *** wie solls jetzt weitergehen?
  '
  DO
    MOUSE x,y,k
    '
    ' *** ab gefundener Stelle ausgeben
    '
    IF x>450 AND x<614 AND y>192 AND y<223 AND k=1
      anfang=suchen
      schluss=suchen+25
      DEFTEXT 1,,,6
      @ausgeben
    ENDIF
    '
    ' *** weitersuchen
    '
    IF x>450 AND x<614 AND y>241 AND y<272 AND k=1
      weitersuchen=1
      PBOX 450,192,614,225
      PBOX 450,241,614,272
      PAUSE 10
      PBOX 122,272,311,289
      GOTO suchweiter
    ENDIF
  LOOP
  DO
  LOOP
RETURN
PROCEDURE shadow.box(x%,y%,w%,h%,fstyle%,findex%)
  IF x%>w%
    SWAP x%,w%
  ENDIF
  IF y%>h%
    SWAP y%,h%
  ENDIF
  DEFFILL 1,1
  PBOX x%+2,h%,w%+2,h%+2
  PBOX w%,y%+2,w%+2,h%
  IF fstyle%=4
    BOX x%,y%,w%,h%
  ELSE
    DEFFILL 1,fstyle%,findex%
    PBOX x%,y%,w%,h%
  ENDIF
RETURN
PROCEDURE double.box(x%,y%,w%,h%,fstyle%,findex%)
  IF x%>w%
    SWAP x%,w%
  ENDIF
  IF y%>h%
    SWAP y%,h%
  ENDIF
  IF fstyle%=4
    BOX x%,y%,w%,h%
    BOX x%+2,y%+2,w%-2,h%-2
  ELSE
    DEFFILL 1,0
    PBOX x%,y%,w%,h%
    DEFFILL 1,fstyle%,findex%
    PBOX x%+2,y%+2,w%-2,h%-2
  ENDIF
RETURN
'
' *** hier wird der Text ausgegeben und wie das funktioniert mužt Du schon
' *** selber ausklabustern, schliežlich sollst Du ja was lernen. Ich habe mir
' *** jetzt n„mlich schon die Finger wund geschrieben und keine Lust mehr!
'
PROCEDURE ausgeben
  IF suchen>0
    GOTO ausgeben
  ENDIF
  DEFTEXT 1,,,6
  anfang=1
  schluss=25
ausgeben:
  suchen=0
  SPUT bild$
  zeile=50
  FOR x=anfang TO schluss
    TEXT 85,zeile,pd_text$(x)
    ADD zeile,10
  NEXT x
  ' @flimmer(0,0)
  DO
  ab:
    MOUSE x,y,k
    IF x>81 AND x<208 AND y>350 AND y<370 AND k=1
      IF schluss>text
        ALERT 0,"   Hier ist der Text leider | zu Ende! Es geht zurck zum |           Anfang!",1,"Achwas",a
        anfang=1
        schluss=25
        GOTO ausgeben
      ENDIF
      SPUT bild$
      anfang=schluss
      ADD schluss,25
      GOTO ausgeben
    ENDIF
    IF x>217 AND x<344 AND y>350 AND y<370 AND k=1
      IF anfang-25<0
        ALERT 0," |Also noch weiter zurck gehts | nun wirklich nicht mehr! | ",1,"Achso",a
        GOTO schluss
      ENDIF
      SPUT bild$
      SUB anfang,25
      SUB schluss,25
      GOTO ausgeben
    ENDIF
    IF x>352 AND x<479 AND y>349 AND y<369 AND k=1
      @suchen
    ENDIF
    IF x>488 AND x<615 AND y>348 AND y<368 AND k=1
      ALERT 1,"Wirklich beenden?",1,"Ja|Nein",a
      IF a=1
        END
      ENDIF
    ENDIF
  schluss:
  LOOP
RETURN
PROCEDURE textende
  suchen=text
  OUT 2,7
  PRINT AT(46,9);
  FORM INPUT 20,suchen$
  IF suchen$=""
    abg
    ALERT 0," |Soll die Suche abgebrochen |     werden? | ",1,"Ja|Nein",a
    abk
    IF a=1
      DEFTEXT 1,,,6
      SPUT lesen$
      @ausgeben
    ELSE
      GOTO suchen
    ENDIF
  ENDIF
  DO
  suchweiter1:
    GRAPHMODE 1
    IF MOUSEK=1 OR INKEY$=" "
      abg
      ALERT 0," |Soll die Suche abgebrochen |     werden? | ",1,"Nein|Ja",a
      IF a=2
        abk
        DEFTEXT 1,,,6
        SPUT lesen$
        @ausgeben
      ELSE
        abk
      ENDIF
    ENDIF
    SUB suchen,1
    IF suchen<0
      nix=1
      GOTO weitersuchen1
    ENDIF
    DEFTEXT 1,,,4
    TEXT 140,307,SPACE$(65)
    TEXT 140,307,pd_text$(suchen)
    gefunden=INSTR(1,such$(suchen),UPPER$(suchen$))
    IF gefunden>0
      GOTO weitersuchen1
    ENDIF
  LOOP
weitersuchen1:
  IF nix=1
    nix=0
    abg
    ALERT 0," |Der Text wurde komplett  | durchsucht! | ",1,"Soso",a
    abk
    PRINT AT(30,14);SPACE$(21)
    DEFTEXT 1,,,6
    SPUT lesen$
    @ausgeben
  ENDIF
  GRAPHMODE 3
  DEFFILL 1,1
  PBOX 122,272,311,289
  PBOX 450,192,614,225
  IF weitersuchen=1
    PBOX 450,241,614,272
    weitersuchen=0
  ENDIF
  OUT 2,7
  DO
    MOUSE x,y,k
    IF x>450 AND x<614 AND y>192 AND y<223 AND k=1
      anfang=suchen
      schluss=suchen+25
      DEFTEXT 1,,,6
      SPUT bild$
      @ausgeben
    ENDIF
    IF x>450 AND x<614 AND y>241 AND y<272 AND k=1
      PAUSE 5
      weitersuchen=1
      PBOX 450,192,614,225
      PBOX 450,241,614,272
      PAUSE 5
      PBOX 122,272,311,289
      GOTO suchweiter1
    ENDIF
  LOOP
RETURN
PROCEDURE textbox(t1$,t2$,t3$,t4$)
  BOX 189,155,450,263
  BOX 190,156,449,262
  BOX 192,158,447,260
  PRINT AT(27,12);t1$
  PRINT AT(27,13);t2$
  PRINT AT(27,14);t3$
  PRINT AT(27,15);t4$
RETURN
