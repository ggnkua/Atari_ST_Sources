06601030305800
1
2#
F0110030
9[...................................................]001
€PROGRAMMATIONAVANCEENGfA-BASIC(V)
parDeneb/FantasyetJedi/SectorOne/T.H.K

Aujourd'huinouschangeonsdesujet:aprŠslessprites,voiciles
scrollings.Ledomaine‚tantassezvaste,nousallonsl'illustrer
…traversdiff‚rentspetitsexemples.Lisezlasuitepouren
savoirplus[...]

WHATIZIT?

Lescrollingestl'undeseffetslesplusr‚pandusdansles
d‚mos.Ilsepr‚sentesousplusieursformes.Toutd'abordentant
quesimpled‚filementd'uneimage…l'‚cran,soit
horizontalement,soitverticalement,soitencorelesdeux(
multidirectionellement).Ilestaussipossibleder‚aliserun
effetdeprofondeurenutilisantlescrollingditdiff‚rentiel.
Danschaquecas,ilexisteuntechniquesp‚cifique.Voyonsici
quelques-unesd'entreelles.

LESCROLLINGVERTICALAVECBMOVE

C'estdeloinleplussimple…r‚aliser.Eneffet,vousn'ˆtes
passansignorerquel'instructionBMOVEpermetder‚aliser
facilementdestransferts…laligneprŠs(Nulbesoinde
pr‚d‚calercommedansleseffetshorizontaux).C'estdonccette
fameuseinstructionquenousallonsjudicieusementemployer.
L'exemplepropos‚icipermetdecontroler…l'aidedujoystick(
batondejoiepourlespuristes!),unscrollingverticalqui
repr‚senteradeuximagesmisesbout-…-bout.Latechniqueestfort
simple.Ilfautdansunpremiertempsrecourir…unlargetampon,
nonpaspourdesrŠglestrŠsabondantes,maispourstockerles
deuxdessins…lasuite.Afind'assurerunparfaitchainageentre
lafinduseconddessinetlebouclageduscrolling,ilest
n‚cessairedecopierled‚butdelapremiŠreimage…lafindu
buffer.Cecifait,ilnenousresteplusqu'…calculerl'adresse
…partirdelaquelleletransfertvas'effectuer…chaqueVBL,
pouradmirerunef‚eriedecouleursglissantavecd‚licatesseet
volupt‚survotretubecathodique.
UnederniŠrepr‚cision:lestestsrelatifsaujoystick
n'utilisentpasl'instructionGfAdedi‚e…cetusage:STICK.
Pourquoi?Toutsimplementcarcelle-ciestsyst‚matiquement
refus‚eparlecompilateur.Fortheureusement,leproblŠmeest
facilementcontournableenutilisantdirectementleXBIOS.

9[...................................................]001
>>>INSERERLISTING"LISTING1.LST"<<<

SCROLLVERTICAL,MMOIREVIDEO

Ilexisteuneautrem‚thodepoureffectuerunscrollingvertical.
Elleconsiste…changerl'adressedelam‚moirevid‚ophysique
(imagevisible…l'‚cran).Cettetechniqueal'avantagepar
rapportauxBMOVEsdeneprendrepratiquementaucuntempsmachine
maiscomporte‚galementquelquesinconv‚nients...
Leprogrammepropos‚enexemplecharge2imagesauformat
€N‚ochrome(demˆmepalette)eteneffectueunscrollingvertical
parpasde4pixels.Lamethodeestfortsimple(maissi...),il
suffitdeplacerlesimages…lasuitedansunbufferde64Ko,
etd'initialiser…chaqueVBLl'adressedelam‚moirevideo(au
debutd'unelignedel'image)aumoyendel'instructionsuivante:

VOIDXBIOS(5,L:ecran_logique%,L:ecran_physique%,resolution%)

Noisnouscontenteronsdansnotrelistingdegarderl'adressede
l'ecranphysique(imagevisible)etcelledel'ecranlogique
(imagedetravail)egales.
ToutsepasseraittrŠsbiensiunerestrictiontechnique
n'intervenaitpas:l'adressedes‚cransdoiteneffetˆtre(sur
lesSTF)multiplede256octets.Cecidonneunscrollverticalde
8pixelsdehauteur(=1280octets,divisiblespar256).Pour
avoirunscrollmoinsgrossierilfautdoncdisposerdeplusieurs
‚crans.Parexemple,avecdeux‚crans,onpeutend‚calerunde4
pixelsparrapport…l'autre,cequinousdonnera(commedans
l'exemplepropos‚)unscrollde4par4.Delamˆmefa‡on,nous
pouvonsobtenirunscrollparpasde2endisposantde4‚crans.
Anoterquecesinconv‚nientssontin‚xistantssurSTEvuquel'on
9[...................................................]001
peutadresserlam‚moire‚cranaumotprŠs.

>>>INSERERLISTING"VERTICA.LST"<<<

DESMOTIFSETRIEND'AUTRE

Vous,quiˆtesvraisemblablementpassionn‚parlesd‚mos,avez
certainementd‚jaobserv‚desscrollingsmultidirectionnelsen
guisedefond.Laplupartd'entreeuxutilisentunetechnique
trŠssimple,etquiadeplusl'avantagedeneprendrequepeude
tempsmachine(surtoutenassembleur...Ah!Sil'onpouvait
directementadresserlesregistresenGfA...).
Enfait,lescrollingn'apasr‚ellementlieusurlatotalit‚de
lasurfacesurlaquelleilestvisible.Seulunpetitmotif(sa
taille‚tantsouvent16x16,32x32,voire64x64)estpr‚calcul‚,
etcelui-ciestensuiterecopi‚surl'ensembledel'‚cran.C'est
enquelquesorteun"motifderemplissage",commeledisentsi
bienlesgraphistes.LapremiŠrequestionquisepose…cestade
est:"Commentr‚alisercettefameusecopiedebloc???".C'est
aprŠsquelquessecondesd'intensereflexionquel'onsetape
violemmentlatˆtecontreuneplaqued'‚goutenhurlant:"BMOVE
!!!".Lorsqu'ils'agitdetransfertsimportants,cette
instructionestdeloinlaplusrapide.LeseulproblŠmequepose
sonutilisationestquesilacopie…lieud'unseulcoup,il
nousfautconsidererdeslignesentiŠresetnondesmotifsde
taillequelconque.Nousallonsdoncpr‚calculer,ouplus
exactementpr‚d‚calerdeslignesentiŠres.Quiditpr‚calculsdit
m‚moire,etilfaudra‚viterded‚passerle32x32(etencore...
)pourquelespauvreposesseursde512KodeRAMnese
retournentpascontrevous.
Deuxprogrammessont…votredisposition.Lepremierpermetla
prisedubloc…lasouris,ainsiquelacr‚ationdelacourbeet
lasauvegardedelapalette.Lesecondreprendutilementces
€fichiersafinder‚aliserlescrollingproprementdit.
Encequiconcernelescopiesdumotif,vousremarquerezqu'elles
nesontpasfaitessuccessivement,enreprenantchaquefoisle
motif.Ilesteneffetplusrapidedetransferer64lignesd'un
coupquedeuxfois32.Ici,cettepropri‚t‚deBMOVEestmise…
profit,puisquel'oncopieenfaittoutcequiad‚j…‚t‚affich‚
surl'‚cran.Vousdevrezparcons‚quentrepetercetteop‚ration
autantdefoisquen‚cessaireenfonctiondelahauteurdevotre
motiforiginal.Leprogrammelivr‚iciestpr‚vupourunetaille
detrente-deuxpixels.

>>>INSERERLISTING"LISTING2.LST"<<<

>>>INSERERLISTING"LISTING3.LST"<<<

SCROLLMULTIDIRECTIONNEL,MEMOIREVIDEO

Grƒce…latechniquedechangementdel'adressevid‚o,ilest
possibled'effectuerunscrollmultidirectionneldemotifsen
quasimentaucuntempsmachine.Ils'agitenfait,d'unscroll
unidirectionnelhorizontalementetbi-directionnelverticalement.
Cavousaiderapeut-ˆtresil'onvousditqu'ilesetquestionde
r‚aliseruneffetsimilaire…l'arriŠreplanduresetdes"Cuddly
Demos"dugroupeTCB(Non?Vousnevoyeztoujourspas??!!?!?
).Lescrollhorizontalesteffectu‚parpasdequatresurdes
motifsdeseizepixelsdelarge.Ilsuffitdoncdepr‚calculer
quatre‚cranspr‚d‚cal‚sdequatrepixelsetd'alternerchacune
descesquatreimagespourobtenirled‚filementhorizontal.Pour
lescrollingvertical,nousallonsnousservirdemotifsde
quinzepixelsdehaut(Lesmotifsaurontdoncunetaillede
16x15).Vouscomprenezdoncais‚mentquesurun‚cranremplipar
cesmotifs,und‚calagedelam‚moire-‚crandeseizepixelsvers
lehautvacorrespondre…und‚placementdesmotifsd'unpixel
verslebas.Nousauronsdoncainsiunepr‚cisiond'unpixelen
vertical.Encouplantlesdeuxdirectionsdescrolll'effet
recherch‚seraobtenu.

>>>INSERERLISTING"TCB.LST"<<<

LESSCROLLINGSDIFFRENTIELS

Sanspourautantpr‚tendre‚galerlesfabuleuxscrollings
diff‚rentielsde"ShadowOfTheBeast"(surAmi...),nous
allonsvousproposericilesprincipessimplesdesscrollings
diff‚rentielsdemotifs.Cettem‚thodeconsistecettefois…un
simpleflippingd'‚crandanslesquelslesmotifsduscrolling
sontpr‚calcul‚s.
L'exemplepropos‚offreunscrollingsursix‚crans(cequiest
unboncompromisentreunetropgranderapidit‚descrolletune
restrictionm‚moirehandicapante).Maintenantfermezlesyeux,
concentrez-vousetimaginezunscrollingdiff‚rentilsix‚crans.
Lemotiflepluslentsetrouve"aufond"etsed‚placeparpas
deunpixel,iladoncunelargeurdesixpixelspourpouvoirse
bouclercorrectement.Ensuite,vientlemotifallantdedeuxen
€deuxetayantunelargeurdedouzepixels(6foisdeux!!!),
puislemotifallantdetroisentroisetdelargeur18pixels(
6foistrois),etainsidesuite...
Voil…doncleprincipeduscrolldiff‚rentieldemotifs,le
nombredeplansscrollantspeutˆtreainsiquelconque.

>>>INSERERLISTING"DIFST.LST"<<<

THEEND

Ilesth‚lasl'heuredenousquitter.Ned‚sesperezpas,carnous
nousretrouveronsdansquelquessemainespourunenouvelle
applicationdesscrollings:lesscrolltexts,aprŠsavoirexpliqu‚
lesproblŠmesrelatifsauxscrollingshorizontaux.D'icil…,nous
restonsouverts…vosremarquesetsuggestionssurleboulversant
3615STMAGenbalSECTORONEouDZC.

